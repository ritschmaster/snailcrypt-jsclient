/*
 * ! OpenUI5
 * (c) Copyright 2009-2022 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["./BasePanel","sap/m/Label","sap/m/ColumnListItem","sap/m/HBox","sap/m/VBox","sap/ui/core/library","sap/ui/core/Icon","sap/m/Text","sap/m/Column","sap/m/Table","sap/m/library","sap/m/ToolbarSpacer","sap/m/Button","sap/m/OverflowToolbar","sap/ui/model/Filter","sap/base/util/merge","sap/ui/core/InvisibleText"],function(B,L,C,H,V,c,I,T,a,b,l,d,e,O,F,m,f){"use strict";var g=c.IconColor;var h=l.ListKeyboardMode;var i=l.FlexJustifyContent;var j=l.ListType;var S=B.extend("sap.m.p13n.SelectionPanel",{metadata:{library:"sap.m",properties:{showHeader:{type:"boolean",defaultValue:false},enableCount:{type:"boolean",defaultValue:false},fieldColumn:{type:"string",defaultValue:sap.ui.getCore().getLibraryResourceBundle("sap.m").getText("p13n.DEFAULT_DESCRIPTION")},activeColumn:{type:"string",defaultValue:""},itemFactory:{type:"function"}}},renderer:{apiVersion:2}});S.prototype.applySettings=function(){B.prototype.applySettings.apply(this,arguments);this._setTemplate(this._getListTemplate());this.addStyleClass("sapMSelectionPanel");this._aInitializedFields=[];this._bShowFactory=false;this.addStyleClass("SelectionPanelHover");this._displayColumns();this.setEnableReorder(true);};S.prototype.setItemFactory=function(k){this.setProperty("itemFactory",k);this._oListControl.setGrowing(!!k);return this;};S.prototype._getListTemplate=function(){return new C({selected:"{"+this.P13N_MODEL+">"+this.PRESENCE_ATTRIBUTE+"}",type:j.Active,cells:[new V({items:[new L({wrapping:true,required:"{"+this.P13N_MODEL+">required}",tooltip:"{"+this.P13N_MODEL+">tooltip}",text:"{"+this.P13N_MODEL+">label}"})]}),new H({justifyContent:i.Center,items:[new I({src:"sap-icon://circle-task-2",size:"0.5rem",color:g.Neutral,visible:{path:this.P13N_MODEL+">active",formatter:function(k){if(k){return true;}else{return false;}}}}),new f({text:{path:this.P13N_MODEL+">active",formatter:function(k){return k?this._getResourceText("p13n.ACTIVESTATE_ACTIVE"):this._getResourceText("p13n.ACTIVESTATE_INACTIVE");}.bind(this)}})]})]});};S.prototype.setShowHeader=function(s){if(s){var k=this._getResourceText("p13n.SHOW_SELECTED");var n=this._getResourceText("p13n.SHOW_ALL");this._oListControl.setHeaderToolbar(new O({content:[this._getSearchField(),new d(),new e({press:function(E){this._bShowSelected=E.getSource().getText()==k;this._filterList(this._bShowSelected,this._sSearch);E.getSource().setText(this._bShowSelected?n:k);}.bind(this),text:k})]}));}this.setProperty("showHeader",s);return this;};S.prototype.getSelectedFields=function(){var s=[];this._loopItems(this._oListControl,function(o,k){if(o.getSelected()){s.push(k);}});return s;};S.prototype._filterList=function(s,k){var o=[],n=[];if(s){n=new F(this.PRESENCE_ATTRIBUTE,"EQ",true);}if(k){o=new F("label","Contains",k);}this._oListControl.getBinding("items").filter(new F([].concat(n,o),true));};S.prototype._onSearchFieldLiveChange=function(E){this._sSearch=E.getSource().getValue();this._filterList(this._bShowSelected,this._sSearch);};S.prototype._handleActivated=function(o){this._removeMoveButtons();if(this._oHoveredItem&&this._oHoveredItem.getBindingContextPath()){var v=!!this._getP13nModel().getProperty(this._oHoveredItem.getBindingContextPath()).active;var k=this._oHoveredItem.getCells()[1].getItems()[0];k.setVisible(v);}var n=o.getCells()[1].getItems()[0];n.setVisible(false);this._oHoveredItem=o;this._updateEnableOfMoveButtons(o,false);this._addMoveButtons(o);};S.prototype._removeMoveButtons=function(){var M=this._getMoveButtonContainer();if(M){M.removeItem(this._getMoveTopButton());M.removeItem(this._getMoveUpButton());M.removeItem(this._getMoveDownButton());M.removeItem(this._getMoveBottomButton());}};S.prototype._getMoveButtonContainer=function(){if(this._oMoveBottomButton&&this._oMoveBottomButton.getParent()&&this._oMoveBottomButton.getParent().isA("sap.m.FlexBox")){return this._oMoveBottomButton.getParent();}};S.prototype.showFactory=function(s){this._bShowFactory=s;this._displayColumns();if(s){this.removeStyleClass("SelectionPanelHover");this._oListControl.setKeyboardMode(h.Edit);this._addFactoryControl();}else{this.addStyleClass("SelectionPanelHover");this._oListControl.setKeyboardMode(h.Navigation);this._removeFactoryControl();}};S.prototype._loopItems=function(o,k){o.getItems().forEach(function(n){var p=n.getBindingContextPath();var K=this._getP13nModel().getProperty(p).name;k.call(this,n,K);}.bind(this));};S.prototype.setP13nData=function(p){if(this.getEnableCount()){p=m([],p);this._oListControl.removeSelections();}B.prototype.setP13nData.call(this,p);this._updateCount();this._removeMoveButtons();this._oSelectedItem=null;};S.prototype._updateCount=function(){this._getP13nModel().setProperty("/selectedItems",this._oListControl.getSelectedContexts(true).length);};S.prototype._selectTableItem=function(t,s){B.prototype._selectTableItem.apply(this,arguments);this._updateCount();};S.prototype._removeFactoryControl=function(){this._oListControl.getItems().forEach(function(o){var k=o.getCells()[0];if(k.getItems().length>1){k.removeItem(k.getItems()[1]);}});this.removeStyleClass("sapUiMDCAFLabelMarkingList");return this._aInitializedFields;};S.prototype._moveSelectedItem=function(){this._oSelectedItem=this._getMoveButtonContainer().getParent();B.prototype._moveSelectedItem.apply(this,arguments);};S.prototype._getShowFactory=function(){return this._bShowFactory;};S.prototype._displayColumns=function(){var k=[this.getFieldColumn()];if(!this._bShowFactory){k.push(new a({width:"30%",hAlign:"Center",vAlign:"Middle",header:new T({text:this.getActiveColumn()})}));}this._setPanelColumns(k);};S.prototype._setPanelColumns=function(k){this._sText=k[0];var E=this.getEnableCount();if(E){var o=new a({header:new T({text:{parts:[{path:this.P13N_MODEL+'>/selectedItems'},{path:this.P13N_MODEL+'>/items'}],formatter:function(s,A){return this._sText+" "+this._getResourceText('p13n.HEADER_COUNT',[s,A instanceof Array?A.length:0]);}.bind(this)}})});k[0]=o;}B.prototype._setPanelColumns.apply(this,arguments);};S.prototype._addFactoryControl=function(o){this._oListControl.getItems().forEach(function(k){var n=k.getBindingContext(this.P13N_MODEL);var p=this.getItemFactory().call(this,n);var q=k.getCells()[0];var r=q.getItems()[0];if(r){r.setLabelFor(p);}q.addItem(p);}.bind(this));this.addStyleClass("sapUiMDCAFLabelMarkingList");};S.prototype._createInnerListControl=function(){return new b(this.getId()+"-innerSelectionPanelTable",Object.assign({growing:false,growingThreshold:25,growingScrollToLoad:true,updateStarted:function(){this._removeMoveButtons();this._removeFactoryControl();}.bind(this),updateFinished:function(){if(this._getShowFactory()){this._addFactoryControl();}}.bind(this)},this._getListControlConfig()));};S.prototype.filterContent=function(k){if(this._oListControl.getBinding("items")){this._oListControl.getBinding("items").filter(k,true);}};S.prototype._addMoveButtons=function(o){var t=o;if(!t){return;}var k=this._getP13nModel().getProperty(t.getBindingContextPath())[this.PRESENCE_ATTRIBUTE];if(k){t.getCells()[1].addItem(this._getMoveTopButton());t.getCells()[1].addItem(this._getMoveUpButton());t.getCells()[1].addItem(this._getMoveDownButton());t.getCells()[1].addItem(this._getMoveBottomButton());}};S.prototype.exit=function(){B.prototype.exit.apply(this,arguments);this._aInitializedFields=null;this._oHoveredItem=null;this._bShowFactory=null;this._sSearch=null;this._bShowSelected=null;};return S;});
