/*!
 * OpenUI5
 * (c) Copyright 2009-2022 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["./PluginBase","sap/ui/core/Core","sap/ui/core/util/PasteHelper"],function(P,C,a){"use strict";var b=P.extend("sap.m.plugins.PasteProvider",{metadata:{library:"sap.m",associations:{pasteFor:{type:"sap.ui.core.Control",multiple:false}},events:{paste:{allowPreventDefault:true,parameters:{data:{type:"string[][]"},text:{type:"string"}}}}}});var p=null;var A=null;var s="[data-sap-ui-pasteregion]";b.prototype.onActivate=function(o){o.attachEvent(this.getConfig("pressEvent"),this._onPress,this);};b.prototype.onDeactivate=function(o){o.detachEvent(this.getConfig("pressEvent"),this._onPress,this);};b.prototype._onPress=function(){if(p){p.close();}A=this;var o=navigator.clipboard;if(o&&o.readText){o.readText().then(function(d){f(d);A=null;},c);}else{c();}};function f(e){var d=a.getClipboardText(e);if(!d){return;}var E={text:d};Object.defineProperty(E,"data",{get:a.getPastedDataAs2DArray.bind(a,d)});if(!A.firePaste(E)){return;}var o=g();if(!o){return;}var h=new ClipboardEvent("paste",{clipboardData:new DataTransfer(),bubbles:true});h.clipboardData.setData("text",d);o.dispatchEvent(h);}function g(){var o=C.byId(A.getPasteFor());var d=o&&o.getDomRef();if(!d){return;}if(d.matches(s)){return d;}else{return d.querySelector(s)||d;}}function t(S){var o=g();o&&o.classList.toggle("sapMPluginsPasteProviderHighlight",S);}function c(){var o=A.getControl();if(p){return p.openBy(o);}sap.ui.require(["sap/ui/Device","sap/ui/core/HTML","sap/ui/core/Icon","sap/m/Popover"],function(D,H,I,d){var m,r=C.getLibraryResourceBundle("sap.m");var e=D.system.desktop&&!D.os.ios&&!D.os.android;if(e){var S=r.getText("PASTEPROVIDER_SHORTCUT_"+(D.os.name=="mac"?"MAC":"WIN"));m=r.getText("PASTEPROVIDER_DESKTOP_MSG",'<span class="sapMPluginsPasteProviderShortCut">'+S+'</span>');}else{m=r.getText("PASTEPROVIDER_MOBILE_MSG");}var h=new H({content:'<div contenteditable="true" class="sapMPluginsPasteProviderMessage">'+m+'</div>',preferDOM:false});p=new d({title:r.getText("PASTEPROVIDER_TITLE"),showArrow:e,horizontalScrolling:false,verticalScrolling:false,placement:"Auto",content:h,initialFocus:h.getId(),beginButton:new I({src:"sap-icon://message-information"}),beforeOpen:function(){t(true);},beforeClose:function(){t(false);A=null;}});p.addEventDelegate({onpaste:function(E){E.preventDefault();f(E.originalEvent);p.close();},onkeypress:function(E){E.preventDefault();}});p.openBy(o);});}P.setConfigs({"sap.m.Button":{pressEvent:"press",onActivate:function(B){if(!B.getText()&&!B.getIcon()&&!B.getTooltip_AsString()){B.setTooltip(C.getLibraryResourceBundle("sap.m").getText("PASTEPROVIDER_PASTE"));B.setIcon("sap-icon://paste");}}}},b);return b;});
