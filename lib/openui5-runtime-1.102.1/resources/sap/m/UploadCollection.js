/*!
 * OpenUI5
 * (c) Copyright 2009-2022 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["./library","sap/m/library","sap/m/MessageBox","sap/m/Dialog","sap/ui/core/Control","sap/ui/core/Icon","sap/ui/core/IconPool","sap/m/Image","sap/m/Text","sap/m/Title","sap/m/Button","sap/m/List","sap/m/BusyIndicator","sap/m/StandardListItem","sap/ui/unified/FileUploaderParameter","sap/ui/unified/FileUploader","sap/ui/core/format/FileSizeFormat","sap/m/OverflowToolbar","sap/m/ToolbarSpacer","sap/m/ObjectAttribute","sap/m/UploadCollectionItem","sap/m/UploadCollectionParameter","sap/m/UploadCollectionToolbarPlaceholder","sap/ui/core/HTML","sap/ui/core/InvisibleText","sap/m/CustomListItem","sap/ui/core/ResizeHandler","sap/ui/Device","./UploadCollectionRenderer","sap/ui/thirdparty/jquery","sap/ui/events/KeyCodes","sap/base/Log","sap/ui/dom/jquery/selectText"],function(L,M,a,D,C,I,b,c,T,d,B,f,g,S,F,h,k,O,l,m,U,n,o,H,p,q,R,r,s,Q,K,t){"use strict";var u=C.extend("sap.m.UploadCollection",{constructor:function(i,j){var v;if(j&&j.instantUpload!==undefined){if(j.instantUpload===false){v=j.instantUpload;}delete j.instantUpload;}else if(i&&i.instantUpload!==undefined){if(i.instantUpload===false){v=i.instantUpload;}delete i.instantUpload;}if(j&&j.mode===L.ListMode.MultiSelect&&v===false){j.mode=L.ListMode.None;t.info("sap.m.ListMode.MultiSelect is not supported by UploadCollection for Upload Pending scenario. Value has been resetted to 'None'");}else if(i&&i.mode===L.ListMode.MultiSelect&&v===false){i.mode=L.ListMode.None;t.info("sap.m.ListMode.MultiSelect is not supported by UploadCollection for Upload Pending scenario. Value has been resetted to 'None'");}try{C.apply(this,arguments);if(v===false){this.bInstantUpload=v;this._oFormatDecimal=k.getInstance({binaryFilesize:true,maxFractionDigits:1,maxIntegerDigits:4});}}catch(e){this.destroy();throw e;}},metadata:{library:"sap.m",properties:{fileType:{type:"string[]",group:"Data",defaultValue:null},maximumFilenameLength:{type:"int",group:"Data",defaultValue:null},maximumFileSize:{type:"float",group:"Data",defaultValue:null},mimeType:{type:"string[]",group:"Data",defaultValue:null},multiple:{type:"boolean",group:"Behavior",defaultValue:false},noDataText:{type:"string",group:"Appearance",defaultValue:null},noDataDescription:{type:"string",group:"Appearance",defaultValue:null},sameFilenameAllowed:{type:"boolean",group:"Behavior",defaultValue:false},showSeparators:{type:"sap.m.ListSeparators",group:"Appearance",defaultValue:"All"},uploadEnabled:{type:"boolean",group:"Behavior",defaultValue:true},uploadUrl:{type:"string",group:"Data",defaultValue:"../../../upload"},instantUpload:{type:"boolean",group:"Behavior",defaultValue:true},numberOfAttachmentsText:{type:"string",group:"Appearance",defaultValue:null},mode:{type:"sap.m.ListMode",group:"Behavior",defaultValue:"None"},uploadButtonInvisible:{type:"boolean",group:"Appearance",defaultValue:false},terminationEnabled:{type:"boolean",group:"Behavior",defaultValue:true}},defaultAggregation:"items",aggregations:{items:{type:"sap.m.UploadCollectionItem",multiple:true,singularName:"item",bindable:"bindable"},headerParameters:{type:"sap.m.UploadCollectionParameter",multiple:true,singularName:"headerParameter"},parameters:{type:"sap.m.UploadCollectionParameter",multiple:true,singularName:"parameter"},toolbar:{type:"sap.m.OverflowToolbar",multiple:false},infoToolbar:{type:"sap.m.Toolbar",multiple:false,forwarding:{idSuffix:"-list",aggregation:"infoToolbar"}},_list:{type:"sap.m.List",multiple:false,visibility:"hidden"},_noDataIcon:{type:"sap.ui.core.Icon",multiple:false,visibility:"hidden"},_dragDropIcon:{type:"sap.ui.core.Icon",multiple:false,visibility:"hidden"},_dragDropText:{type:"sap.m.Text",multiple:false,visibility:"hidden"}},events:{change:{parameters:{documentId:{type:"string"},files:{type:"object[]"}}},fileDeleted:{parameters:{documentId:{type:"string"},item:{type:"sap.m.UploadCollectionItem"}}},filenameLengthExceed:{parameters:{documentId:{type:"string"},files:{type:"object[]"}}},fileRenamed:{parameters:{documentId:{type:"string"},fileName:{type:"string"},item:{type:"sap.m.UploadCollectionItem"}}},fileSizeExceed:{parameters:{documentId:{type:"string"},fileSize:{type:"string"},files:{type:"object[]"}}},typeMissmatch:{parameters:{documentId:{type:"string"},fileType:{type:"string"},mimeType:{type:"string"},files:{type:"object[]"}}},uploadComplete:{parameters:{readyStateXHR:{type:"string"},response:{type:"string"},status:{type:"string"},files:{type:"object[]"}}},uploadTerminated:{parameters:{fileName:{type:"string"},getHeaderParameter:{type:"function",parameters:{headerParameterName:{type:"string"}}}}},beforeUploadStarts:{parameters:{fileName:{type:"string"},addHeaderParameter:{type:"function",parameters:{headerParameter:{type:"sap.m.UploadCollectionParameter"}}},getHeaderParameter:{type:"function",parameters:{headerParameterName:{type:"string"}}}}},selectionChange:{parameters:{selectedItem:{type:"sap.m.UploadCollectionItem"},selectedItems:{type:"sap.m.UploadCollectionItem[]"},selected:{type:"boolean"}}}}}});u._uploadingStatus="uploading";u._displayStatus="display";u._toBeDeletedStatus="toBeDeleted";u._pendingUploadStatus="pendingUploadStatus";u._placeholderCamera="sap-icon://card";u._markerMargin=8;if(r.system.phone){u._resizeTimeoutInterval=500;}else{u._resizeTimeoutInterval=100;}u.prototype.init=function(){u.prototype._oRb=sap.ui.getCore().getLibraryResourceBundle("sap.m");this._headerParamConst={requestIdName:"requestId"+Q.now(),fileNameRequestIdName:"fileNameRequestId"+Q.now(),acceptLanguage:"accept-language"};this._requestIdValue=0;this._iFUCounter=0;var N=this.getNoDataText()+" "+this.getNoDataDescription();this._oList=new f(this.getId()+"-list",{selectionChange:[this._handleSelectionChange,this],noDataText:N});this.setAggregation("_list",this._oList,true);this._oList.addStyleClass("sapMUCList");this.setAggregation("_noDataIcon",new I(this.getId()+"-no-data-icon",{src:"sap-icon://document",size:"6rem",noTabStop:true}),true);this.setAggregation("_dragDropIcon",new I(this.getId()+"-drag-drop-icon",{src:"sap-icon://upload-to-cloud",size:"4rem",noTabStop:true}),true);this.setAggregation("_dragDropText",new T(this.getId()+"-drag-drop-text",{text:this._oRb.getText("UPLOADCOLLECTION_DRAG_FILE_INDICATOR")}),true);this._iUploadStartCallCounter=0;this.aItems=[];this._aDeletedItemForPendingUpload=[];this._aFileUploadersForPendingUpload=[];this._aFilesFromDragAndDropForPendingUpload=[];this._iFileUploaderPH=null;this._oListEventDelegate=null;this._oItemToUpdate=null;this._sReziseHandlerId=null;this.oInvisibleText=new p().toStatic();};u.prototype.setFileType=function(e){if(!e){return this;}if(!this.getInstantUpload()){t.info("As property instantUpload is false it is not allowed to change fileType at runtime.");}else{var j=e.length;for(var i=0;i<j;i++){e[i]=e[i].toLowerCase();}if(this.getFileType()!==e){this.setProperty("fileType",e,true);this._getFileUploader().setFileType(e);}}return this;};u.prototype.setMaximumFilenameLength=function(i){if(!this.getInstantUpload()){t.info("As property instantUpload is false it is not allowed to change maximumFilenameLength at runtime.");}else if(this.getMaximumFilenameLength()!==i){this.setProperty("maximumFilenameLength",i,true);this._getFileUploader().setMaximumFilenameLength(i);}return this;};u.prototype.setMaximumFileSize=function(i){if(!this.getInstantUpload()){t.info("As property instantUpload is false it is not allowed to change maximumFileSize at runtime.");}else if(this.getMaximumFileSize()!==i){this.setProperty("maximumFileSize",i,true);this._getFileUploader().setMaximumFileSize(i);}return this;};u.prototype.setMimeType=function(e){if(!this.getInstantUpload()){t.info("As property instantUpload is false it is not allowed to change mimeType at runtime.");}else if(this.getMimeType()!==e){this.setProperty("mimeType",e,true);this._getFileUploader().setMimeType(e);}return this;};u.prototype.setMultiple=function(e){if(!this.getInstantUpload()){t.info("As property instantUpload is false it is not allowed to change multiple at runtime.");}else if(this.getMultiple()!==e){this.setProperty("multiple",e);this._getFileUploader().setMultiple(e);}return this;};u.prototype.setShowSeparators=function(e){if(this.getShowSeparators()!==e){this.setProperty("showSeparators",e);this._oList.setShowSeparators(e);}return this;};u.prototype.setUploadEnabled=function(e){if(!this.getInstantUpload()){t.info("As property instantUpload is false it is not allowed to change uploadEnabled at runtime.");}else if(this.getUploadEnabled()!==e){this.setProperty("uploadEnabled",e);this._getFileUploader().setEnabled(e);}return this;};u.prototype.setUploadUrl=function(e){if(!this.getInstantUpload()){t.info("As property instantUpload is false it is not allowed to change uploadUrl at runtime.");}else if(this.getUploadUrl()!==e){this.setProperty("uploadUrl",e);this._getFileUploader().setUploadUrl(e);}return this;};u.prototype.setInstantUpload=function(){t.error("It is not supported to change the behavior at runtime.");return this;};u.prototype.setMode=function(e){if(e===L.ListMode.Delete){this._oList.setMode(L.ListMode.None);t.info("sap.m.ListMode.Delete is not supported by UploadCollection. Value has been resetted to 'None'");}else if(e===L.ListMode.MultiSelect&&!this.getInstantUpload()){this._oList.setMode(L.ListMode.None);t.info("sap.m.ListMode.MultiSelect is not supported by UploadCollection for Pending Upload. Value has been resetted to 'None'");}else{this._oList.setMode(e);}return this;};u.prototype.getMode=function(){return this._oList.getMode();};u.prototype.getToolbar=function(){return this._oHeaderToolbar;};u.prototype.getNoDataText=function(){var N=this.getProperty("noDataText");N=N||this._oRb.getText("UPLOADCOLLECTION_NO_DATA_TEXT");return N;};u.prototype.getNoDataDescription=function(){var N=this.getProperty("noDataDescription");N=N||this._oRb.getText("UPLOADCOLLECTION_NO_DATA_DESCRIPTION");return N;};u.prototype.setNoDataText=function(N){this.setProperty("noDataText",N,true);this.$().find("#"+this.getId()+"-no-data-text").text(N);var e=N+" "+this.getNoDataDescription();this._oList.setNoDataText(e);return this;};u.prototype.setNoDataDescription=function(N){this.setProperty("noDataDescription",N,true);var e=this.getNoDataText()+" "+N;this._oList.setNoDataText(e);if(this.getUploadEnabled()&&this._oList.getItems().length==0){this.rerender();}return this;};u.prototype.setUploadButtonInvisible=function(e){if(this.getUploadButtonInvisible()===e){return this;}this.setProperty("uploadButtonInvisible",e,true);if(this.getInstantUpload()){this._getFileUploader().setVisible(!e);}else{this._setFileUploaderVisibility(e);}if(this._bDragDropEnabled){this._unbindDragEnterLeave();this._bDragDropEnabled=false;}else{this._bindDragEnterLeave();}return this;};u.prototype.getInternalRequestHeaderNames=function(){return[this._headerParamConst.fileNameRequestIdName,this._headerParamConst.requestIdName];};u.prototype.upload=function(){if(this.getInstantUpload()){t.error("Not a valid API call. 'instantUpload' should be set to 'false'.");}var e=this._aFileUploadersForPendingUpload.length;for(var i=0;i<e;i++){this._iUploadStartCallCounter=0;if(this._aFileUploadersForPendingUpload[i].getValue()){this._aFileUploadersForPendingUpload[i].upload();}}if(this._aFilesFromDragAndDropForPendingUpload.length>0){this._oFileUploader._sendFilesFromDragAndDrop(this._aFilesFromDragAndDropForPendingUpload);this._aFilesFromDragAndDropForPendingUpload=[];}};u.prototype.getSelectedItems=function(){var e=this._oList.getSelectedItems();return this._getUploadCollectionItemsByListItems(e);};u.prototype.getSelectedItem=function(){var e=this._oList.getSelectedItem();if(e){return this._getUploadCollectionItemByListItem(e);}return null;};u.prototype.setSelectedItemById=function(i,e){this._oList.setSelectedItemById(i+"-cli",e);this._setSelectedForItems([this._getUploadCollectionItemById(i)],e);return this;};u.prototype.setSelectedItem=function(e,i){return this.setSelectedItemById(e.getId(),i);};u.prototype.selectAll=function(){var e=this._oList.selectAll();if(e.getItems().length!==this.getItems().length){t.info("Internal 'List' and external 'UploadCollection' are not in sync.");}this._setSelectedForItems(this.getItems(),true);return this;};u.prototype.downloadItem=function(e,i){if(!this.getInstantUpload()){t.info("Download is not possible on Pending Upload mode");return false;}else{return e.download(i);}};u.prototype.openFileDialog=function(i){if(this._oFileUploader){if(i){if(!this._oFileUploader.getMultiple()){this._oItemToUpdate=i;this._oFileUploader.$().find("input[type=file]").trigger("click");}else{t.warning("Version Upload cannot be used in multiple upload mode");}}else{this._oFileUploader.$().find("input[type=file]").trigger("click");}}return this;};u.prototype.removeAggregation=function(A,v,e){var i,j,w;if(!this.getInstantUpload()&&A==="items"&&v){i=v._internalFileIdWithinDragDropArray;if(i){j=this._aFilesFromDragAndDropForPendingUpload.indexOf(i);if(j!==-1){this._aFilesFromDragAndDropForPendingUpload.splice(j,1);}}else if(typeof v==="number"){w=this.getItems();this._aDeletedItemForPendingUpload.push(w[v]);}else{this._aDeletedItemForPendingUpload.push(v);}}return C.prototype.removeAggregation.apply(this,arguments);};u.prototype.removeAllAggregation=function(A,e){if(!this.getInstantUpload()&&A==="items"){if(this._aFileUploadersForPendingUpload){for(var i=0;i<this._aFileUploadersForPendingUpload.length;i++){this._aFileUploadersForPendingUpload[i].destroy();this._aFileUploadersForPendingUpload[i]=null;}this._aFileUploadersForPendingUpload=[];}}return C.prototype.removeAllAggregation.apply(this,arguments);};u.prototype.onBeforeRendering=function(){this._RenderManager=this._RenderManager||sap.ui.getCore().createRenderManager();var i,e;if(this._oListEventDelegate){this._oList.removeEventDelegate(this._oListEventDelegate);this._oListEventDelegate=null;}this._deregisterSizeHandler();this._unbindDragEnterLeave();v.bind(this)();if(!this.getInstantUpload()){this.aItems=this.getItems();this._getListHeader(this.aItems.length);this._clearList();this._fillList(this.aItems);this._oList.setHeaderToolbar(this._oHeaderToolbar);return;}if(this.aItems.length>0){e=this.aItems.length;var j=[];for(i=0;i<e;i++){if(this.aItems[i]&&this.aItems[i]._status===u._uploadingStatus){j.push(this.aItems[i]);}else if(this.aItems[i]&&this.aItems[i]._status!==u._uploadingStatus&&this.aItems[i]._percentUploaded===100&&this.getItems().length===0){j.push(this.aItems[i]);}}if(j.length!==0){this.aItems=[];this.aItems=this.getItems();this.aItems=j.concat(this.aItems);}else{this.aItems=this.getItems();}}else{this.aItems=this.getItems();}this._getListHeader(this.aItems.length);this._clearList();this._fillList(this.aItems);this._oList.setAggregation("headerToolbar",this._oHeaderToolbar,true);if(this.sErrorState!=="Error"){if(this.getUploadEnabled()!==this._oFileUploader.getEnabled()){this._oFileUploader.setEnabled(this.getUploadEnabled());}}else{this._oFileUploader.setEnabled(false);}if(this.sDeletedItemId){Q(document.activeElement).trigger("blur");}function v(){if(this.bInstantUpload===false){this.setProperty("instantUpload",this.bInstantUpload,true);delete this.bInstantUpload;}}};u.prototype.onAfterRendering=function(){this._bindDragEnterLeave();if(this.getInstantUpload()){if(this.aItems||(this.aItems===this.getItems())){if(this.editModeItem){var $=Q(document.getElementById(this.editModeItem+"-ta_editFileName-inner"));if($){var i=this.editModeItem;if(!r.os.ios){$.on("focus",function(){$.selectText(0,$.val().length);});}$.trigger("focus");this.oInvisibleText.setText("");sap.ui.getCore().byId(this.editModeItem+"-cli").removeAllAriaLabelledBy();sap.ui.getCore().byId(this.editModeItem+"-cli").addAriaLabelledBy(this.oInvisibleText.getId());this._oListEventDelegate={onclick:function(e){this._handleClick(e,i);}.bind(this)};this._oList.addDelegate(this._oListEventDelegate);}}else if(this.sFocusId){this._setFocusToLineItem(this.sFocusId);this.sFocusId=null;}else if(this.sDeletedItemId){this._setFocusAfterDeletion();}}}else if(this.sFocusId){this._setFocusToLineItem(this.sFocusId);this.sFocusId=null;}};u.prototype.exit=function(){var i,P,e;this._unbindDragEnterLeave();if(this._$RootNode){this._$RootNode=null;}if(this._oFileUploader){this._oFileUploader.destroy();this._oFileUploader=null;}if(this._oHeaderToolbar){this._oHeaderToolbar.destroy();this._oHeaderToolbar=null;}if(this._oNumberOfAttachmentsTitle){this._oNumberOfAttachmentsTitle.destroy();this._oNumberOfAttachmentsTitle=null;}if(this._RenderManager){this._RenderManager.destroy();}if(this._aFileUploadersForPendingUpload){P=this._aFileUploadersForPendingUpload.length;for(i=0;i<P;i++){this._aFileUploadersForPendingUpload[i].destroy();this._aFileUploadersForPendingUpload[i]=null;}this._aFileUploadersForPendingUpload=null;}if(this.aItems&&this.aItems.length>0){for(i=0;i<this.aItems.length;i++){if(this.aItems[i]._status===u._uploadingStatus){e=this.aItems.splice(i,1)[0];if(e.destroy){e.destroy();}}}}this._deregisterSizeHandler();if(this.oInvisibleText){this.oInvisibleText.destroy();}};u.prototype._bindDragEnterLeave=function(){this._bDragDropEnabled=this._isDragAndDropAllowed();if(!this._bDragDropEnabled){return;}if(!this._oDragDropHandler){this._oDragDropHandler={dragEnterUIArea:this._onDragEnterUIArea.bind(this),dragLeaveUIArea:this._onDragLeaveUIArea.bind(this),dragOverUIArea:this._onDragOverUIArea.bind(this),dropOnUIArea:this._onDropOnUIArea.bind(this),dragEnterUploadCollection:this._onDragEnterUploadCollection.bind(this),dragLeaveUploadCollection:this._onDragLeaveUploadCollection.bind(this),dragOverUploadCollection:this._onDragOverUploadCollection.bind(this),dropOnUploadCollection:this._onDropOnUploadCollection.bind(this)};}this._$RootNode=Q(document.body);this._$RootNode.on("dragenter",this._oDragDropHandler.dragEnterUIArea);this._$RootNode.on("dragleave",this._oDragDropHandler.dragLeaveUIArea);this._$RootNode.on("dragover",this._oDragDropHandler.dragOverUIArea);this._$RootNode.on("drop",this._oDragDropHandler.dropOnUIArea);this._$DragDropArea=this.$("drag-drop-area");this.$().on("dragenter",this._oDragDropHandler.dragEnterUploadCollection);this.$().on("dragleave",this._oDragDropHandler.dragLeaveUploadCollection);this.$().on("dragover",this._oDragDropHandler.dragOverUploadCollection);this.$().on("drop",this._oDragDropHandler.dropOnUploadCollection);};u.prototype._unbindDragEnterLeave=function(){if(!this._bDragDropEnabled&&!this._oDragDropHandler){return;}if(this._$RootNode){this._$RootNode.off("dragenter",this._oDragDropHandler.dragEnterUIArea);this._$RootNode.off("dragleave",this._oDragDropHandler.dragLeaveUIArea);this._$RootNode.off("dragover",this._oDragDropHandler.dragOverUIArea);this._$RootNode.off("drop",this._oDragDropHandler.dropOnUIArea);}this.$().off("dragenter",this._oDragDropHandler.dragEnterUploadCollection);this.$().off("dragleave",this._oDragDropHandler.dragLeaveUploadCollection);this.$().off("dragover",this._oDragDropHandler.dragOverUploadCollection);this.$().off("drop",this._oDragDropHandler.dropOnUploadCollection);};u.prototype._onDragEnterUIArea=function(e){if(!this._checkForFiles(e)){return;}this._oLastEnterUIArea=e.target;this._$DragDropArea.removeClass("sapMUCDragDropOverlayHide");this._adjustDragDropIcon();};u.prototype._onDragOverUIArea=function(e){e.preventDefault();if(!this._checkForFiles(e)){return;}this._$DragDropArea.removeClass("sapMUCDragDropOverlayHide");};u.prototype._onDragLeaveUIArea=function(e){if(this._oLastEnterUIArea===e.target){this._$DragDropArea.addClass("sapMUCDragDropOverlayHide");}};u.prototype._onDropOnUIArea=function(e){this._$DragDropArea.addClass("sapMUCDragDropOverlayHide");};u.prototype._onDragEnterUploadCollection=function(e){if(!this._checkForFiles(e)){return;}if(e.target===this._$DragDropArea[0]){this._$DragDropArea.addClass("sapMUCDropIndicator");this._adjustDragDropIcon();this.getAggregation("_dragDropText").setText(this._oRb.getText("UPLOADCOLLECTION_DROP_FILE_INDICATOR"));}};u.prototype._onDragOverUploadCollection=function(e){e.preventDefault();e.originalEvent.dataTransfer.dropEffect="copy";};u.prototype._onDragLeaveUploadCollection=function(e){if(e.target===this._$DragDropArea[0]){this._$DragDropArea.removeClass("sapMUCDropIndicator");this.getAggregation("_dragDropText").setText(this._oRb.getText("UPLOADCOLLECTION_DRAG_FILE_INDICATOR"));}};u.prototype._checkForFiles=function(e){var j=e.originalEvent.dataTransfer.types;if(j){for(var i=0;i<j.length;i++){if(j[i]==="Files"){return true;}}}return false;};u.prototype._isDragAndDropAllowed=function(){return this.getUploadEnabled()&&!this.getUploadButtonInvisible();};u.prototype._onDropOnUploadCollection=function(e){if(!this._checkForFiles(e)){e.preventDefault();return;}if(e.target===this._$DragDropArea[0]){e.preventDefault();this._$DragDropArea.removeClass("sapMUCDropIndicator");this._$DragDropArea.addClass("sapMUCDragDropOverlayHide");this.getAggregation("_dragDropText").setText(this._oRb.getText("UPLOADCOLLECTION_DRAG_FILE_INDICATOR"));var j=e.originalEvent.dataTransfer.files;if(j.length>1&&!this.getMultiple()){var v=this._oRb.getText("UPLOADCOLLECTION_MULTIPLE_FALSE");a.error(v);return;}if(!this._oFileUploader._areFilesAllowed(j)){return;}if(!this.getInstantUpload()){for(var i=0;i<j.length;i++){this._oFileUploader.fireChange({files:[j[i]],fromDragDrop:true});this._aFilesFromDragAndDropForPendingUpload.push(j[i]);}}else{this._oFileUploader.fireChange({files:j});this._oFileUploader._sendFilesFromDragAndDrop(j);}}};u.prototype._adjustDragDropIcon=function(){if(this._$DragDropArea[0].offsetHeight<160){this.getAggregation("_dragDropIcon").$().hide();}};u.prototype._deregisterSizeHandler=function(){r.orientation.detachHandler(this._onResize,this);R.deregister(this._sReziseHandlerId);};u.prototype._hideFileUploaders=function(){var e,i;if(!this.getInstantUpload()){e=this._oHeaderToolbar.getContent().length;if(this._aFileUploadersForPendingUpload.length){for(i=0;i<e;i++){if(this._oHeaderToolbar.getContent()[i]instanceof h){if(i===this._iFileUploaderPH&&this._bFocusFileUploader){this._oHeaderToolbar.getContent()[i].$().find("button").trigger("focus");}else{this._oHeaderToolbar.getContent()[i].$().hide();}}}}}};u.prototype._truncateFileName=function(e){if(!e){return;}if(e._status==="Edit"){e._oListItem.$().find(".sapMUCObjectMarkerContainer").attr("style","display: none");return;}var j=0;var v=e.getMarkers();var w;for(var i=0;i<v.length;i++){j=j+v[i].$().width()+u._markerMargin;}if(j>0){var $=e._oFileNameLink.$();if($){w="max-width: calc(100% - "+j+"px)";if($.attr("style")!==w){$.attr("style",w);}}}};u.prototype._getListHeader=function(e){var v,i,j;this._setNumberOfAttachmentsTitle(e);if(!this._oHeaderToolbar){if(this._oFileUploader&&!this.getInstantUpload()){this._oFileUploader.destroy();}v=this._getFileUploader();this._oHeaderToolbar=this.getAggregation("toolbar");if(!this._oHeaderToolbar){this._oHeaderToolbar=new O(this.getId()+"-toolbar",{content:[this._oNumberOfAttachmentsTitle,new l(),v]}).addEventDelegate({onAfterRendering:this._hideFileUploaders},this);this._iFileUploaderPH=2;}else{this._oHeaderToolbar.addEventDelegate({onAfterRendering:this._hideFileUploaders},this);this._iFileUploaderPH=this._getFileUploaderPlaceHolderPosition(this._oHeaderToolbar);if(this._oHeaderToolbar&&this._iFileUploaderPH>-1){this._setFileUploaderInToolbar(v);}else{t.info("A place holder of type 'sap.m.UploadCollectionPlaceholder' needs to be provided.");}}}else if(!this.getInstantUpload()){var P=this._aFileUploadersForPendingUpload.length;for(i=P-1;i>=0;i--){if(this._aFileUploadersForPendingUpload[i].getId()===this._oFileUploader.getId()){v=this._getFileUploader();var w=this.getAggregation("headerParameters");var x=this._requestIdValue.toString();if(w){for(j=0;j<w.length;j++){v.addHeaderParameter(new F({name:w[j].getProperty("name"),value:w[j].getProperty("value")}));}v.addHeaderParameter(new F({name:this._headerParamConst.requestIdName,value:x}));}this._oHeaderToolbar.insertAggregation("content",v,this._iFileUploaderPH,true);break;}}}};u.prototype._getFileUploaderPlaceHolderPosition=function(e){for(var i=0;i<e.getContent().length;i++){if(e.getContent()[i]instanceof o){return i;}}return-1;};u.prototype._setFileUploaderInToolbar=function(e){this._oHeaderToolbar.getContent()[this._iFileUploaderPH].setVisible(false);this._oHeaderToolbar.insertContent(e,this._iFileUploaderPH);};u.prototype._mapItemToListItem=function(i){if(!i||(this._oItemToUpdate&&i.getId()===this._oItemToUpdate.getId())){return null;}var e,j,v,w,x,y,$,z,A;e=i.getId();j=i._status;v=i.getFileName();if(j===u._uploadingStatus){w=new g({id:e+"-ia_indicator"});w.addStyleClass("sapMUCloadingIcon");}else{A=this._createIcon(i,e,v);}y=e+"-container";$=Q(document.getElementById(y));if($){$.remove();$=null;}z=new H(y,{content:"<span class='sapMUCTextButtonContainer'></span>",afterRendering:this._renderContent.bind(this,i,y)});x=new q(e+"-cli",{content:[w,A,z],selected:i.getSelected()});x._oUploadCollectionItem=i;x._status=j;x.addStyleClass("sapMUCItem");x.setTooltip(i.getTooltip_Text());i._oListItem=x;return x;};u.prototype._renderContent=function(e,v){var w,i,A,x,y,P,z,E,G,J,N;P=e._percentUploaded;z=e.getAllAttributes();E=e.getStatuses();N=e.getMarkers();w=e.getId();A=z.length;x=E.length;y=N.length;J=e._status;G=this._RenderManager;G.openStart("div");G.class("sapMUCTextContainer");if(J==="Edit"){G.class("sapMUCEditMode");}G.openEnd();G.renderControl(this._getFileNameControl(e));if(J===u._uploadingStatus){G.renderControl(this._createProgressLabel(e,P));}else{if(y>0){G.openStart("div");G.class("sapMUCObjectMarkerContainer");G.openEnd();for(i=0;i<y;i++){G.renderControl(N[i].addStyleClass("sapMUCObjectMarker"));}G.close("div");}if(A>0){G.openStart("div");G.class("sapMUCAttrContainer");G.attr("tabindex","-1");G.openEnd();for(i=0;i<A;i++){z[i].addStyleClass("sapMUCAttr");G.renderControl(z[i]);if((i+1)<A){G.openStart("div");G.class("sapMUCSeparator");G.openEnd();G.unsafeHtml("&nbsp&#x00B7&#160");G.close("div");}}G.close("div");}if(x>0){G.openStart("div");G.class("sapMUCStatusContainer");G.attr("tabindex","-1");G.openEnd();for(i=0;i<x;i++){E[i].detachBrowserEvent("hover");E[i].setTooltip(E[i].getTitle()+":"+E[i].getText());G.renderControl(E[i]);for(var j=i+1;j<x;j++){if(!E[i].getVisible()){break;}else if(E[j]&&E[j].getVisible()){G.openStart("div");G.class("sapMUCSeparator");G.openEnd();G.unsafeHtml("&nbsp&#x00B7&#160");G.close("div");break;}}}G.close("div");}}G.close("div");this._renderButtons(G,e,J,w);G.flush(Q(document.getElementById(v))[0],true);this._truncateFileName(e);this._sReziseHandlerId=R.register(this,this._onResize.bind(this));r.orientation.attachHandler(this._onResize,this);};u.prototype._renderButtons=function(e,j,v,w){var x,y;x=this._getButtons(j,v,w);if(x){y=x.length;}if(y>0){e.openStart("div");e.class("sapMUCButtonContainer");e.openEnd();for(var i=0;i<y;i++){if((i+1)<y){x[i].addStyleClass("sapMUCFirstButton");}e.renderControl(x[i]);}e.close("div");}};u.prototype._getFileNameControl=function(i){var e,j,v,w,x,y,z,V,A,E,G;w=i.getFileName();x=i.getId();y=i._status;if(y!=="Edit"){e=i._getFileNameLink?i._getFileNameLink():i._getControl("sap.m.Link",{id:x+"-ta_filenameHL",press:[i,this._onItemPressed,this]},"FileNameLink");e.setEnabled(this._getItemPressEnabled(i));e.addStyleClass("sapMUCFileName");e.setModel(i.getModel());e.setText(w);i._oFileNameLink=e;return e;}else{j=u._splitFilename(w);z=this.getMaximumFilenameLength();V="None";A=false;v=j.name;if(i.errorState==="Error"){A=true;V="Error";v=i.changedFileName;if(v.length===0){G=this._oRb.getText("UPLOADCOLLECTION_TYPE_FILENAME");}else{G=this._oRb.getText("UPLOADCOLLECTION_EXISTS");}}E=i._getFileNameEditBox?i._getFileNameEditBox():i._getControl("sap.m.Input",{id:x+"-ta_editFileName",type:L.InputType.Text},"FileNameEditBox");E.addStyleClass("sapMUCEditBox");E.setModel(i.getModel());E.setValue(v);E.setValueState(V);E.setFieldWidth("75%");E.setValueStateText(G);E.setDescription(j.extension);E.setShowValueStateMessage(A);if((z-j.extension.length)>0){E.setProperty("maxLength",z-j.extension.length,true);}return E;}};u.prototype._getItemPressEnabled=function(i){return i._getPressEnabled()&&this.sErrorState!=="Error";};u.prototype._onItemPressed=function(e,i){if(i.hasListeners("press")){i.firePress();}else if(this.sErrorState!=="Error"&&i._hasUrl()){this._triggerLink(e,i);}};u.prototype._createProgressLabel=function(i,e){var P,j=i.getId();P=i._getProgressLabel?i._getProgressLabel():i._getControl("sap.m.Label",{id:j+"-ta_progress"},"ProgressLabel").addStyleClass("sapMUCProgress");P.setText(this._oRb.getText("UPLOADCOLLECTION_UPLOADING",[e]));return P;};u.prototype._createIcon=function(i,e,j){var v,w,x,y;v=i.getThumbnailUrl();if(v){x=b.createControlByURI({id:e+"-ia_imageHL",src:this._getThumbnail(v,j),decorative:false},c).addStyleClass("sapMUCItemImage sapMUCItemIcon");x.setAlt(this._getAriaLabelForPicture(i));}else{w=this._getThumbnail(undefined,j);x=new I(e+"-ia_iconHL",{src:w,decorative:false,useIconTooltip:false});x.setAlt(this._getAriaLabelForPicture(i));if(this.sErrorState!=="Error"&&i._hasUrl()){y="sapMUCItemIcon";}else{y="sapMUCItemIconInactive";}if(w===u._placeholderCamera){if(this.sErrorState!=="Error"&&i._hasUrl()){y=y+" sapMUCItemPlaceholder";}else{y=y+" sapMUCItemPlaceholderInactive";}}x.addStyleClass(y);}if(this._getItemPressEnabled(i)){x.attachPress(i,this._onItemPressed,this);}return x;};u.prototype._getButtons=function(i,e,j){var v,w,x,y,z,E,A;v=[];if(!this.getInstantUpload()){y="deleteButton";z=this._createDeleteButton(j,y,i,this.sErrorState);v.push(z);return v;}if(e==="Edit"){w=i._getOkButton?i._getOkButton():i._getControl("sap.m.Button",{id:j+"-okButton",text:this._oRb.getText("UPLOADCOLLECTION_RENAMEBUTTON_TEXT"),type:L.ButtonType.Transparent},"OkButton").addStyleClass("sapMUCOkBtn");x=i._getCancelButton?i._getCancelButton():i._getControl("sap.m.Button",{id:j+"-cancelButton",text:this._oRb.getText("UPLOADCOLLECTION_CANCELBUTTON_TEXT"),type:L.ButtonType.Transparent},"CancelButton").addStyleClass("sapMUCCancelBtn");v.push(w);v.push(x);}else if(e===u._uploadingStatus){y="terminateButton";z=this._createDeleteButton(j,y,i,this.sErrorState);v.push(z);}else{E=i.getEnableEdit();if(this.sErrorState==="Error"){E=false;}if(i.getVisibleEdit()){A=i._getEditButton?i._getEditButton():i._getControl("sap.m.Button",{id:j+"-editButton",icon:"sap-icon://edit",type:L.ButtonType.Standard,tooltip:this._oRb.getText("UPLOADCOLLECTION_EDITBUTTON_TEXT"),press:[i,this._handleEdit,this]},"EditButton").addStyleClass("sapMUCEditBtn");A.setEnabled(E);A.setVisible(i.getVisibleEdit());v.push(A);}y="deleteButton";if(i.getVisibleDelete()){z=this._createDeleteButton(j,y,i,this.sErrorState);v.push(z);}}return v;};u.prototype._createDeleteButton=function(i,e,j,v){var E,w,G,x,y,V,P;E=j.getEnableDelete();if(v==="Error"){E=false;}if(e==="deleteButton"){G="DeleteButton";y=j._getDeleteButton;x=this._oRb.getText("UPLOADCOLLECTION_DELETEBUTTON_TEXT");V=j.getVisibleDelete();P=[this,this._handleDelete,this];}else{G="TerminateButton";y=j._getTerminateButton;x=this._oRb.getText("UPLOADCOLLECTION_TERMINATEBUTTON_TEXT");V=this.getTerminationEnabled();P=[j,this._handleTerminate,this];}w=y?y():j._getControl("sap.m.Button",{id:i+"-"+e,icon:"sap-icon://decline",type:L.ButtonType.Standard,press:P},G).addStyleClass("sapMUCDeleteBtn");w.setVisible(V);w.setEnabled(E);w.setTooltip(x);return w;};u.prototype._fillList=function(i){var e=this,j=i.length-1,v=this.getBinding("items"),G=false,w,x=this.getBindingInfo("items")?this.getBindingInfo("items").model:undefined,y=this.getBindingInfo("items")?this.getBindingInfo("items").groupHeaderFactory:null;var z=function(E){return E.getBindingContext(x)?v.getGroup(E.getBindingContext(x)):null;};var A=function(E){return z(E)&&z(E).key;};Q.each(i,function(E,J){if(v&&v.isGrouped()&&J){if(!G||w!==A(J)){if(y){e._oList.addItemGroup(z(J),y(z(J)),true);}else if(z(J)){e._oList.addItemGroup(z(J),null,true);}G=true;w=A(J);}}if(!J._status||!J.getVisibleEdit()){J._status=u._displayStatus;}else if(e.getInstantUpload()&&e._oItemForDelete&&e._oItemForDelete._status===u._toBeDeletedStatus&&J.getDocumentId()===e._oItemForDelete.documentId){return false;}if(!J._percentUploaded&&J._status===u._uploadingStatus){J._percentUploaded=0;}var N=e._mapItemToListItem(J);if(N){if(E===0&&j===0){N.addStyleClass("sapMUCListSingleItem");}else if(E===0){N.addStyleClass("sapMUCListFirstItem");}else if(E===j){N.addStyleClass("sapMUCListLastItem");}else{N.addStyleClass("sapMUCListItem");}e._oList.addAggregation("items",N,true);J.attachEvent("selected",e._handleItemSetSelected,e);}return true;});};u.prototype._clearList=function(){if(this._oList){this._oList.destroyAggregation("items",true);}};u.prototype._setNumberOfAttachmentsTitle=function(e){var i=e||0;var j;if(this._oItemToUpdate){i--;}if(this.getNumberOfAttachmentsText()){j=this.getNumberOfAttachmentsText();}else{j=this._oRb.getText("UPLOADCOLLECTION_ATTACHMENTS",[i]);}if(!this._oNumberOfAttachmentsTitle){this._oNumberOfAttachmentsTitle=new d(this.getId()+"-numberOfAttachmentsTitle",{text:j});}else{this._oNumberOfAttachmentsTitle.setText(j);}};u.prototype._setFileUploaderVisibility=function(e){var i=this._oHeaderToolbar.getContent();if(i){var P=i[this._iFileUploaderPH];if(P instanceof h){P.setVisible(!e);}}};u.prototype._handleDelete=function(e){var P=e.getParameters();var j=this.getItems();var v=P.id.split("-deleteButton")[0];var w;var x;var y="";var z;var A;for(var i=0;i<j.length;i++){if(j[i].sId===v){x=i;w={documentId:j[i].getDocumentId(),_iLineNumber:x};break;}}if(j[x].hasListeners("deletePress")){j[x].fireDeletePress();return;}this.sDeletedItemId=v;if(Q(document.getElementById(this.sId)).hasClass("sapUiSizeCompact")){y="sapUiSizeCompact";}if(this.editModeItem){this._handleOk(e,this.editModeItem,true);if(this.sErrorState==="Error"){return;}}if(j[x]&&j[x].getEnableDelete()){z=j[x].getFileName();if(!z){A=this._oRb.getText("UPLOADCOLLECTION_DELETE_WITHOUT_FILENAME_TEXT");}else{A=this._oRb.getText("UPLOADCOLLECTION_DELETE_TEXT",z);}this._oItemForDelete=w;a.show(A,{title:this._oRb.getText("UPLOADCOLLECTION_DELETE_TITLE"),actions:[a.Action.OK,a.Action.CANCEL],onClose:this._onCloseMessageBoxDeleteItem.bind(this),dialogId:"messageBoxDeleteFile",styleClass:y});}};u.prototype._onCloseMessageBoxDeleteItem=function(e){var j=this.getItems();var v;if(this.getInstantUpload()){for(var i=0;i<j.length;i++){if(j[i].getDocumentId()===this._oItemForDelete.documentId){v=j[i];}}}else{v=j[this._oItemForDelete._iLineNumber];}if(e===a.Action.OK){this._oItemForDelete._status=u._toBeDeletedStatus;if(this.getInstantUpload()){this.fireFileDeleted({documentId:this._oItemForDelete.documentId,item:v});this._oItemForDelete=null;}else{if(this.aItems.length===1){if(!this.getUploadButtonInvisible()){this.sFocusId=this._oFileUploader.$().find(":button")[0].id;}}else if(this._oItemForDelete._iLineNumber<this.aItems.length-1){this.sFocusId=this.aItems[this._oItemForDelete._iLineNumber+1].getId()+"-cli";}else{this.sFocusId=this.aItems[0].getId()+"-cli";}this._aDeletedItemForPendingUpload.push(v);this.aItems.splice(this._oItemForDelete._iLineNumber,1);this.removeAggregation("items",v,false);}}};u.prototype._handleTerminate=function(e,j){var v,w;v=new f({items:[new S({icon:this._getIconFromFilename(j.getFileName())})]});v.getItems()[0].setTitle(j.getFileName());w=new D({id:this.getId()+"deleteDialog",title:this._oRb.getText("UPLOADCOLLECTION_TERMINATE_TITLE"),content:[new T({text:this._oRb.getText("UPLOADCOLLECTION_TERMINATE_TEXT")}),v],buttons:[new B({text:this._oRb.getText("UPLOADCOLLECTION_OKBUTTON_TEXT"),press:[x,this]}),new B({text:this._oRb.getText("UPLOADCOLLECTION_CANCELBUTTON_TEXT"),press:function(){w.close();}})],afterClose:function(){w.destroy();}}).open();function x(){var A=false;for(var i=0;i<this.aItems.length;i++){if(this.aItems[i]._status===u._uploadingStatus&&this.aItems[i]._requestIdName===j._requestIdName){this.aItems[i]._status=u._toBeDeletedStatus;this._oItemForDelete=this.aItems[i];A=true;break;}else if(j.getFileName()===this.aItems[i].getFileName()&&this.aItems[i]._status===u._displayStatus){this.aItems[i]._status=u._toBeDeletedStatus;this._oItemForDelete=this.aItems[i];this.fireFileDeleted({documentId:this.aItems[i].getDocumentId(),item:this.aItems[i]});break;}}if(A){this._getFileUploader().abort(this._headerParamConst.fileNameRequestIdName,this._encodeToAscii(j.getFileName())+this._oItemForDelete._requestIdName);}w.close();this.invalidate();}};u.prototype._handleEdit=function(e,j){var i,v=j.getId(),w=this.aItems.length;if(this.editModeItem){this._handleOk(e,this.editModeItem,false);}if(this.sErrorState!=="Error"){for(i=0;i<w;i++){if(this.aItems[i].getId()===v){this.aItems[i]._status="Edit";break;}}j._status="Edit";this.editModeItem=e.getSource().getId().split("-editButton")[0];this.invalidate();}};u.prototype._handleClick=function(e,i){var $=Q(e.target).closest("button");var j="";if($.length){j=$.prop("id");}if(j.lastIndexOf("editButton")===-1){if(j.lastIndexOf("cancelButton")!==-1){this._handleCancel(e,i);}else if(e.target.id.lastIndexOf("ia_imageHL")<0&&e.target.id.lastIndexOf("ia_iconHL")<0&&e.target.id.lastIndexOf("deleteButton")<0&&e.target.id.lastIndexOf("ta_editFileName-inner")<0){if(e.target.id.lastIndexOf("cli")>0){this.sFocusId=e.target.id;}this._handleOk(e,i,true);}}};u.prototype._handleOk=function(e,i,j){var E=document.getElementById(i+"-ta_editFileName-inner");var N;var v=u._findById(i,this.aItems);var w=v.getProperty("fileName");var x=u._splitFilename(w);var y=sap.ui.getCore().byId(i+"-ta_editFileName");var z=v.errorState;var A=v.changedFileName;if(E!==null){N=E.value.replace(/^\s+/,"");}this.sFocusId=i+"-cli";if(!N||N.length===0){if(E!==null){this._setErrorStateOnItem(this,v,N,A,z);}return;}v._status=u._displayStatus;if(x.name===N){this._removeErrorStateFromItem(this,v);if(j){this.invalidate();}return;}if(this.getSameFilenameAllowed()){this._removeErrorStateFromItem(this,v);this._oItemForRename=v;this._onEditItemOk.bind(this)(N+x.extension);return;}if(u._checkDoubleFileName(N+x.extension,this.aItems)){y.setProperty("valueState","Error",true);this._setErrorStateOnItem(this,v,N,A,z);}else{y.setProperty("valueState","None",true);v.changedFileName=null;this._removeErrorStateFromItem(this,v);if(j){this.invalidate();}this._oItemForRename=v;this._onEditItemOk.bind(this)(N+x.extension);}};u.prototype._setErrorStateOnItem=function(e,i,N,j,E){i._status="Edit";i.errorState="Error";e.sErrorState="Error";i.changedFileName=N;if(E!=="Error"||j!==N){e.invalidate();}};u.prototype._removeErrorStateFromItem=function(e,i){i.errorState=null;e.sErrorState=null;e.editModeItem=null;};u.prototype._onEditItemOk=function(N){if(this._oItemForRename){this._oItemForRename.setFileName(N);this.fireFileRenamed({documentId:this._oItemForRename.getProperty("documentId"),fileName:N,item:this._oItemForRename});}delete this._oItemForRename;};u.prototype._handleCancel=function(e,i){var j=u._findById(i,this.aItems);j._status=u._displayStatus;j.errorState=null;j.changedFileName=j._getFileNameEditBox().getValue();this.sFocusId=this.editModeItem+"-cli";this.sErrorState=null;this.editModeItem=null;this.invalidate();};u.prototype._onChange=function(e){if(e){var j,v=e.getParameter("files").length,i,w,x,y,A;if(v===0){return;}this._oFileUploader.removeAllAggregation("headerParameters",true);this.removeAllAggregation("headerParameters",true);this._oFileUploader.removeAllAggregation("parameters",true);this.removeAllAggregation("parameters",true);this.fireChange({getParameter:function(E){if(E){return e.getParameter(E);}return null;},getParameters:function(){return e.getParameters();},mParameters:e.getParameters(),files:e.getParameter("files")});var P=this.getAggregation("parameters");if(P){Q.each(P,function(E,G){var J=new F({name:G.getProperty("name"),value:G.getProperty("value")});this._oFileUploader.addParameter(J);}.bind(this));}if(!this.getInstantUpload()){this._bFocusFileUploader=true;x=u._pendingUploadStatus;}else{x=u._uploadingStatus;}this._requestIdValue++;j=this._requestIdValue.toString();var z=this.getAggregation("headerParameters");if(!this.getInstantUpload()){this._aFileUploadersForPendingUpload.push(this._oFileUploader);}for(i=0;i<v;i++){w=new U();w.setFileName(e.getParameter("files")[i].name);if(e.getParameter("fromDragDrop")){w._internalFileIdWithinDragDropArray=e.getParameter("files")[i];}w._status=x;w._internalFileIndexWithinFileUploader=i+1;w._requestIdName=j;if(!this.getInstantUpload()){w.setAssociation("fileUploader",this._oFileUploader,true);y=this._oFormatDecimal.format(e.getParameter("files")[i].size);A=new m({text:y});w.insertAggregation("attributes",A,true);this.insertItem(w);}else{w._percentUploaded=0;}this.aItems.unshift(w);}if(z){Q.each(z,function(E,G){this._oFileUploader.addHeaderParameter(new F({name:G.getProperty("name"),value:G.getProperty("value")}));}.bind(this));}this._oFileUploader.addHeaderParameter(new F({name:this._headerParamConst.requestIdName,value:j}));}};u.prototype._onFilenameLengthExceed=function(e){var i={name:e.getParameter("fileName")};var j=[i];this.fireFilenameLengthExceed({getParameter:function(P){if(P){return e.getParameter(P);}},getParameters:function(){return e.getParameters();},mParameters:e.getParameters(),files:j});};u.prototype._onFileSizeExceed=function(e){var i={name:e.getParameter("fileName"),fileSize:e.getParameter("fileSize")};this.fireFileSizeExceed({getParameter:function(P){if(P){return e.getParameter(P);}},getParameters:function(){return e.getParameters();},mParameters:e.getParameters(),files:[i]});};u.prototype._onTypeMissmatch=function(e){var i={name:e.getParameter("fileName"),fileType:e.getParameter("fileType"),mimeType:e.getParameter("mimeType")};var j=[i];this.fireTypeMissmatch({getParameter:function(P){if(P){return e.getParameter(P);}},getParameters:function(){return e.getParameters();},mParameters:e.getParameters(),files:j});};u.prototype._onUploadTerminated=function(e){var i;var j=this._getRequestId(e);var v=e.getParameter("fileName");var w=this.aItems.length;for(i=0;i<w;i++){if(this.aItems[i]&&this.aItems[i].getFileName()===v&&this.aItems[i]._requestIdName===j&&(this.aItems[i]._status===u._uploadingStatus||this.aItems[i]._status===u._toBeDeletedStatus)){if(this.getItems()&&this.getItems()[i]===this.aItems[i]){this.removeItem(i);}this.aItems.splice(i,1);break;}}this.fireUploadTerminated({fileName:v,getHeaderParameter:this._getHeaderParameterWithinEvent.bind(e)});};u.prototype._onUploadComplete=function(e){if(e){var i,j=this._getRequestId(e),v=e.getParameter("fileName"),w=e.getParameter("id"),x,y,z,A=E();x=this.aItems.length;z=[u._uploadingStatus,u._pendingUploadStatus];for(i=0;i<x;i++){if((!j||this.aItems[i]._requestIdName===j)&&this.aItems[i].getProperty("fileName")===v&&(z.indexOf(this.aItems[i]._status)>=0)){if(A&&this.aItems[i]._status!==u._pendingUploadStatus){this.aItems[i]._percentUploaded=100;this.aItems[i]._status=u._displayStatus;}y=this.aItems.splice(i,1)[0];if(y.destroy){y.destroy();}this._oItemToUpdate=null;break;}}for(i=0;i<this._aFileUploadersForPendingUpload.length;i++){if(this._aFileUploadersForPendingUpload[i].getId()===w){this._aFileUploadersForPendingUpload[i].clear();break;}}this.fireUploadComplete({getParameter:e.getParameter,getParameters:e.getParameters,mParameters:e.getParameters(),files:[{fileName:e.getParameter("fileName")||v,responseRaw:e.getParameter("responseRaw"),reponse:e.getParameter("response"),response:e.getParameter("response"),status:e.getParameter("status"),headers:e.getParameter("headers")}]});}this.invalidate();function E(){var G=e.getParameter("status").toString()||"200";return G[0]==="2"||G[0]==="3";}};u.prototype._onUploadProgress=function(e){if(!e||!this.getInstantUpload()){return;}var j=e.getParameter("fileName"),P,v=Math.round(e.getParameter("loaded")/e.getParameter("total")*100),w=this._getRequestId(e),x=this.aItems.length,y,$,z;if(v===100){P=this._oRb.getText("UPLOADCOLLECTION_UPLOAD_COMPLETED");}else{P=this._oRb.getText("UPLOADCOLLECTION_UPLOADING",[v]);}for(var i=0;i<x;i++){z=this.aItems[i];if(z.getProperty("fileName")===j&&z._requestIdName===w&&z._status===u._uploadingStatus){y=z._getProgressLabel?z._getProgressLabel():z._getControl("sap.m.Label",{id:z.getId()+"-ta_progress"},"ProgressLabel");if(y){y.setText(P);y.rerender();z._percentUploaded=v;$=z.$("ia_indicator");if(v===100){$.attr("aria-label",P);}else{$.attr("aria-valuenow",v);}break;}}}};u.prototype._getRequestId=function(e){var i;i=e.getParameter("requestHeaders");if(!i){return null;}for(var j=0;j<i.length;j++){if(i[j].name===this._headerParamConst.requestIdName){return i[j].value;}}return null;};u.prototype._getFileUploader=function(){var e=this.getInstantUpload();if(!e||!this._oFileUploader){var i=this.getInstantUpload()?this._oRb.getText("UPLOADCOLLECTION_UPLOAD"):this._oRb.getText("UPLOADCOLLECTION_ADD");this._iFUCounter=this._iFUCounter+1;this._oFileUploader=new h(this.getId()+"-"+this._iFUCounter+"-uploader",{buttonOnly:true,buttonText:i,iconOnly:false,enabled:this.getUploadEnabled(),fileType:this.getFileType(),icon:"",iconFirst:false,style:"Transparent",maximumFilenameLength:this.getMaximumFilenameLength(),maximumFileSize:this.getMaximumFileSize(),mimeType:this.getMimeType(),multiple:this.getMultiple(),name:"uploadCollection",uploadOnChange:e,sameFilenameAllowed:true,uploadUrl:this.getUploadUrl(),useMultipart:false,sendXHR:true,change:[this._onChange,this],filenameLengthExceed:[this._onFilenameLengthExceed,this],fileSizeExceed:[this._onFileSizeExceed,this],typeMissmatch:[this._onTypeMissmatch,this],uploadAborted:[this._onUploadTerminated,this],uploadComplete:[this._onUploadComplete,this],uploadProgress:[this._onUploadProgress,this],uploadStart:[this._onUploadStart,this],visible:!this.getUploadButtonInvisible()});}return this._oFileUploader;};u.prototype._onUploadStart=function(e){var j,i,v,w,P,x,G;this._iUploadStartCallCounter++;P=e.getParameter("requestHeaders").length;for(i=0;i<P;i++){if(e.getParameter("requestHeaders")[i].name===this._headerParamConst.requestIdName){v=e.getParameter("requestHeaders")[i].value;break;}}x=e.getParameter("fileName");j={name:this._headerParamConst.fileNameRequestIdName,value:this._encodeToAscii(x)+v};e.getParameter("requestHeaders").push(j);w={name:this._headerParamConst.acceptLanguage,value:sap.ui.getCore().getConfiguration().getLanguage()};e.getParameter("requestHeaders").push(w);for(i=0;i<this._aDeletedItemForPendingUpload.length;i++){if(this._aDeletedItemForPendingUpload[i].getAssociation("fileUploader")===e.oSource.sId&&this._aDeletedItemForPendingUpload[i].getFileName()===x&&this._aDeletedItemForPendingUpload[i]._internalFileIndexWithinFileUploader===this._iUploadStartCallCounter){e.getSource().abort(this._headerParamConst.fileNameRequestIdName,this._encodeToAscii(x)+v);return;}}this.fireBeforeUploadStarts({fileName:x,addHeaderParameter:y,getHeaderParameter:z.bind(this)});if(Array.isArray(G)){for(i=0;i<G.length;i++){if(e.getParameter("requestHeaders")[i].name===G[i].getName()){e.getParameter("requestHeaders")[i].value=G[i].getValue();}}}else if(G instanceof n){for(i=0;i<e.getParameter("requestHeaders").length;i++){if(e.getParameter("requestHeaders")[i].name===G.getName()){e.getParameter("requestHeaders")[i].value=G.getValue();break;}}}function y(A){var j={name:A.getName(),value:A.getValue()};e.getParameter("requestHeaders").push(j);}function z(A){G=this._getHeaderParameterWithinEvent.bind(e)(A);return G;}};u.prototype._getIconFromFilename=function(e){var i=u._splitFilename(e).extension;if(typeof i==="string"){i=i.toLowerCase();}switch(i){case".bmp":case".jpg":case".jpeg":case".png":return u._placeholderCamera;case".csv":case".xls":case".xlsx":return"sap-icon://excel-attachment";case".doc":case".docx":case".odt":return"sap-icon://doc-attachment";case".pdf":return"sap-icon://pdf-attachment";case".ppt":case".pptx":return"sap-icon://ppt-attachment";case".txt":return"sap-icon://document-text";default:return"sap-icon://document";}};u.prototype._getThumbnail=function(e,i){if(e){return e;}else{return this._getIconFromFilename(i);}};u.prototype._triggerLink=function(e,i){if(this.editModeItem){this._handleOk(e,this.editModeItem,true);if(this.sErrorState==="Error"){return;}this.sFocusId=e.getParameter("id");}M.URLHelper.redirect(i.getProperty("url"),true);};u.prototype.onkeydown=function(e){switch(e.keyCode){case K.F2:this._handleF2(e);break;case K.ESCAPE:this._handleESC(e);break;case K.DELETE:this._handleDEL(e);break;case K.ENTER:this._handleENTER(e);break;default:return;}e.setMarked();};u.prototype._setFocusAfterDeletion=function(){var i=this.aItems.length;var e;if(i===0){this._oFileUploader.focus();}else{var j=this.sDeletedItemId.split("-").pop();if(j<=i-1){e=this.sDeletedItemId+"-cli";}else{e=this.aItems[this.aItems.length-1].sId+"-cli";}this._setFocusToLineItem(e);}this.sDeletedItemId=null;};u.prototype._setFocusToLineItem=function(i){Q(document.getElementById(i)).trigger("focus");};u.prototype._handleENTER=function(e){var i,j,v,w;if(this.editModeItem){i=e.target.id.split(this.editModeItem).pop();}else{i=e.target.id.split("-").pop();}switch(i){case"-ta_editFileName-inner":case"-okButton":this._handleOk(e,this.editModeItem,true);break;case"-cancelButton":e.preventDefault();this._handleCancel(e,this.editModeItem);break;case"-ia_iconHL":case"-ia_imageHL":w=this.editModeItem.split("-").pop();M.URLHelper.redirect(this.aItems[w].getProperty("url"),true);break;case"ia_iconHL":case"ia_imageHL":case"cli":j=e.target.id.split(i)[0]+"ta_filenameHL";v=sap.ui.getCore().byId(j);if(v.getEnabled()){w=e.target.id.split("-")[2];M.URLHelper.redirect(this.aItems[w].getProperty("url"),true);}break;default:break;}};u.prototype._handleDEL=function(e){if(!this.editModeItem){var i=e.target.id.slice(0,-4),j=sap.ui.getCore().byId(i),v=j&&j._getDeleteButton&&j._getDeleteButton();if(v){v.firePress();}}};u.prototype._handleESC=function(e){if(this.editModeItem){this.sFocusId=this.editModeItem+"-cli";this.aItems[this.editModeItem.split("-").pop()]._status=u._displayStatus;this._handleCancel(e,this.editModeItem);}};u.prototype._handleF2=function(e){var i=sap.ui.getCore().byId(e.target.id);if(i!==undefined){if(i._status===u._displayStatus){var j=Q(document.getElementById(e.target.id));var v=j.find("[id$='-editButton']");var E=sap.ui.getCore().byId(v[0].id);if(E.getEnabled()){if(this.editModeItem){this._handleClick(e,this.editModeItem);}if(this.sErrorState!=="Error"){E.firePress();}}}else{this._handleClick(e,this.editModeItem);}}else if(e.target.id.search(this.editModeItem)===0){this._handleOk(e,this.editModeItem,true);}};u._checkDoubleFileName=function(e,j){if(j.length===0||!e){return false;}var v=j.length;e=e.replace(/^\s+/,"");for(var i=0;i<v;i++){if(e===j[i].getProperty("fileName")){return true;}}return false;};u._splitFilename=function(e){var i={};var N=e.split(".");if(N.length===1){i.extension="";i.name=N.pop();return i;}i.extension="."+N.pop();i.name=N.join(".");return i;};u.prototype._getAriaLabelForPicture=function(i){var e;e=(i.getAriaLabelForPicture()||i.getFileName());return e;};u.prototype._getHeaderParameterWithinEvent=function(e){var j=[];var v=this.getParameter("requestHeaders");var P=v.length;var i;if(v&&e){for(i=0;i<P;i++){if(v[i].name===e){return new n({name:v[i].name,value:v[i].value});}}return null;}else if(v){for(i=0;i<P;i++){j.push(new n({name:v[i].name,value:v[i].value}));}return j;}};u.prototype._encodeToAscii=function(v){var e="";for(var i=0;i<v.length;i++){e=e+v.charCodeAt(i);}return e;};u.prototype._onResize=function(){var e=this._oList.getItems();for(var i=0;i<e.length;i++){var j=e[i];setTimeout(function(){var v=this._truncateFileName.bind(this);if(typeof v==="string"||v instanceof String){v=this[v];}v.apply(this,[j._oUploadCollectionItem]||[]);}.bind(this),u._resizeTimeoutInterval);}};u.prototype._getUploadCollectionItemByListItem=function(e){var A=this.getItems();for(var i=0;i<A.length;i++){if(A[i].getId()===e.getId().replace("-cli","")){return A[i];}}return null;};u.prototype._getUploadCollectionItemById=function(e){var A=this.getItems();for(var i=0;i<A.length;i++){if(A[i].getId()===e){return A[i];}}return null;};u.prototype._getUploadCollectionItemsByListItems=function(e){var v=[];var w=this.getItems();if(e){for(var i=0;i<e.length;i++){for(var j=0;j<w.length;j++){if(e[i].getId().replace("-cli","")===w[j].getId()){v.push(w[j]);break;}}}return v;}return null;};u.prototype._setSelectedForItems=function(e,v){if(this.getMode()!==L.ListMode.MultiSelect&&v){var w=this.getItems();for(var j=0;j<w.length;j++){w[j].setSelected(false);}}for(var i=0;i<e.length;i++){e[i].setSelected(v);}};u.prototype._handleItemSetSelected=function(e){var i=e.getSource();if(i instanceof U){var j=this._getListItemById(i.getId()+"-cli");if(j){j.setSelected(i.getSelected());}}};u.prototype._handleSelectionChange=function(e){var i=e.getParameter("listItem");var j=e.getParameter("selected");var v=this._getUploadCollectionItemsByListItems(e.getParameter("listItems"));var w=this._getUploadCollectionItemByListItem(i);if(w&&i&&v){this.fireSelectionChange({selectedItem:w,selectedItems:v,selected:j});w.setSelected(i.getSelected());}};u.prototype._getListItemById=function(e){var i=this._oList.getItems();return u._findById(e,i);};u._findById=function(e,j){for(var i=0;i<j.length;i++){if(j[i].getId()===e){return j[i];}}return null;};return u;});
