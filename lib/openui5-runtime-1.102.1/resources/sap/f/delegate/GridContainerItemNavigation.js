/*!
 * OpenUI5
 * (c) Copyright 2009-2022 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/core/delegate/ItemNavigation","./GridItemNavigation","sap/ui/dom/containsOrEquals","sap/ui/thirdparty/jquery"],function(I,G,c,q){"use strict";function d(C){if(C.onfocusin){C.onfocusin();}}var a=G.extend("sap.f.delegate.GridContainerItemNavigation",{constructor:function(){G.apply(this,arguments);this.attachEvent(I.Events.FocusLeave,this._onFocusLeave,this);},metadata:{library:"sap.f",properties:{},events:{}}});a.prototype._onFocusLeave=function(e){var b=this.getFocusedDomRef();this.getItemDomRefs().forEach(function(i,f){if(b===i){var n=f++;this.setFocusedIndex(n);}}.bind(this));this._bFocusLeft=true;};a.prototype.forwardTab=function(f){var i=this._getRootDomRefId()+"-"+(f?"after":"before");document.getElementById(i).focus();};a.prototype._getRootDomRefId=function(f){return this.getRootDomRef().getAttribute("id");};a.prototype.onsaptabnext=function(e){var n=this.getItemDomRefs(),l=this.getFocusedIndex(),L=q(n[l]),T=[];var A=L.find(":sapTabbable");A.map(function(i,b){if(b.className.indexOf("DummyArea")===-1){T.push(b);}});var t=q(T),f=t.length===1?0:t.length-1;if(f===-1||(t.control(f)&&t.control(f).getId()===e.target.id)){this._lastFocusedElement=e.target;this.forwardTab(true);}};a.prototype.onsaptabprevious=function(e){if(!e.target.classList.contains("sapFGridContainerItemWrapper")){this._lastFocusedElement=e.target;return;}var t=e.target.id;if(t===(this._getRootDomRefId()+"-nodata")){this.forwardTab(false);}this._lastFocusedElement=null;this.forwardTab(false);};a.prototype.onmousedown=function(e){this._bIsMouseDown=true;I.prototype.onmousedown.call(this,e);};a.prototype.onmouseup=function(e){var $=q(e.target).closest('.sapFGridContainerItemWrapperNoVisualFocus'),C;if($.length){C=$.children().eq(0).control()[0];if(C&&C.getFocusDomRef()===document.activeElement){this._lastFocusedElement=null;$.trigger("focus");d(C);}}this._bIsMouseDown=false;};a.prototype.ondragend=function(){this._bIsMouseDown=false;};a.prototype.ondrop=function(){this._bIsMouseDown=false;};a.prototype.onfocusin=function(e){G.prototype.onfocusin.call(this,e);var $=q(e.target).closest('.sapFGridContainerItemWrapperNoVisualFocus'),C,n,l,L;if($.length){C=$.children().eq(0).control()[0];if(C){d(C);if(!this._bIsMouseDown&&C.getFocusDomRef()===e.target){this._lastFocusedElement=null;$.trigger("focus");return;}}}if(e.target.classList.contains("sapFGridContainerItemWrapper")){this._lastFocusedElement=null;}if(this._bFocusLeft&&!this._bIsMouseDown){n=this.getItemDomRefs();l=this.getFocusedIndex();L=this._lastFocusedElement||n[l];if(!c(L,e.target)){L.focus();}}this._bFocusLeft=false;};a.prototype.focusItem=function(i,e){var o,b,f;if(i===this.iFocusedIndex&&this.aItemDomRefs[this.iFocusedIndex]===document.activeElement){this.fireEvent(I.Events.FocusAgain,{index:i,event:e});return;}this.fireEvent(I.Events.BeforeFocus,{index:i,event:e});this.setFocusedIndex(i);this.bISetFocus=true;if(e&&q(this.aItemDomRefs[this.iFocusedIndex]).data("sap.INRoot")){o=q(this.aItemDomRefs[this.iFocusedIndex]).data("sap.INRoot");o._sFocusEvent=e.type;}if(!this._bIsMouseDown&&this.aItemDomRefs.length){this.aItemDomRefs[this.iFocusedIndex].focus();b=q(this.aItemDomRefs[this.iFocusedIndex].firstChild).control()[0];if(b){f=b.getFocusDomRef();if(f){this.scrollIntoViewIfNeeded(f);}}}this.fireEvent(I.Events.AfterFocus,{index:i,event:e});};a.prototype.scrollIntoViewIfNeeded=function(e){var p=e.parentElement,C,E;while(p&&p.offsetWidth>=p.scrollWidth&&p.offsetHeight>=p.scrollHeight){p=p.parentElement;}if(!p){return;}p=p.parentElement;if(!p){return;}C=p.getBoundingClientRect();E=e.getBoundingClientRect();if(E.top<C.top||E.bottom>C.bottom||E.right>C.right||E.left<C.left){e.scrollIntoView();}};return a;});
