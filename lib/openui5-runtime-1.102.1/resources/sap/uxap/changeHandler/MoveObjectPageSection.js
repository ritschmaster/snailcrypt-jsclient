/*!
	* OpenUI5
 * (c) Copyright 2009-2022 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
	*/
sap.ui.define(["sap/ui/fl/changeHandler/MoveControls","sap/ui/core/Core","sap/base/util/merge","sap/ui/thirdparty/jquery"],function(M,C,m,q){"use strict";var a=q.extend({},M);a.applyChange=function(c,o,p){var j=p.modifier.targets==="jsControlTree";if(j){o._suppressScroll();}var r=M.applyChange.call(this,c,o,p);if(j){o.attachEventOnce("onAfterRenderingDOMReady",function(){o._resumeScroll(false);});}return r;};a.revertChange=function(c,o,p){var j=p.modifier.targets==="jsControlTree";if(j){o._suppressScroll();}var r=M.revertChange.call(this,c,o,p);if(j){o.attachEventOnce("onAfterRenderingDOMReady",function(){o._resumeScroll(false);});}return r;};a.completeChangeContent=function(c,s,p){var S=C.byId(s.source.id),t=C.byId(s.target.id);var P=Promise.resolve();if(S.isA("sap.uxap.AnchorBar")&&t.isA("sap.uxap.AnchorBar")){P=P.then(this._mapAnchorsToSections.bind(this,s,p));}return P.then(function(){return M.completeChangeContent.apply(this,arguments[0]);}.bind(this,arguments));};a._mapAnchorsToSections=function(s,p){return Promise.resolve().then(function(){var S,o;var b=p.modifier;var l=b.bySelector(s.selector,p.appComponent,p.view);var A=l._getVisibleSections();function g(c){var d=C.byId(c),e=d.data("sectionId");return C.byId(e);}var P=[];s.movedElements.forEach(function(e){var c=A[e.targetIndex];var d=Promise.resolve().then(function(){return b.findIndexInParentAggregation(c);}).then(function(t){e.targetIndex=t;S=g(e.id);if(!S||!S.getParent()){throw new Error("Cannot map anchor to section");}o={id:S.getParent().getId(),aggregation:S.sParentAggregationName};e.id=S.getId();});P.push(d);});return Promise.all(P).then(function(){m(s.source,o);m(s.target,o);});});};return a;},true);
