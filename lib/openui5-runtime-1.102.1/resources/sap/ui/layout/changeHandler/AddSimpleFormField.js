/*!
 * OpenUI5
 * (c) Copyright 2009-2022 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/fl/changeHandler/BaseAddViaDelegate","sap/ui/core/util/reflection/JsControlTreeModifier"],function(B,J){"use strict";var t="sap.ui.core.Title";var T="sap.m.Toolbar";var s="sap.m.Label";var a="sap.ui.comp.smartfield.SmartLabel";function g(c,p){var C=p.change;var m=p.modifier;var b=C.getContent();var d=b.newFieldIndex;var o=C.getDependentControl("targetContainerHeader",p);var I=c.indexOf(o);var n=0;var f=0;if(c.length===1||c.length===I+1){n=c.length;}else{var j=0;for(j=I+1;j<c.length;j++){var e=m.getControlType(c[j]);if(e===s||e===a){if(f===d){n=j;break;}f++;}if(e===t||e===T){n=j;break;}if(j===(c.length-1)){n=c.length;}}}return n;}function i(c,n,I){var C=c.slice();C.splice(n,0,I.label,I.control);return C;}function r(S,c,m,p){return c.reduce(function(P,C,I){return P.then(function(){return m.insertAggregation(S,"content",C,I,p.view);});},Promise.resolve());}var A=B.createAddViaDelegateChangeHandler({addProperty:function(p){var S=p.control;var I=p.innerControls;var m=p.modifier;var o=p.appComponent;var c;var n;var C;var b=p.change;var R=b.getRevertData();R.labelSelector=m.getSelector(I.label,o);return Promise.resolve().then(m.getAggregation.bind(m,S,"content")).then(function(d){c=d;n=g(c,p);C=i(c,n,I);return m.removeAllAggregation(S,"content");}).then(function(){return r(S,C,m,p);}).then(function(){if(I.valueHelp){return m.insertAggregation(S,"dependents",I.valueHelp,0,p.view);}return undefined;});},revertAdditionalControls:function(p){var S=p.control;var c=p.change;var m=p.modifier;var o=p.appComponent;var l=c.getRevertData().labelSelector;if(l){var L=m.bySelector(l,o);return Promise.resolve().then(m.removeAggregation.bind(m,S,"content",L)).then(m.destroy.bind(m,L));}return Promise.resolve();},aggregationName:"content",mapParentIdIntoChange:function(c,S,p){var o=p.appComponent;var v=p.view;var f=p.modifier.bySelector(S.parentId,o,v);var b=f.getTitle()||f.getToolbar();if(b){c.addDependentControl(b.getId(),"targetContainerHeader",p);}},parentAlias:"_",fieldSuffix:"",skipCreateLayout:true,supportsDefault:true});A.getChangeVisualizationInfo=function(c,o){var R=c.getRevertData();if(R&&R.labelSelector){return{affectedControls:[J.bySelector(R.labelSelector,o).getParent().getId()]};}return{affectedControls:[c.getContent().newFieldSelector]};};return A;},true);
