/*!
 * OpenUI5
 * (c) Copyright 2009-2022 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(['sap/ui/core/Control','sap/ui/core/CustomData','./library','sap/ui/core/library','sap/ui/core/ResizeHandler','sap/ui/core/RenderManager','./SplitterRenderer',"sap/base/Log","sap/ui/thirdparty/jquery","sap/ui/layout/SplitterLayoutData"],function(C,a,l,c,R,b,S,L,q,d){"use strict";var O=c.Orientation;var r=16;var e=C.extend("sap.ui.layout.Splitter",{metadata:{library:"sap.ui.layout",properties:{orientation:{type:"sap.ui.core.Orientation",group:"Behavior",defaultValue:O.Horizontal},width:{type:"sap.ui.core.CSSSize",group:"Appearance",defaultValue:'100%'},height:{type:"sap.ui.core.CSSSize",group:"Appearance",defaultValue:'100%'}},defaultAggregation:"contentAreas",aggregations:{contentAreas:{type:"sap.ui.core.Control",multiple:true,singularName:"contentArea"}},events:{resize:{parameters:{id:{type:"string"},oldSizes:{type:"int[]"},newSizes:{type:"int[]"}}}},designtime:"sap/ui/layout/designtime/Splitter.designtime"},renderer:S});e.prototype.init=function(){this._liveResize=true;this._keyboardEnabled=true;this._bHorizontal=true;this._calculatedSizes=[];this._move={};this._resizeTimeout=null;this._resizeCallback=function(E){this._delayedResize(0);}.bind(this);this._resizeHandlerId=null;this._autoResize=true;this.enableAutoResize();this._boundBarMoveEnd=this._onBarMoveEnd.bind(this);this._boundBarMove=this._onBarMove.bind(this);this._initOrientationProperties();this._bRtl=sap.ui.getCore().getConfiguration().getRTL();this._keyListeners={increase:this._onKeyboardResize.bind(this,"inc",20),decrease:this._onKeyboardResize.bind(this,"dec",20),increaseMore:this._onKeyboardResize.bind(this,"incMore",20),decreaseMore:this._onKeyboardResize.bind(this,"decMore",20),max:this._onKeyboardResize.bind(this,"max",20),min:this._onKeyboardResize.bind(this,"min",20)};this._enableKeyboardListeners();};e.prototype.exit=function(){this.disableAutoResize();delete this._resizeCallback;delete this._boundBarMoveEnd;delete this._boundBarMove;delete this._$SplitterOverlay;delete this._$SplitterOverlayBar;};e.prototype.onBeforeRendering=function(){this._initOrientationProperties();};e.prototype.onAfterRendering=function(){this._$SplitterOverlay=this.$("overlay");this._$SplitterOverlayBar=this.$("overlayBar");this._resize();};e.prototype.triggerResize=function(g){if(g){this._resize();}else{this._delayedResize();}};e.prototype.resetContentAreasSizes=function(){var g=this._getContentAreas();for(var i=0;i<g.length;i++){g[i].getLayoutData().setSize("auto");}};e.prototype.getCalculatedSizes=function(){return this._calculatedSizes;};e.prototype.enableAutoResize=function(t){if(t&&!this._autoResize){return;}this._autoResize=true;var g=this;sap.ui.getCore().attachInit(function(){g._resizeHandlerId=R.register(g,g._resizeCallback);});this._delayedResize();};e.prototype.disableAutoResize=function(t){R.deregister(this._resizeHandlerId);if(!t){this._autoResize=false;}};e.prototype.enableLiveResize=function(){this._liveResize=true;this.removeStyleClass("sapUiLoSplitterAnimated");};e.prototype.disableLiveResize=function(){this._liveResize=false;this.addStyleClass("sapUiLoSplitterAnimated");};e.prototype.enableKeyboardSupport=function(){var B=this.$().find(".sapUiLoSplitterBar");B.attr("tabindex","0");this._enableKeyboardListeners();};e.prototype.disableKeyboardSupport=function(){var B=this.$().find(".sapUiLoSplitterBar");B.attr("tabindex","-1");this._disableKeyboardListeners();};e.prototype.onLayoutDataChange=function(){this._delayedResize();};e.prototype.ontouchstart=function(E){if(this._ignoreTouch){return;}var t=this._getBar(E.target);if(!t){return;}if(!E.changedTouches||!E.changedTouches[0]){return;}this._ignoreMouse=true;this._onBarMoveStart(E.changedTouches[0],t,true);};e.prototype.onmousedown=function(E){if(this._ignoreMouse){return;}var t=this._getBar(E.target);if(!t){return;}this._ignoreTouch=true;this._onBarMoveStart(E,t);this._oLastDOMclicked=t;};e.prototype._onBarMoveStart=function(E,B,t){var I=this.getId();this.disableAutoResize(true);var p=E[this._moveCord];var g=parseInt(B.id.substr((I+"-splitbar-").length));var $=q(B);var m=this.getCalculatedSizes();var h=this._bHorizontal?$.outerWidth():$.outerHeight();var j=this._getContentAreas();var o=j[g].getLayoutData();var k=j[g+1].getLayoutData();if(!o.getResizable()||!k.getResizable()){f(t);return;}var n=0-h;for(var i=0;i<=g;++i){n+=m[i]+h;}this._move={start:p,relStart:n,barNum:g,$bar:$,c1Size:m[g],c1MinSize:o.getMinSize(),c2Size:m[g+1],c2MinSize:k.getMinSize()};if(t){document.addEventListener("touchend",this._boundBarMoveEnd);document.addEventListener("touchmove",this._boundBarMove);}else{document.addEventListener("mouseup",this._boundBarMoveEnd);document.addEventListener("mousemove",this._boundBarMove);}this._$SplitterOverlay.css("display","block");this._$SplitterOverlayBar.css(this._sizeDirNot,"");this._move.$bar.css("visibility","hidden");this._onBarMove(E);};e.prototype._onBarMove=function(E){if(E.preventDefault&&!(E.changedTouches)){E.preventDefault();}var o=E;if(E.changedTouches&&E.changedTouches[0]){o=o.changedTouches[0];}var p=o[this._moveCord];var D=(p-this._move.start);if(this.getOrientation()==O.Horizontal&&this._bRtl){D=-D;}var g=this._move.c1Size+D;var h=this._move.c2Size-D;var i=(g>=0&&h>=0&&g>=this._move.c1MinSize&&h>=this._move.c2MinSize);if(i){this._$SplitterOverlayBar.css(this._sizeDir,this._move.relStart+D);if(this._liveResize){var m=(this._move["start"]-o[this._moveCord]);if(this.getOrientation()==O.Horizontal&&this._bRtl){m=-m;}this._resizeContents(this._move["barNum"],-m,false);}}};e.prototype._onBarMoveEnd=function(E){this._ignoreMouse=false;this._ignoreTouch=false;var o=E;if(E.changedTouches&&E.changedTouches[0]){o=o.changedTouches[0];}var p=o[this._moveCord];var m=this._move["start"]-p;if(this.getOrientation()==O.Horizontal&&this._bRtl){m=-m;}this._resizeContents(this._move["barNum"],-m,true);this._move.$bar.css("visibility","");this._$SplitterOverlay.css("display","");document.removeEventListener("mouseup",this._boundBarMoveEnd);document.removeEventListener("mousemove",this._boundBarMove);document.removeEventListener("touchend",this._boundBarMoveEnd);document.removeEventListener("touchmove",this._boundBarMove);this.enableAutoResize(true);if(this._move.$bar){this._move.$bar.trigger("focus");}};e.prototype._resizeContents=function(i,p,F){if(isNaN(p)){L.warning("Splitter: Received invalid resizing values - resize aborted.");return;}var g=this._getContentAreas();var o=g[i].getLayoutData();var h=g[i+1].getLayoutData();var s=o.getSize();var j=h.getSize();var $=this.$("content-"+i);var k=this.$("content-"+(i+1));var n=this._move.c1Size+p;var N=this._move.c2Size-p;var m=o.getMinSize();var M=h.getMinSize();var D;if(n<m){D=m-n;p+=D;n=m;N-=D;}else if(N<M){D=M-N;p-=D;N=M;n-=D;}if(F){if(s==="auto"&&j!=="auto"){h.setSize(N+"px");}else if(s!=="auto"&&j==="auto"){o.setSize(n+"px");}else{o.setSize(n+"px");h.setSize(N+"px");}}else{$.css(this._sizeType,n+"px");k.css(this._sizeType,N+"px");}};e.prototype._delayedResize=function(D){if(D===undefined){D=0;}if(this.getDomRef()){clearTimeout(this._resizeTimeout);this._resizeTimeout=setTimeout(this._resize.bind(this),D);}};e.prototype._resizeBars=function(g){var i,B,s=this._bHorizontal?this.$().innerHeight():this.$().innerWidth();for(i=0;i<g.length-1;++i){B=this.$("splitbar-"+i);B.css(this._sizeTypeNot,"");}for(i=0;i<g.length-1;++i){B=this.$("splitbar-"+i);B.css(this._sizeType,"");B.css(this._sizeTypeNot,s+"px");}};e.prototype._resize=function(){var D=this.getDomRef();if(!D||b.getPreserveAreaRef().contains(D)||D.scrollHeight===0||D.scrollWidth===0){return;}var i=0,B;var g=this._getContentAreas();this._resizeBars(g);var o=this.getCalculatedSizes();this._recalculateSizes();var n=this.getCalculatedSizes();var s=false;for(i=0;i<n.length;++i){if(n[i]!==0){s=true;break;}}if(!s){this._delayedResize(100);return;}var h=true;for(i=0;i<g.length;++i){var $=this.$("content-"+i);var j=g[i];$.css(this._sizeType,n[i]+"px");$.css(this._sizeTypeNot,"");var k=j.getLayoutData();var m=k&&k.getResizable();if(i>0){var p=m&&h;B=this.$("splitbar-"+(i-1));B.toggleClass("sapUiLoSplitterNoResize",!p);B.attr("tabindex",p&&this._keyboardEnabled?"0":"-1");}h=m;}this._resizeBars(g);if(_(o,n)){this.fireResize({oldSizes:o,newSizes:n});}};e.prototype._getTotalSize=function(){return this._bHorizontal?this.$().innerWidth():this.$().innerHeight();};e.prototype._calcAvailableContentSize=function(){return this._getTotalSize()-this._calcBarsSize();};e.prototype._calcBarsSize=function(){var s=0,B=this._getContentAreas().length-1;for(var i=0;i<B;i++){s+=this._bHorizontal?this.$("splitbar-"+i).outerWidth():this.$("splitbar-"+i).outerHeight();}return s;};e.prototype._recalculateSizes=function(){var i,A,g,m;var s=[];var h=this._getContentAreas();var j=this._calcAvailableContentSize();var k=[];var n=[];var p=[];this._calculatedSizes=[];for(i=0;i<h.length;++i){s.push(h[i].getLayoutData().getSize());}for(i=0;i<s.length;++i){var o=s[i];var t;if(o.indexOf("rem")>-1){t=parseFloat(o)*r;j-=t;this._calculatedSizes[i]=t;}else if(o.indexOf("px")>-1){t=parseInt(o);j-=t;this._calculatedSizes[i]=t;}else if(o.indexOf("%")>-1){p.push(i);}else if(o==="auto"){if(h[i].getLayoutData().getMinSize()!==0){n.push(i);}else{k.push(i);}}else{L.error("Illegal size value: "+s[i]);}}var w=false;if(j<0){w=true;j=0;}j=this._calcPercentBasedSizes(p,j);if(j<0){w=true;j=0;}var u=Math.floor(j/(n.length+k.length),0);for(i=0;i<n.length;++i){A=u;g=n[i];m=h[g].getLayoutData().getMinSize();if(A>j){A=j;}if(A<m){A=m;}this._calculatedSizes[g]=A;j-=A;}if(j<0){w=true;j=0;}var v=k.length;u=Math.floor(j/v,0);for(i=0;i<v;++i){g=k[i];this._calculatedSizes[g]=u;j-=u;}if(w){this._logConstraintsViolated();}};e.prototype._calcPercentBasedSizes=function(p,g){var h=this._getContentAreas(),A=this._calcAvailableContentSize();for(var i=0;i<p.length;++i){var j=p[i];var k=parseFloat(h[j].getLayoutData().getSize())/100*A;var m=h[j].getLayoutData().getMinSize();if(k<m){k=m;}this._calculatedSizes[j]=k;g-=k;}return g;};e.prototype._logConstraintsViolated=function(){L.warning("The set sizes and minimal sizes of the splitter contents are bigger than the available space in the UI.",null,"sap.ui.layout.Splitter");};e.prototype._initOrientationProperties=function(){this._bHorizontal=this.getOrientation()===O.Horizontal;if(this._bHorizontal){this._sizeDirNot="top";this._sizeTypeNot="height";this._sizeType="width";this._moveCord="pageX";if(this._bRtl){this._sizeDir="right";}else{this._sizeDir="left";}}else{this._moveCord="pageY";this._sizeType="height";this._sizeTypeNot="width";this._sizeDir="top";this._sizeDirNot="left";}};e.prototype._onKeyboardResize=function(t,s,E){var B=this.getId()+"-splitbar-";if(!E||!E.target||!E.target.id||E.target.id.indexOf(B)!==0){return;}var i=999999;var g=parseInt(E.target.id.substr(B.length));var m=this.getCalculatedSizes();this._move.c1Size=m[g];this._move.c2Size=m[g+1];var h=0;switch(t){case"inc":h=s;break;case"incMore":h=s*10;break;case"dec":h=0-s;break;case"decMore":h=0-s*10;break;case"max":h=i;break;case"min":h=0-i;break;default:L.warn("[Splitter] Invalid keyboard resize type");break;}this._resizeContents(g,h,true);};e.prototype._enableKeyboardListeners=function(){this.onsapright=this._keyListeners.increase;this.onsapdown=this._keyListeners.increase;this.onsapleft=this._keyListeners.decrease;this.onsapup=this._keyListeners.decrease;this.onsappageup=this._keyListeners.decreaseMore;this.onsappagedown=this._keyListeners.increaseMore;this.onsapend=this._keyListeners.max;this.onsaphome=this._keyListeners.min;this._keyboardEnabled=true;};e.prototype._disableKeyboardListeners=function(){delete this.onsapincreasemodifiers;delete this.onsapdecreasemodifiers;delete this.onsapendmodifiers;delete this.onsaphomemodifiers;this._keyboardEnabled=false;};e.prototype._getBar=function(t){var B=t,i=this.getId();if(B.classList.contains("sapUiLoSplitterBarGripIcon")){B=t.parentElement;}if(B.classList.contains("sapUiLoSplitterBarDecorationBefore")||B.classList.contains("sapUiLoSplitterBarDecorationAfter")||B.classList.contains("sapUiLoSplitterBarGrip")){B=B.parentElement;}if(!B.id||B.id.indexOf(i+"-splitbar")!==0){return null;}return B;};function _(s,g){if(s===g){return false;}if(!s||!g||s.length===undefined||g.length===undefined){return true;}if(s.length!=g.length){return true;}for(var i=0;i<s.length;++i){if(s[i]!==g[i]){return true;}}return false;}function f(t){var p=function(E){if(!t){E.preventDefault();}};var A=null;A=function(){document.removeEventListener("touchend",A);document.removeEventListener("touchmove",p);document.removeEventListener("mouseup",A);document.removeEventListener("mousemove",p);};if(t){this._ignoreMouse=true;document.addEventListener("touchend",A);document.addEventListener("touchmove",p);}else{document.addEventListener("mouseup",A);document.addEventListener("mousemove",p);}}e.prototype._ensureLayoutData=function(o){var g=o.getLayoutData();if(g&&(!g.getResizable||!g.getSize||!g.getMinSize)){L.warning("Content \""+o.getId()+"\" for the Splitter contained wrong LayoutData. "+"The LayoutData has been replaced with default values.");g=null;}if(!g){o.setLayoutData(new d());}};e.prototype.invalidate=function(o){var F=(o&&this.indexOfContentArea(o)!=-1)||(o&&o instanceof a&&o.getWriteToDom())||(o===undefined);if(F){C.prototype.invalidate.apply(this,arguments);}};e.prototype.addContentArea=function(o){this._ensureLayoutData(o);return this.addAggregation("contentAreas",o);};e.prototype.insertContentArea=function(o,i){this._ensureLayoutData(o);return this.insertAggregation("contentAreas",o,i);};e.prototype._getContentAreas=function(){return this.getContentAreas();};return e;});
