/*!
 * OpenUI5
 * (c) Copyright 2009-2022 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/core/mvc/Controller","sap/m/MessageBox","sap/m/MessageToast","sap/ui/fl/write/api/ContextSharingAPI","sap/m/ColumnListItem","sap/ui/core/Fragment","sap/base/util/uid","sap/ui/rta/appContexts/controller/RestAPIConnector"],function(C,M,a,b,c,F,u,R){"use strict";var _;var o;var r={Initial:0,Default:1024,Before:function(h){return h+1024;},Between:function(h,j){return(h+j)/2;},After:function(h){return h+0.5;}};function d(E){if(E.getParameter("selected")===true){var U=this.byId("moveUpButton");var D=this.byId("moveDownButton");U.setEnabled(true);D.setEnabled(true);}}function i(m){var h=m.getProperty("/appContexts")||[];h.forEach(function(j,I){j.rank=I+1;});m.setProperty("/appContexts",h);}function e(h,j){return h.rank-j.rank;}function s(m){var h=m.getProperty("/appContexts")||[];h.sort(e);m.setProperty("/appContexts",h);m.refresh(true);}function f(h){return F.load({id:this.getView().getId(),name:"sap.ui.rta.appContexts.view."+h,controller:this}).then(function(D){D.setModel(this.oAppContextsModel);this.getView().addDependent(D);return D;}.bind(this));}function p(B){var h=this.oAppContextsModel.getProperty("types/role",B)||[];this.oComponent.setSelectedContexts({role:h});}function g(E,B){var A=this.oAppContextsModel.getProperty("/appContexts");var n=E?{types:{role:[]}}:Object.assign({},this.oAppContextsModel.getProperty("",B));n.id=u();n.title="";n.description="";n.rank=A.length+1;A.push(n);this.oAppContextsModel.setProperty("/appContexts",A);return n;}return C.extend("sap.ui.rta.appContexts.controller.ManageContexts",{onInit:function(){this.oAppContextsModel=this.getView().getModel("appContexts");this.oI18n=this.getView().getModel("i18n").getResourceBundle();_=this.getOwnerComponent().getLayer();var t=this.byId("manageContexts");t.attachSelectionChange(d.bind(this));this.oAppContextsModel.setData(R.getAppContextData());i(this.oAppContextsModel);return b.createComponent({layer:_}).then(function(h){o=h;this.oComponent=o.getComponentInstance();}.bind(this));},formatContextColumnCell:function(h){var j=h.length+" "+this.oI18n.getText("TXT_TABLE_CONTEXT_CELL_ROLE");j+=h.length===1?"":"s";return j;},formatEnabled:function(){var t=this.byId("manageContexts");return t.getSelectedItems().length!==0;},formatContextTooltip:function(h){return(this.oI18n.getText("TXT_TABLE_CONTEXT_CELL_ROLE")+(h.length===1?"":"s")).toUpperCase()+" - \n"+h.join("\n");},moveUp:function(E){this.moveSelectedItem("Up");E.getSource().focus();},moveDown:function(E){this.moveSelectedItem("Down");E.getSource().focus();},moveSelectedItem:function(D){var t=this.byId("manageContexts");var S=t.getSelectedItem(0);var h=S.getBindingContext("appContexts");var j=t.indexOfItem(S)+(D==="Up"?-1:1);var k=t.getItems()[j];var l=k?k.getBindingContext("appContexts"):undefined;if(!l){return;}var m=l.getProperty("rank");var n=h.getProperty("rank");this.oAppContextsModel.setProperty("rank",m,h);this.oAppContextsModel.setProperty("rank",n,l);s(this.oAppContextsModel);t.getItems()[j].setSelected(true).focus();},onDropSelectedProductsTable:function(E){var D=E.getParameter("draggedControl");var h=D.getBindingContext("appContexts");if(!h){return;}var n=r.Default;var j=E.getParameter("droppedControl");if(j instanceof c){var k=E.getParameter("dropPosition");var l=j.getBindingContext("appContexts");var m=l.getProperty("rank");var q=j.getParent();var t=q.indexOfItem(j);var N=t+(k==="After"?1:-1);var v=q.getItems()[N];if(!v){n=r[k](m);}else{var w=v.getBindingContext("appContexts");n=r.Between(m,w.getProperty("rank"));}}this.oAppContextsModel.setProperty("rank",n,h);s(this.oAppContextsModel);i(this.oAppContextsModel);},onMenuAction:function(E){var I=E.getParameter("item");var h=I.getText();switch(h){case this.oI18n.getText("MAA_DIALOG_ADAPT_UI"):return this.handleUiAdaptation(E);case this.oI18n.getText("MENU_BTN_EDIT"):return this.edit(E);case this.oI18n.getText("MENU_BTN_SHARE"):return this.share(E);case this.oI18n.getText("MAA_DIALOG_DELETE"):return this.deleteContext(E);case this.oI18n.getText("MAA_DIALOG_SAVE_AS_APP"):return this.save(E);default:return undefined;}},edit:function(E){var B=E.getSource().getBindingContext("appContexts");p.call(this,B);if(!this._pEditDialog){this._pEditDialog=f.call(this,"EditContextsDialog");}this._pEditDialog.then(function(D){D.addContent(o);this.oEditedContext=Object.assign({},this.oAppContextsModel.getProperty("",B));D.bindElement(B.getPath());D.open();}.bind(this));},editSelect:function(E){var B=E.getSource().getBindingContext();var S=this.oComponent.getSelectedContexts();this.oAppContextsModel.setProperty("types/role",S.role,B);E.getSource().getParent().close();},editClose:function(E){var B=E.getSource().getBindingContext();this.oAppContextsModel.setProperty("",this.oEditedContext,B);E.getSource().getParent().close();},save:function(E){var B=E.getSource().getBindingContext("appContexts");p.call(this,B);if(!this._pSaveAsDialog){this._pSaveAsDialog=f.call(this,"SaveAsContextsDialog");}var h=E.getSource().getId().endsWith("manageContexts-newContextButton");var n=g.call(this,h,B);this._pSaveAsDialog.then(function(D){D.addContent(o);D.bindElement("/appContexts/".concat(n.rank-1));D.open();});},saveSelect:function(E){var B=E.getSource().getBindingContext();var t=this.oAppContextsModel.getProperty("title",B);if(t===""){return this.byId("savecontextdialog-title-input").setValueState("Error");}var S=this.oComponent.getSelectedContexts();this.oAppContextsModel.setProperty("types/role",S.role,B);E.getSource().getParent().close();},saveClose:function(E){var A=this.oAppContextsModel.getProperty("/appContexts");A.pop();this.oAppContextsModel.setProperty("/appContexts",A);E.getSource().getParent().close();},share:function(){var t=this.byId("manageContexts");var S=t.getSelectedItem(0).getBindingContext("appContexts");var h=this.oAppContextsModel.getProperty("title",S);a.show("Context '"+h+"' shared!");},deleteContext:function(E){var B=E.getSource().getBindingContext("appContexts");var t=this.oAppContextsModel.getProperty("id",B);var A=this.oAppContextsModel.getProperty("/appContexts");var n=A.filter(function(h){return h.id!==t;});this.oAppContextsModel.setProperty("/appContexts",n);i(this.oAppContextsModel);},pressColumnListItem:function(E){var B=E.getSource().getBindingContext("appContexts");var t=this.oAppContextsModel.getProperty("title",B);M.confirm("Do you want to adapt context '"+t+"'?");},handleUiAdaptation:function(){return false;}});});
