/*!
 * OpenUI5
 * (c) Copyright 2009-2022 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/rta/plugin/Plugin","sap/ui/dt/Util","sap/ui/fl/Utils","sap/ui/fl/write/api/LocalResetAPI","sap/ui/rta/command/CompositeCommand","sap/m/MessageToast","sap/ui/dt/OverlayRegistry"],function(P,D,F,L,C,M,O){"use strict";function g(v,V){return V?v.getCurrentVariantReference(V):"";}var a=P.extend("sap.ui.rta.plugin.LocalReset",{metadata:{library:"sap.ui.rta",properties:{},associations:{},events:{}}});a.prototype._isEditable=function(o){var l=this.getAction(o);return!!l;};a.prototype.isEnabled=function(e){if(e.length!==1){return false;}var E=e[0];var o=E.getElement();var A=this.getAction(E);if(!A){return false;}var i=true;if(typeof A.isEnabled!=="undefined"){if(typeof A.isEnabled==="function"){i=A.isEnabled(o);}else{i=A.isEnabled;}}var r=A.changeOnRelevantContainer?E.getRelevantContainer():o;var R=O.getOverlay(r);var b=F.getAppComponentForControl(r);var v=b.getModel(F.VARIANT_MODEL_NAME);var c=g(v,this.getVariantManagementReference(R));return(i&&L.isResetEnabled(r,{layer:this.getCommandFactory().getFlexSettings().layer,currentVariant:c}));};a.prototype.getMenuItems=function(e){return this._getMenuItems(e,{pluginId:"CTX_LOCAL_RESET",rank:61,icon:"sap-icon://reset"});};a.prototype.getActionName=function(){return"localReset";};a.prototype.handler=function(o){var b=o[0];var e=b.getElement();var d=b.getDesignTimeMetadata();var v=this.getVariantManagementReference(b);var A=F.getAppComponentForControl(e);var V=A.getModel(F.VARIANT_MODEL_NAME);var c=g(V,v);var h=!!c;var f=h?A.byId(v)||sap.ui.getCore().byId(v):undefined;var i=this.getCommandFactory();var j=new C();return Promise.all([i.getCommandFor(e,"localReset",{currentVariant:c},d,v),h&&i.getCommandFor(f,"save",{model:V},d,v)].filter(Boolean)).then(function(k){k.forEach(function(l){j.addCommand(l);});this.fireElementModified({command:j});if(h){var m=sap.ui.getCore().getLibraryResourceBundle("sap.ui.rta").getText("MSG_LOCAL_RESET_VARIANT_SAVE");M.show(m,{duration:5000});}}.bind(this)).catch(function(E){throw D.propagateError(E,"LocalReset#handler","Error occured during handler execution","sap.ui.rta.plugin");});};return a;});
