/*!
 * OpenUI5
 * (c) Copyright 2009-2022 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/dt/ElementUtil","sap/ui/dt/OverlayRegistry","sap/base/util/isPlainObject"],function(E,O,a){"use strict";var B={};B.collectBindingPaths=function(e,m,r){var d={bindingPaths:[],bindingContextPaths:[]};var A=e.sParentAggregationName;var p=e.getParent();var h=B.getBindings(e,m,undefined,undefined,r);if(p){var D=p.getMetadata().getAggregation();if(D){var P=E.getAggregation(p,A).indexOf(e);var s=D.name;var o=p.getBindingInfo(s);var t=o&&o.template;if(t){var T=t.getMetadata().getAggregation();if(T){var j=T.name;var k=E.getAggregation(t,j)[P];h=h.concat(B.getBindings(k,null,true,undefined,r));}}}}for(var i=0,l=h.length;i<l;i++){if(h[i].getPath){var n=h[i].getPath();if(n&&d.bindingPaths.indexOf(n)===-1){d.bindingPaths.push(n);}}if(h[i].getContext&&h[i].getContext()&&h[i].getContext().getPath){var q=h[i].getContext().getPath();if(q&&d.bindingContextPaths.indexOf(q)===-1){d.bindingContextPaths.push(q);}}if(a(h[i])){var C=h[i].parts[0]&&h[i].parts[0].path;if(C&&d.bindingPaths.indexOf(C)===-1){d.bindingPaths.push(C);}}}return d;};function b(e,r){if(r&&e!==r){var o=O.getOverlay(e);var R=o&&(o.getRelevantContainer()||o.getElement());return R?R.getId()===r.getId():true;}return true;}B.getBindings=function(e,p,t,A,r){var d=[];if(b(e,r)){d=(t?c(e):B.getBindingsFromProperties(e,p));}var h=A?[A]:Object.keys(e.getMetadata().getAllAggregations());h.forEach(function(s){d=d.concat(g(e,p,t,s,r));});return d;};function g(e,p,t,A,r){var d=[];var T;var h;var o=e.getBindingInfo(A);if(t!==false){T=o&&o.template;h=!!t;}var i=T?[T]:E.getAggregation(e,A);i.forEach(function(C){if(C.getMetadata){if(b(e,r)){d=d.concat(T||h?c(C,r):B.getBindingsFromProperties(C,p));}d=d.concat(B.getBindings(C,p,false,undefined,r));}});return d;}B.flattenBindings=function(o,p){var d=[];var m=o.getMetadata().getName();if(m==="sap.ui.model.CompositeBinding"){o.getBindings().forEach(function(o){d=d.concat(B.flattenBindings(o,p));});}else if((m==="sap.ui.model.odata.ODataPropertyBinding"||m==="sap.ui.model.odata.v2.ODataPropertyBinding"||m==="sap.ui.model.odata.v4.ODataPropertyBinding"||m==="sap.ui.model.json.JSONPropertyBinding"||m==="sap.ui.model.json.XMLPropertyBinding"||m==="sap.ui.model.resource.ResourcePropertyBinding")&&o.getModel()===p&&o.isRelative()&&typeof o.getPath==="function"&&o.getPath()){d.push(o);}return d;};function f(m){var d=[];var p=m.parts;p.forEach(function(P){d.push({parts:[P]});});return d;}B.getBindingsFromProperties=function(e,p){var P=Object.keys(e.getMetadata().getAllProperties());return P.filter(e.getBinding.bind(e)).reduce(function(d,s){return d.concat(B.flattenBindings(e.getBinding(s),p));},[]);};function c(e){var p=Object.keys(e.getMetadata().getAllProperties());return p.filter(function(P){return P in e.mBindingInfos;}).reduce(function(d,P){return d.concat(f(e.mBindingInfos[P]));},[]);}B.getBindingContextPath=function(e){if(e.getBindingContext()&&e.getBindingContext().getPath){return e.getBindingContext().getPath();}return undefined;};return B;},true);
