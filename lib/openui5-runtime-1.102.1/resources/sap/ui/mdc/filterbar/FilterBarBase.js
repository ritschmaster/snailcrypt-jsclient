/*
 * ! OpenUI5
 * (c) Copyright 2009-2022 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(['sap/ui/mdc/p13n/subcontroller/FilterController','sap/ui/core/library','sap/ui/core/ShortcutHintsMixin','sap/ui/Device','sap/ui/mdc/Control','sap/base/Log','sap/base/util/merge','sap/ui/model/base/ManagedObjectModel','sap/ui/base/ManagedObjectObserver','sap/ui/mdc/condition/ConditionModel','sap/ui/mdc/condition/Condition','sap/ui/mdc/condition/ConditionConverter','sap/ui/mdc/util/IdentifierUtil',"sap/ui/mdc/filterbar/PropertyHelper","sap/ui/fl/apply/api/ControlVariantApplyAPI","sap/m/library","sap/m/Button",'sap/m/MessageBox'],function(F,c,S,D,C,L,m,M,a,b,d,e,I,P,f,l,B,g){"use strict";var V=c.ValueState;var h=C.extend("sap.ui.mdc.filterbar.FilterBarBase",{metadata:{library:"sap.ui.mdc",designtime:"sap/ui/mdc/designtime/filterbar/FilterBarBase.designtime",defaultAggregation:"filterItems",interfaces:["sap.ui.mdc.IFilter","sap.ui.mdc.IxState"],properties:{delegate:{type:"object",defaultValue:{name:"sap/ui/mdc/FilterBarDelegate",payload:{modelName:undefined,collectionName:""}}},liveMode:{type:"boolean",defaultValue:false},showMessages:{type:"boolean",group:"Misc",defaultValue:true},showGoButton:{type:"boolean",defaultValue:true},filterConditions:{type:"object",defaultValue:{}},propertyInfo:{type:"object",defaultValue:[]},suspendSelection:{type:"boolean",defaultValue:false},_filterCount:{type:"string",visibility:"hidden"}},aggregations:{filterItems:{type:"sap.ui.mdc.FilterField",multiple:true},basicSearchField:{type:"sap.ui.mdc.FilterField",multiple:false},layout:{type:"sap.ui.mdc.filterbar.IFilterContainer",multiple:false,visibility:"hidden"}},associations:{variantBackreference:{type:"sap.ui.fl.variants.VariantManagement",multiple:false}},events:{search:{conditions:{type:"object"}},filtersChanged:{conditionsBased:{type:"boolean"},filtersText:{type:"string"},filtersTextExpanded:{type:"string"}}}}});var j=l.ButtonType;h.INNER_MODEL_NAME="$sap.ui.filterbar.mdc.FilterBarBase";h.CONDITION_MODEL_NAME="$filters";var E={NoError:-1,RequiredHasNoValue:0,FieldInErrorState:1,AsyncValidation:2,OngoingChangeAppliance:3};h.prototype.init=function(){C.prototype.init.apply(this,arguments);this._oRb=sap.ui.getCore().getLibraryResourceBundle("sap.ui.mdc");this._createInnerModel();this._oObserver=new a(this._observeChanges.bind(this));this._oObserver.observe(this,{aggregations:["filterItems","basicSearchField"]});this._createInnerLayout();this._bPersistValues=false;this.getEngine().registerAdaptation(this,{controller:{Filter:F}});this._fResolveInitialFiltersApplied=undefined;this._oInitialFiltersAppliedPromise=new Promise(function(r){this._fResolveInitialFiltersApplied=r;}.bind(this));this._bIgnoreChanges=false;this._bSearchTriggered=false;this._bIgnoreQueuing=false;};h.prototype._createInnerLayout=function(){this._cLayoutItem=null;this._oFilterBarLayout=null;this._bPersistValues=false;this._btnAdapt=null;this.setAggregation("layout",this._oFilterBarLayout,true);};h.prototype._isPhone=function(){return(D.system.phone)?true:false;};h.prototype._isLiveMode=function(){if(this._isPhone()){return false;}return this.getLiveMode();};h.prototype._getConditionModel=function(){return this._oConditionModel;};h.prototype._getSearchButton=function(){if(!this._btnSearch){this._btnSearch=new B(this.getId()+"-btnSearch",{text:this._oRb.getText("filterbar.GO"),press:this.onSearch.bind(this),type:j.Emphasized});S.addConfig(this._btnSearch,{addAccessibilityLabel:true,message:this._oRb.getText("filterbar.GoBtnShortCutHint")},this);}return this._btnSearch;};h.prototype.getConditionModelName=function(){return this._getConditionModelName();};h.prototype._getConditionModelName=function(){return h.CONDITION_MODEL_NAME;};h.prototype._createConditionModel=function(){this._oConditionModel=new b();this.setModel(this._oConditionModel,this._getConditionModelName());};h.prototype.applySettings=function(s,o){this._setPropertyHelperClass(P);this._setupPropertyInfoStore("propertyInfo");this._applySettings(s,o);Promise.all([this.awaitPropertyHelper()]).then(function(){if(!this._bIsBeingDestroyed){this._applyInitialFilterConditions();}}.bind(this));};h.prototype._applySettings=function(s,o){C.prototype.applySettings.apply(this,arguments);this._createConditionModel();this._oConditionModel.attachPropertyChange(this._handleConditionModelPropertyChange,this);};h.prototype._waitForMetadata=function(){return this._retrieveMetadata().then(function(){this._applyInitialFilterConditions();}.bind(this));};h.prototype.setIgnoreQueuing=function(v){this._bIgnoreQueuing=v;};h.prototype.getIgnoreQueuing=function(){return this._bIgnoreQueuing;};h.prototype.setSuspendSelection=function(v){this.setProperty("suspendSelection",v);if(!v){if(this._bSearchTriggered&&!this.getIgnoreQueuing()){this.triggerSearch();}this._bSearchTriggered=false;this.setIgnoreQueuing(false);}return this;};h.prototype._createInnerModel=function(){this._oModel=new M(this);this.setModel(this._oModel,h.INNER_MODEL_NAME);return this;};h.prototype.getCurrentState=function(){var i={};var s={};if(this._bPersistValues){var k=m({},this.getFilterConditions());for(var K in k){if(this._getPropertyByName(K)){i[K]=k[K];}}s.filter=i;}var n=this.getFilterItems();var o=[];n.forEach(function(p,q){o.push({name:p.getFieldPath()});});s.items=o;return s;};h.prototype.getAssignedFilterNames=function(){var n,i=null,o=this._getConditionModel();if(o){i=[];var k=o.getConditions("$search");if(k&&k.length>0){i.push(this._oRb.getText("filterbar.ADAPT_SEARCHTERM"));}this._getNonHiddenPropertyInfoSet().forEach(function(p){n=I.getPropertyKey(p);var k=o.getConditions(n);if(k&&k.length>0){i.push(p.label||n);}});}return i;};h.prototype._getAssignedFiltersText=function(){var t={};t.filtersText=this._getAssignedFiltersCollapsedText(this.getAssignedFilterNames());t.filtersTextExpanded=this._getAssignedFiltersExpandedText();return t;};h.prototype._getAssignedFiltersExpandedText=function(){var n=0,i=0,o=this._getConditionModel();if(o){var A=o.getAllConditions();for(var s in A){var p=this._getPropertyByName(s);if(p&&!p.hiddenFilter&&(A[s].length>0)){++n;if(!(((s==="$search")&&this.getAggregation("basicSearchField"))||this._getFilterField(s))){++i;}}}}if(!n&&!i){return this._oRb.getText("filterbar.ADAPT_NOTFILTERED");}if(!i){if(n===1){return this._oRb.getText("filterbar.ADAPT_FILTER_WITH_NON_HIDDEN",[n]);}return this._oRb.getText("filterbar.ADAPT_FILTERS_WITH_NON_HIDDEN",[n]);}if((n===1)){return this._oRb.getText("filterbar.ADAPT_FILTER_WITH_HIDDEN",[n,i]);}return this._oRb.getText("filterbar.ADAPT_FILTERS_WITH_HIDDEN",[n,i]);};h.prototype._getAssignedFiltersCollapsedText=function(k){var A;k=k||[];if(k.length){A=Object.keys(k).map(function(i){return k[i];}).join(", ");if(k.length===1){return this._oRb.getText("filterbar.ADAPT_FILTER_COLLAPSED",[k.length,A]);}return this._oRb.getText("filterbar.ADAPT_FILTERS_COLLAPSED",[k.length,A]);}return this._oRb.getText("filterbar.ADAPT_NOTFILTERED");};h.prototype.getAssignedFiltersText=function(){return this._getAssignedFiltersText();};h.prototype._reportModelChange=function(t,i){this._handleAssignedFilterNames(false,i);if(this.getLiveMode()||t){this.triggerSearch();}};h.prototype._isPersistenceSupported=function(o){return this.getEngine().isModificationSupported(this);};h.prototype.getPropertyInfoSet=function(){return this.getPropertyHelper()?this.getPropertyHelper().getProperties():[];};h.prototype._addConditionChange=function(o,s){if(!this._aOngoingChangeAppliance){this._aOngoingChangeAppliance=[];}this._aOngoingChangeAppliance.push(this.getEngine().createChanges({control:this,applySequentially:true,key:"Filter",state:o}));};h.prototype._handleConditionModelPropertyChange=function(o){var A=function(s,i){var O={};O[s]=this._stringifyConditions(s,m([],i));this._cleanupConditions(O[s]);this._addConditionChange(O,s);}.bind(this);if(!this._bIgnoreChanges){var p=o.getParameter("path");if(p.indexOf("/conditions/")===0){var s=p.substring("/conditions/".length);if(this._bPersistValues&&this._isPersistenceSupported()){var i=o.getParameter("value");if(this._getPropertyByName(s)){A(s,i);}else{this._retrieveMetadata().then(function(){A(s,i);});}}else{this._reportModelChange(false);}}}};h.prototype._toExternal=function(p,o){var i=m({},o);i=e.toString(i,p.typeConfig,this.getTypeUtil());this._cleanupCondition(i);this._convertInOutParameters(o,i,"inParameters",e.toString);this._convertInOutParameters(o,i,"outParameters",e.toString);return i;};h.prototype._toInternal=function(p,o){var i=m({},o);i=e.toType(i,p.typeConfig,this.getTypeUtil());this._convertInOutParameters(o,i,"inParameters",e.toType);this._convertInOutParameters(o,i,"outParameters",e.toType);return i;};h.prototype._convertInOutParameters=function(o,i,p,k){if(o[p]&&(Object.keys(o[p]).length>0)){Object.keys(o[p]).forEach(function(K){var n=K.startsWith("conditions/")?K.slice(11):K;var q=this._getPropertyByName(n);if(q){var O=d.createCondition("EQ",[o[p][K]]);var v=k(O,q.typeConfig,this.getTypeUtil());if(!i[p]){i[p]={};}if(!K.startsWith("conditions/")){delete i[p][K];K="conditions/"+n;}i[p][K]=v.values[0];}else{L.error("mdc.FilterBar._convertInOutParameters: could not find property info for "+n);}}.bind(this));}};h.prototype._cleanupCondition=function(o){if(o){if(o.hasOwnProperty("isEmpty")){delete o.isEmpty;}}};h.prototype._cleanupConditions=function(i){if(i){i.forEach(function(o){this._cleanupCondition(o);},this);}};h.prototype._stringifyCondition=function(p,o){var r=o;if(o&&o.values){if(o.values.length>0){r=this._toExternal(p,o);}else{r=m({},o);this._cleanupCondition(r);}}return r;};h.prototype._stringifyConditions=function(s,i){var p=this._getPropertyByName(s);var r=i;if(p&&i){r=[];i.forEach(function(o){r.push(this._stringifyCondition(p,o));},this);}return r;};h.prototype._handleAssignedFilterNames=function(i,k){if(this._bIsBeingDestroyed){return;}if(!i){if(this._btnAdapt){var n=this.getAssignedFilterNames();this.setProperty("_filterCount",this._oRb.getText(n.length?"filterbar.ADAPT_NONZERO":"filterbar.ADAPT",n.length),false);}}var t=this._getAssignedFiltersText();var o={conditionsBased:(!i&&!k),filtersText:t.filtersText,filtersTextExpanded:t.filtersTextExpanded};this.fireFiltersChanged(o);};h.prototype.onReset=function(o){this._getConditionModel().oConditionModel.removeAllConditions();};h.prototype.onSearch=function(o){if(!this._bSearchPressed){this._bSearchPressed=true;this.triggerSearch().then(function(){this._bSearchPressed=false;}.bind(this),function(){this._bSearchPressed=false;}.bind(this));}};h.prototype.triggerSearch=function(){if(this.getSuspendSelection()){this._bSearchTriggered=true;return Promise.resolve();}return this.validate();};h.prototype._hasRetrieveMetadataToBeCalled=function(){return((this.getPropertyHelper()===null)||((this.getPropertyHelper().getProperties().length===0)&&!this.isPropertyHelperFinal()));};h.prototype.validate=function(s){var i=!s;var v=function(){if(!this._oValidationPromise){this._oValidationPromise=new Promise(function(r,n){this._fResolvedSearchPromise=r;this._fRejectedSearchPromise=n;}.bind(this));var k=function(){this._validate(i);this._oValidationPromise=null;};setTimeout(k.bind(this),0);}return this._oValidationPromise;}.bind(this);return this.waitForInitialization().then(function(){if(this._hasRetrieveMetadataToBeCalled()){return this._retrieveMetadata().then(function(){return v();});}else{return v();}}.bind(this));};h.prototype._clearDelayedSearch=function(){if(this._iDelayedSearchId){clearTimeout(this._iDelayedSearchId);this._iDelayedSearchId=null;}};h.prototype._getRequiredFieldsWithoutValues=function(){var r=[];this._getRequiredPropertyNames().forEach(function(n){var i=this._getConditionModel().getConditions(n);if(!i||i.length===0){r.push(n);}}.bind(this));return r;};h.prototype._checkAsyncValidation=function(){var r=E.NoError;if(this._aFIChanges&&this._aFIChanges.length>0){r=E.AsyncValidation;}return r;};h.prototype._checkOngoingChangeAppliance=function(){var r=E.NoError;if(this._aOngoingChangeAppliance&&this._aOngoingChangeAppliance.length>0){r=E.OngoingChangeAppliance;}return r;};h.prototype._checkRequiredFields=function(){var r=E.NoError;var R=this._getRequiredFieldsWithoutValues();R.forEach(function(n){var o=this._getFilterField(n);if(o){if(o.getValueState()===V.None){o.setValueState(V.Error);o.setValueStateText(this._oRb.getText("filterbar.REQUIRED_FILTER_VALUE_MISSING"));}}else{L.error("Mandatory filter field '"+n+"' not visible on FilterBarBase has no value.");}r=E.RequiredHasNoValue;}.bind(this));return r;};h.prototype._checkFieldsInErrorState=function(){var r=E.NoError;this._getNonRequiredPropertyNames().some(function(n){var o=this._getFilterField(n);if(o&&(o.getValueState()!==V.None)){r=E.FieldInErrorState;}return r!==E.NoError;}.bind(this));return r;};h.prototype._handleFilterItemSubmit=function(o){var p=o.getParameter("promise");if(p){p.then(function(){this.triggerSearch();}.bind(this)).catch(function(i){L.error(i);});}};h.prototype._handleFilterItemChanges=function(o){if(this._bIgnoreChanges){return;}var i=o.oSource;if(i.getRequired()&&(i.getValueState()===V.Error)&&o.getParameter("valid")){i.setValueState(V.None);return;}if(!this._aFIChanges){this._aFIChanges=[];}this._aFIChanges.push({name:i.getFieldPath(),promise:o.getParameter("promise")});};h.prototype._checkFilters=function(){var r=this._checkAsyncValidation();if(r!==E.NoError){return r;}r=this._checkOngoingChangeAppliance();if(r!==E.NoError){return r;}r=this._checkRequiredFields();if(r!==E.NoError){return r;}r=this._checkFieldsInErrorState();if(r!==E.NoError){return r;}return r;};h.prototype._setFocusOnFirstErroneousField=function(){var o=null;this.getFilterItems().some(function(i){if(i.getValueState()!==V.None){o=i;setTimeout(i["focus"].bind(i),0);}return o!=null;});return o;};h.prototype._handleAsyncValidation=function(i){if(this._aFIChanges&&(this._aFIChanges.length>0)){var n=this._aFIChanges.slice();this._aFIChanges=null;var k=[];n.forEach(function(N){k.push(N.promise);});Promise.all(k).then(function(o){o.forEach(function(p,q){var r=this._getFilterField(n[q].name);if(r&&r.getRequired()&&(r.getValueState()===V.Error)){r.setValueState(V.None);}},this);this._validate(i);}.bind(this),function(o){this._validate(i);}.bind(this));}};h.prototype._handleOngoingChangeAppliance=function(i){if(this._aOngoingChangeAppliance&&(this._aOngoingChangeAppliance.length>0)){var k=this._aOngoingChangeAppliance.slice();this._aOngoingChangeAppliance=null;Promise.all(k).then(function(){this._validate(i);}.bind(this),function(){this._validate(i);}.bind(this));}};h.prototype._validate=function(i){var s,r;var k=function(){if(i){this.fireSearch();}}.bind(this);var n=function(){this._fRejectedSearchPromise=null;this._fResolvedSearchPromise=null;}.bind(this);if(this.bIsDestroyed){n();return;}r=this._checkFilters();if(r===E.AsyncValidation){this._handleAsyncValidation(i);return;}if(r===E.OngoingChangeAppliance){this._handleOngoingChangeAppliance(i);return;}if(r===E.NoError){k();this._fResolvedSearchPromise();n();}else{if(r===E.RequiredHasNoValue){s=this._oRb.getText("filterbar.REQUIRED_CONDITION_MISSING");}else{s=this._oRb.getText("filterbar.VALIDATION_ERROR");}if(this.getShowMessages()&&!this._isLiveMode()){try{g.error(s,{styleClass:(this.$()&&this.$().closest(".sapUiSizeCompact").length)?"sapUiSizeCompact":"",onClose:this._setFocusOnFirstErroneousField.bind(this)});}catch(x){L.error(x.message);}}else{L.warning("search was not triggered. "+s);}this._fRejectedSearchPromise();n();}};h.prototype.setInternalConditions=function(i){var o=this._getConditionModel();if(o){o.setConditions(i);}};h.prototype.getInternalConditions=function(){return this._getModelConditions(this._getConditionModel(),true);};h.prototype.waitForInitialization=function(){return Promise.all([this._oInitialFiltersAppliedPromise,this._oMetadataAppliedPromise]);};h.prototype.initialized=function(){if(!this._oMetadataAppliedPromise){this._retrieveMetadata();}return this.waitForInitialization();};h.prototype._getModelConditions=function(o,i,k){var n={};if(o){var A=m({},o.getAllConditions());for(var s in A){if(A[s]&&(k||A[s].length>0)){n[s]=A[s];if(!i){this._cleanupConditions(n[s]);var p=this._stringifyConditions(s,n[s]);n[s]=p;}}}}return n;};var _=function(p){var t=p.typeConfig.typeInstance;var o=t.getConstraints();return t.getMetadata().getName()==="sap.ui.model.odata.type.String"&&o&&o.isDigitSequence&&o.maxLength?function(i){return this._toExternal(p,i,this.getTypeUtil());}.bind(this):undefined;};h.prototype._isPathKnownAsync=function(s,x){var n,k,p=[];p.push(this._getPropertyByNameAsync(s));for(k in x["inParameters"]){n=k.startsWith("conditions/")?k.slice(11):k;p.push(this._getPropertyByNameAsync(n));}for(k in x["outParameters"]){n=k.startsWith("conditions/")?k.slice(11):k;p.push(this._getPropertyByNameAsync(n));}return Promise.all(p);};h.prototype._isPathKnown=function(s,x){var k,n;if(!this._getPropertyByName(s)){return false;}for(k in x["inParameters"]){n=k.startsWith("conditions/")?k.slice(11):k;if(!this._getPropertyByName(n)){return false;}}for(k in x["outParameters"]){n=k.startsWith("conditions/")?k.slice(11):k;if(!this._getPropertyByName(n)){return false;}}return true;};h.prototype._removeCondition=function(s,x,o){var p=this._getPropertyByName(s);if(p){var i=this._toInternal(p,x);if(o.indexOf(s,i,_.call(this,p))>=0){o.removeCondition(s,i);}}};h.prototype.removeCondition=function(s,x){return this.waitForInitialization().then(function(){var o=this._getConditionModel();if(o){this._isPathKnownAsync(s,x).then(function(){this._removeCondition(s,x,o);}.bind(this));}}.bind(this));};h.prototype._addCondition=function(s,x,o){var p=this._getPropertyByName(s);if(p){var i=this._toInternal(p,x);if(o.indexOf(s,i,_.call(this,p))<0){var k={};k[s]=[i];F.checkConditionOperatorSanity(k);var n=k[s];if(n&&n.length>0){this._cleanUpFilterFieldInErrorStateByName(s);o.addCondition(s,i);}}}};h.prototype.addCondition=function(s,x){return this.waitForInitialization().then(function(){var o=this._getConditionModel();if(o){this._isPathKnownAsync(s,x).then(function(){this._addCondition(s,x,o);}.bind(this));}}.bind(this));};h.prototype._setXConditions=function(i,r){var s,p,k,o=this._getConditionModel();var n=null;var q=new Promise(function(u,v){n=u;});this._oConditionModel.detachPropertyChange(this._handleConditionModelPropertyChange,this);var A=function(i){for(s in i){k=i[s];p=this._getPropertyByName(s);if(p){if(k.length===0){o.removeAllConditions(s);}else{if(p.maxConditions!==-1){o.removeAllConditions(s);}k.forEach(function(u){this._addCondition(s,u,o);}.bind(this));}}}this._oConditionModel.attachPropertyChange(this._handleConditionModelPropertyChange,this);n();}.bind(this);if(r){o.removeAllConditions();}if(i){var t=true;for(s in i){k=i[s];if(!this._isPathKnown(s,k)){t=false;break;}}if(!t){this._retrieveMetadata().then(function(){A(i);});}else{A(i);}}return q;};h.prototype._getXConditions=function(){return this._getModelConditions(this._getConditionModel(),false);};h.prototype._getRequiredPropertyNames=function(){var r=[];this._getNonHiddenPropertyInfoSet().forEach(function(p){if(p.required){r.push(I.getPropertyKey(p));}});return r;};h.prototype._getNonRequiredPropertyNames=function(){var n=[];this._getNonHiddenPropertyInfoSet().forEach(function(p){if(!p.required){n.push(I.getPropertyKey(p));}});return n;};h.prototype._insertFilterFieldtoContent=function(o,n){if(!this._cLayoutItem){return;}var i=this._cLayoutItem;var k=new i();k.setFilterField(o);this._oFilterBarLayout.insertFilterField(k,n);};h.prototype._filterItemInserted=function(o){if(!o.getVisible()){return;}if(o.setWidth){o.setWidth("");}this._applyFilterItemInserted(o);this._handleAssignedFilterNames(true);};h.prototype._applyFilterItemInserted=function(o){var n,k;k=this.indexOfAggregation("filterItems",o);if(this.getAggregation("basicSearchField")){k++;}n=k;var p=this.getFilterItems();for(var i=0;i<n;i++){if(!p[i].getVisible()){k--;}}this._insertFilterFieldtoContent(o,k);if(!this._oObserver.isObserved(o,{properties:["visible"]})){this._oObserver.observe(o,{properties:["visible"]});}};h.prototype._filterItemRemoved=function(o){this._applyFilterItemRemoved(o.getFieldPath());this._handleAssignedFilterNames(true);};h.prototype._applyFilterItemRemoved=function(s){this._removeFilterFieldFromContentByName(s);};h.prototype._removeFilterFieldFromContent=function(o){this._removeFilterFieldFromContentByName(o.getFieldPath());};h.prototype._removeFilterFieldFromContentByName=function(s){var o=this._getFilterItemLayoutByName(s);if(o){this._oFilterBarLayout.removeFilterField(o);o.destroy();}};h.prototype._observeChanges=function(o){if(o.type==="aggregation"){if(o.name==="filterItems"){switch(o.mutation){case"insert":o.child.attachChange(this._handleFilterItemChanges,this);o.child.attachSubmit(this._handleFilterItemSubmit,this);this._filterItemInserted(o.child);break;case"remove":o.child.detachChange(this._handleFilterItemChanges,this);o.child.detachSubmit(this._handleFilterItemSubmit,this);this._filterItemRemoved(o.child);break;default:L.error("operation "+o.mutation+" not yet implemented");}}else if(o.name==="basicSearchField"){switch(o.mutation){case"insert":o.child.attachSubmit(this._handleFilterItemSubmit,this);this._insertFilterFieldtoContent(o.child,0);break;case"remove":o.child.detachSubmit(this._handleFilterItemSubmit,this);this._removeFilterFieldFromContent(o.child);break;default:L.error("operation "+o.mutation+" not yet implemented");}}}else if(o.type==="property"){var i;if(o.object.isA&&o.object.isA("sap.ui.mdc.FilterField")){i=o.object;if(i){if(o.current){this._filterItemInserted(i);}else{this._filterItemRemoved(i);}this._oFilterBarLayout.rerender();}}}};h.prototype._getFilterItemLayout=function(o){return this._getFilterItemLayoutByName(o.getFieldPath());};h.prototype._getFilterItemLayoutByName=function(s){var o=null;if(this._oFilterBarLayout){this._oFilterBarLayout.getFilterFields().some(function(i){if(i._getFieldPath()===s){o=i;}return o!==null;});}return o;};h.prototype._getFilterField=function(n){var o=null;this.getFilterItems().some(function(i){if(i&&i.getFieldPath&&(i.getFieldPath()===n)){o=i;}return o!==null;});return o;};h.prototype._retrieveMetadata=function(){if(this._oMetadataAppliedPromise){return this._oMetadataAppliedPromise;}this._fResolveMetadataApplied=undefined;this._oMetadataAppliedPromise=new Promise(function(r,i){this._fResolveMetadataApplied=r;this._fRejectMetadataApplied=i;}.bind(this));this.initControlDelegate().then(function(){if(!this._bIsBeingDestroyed){var r=function(i){i?this._fResolveMetadataApplied():this._fRejectMetadataApplied();this._fResolveMetadataApplied=null;this._fRejectMetadataApplied=null;}.bind(this);if(this.bDelegateInitialized){this.finalizePropertyHelper().then(function(){r(true);});}else{L.error("Delegate not initialized.");r(false);}}}.bind(this));return this._oMetadataAppliedPromise;};h.prototype.setBasicSearchField=function(o){var O=this.getAggregation("basicSearchField");if(O){this.removeAggregation("basicSearchField",O);}this.setAggregation("basicSearchField",o);if(o){if(!this._oObserver.isObserved(o,{properties:["visible"]})){this._oObserver.observe(o,{properties:["visible"]});}}return this;};h.prototype._getNonHiddenPropertyInfoSet=function(){var v=[];this.getPropertyInfoSet().every(function(p){if(!p.hiddenFilter){if(I.getPropertyKey(p)!=="$search"){v.push(p);}}return true;});return v;};h.prototype._getNonHiddenPropertyByName=function(n){var p=null;this._getNonHiddenPropertyInfoSet().some(function(o){if(I.getPropertyKey(o)===n){p=o;}return p!=null;});return p;};h.prototype._cleanUpFilterFieldInErrorStateByName=function(s){var o=null;var i=this.getFilterItems();i.some(function(k){if(k.getFieldPath()===s){o=k;}return o!=null;});if(o){this._cleanUpFilterFieldInErrorState(o);}};h.prototype._cleanUpAllFilterFieldsInErrorState=function(){var i=this.getFilterItems();i.forEach(function(o){this._cleanUpFilterFieldInErrorState(o);}.bind(this));};h.prototype._cleanUpFilterFieldInErrorState=function(o){if(o&&(o.getValueState()!==V.None)){o.setValueState(V.None);}};h.prototype.applyConditionsAfterChangesApplied=function(){if(this._isChangeApplying()){return;}this._bIgnoreChanges=true;this._oFlexPromise=this._getWaitForChangesPromise();Promise.all([this._oFlexPromise,this._oInitialFiltersAppliedPromise,this._oMetadataAppliedPromise]).then(function(A){this._oFlexPromise=null;this._changesApplied();}.bind(this));};h.prototype._isChangeApplying=function(){return!!this._oFlexPromise;};h.prototype._applyInitialFilterConditions=function(){this._bIgnoreChanges=true;this._applyFilterConditionsChanges().then(function(){this._changesApplied();this._bInitialFiltersApplied=true;this._fResolveInitialFiltersApplied();this._fResolveInitialFiltersApplied=null;}.bind(this));};h.prototype._applyFilterConditionsChanges=function(){var s,i;s=this.getProperty("filterConditions");if(Object.keys(s).length>0){i=m({},s);return this._setXConditions(i,true);}return Promise.resolve();};h.prototype.setVariantBackreference=function(v){if(!this._hasAssignedVariantManagement()){this.setAssociation("variantBackreference",v);f.attachVariantApplied({selector:this,vmControlId:this.getVariantBackreference(),callback:this._handleVariantSwitch.bind(this),callAfterInitialVariant:true});}else{L.error("the association 'variant' may only be assigned once and may not change afterwards.");}};h.prototype._handleVariantSwitch=function(v){this._cleanUpAllFilterFieldsInErrorState();this._bExecuteOnSelect=this._getExecuteOnSelectionOnVariant(v);this._bDoNotTriggerFiltersChangeEventBasedOnVariantSwitch=undefined;if(v.hasOwnProperty("createScenario")&&(v.createScenario==="saveAs")){this._bDoNotTriggerFiltersChangeEventBasedOnVariantSwitch=true;}if(!this._isChangeApplying()&&this._bInitialFiltersApplied){this._changesApplied();}};h.prototype._getExecuteOnSelectionOnVariant=function(v){var i=false,o=this._getAssignedVariantManagement();if(o){i=o.getApplyAutomaticallyOnVariant(v);}return i;};h.prototype._hasAssignedVariantManagement=function(){return this._getAssignedVariantManagement()?true:false;};h.prototype._getAssignedVariantManagement=function(){var v=this.getVariantBackreference();if(v){var o=sap.ui.getCore().byId(v);if(o&&o.isA("sap.ui.fl.variants.VariantManagement")){return o;}}return null;};h.prototype._changesApplied=function(){if(!this._isChangeApplying()){this._bIgnoreChanges=false;}this._reportModelChange(this._bExecuteOnSelect,this._bDoNotTriggerFiltersChangeEventBasedOnVariantSwitch);this._bExecuteOnSelect=undefined;this._bDoNotTriggerFiltersChangeEventBasedOnVariantSwitch=undefined;};h.prototype._getView=function(){return I.getView(this);};h.prototype.getConditions=function(){var i=this._bPersistValues?this.getCurrentState().filter:this._getXConditions();if(i&&i["$search"]){delete i["$search"];}return i;};h.prototype.getSearch=function(){var s=this._getConditionModel()?this._getConditionModel().getConditions("$search"):[];return s[0]?s[0].values[0]:"";};h.prototype.exit=function(){if(this._hasAssignedVariantManagement()){f.detachVariantApplied({selector:this,vmControlId:this.getVariantBackreference()});}if(this.bDelegateInitialized&&this.getControlDelegate().cleanup){this.getControlDelegate().cleanup(this);}C.prototype.exit.apply(this,arguments);this._clearDelayedSearch();this._oFilterBarLayout=null;this._cLayoutItem=null;this._btnAdapt=undefined;this._btnSearch=undefined;this._oRb=null;if(this._oModel){this._oModel.destroy();this._oModel=null;}if(this._oConditionModel){this._oConditionModel.detachPropertyChange(this._handleConditionModelPropertyChange,this);this._oConditionModel.destroy();this._oConditionModel=null;}this._oObserver.disconnect();this._oObserver=undefined;this._bPersistValues=null;this._oDelegate=null;this._oFlexPromise=null;this._fResolveMetadataApplied=undefined;this._oMetadataAppliedPromise=null;this._oInitialFiltersAppliedPromise=null;this._oValidationPromise=null;this._aBindings=null;this._aFIChanges=null;this._aOngoingChangeAppliance=null;};return h;});
