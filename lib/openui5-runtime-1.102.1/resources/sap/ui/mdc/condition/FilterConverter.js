/*!
 * OpenUI5
 * (c) Copyright 2009-2022 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
*/
sap.ui.define(["sap/ui/mdc/condition/FilterOperatorUtil","sap/ui/model/Filter","sap/ui/model/FilterOperator","sap/base/Log"],function(F,a,b,L){"use strict";var c={createConditionTypesMapFromFilterBar:function(C,f){var r={};for(var s in C){if(f){var p=f._getPropertyByName(s);var d;if(p&&p.typeConfig){d=p.typeConfig.typeInstance;}else{var o=f._getFilterField(s);if(o){var e=o._getFormatOptions();if(e.originalDateType){d=e.originalDateType;}else{d=e.valueType;}}}r[s]={type:d};}}return r;},createFilters:function(C,o,f,d){var i,l,e,O=[],g,h,n,k,A;var m=function(h,v,P){var V="L1";var S,N,w;if(h.sPath&&h.sPath.indexOf(P)>-1){S=h.sPath.split(P);if(S.length===2){N=S[0];w=S[1];h.sPath=V+"/"+w;return{path:N,operator:v,variable:V};}else{throw new Error("FilterConverter: not supported binding "+h.sPath);}}return false;};var p=function(h){var v=m(h,b.Any,"*/");if(v){return v;}else{return m(h,b.All,"+/");}};for(var s in C){l=[];e=[];A=null;var q=C[s];if(s==="$search"){continue;}var D;var r=true;var B;if(o){if(o[s]){D=o[s].type;r=o[s].caseSensitive;B=o[s].baseType;if(!D){L.warning("FilterConverter","Not able to retrieve the type of path '"+s+"!");}}}for(i=0;i<q.length;i++){k=q[i];g=F.getOperator(k.operator);if(!g){continue;}try{h=g.getModelFilter(k,s,D,r,B);}catch(t){L.error("FilterConverter","Not able to convert the condition for path '"+s+"' into a filter! The type is missing!");continue;}if(f){h=f(k,s,D,h);if(!h){continue;}}if(!g.exclude){if(h.sPath==="$search"){continue;}var $=/^\*(.+)\*$/.exec(h.sPath);if($){var u=$[1].split(',');for(var j=0;j<u.length;j++){l.push(new a({path:u[j],operator:h.sOperator,value1:h.oValue1,caseSensitive:d}));}continue;}A=p(h);l.push(h);}else{A=p(h);e.push(h);}}h=undefined;if(l.length===1){h=l[0];}else if(l.length>1){h=new a({filters:l,and:false});}if(h){e.unshift(h);}n=undefined;if(e.length===1){n=e[0];}else if(e.length>1){n=new a({filters:e,and:true});}if(A){A.condition=n;n=new a(A);}if(n){O.push(n);}}if(O.length===1){h=O[0];}else if(O.length>1){h=new a({filters:O,and:true});}else{h=null;}L.info("FilterConverter",c.prettyPrintFilters(h));return h;},prettyPrintFilters:function(f){var r;if(!f){return"no filters set";}if(f._bMultiFilter){r="";var A=f.bAnd;f.aFilters.forEach(function(f,i,d){r+=c.prettyPrintFilters(f);if(d.length-1!=i){r+=A?" and ":" or ";}},this);return"("+r+")";}else{if(f.sOperator===b.Any||f.sOperator===b.All){r=f.sPath+" "+f.sOperator+" "+c.prettyPrintFilters(f.oCondition);}else{if(f.bCaseSensitive===false){r="tolower("+f.sPath+") "+f.sOperator+" tolower('"+f.oValue1+"')";}else{r=f.sPath+" "+f.sOperator+" '"+f.oValue1+"'";}if([b.BT,b.NB].indexOf(f.sOperator)>=0){r+="...'"+f.oValue2+"'";}}return r;}}};return c;},true);
