/*
 * ! OpenUI5
 * (c) Copyright 2009-2022 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(['sap/ui/mdc/field/FieldValueHelpTableWrapperBase','sap/ui/model/ChangeReason','sap/base/strings/capitalize','sap/m/library','sap/ui/mdc/util/loadModules','sap/ui/thirdparty/jquery'],function(F,C,c,l,a,q){"use strict";var L=l.ListMode;var S=l.Sticky;var b;var d=F.extend("sap.ui.mdc.field.FieldValueHelpMTableWrapper",{metadata:{library:"sap.ui.mdc",aggregations:{table:{type:"sap.m.Table",multiple:false}},defaultAggregation:"table"}});d._init=function(){b=undefined;};d.prototype.exit=function(){F.prototype.exit.apply(this,arguments);};d.prototype.initialize=function(s){if(s||this._oScrollContainer){return this._bTableResolved?this:this._oTablePromise;}if(!b){a("sap/m/ScrollContainer").then(function(m){if(!this._bIsBeingDestroyed){b=m[0];this.initialize();this.fireDataUpdate({contentChange:true});}}.bind(this));return this;}this._oScrollContainer=new b(this.getId()+"-SC",{height:"100%",width:"100%",vertical:true});this._oScrollContainer._oWrapper=this;this._oScrollContainer.getContent=function(){var e=[];var t=this._oWrapper&&this._oWrapper.getTable();if(t){e.push(t);}return e;};return this;};d.prototype.dispose=function(){if(this._oScrollContainer){this._oScrollContainer.destroy();delete this._oScrollContainer;}};d.prototype.getDialogContent=function(){return this._oScrollContainer;};d.prototype.getSuggestionContent=function(){return this._getWrappedTable();};d.prototype.fieldHelpOpen=function(s){F.prototype.fieldHelpOpen.apply(this,arguments);var t=this._getWrappedTable();if(t){if(s){var o=t.getSelectedItem();if(o){this._handleScrolling(o);}}}return this;};d.prototype.getListBinding=function(){var t=this._getWrappedTable();return t&&t.getBinding("items");};d.prototype._getListBindingInfo=function(){var t=this._getWrappedTable();return t&&t.getBindingInfo("items");};d.prototype.isSuspended=function(){var o=this.getListBinding();if(!o){return true;}return o.isSuspended();};d.prototype._handleEvents=function(A){var t=this._getWrappedTable();if(t){var e=(A?t.attachEvent:t.detachEvent).bind(t);e("itemPress",this._handleItemPress,this);e("selectionChange",this._handleSelectionChange,this);e("updateFinished",this._handleUpdateFinished,this);}};d.prototype._adjustTable=function(s,n){F.prototype._adjustTable.apply(this,arguments);var t=this._getWrappedTable();if(t&&this.getParent()){t.setRememberSelections(false);if(s){if(this._getMaxConditions()===1){t.setMode(L.SingleSelectMaster);}else{t.setMode(L.MultiSelect);}}else if(this._getMaxConditions()===1){t.setMode(L.SingleSelectLeft);}else{t.setMode(L.MultiSelect);}var e=t.getSticky();if(!e||e.length===0){t.setSticky([S.ColumnHeaders]);}}};var _=function(B){if(B){this._handleModelContextChange();return true;}};d.prototype._handleTableChanged=function(m,t){if(m==="insert"){this._adjustTable(true);if(!_.call(this,this.getListBinding())){this._oObserver.observe(t,{bindings:["items"]});}}else{this._oObserver.unobserve(t);}F.prototype._handleTableChanged.call(this,m,t);};d.prototype._observeChanges=function(o,n){if(o.name==="items"&&o.mutation==="ready"){_.call(this,o.bindingInfo.binding);}F.prototype._observeChanges.apply(this,arguments);};d.prototype._handleItemPress=function(e){var i=e.getParameter("listItem");if(!this._bSuggestion||this._getMaxConditions()!==1){i.setSelected(!i.getSelected());}this._fireSelectionChange(true);};d.prototype._handleSelectionChange=function(e,f){if(!this._bSuggestion||this._getMaxConditions()!==1||f){this._fireSelectionChange.call(this,false);}};d.prototype._handleUpdateFinished=function(e){if(!this.getParent()){return;}this._updateSelectedItems();if(this._bNavigate){this._bNavigate=false;this.navigate(this._iStep);}this.fireDataUpdate({contentChange:false});};d.prototype._getTableItems=function(s,n){var t=this._getWrappedTable();if(t){return s?t.getSelectedItems():t.getItems();}return[];};d.prototype._modifyTableSelection=function(i,I,s,e){if(I.getSelected()!==s){I.setSelected(s);}};d.prototype._handleTableEvent=function(e){if(!this._bSuggestion){return;}var t=this._getWrappedTable();var i=q(e.target).control(0);switch(e.type){case"sapprevious":if(i.isA("sap.m.ListItemBase")){if(t.indexOfItem(i)===0){this.fireNavigate({key:undefined,description:undefined,leave:true});e.preventDefault();e.stopPropagation();e.stopImmediatePropagation(true);}}break;default:break;}};d.prototype._handleScrolling=function(i){var s=this.getScrollDelegate();if(s){var t=this._getWrappedTable();var I=!isNaN(i)?i:t.indexOfItem(i);t.scrollToIndex(I).catch(function(e){});return true;}};d.prototype.enableShowAllItems=function(){var t=this._getWrappedTable();var B=t&&t.getBindingInfo("items");return B&&!!B.length;};d.prototype.getAllItemsShown=function(){var B=this.getListBinding();return B&&(!B.getLength()||B.bLengthFinal);};return d;});
