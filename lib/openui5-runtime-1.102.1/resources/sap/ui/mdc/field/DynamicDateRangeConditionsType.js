/*!
 * OpenUI5
 * (c) Copyright 2009-2022 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(['sap/ui/mdc/field/ConditionsType','sap/ui/mdc/condition/FilterOperatorUtil','sap/ui/mdc/condition/Operator','sap/ui/mdc/condition/Condition','sap/ui/mdc/enum/ConditionValidated','sap/ui/mdc/enum/BaseType',"sap/ui/mdc/util/DateUtil",'sap/ui/model/SimpleType','sap/ui/model/FormatException','sap/ui/model/ParseException','sap/ui/model/ValidateException','sap/m/DynamicDate','sap/m/library'],function(C,F,O,a,b,B,D,S,c,P,V,d,l){"use strict";var e=C.extend("sap.ui.mdc.field.DynamicDateRangeConditionsType",{constructor:function(o,i){S.apply(this,arguments);this.sName="ConditionsDateRange";this._oResourceBundle=sap.ui.getCore().getLibraryResourceBundle("sap.ui.mdc");}});e.prototype.destroy=function(){S.prototype.destroy.apply(this,arguments);this._bDestroyed=true;};e.prototype.formatValue=function(o,I){if(o==undefined||o==null||this._bDestroyed){return null;}if(!Array.isArray(o)){throw new c("No valid conditions provided");}var M=j.call(this);var r;if(M!==1){throw new c("MaxConditions must be 1");}if(o.length===1){var p=o[0];var q=F.getOperator(p.operator);if(!p.operator||!q){throw new c("No valid condition provided, Operator wrong.");}var v=[];var s=n.call(this);var t=F.getDynamicDateOptionForOperator(q,l.StandardDynamicDateRangeKeys,s);for(var i=0;i<q.valueTypes.length;i++){if(t&&q.valueTypes[i]===O.ValueType.Self){v.push(f.call(this,p.values[i]));}else if(q.valueTypes[i]&&q.valueTypes[i]!==O.ValueType.Static){v.push(p.values[i]);}}if(!t){t=F.getCustomDynamicDateOptionForOperator(q,s);}var u=_.call(this,s);r=u.formatValue({operator:t,values:v},I);}return r;};function _(s){if(!this._oDynamicDateType){var o={date:{source:{pattern:"timestamp"}},"int":{}};if(s===B.DateTime){o.datetime={source:{pattern:"timestamp"}};}this._oDynamicDateType=new d(o);}return this._oDynamicDateType;}function f(v){var t=h.call(this);var s=n.call(this);var i=t.formatValue(v,"string");var p;var H=0;var M=0;var o=0;var q=0;if(s===B.DateTime){p=i.split("T");i=p[0];var T=p[1];p=T.split(":");H=parseInt(p[0]);M=parseInt(p[1]);o=parseInt(p[2]);}p=i.split("-");var y=parseInt(p[0]);var r=parseInt(p[1])-1;var u=parseInt(p[2]);var w=new Date(y,r,u,H,M,o,q).getTime();return w;}function g(t){var T=h.call(this);var s=n.call(this);var o=new Date(t);var y=o.getFullYear();var M=o.getMonth()+1;var i=o.getDate();var p=y.toString()+"-"+((M<10)?"0":"")+M.toString()+"-"+((i<10)?"0":"")+i.toString();if(s===B.DateTime){var H=o.getHours();var q=o.getMinutes();var r=o.getSeconds();var u=0;p=p+"T"+((H<10)?"0":"")+H.toString()+":"+((q<10)?"0":"")+q.toString()+":"+((r<10)?"0":"")+r.toString()+":"+((u<100)?"0":"")+((u<10)?"0":"")+u.toString();}var v=T.parseValue(p,"string");return v;}function h(){if(!this._oInternalType){var t=k.call(this);var s=n.call(this);var p;if(s===B.DateTime){p="yyyy-MM-dd'T'HH:mm:ss:SSS";}else{p="yyyy-MM-dd";}this._oInternalType=D.createInternalType(t,p);}return this._oInternalType;}e.prototype.parseValue=function(v,I){if(this._bDestroyed){return null;}if(j.call(this)!==1){throw new P("Only one condition supported for parsing");}var o=m.call(this);var p=[];if(v&&v.operator){if(v.operator==="PARSEERROR"){throw new P(v.values[0]);}var s=v.operator;var q=F.getOperatorForDynamicDateOption(s,n.call(this));s=q.name;if(q){var r=n.call(this);var t=_.call(this,r);var R=t.parseValue(v,I);var u=[];for(var i=0;i<q.valueTypes.length;i++){if(l.StandardDynamicDateRangeKeys[v.operator]&&q.valueTypes[i]===O.ValueType.Self){u.push(g.call(this,R.values[i]));}else if(q.valueTypes[i]&&q.valueTypes[i]!==O.ValueType.Static){u.push(R.values[i]);}}var w=a.createCondition(q.name,u,undefined,undefined,b.NotValidated);F.updateConditionValues(w);F.checkConditionsEmpty(w,o);p.push(w);}}return p;};e.prototype.validateValue=function(o){if(o===undefined||o===null||this._bDestroyed){return;}if(!Array.isArray(o)){throw new V("No valid conditions provided");}var t=k.call(this);var p=m.call(this);for(var i=0;i<o.length;i++){var q=o[i];if(typeof q!=="object"||!q.operator||!q.values||!Array.isArray(q.values)){throw new V(this._oResourceBundle.getText("field.VALUE_NOT_VALID"));}var r=F.getOperator(q.operator);if(!r||p.indexOf(r.name)===-1){throw new V("No valid condition provided, Operator wrong.");}r.validate(q.values,t);}};function j(){var M=1;if(this.oFormatOptions.hasOwnProperty("maxConditions")){M=this.oFormatOptions.maxConditions;}return M;}function k(){var t=this.oFormatOptions.valueType;if(!t){throw new Error("Type missing");}return t;}function m(){var o=this.oFormatOptions.operators;if(!o||o.length===0){o=F.getOperatorsForType(n.call(this));}return o;}function n(){var t=k.call(this);var T=t.getMetadata().getName();var o=t.getFormatOptions();var i=t.getConstraints();var p=this.oFormatOptions.delegate;var q=this.oFormatOptions.payload;var s=p?p.getTypeUtil(q).getBaseType(T,o,i):B.Date;return s;}return e;});
