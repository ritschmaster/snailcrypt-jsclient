/*!
 * OpenUI5
 * (c) Copyright 2009-2022 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(['sap/ui/core/Control','sap/ui/base/ManagedObjectObserver','sap/base/util/merge','sap/base/util/deepEqual','sap/ui/mdc/condition/Condition','sap/ui/mdc/condition/FilterOperatorUtil','sap/ui/mdc/condition/Operator','sap/ui/mdc/field/ConditionType','sap/ui/mdc/enum/EditMode','sap/ui/mdc/enum/FieldDisplay','sap/ui/mdc/enum/BaseType','sap/ui/mdc/enum/ConditionValidated','sap/ui/mdc/Field','sap/ui/mdc/field/ListFieldHelp','sap/ui/mdc/field/ListFieldHelpItem','sap/ui/model/base/ManagedObjectModel','sap/ui/model/json/JSONModel','sap/ui/model/resource/ResourceModel','sap/ui/model/type/String','sap/ui/core/library','sap/ui/core/InvisibleText','sap/ui/core/ListItem','sap/ui/layout/Grid','sap/ui/layout/GridData','sap/m/library','sap/m/Button','sap/m/Panel','sap/base/Log','sap/ui/core/InvisibleMessage','sap/ui/thirdparty/jquery'],function(C,M,m,d,a,F,O,b,E,c,B,e,f,L,g,h,J,R,S,k,I,l,G,o,p,q,P,r,s,Q){"use strict";var t=sap.ui.getCore().getLibraryResourceBundle("sap.ui.mdc");sap.ui.getCore().attachLocalizationChanged(function(){t=sap.ui.getCore().getLibraryResourceBundle("sap.ui.mdc");});var u=p.ButtonType;var V=k.ValueState;var v=k.InvisibleMessageMode;var D=C.extend("sap.ui.mdc.field.DefineConditionPanel",{metadata:{library:"sap.ui.mdc",properties:{conditions:{type:"object[]",group:"Data",defaultValue:[],byValue:true},formatOptions:{type:"object",defaultValue:{}},label:{type:"string",defaultValue:""},inputOK:{type:"boolean",defaultValue:true}},aggregations:{_content:{type:"sap.ui.core.Control",multiple:false,visibility:"hidden"}},events:{conditionProcessed:{}}},_oManagedObjectModel:null,renderer:{apiVersion:2,render:function(i,j){i.openStart("section",j);i.class("sapUiMdcDefineConditionPanel");i.openEnd();i.renderControl(j.getAggregation("_content"));i.close("section");}},init:function(){sap.ui.getCore().getMessageManager().registerObject(this,true);C.prototype.init.apply(this,arguments);this.oInvisibleMessage=s.getInstance();this._oManagedObjectModel=new h(this);this._oObserver=new M(_.bind(this));this._oObserver.observe(this,{properties:["conditions","formatOptions"]});Z.call(this);this.setModel(this._oManagedObjectModel,"$this");this.setModel(this._oManagedObjectModel,"$condition");},exit:function(){sap.ui.getCore().getMessageManager().unregisterObject(this,true);this._oObserver.disconnect();this._oObserver=undefined;if(this._sConditionsTimer){clearTimeout(this._sConditionsTimer);this._sConditionsTimer=null;}if(this._oDefaultType){this._oDefaultType.destroy();delete this._oDefaultType;}this._oManagedObjectModel.destroy();delete this._oManagedObjectModel;},byId:function(i){return sap.ui.getCore().byId(this.getId()+"--"+i);},onBeforeRendering:function(){if(!this.getModel("$i18n")){this.setModel(new R({bundleName:"sap/ui/mdc/messagebundle",async:false}),"$i18n");}if(this.getConditions().length===0){this.updateDefineConditions();}},removeCondition:function(j){var n=j.oSource;var o1=n.getBindingContext("$this");var p1=this.getConditions();var q1=o1.getPath();var r1=q1.match(/^.*\/(\d+)\/$/);var s1;if(r1){s1=parseInt(r1[1]);}if(s1>0&&p1.length-1===s1){this._bFocusLastRemoveBtn=true;}this.oInvisibleMessage.announce(t.getText("valuehelp.DEFINECONDITIONS_REMOVECONDITION_ANNOUNCE"),v.Polite);var t1=this.byId("conditions");var u1=t1.getContent();var v1=0;for(var i=0;i<u1.length&&v1<=s1;i++){var w1=u1[i];if(v1===s1&&w1 instanceof f&&w1.hasOwnProperty("_iValueIndex")){if(w1._bParseError){w1.setValue(null);}}if(w1 instanceof q&&w1.getId().endsWith("-removeBtnLarge")){v1++;}}if(p1.length===1&&s1===0){this.addDummyCondition(1);p1=this.getConditions();}p1.splice(s1,1);this.setProperty("conditions",p1,true);n1.call(this,undefined);this.fireConditionProcessed();},addCondition:function(i){var j=this.getConditions();var n=this.getFormatOptions();var o1=n.maxConditions;if(o1===-1||j.length<o1){this.addDummyCondition(j.length+1);if(this.getConditions().length===o1){this._bFocusLastCondition=true;}}},addDummyCondition:function(i){var j=H.call(this);var n=A.call(this);var o1=n.name;var p1=a.createCondition(o1,n.valueDefaults?n.valueDefaults:[],undefined,undefined,e.NotValidated);if(n.valueTypes[0]&&n.valueTypes[0]!==O.ValueType.Static){p1.isInitial=true;}F.updateConditionValues(p1);F.checkConditionsEmpty(p1,j);var q1=this.getConditions();if(i!==undefined){q1.splice(i,0,p1);}else{q1.push(p1);}this.setProperty("conditions",q1,true);if(!p1.isInitial){this.fireConditionProcessed();}},updateDefineConditions:function(){var i=this.getConditions().filter(function(j){var n=F.getOperator(j.operator);return j.validated!==e.Validated||n.exclude;});Y.call(this,i,true,false);if(i.length===0){this.addDummyCondition();}},onChange:function(i){var j=H.call(this);var n=this.getConditions();F.checkConditionsEmpty(n,j);F.updateConditionsValues(n,j);if(i){n.forEach(function(o1){if(!o1.isEmpty){delete o1.isInitial;}});}this.setProperty("conditions",n,true);},onSelectChange:function(i){var j=i.getSource();var n=j.getBindingContext("$this").getObject();var o1=this.getConditions();var p1=F.indexOfCondition(n,o1);if(p1>=0){n=o1[p1];}if(!i.getParameter("valid")){n.invalid=true;this.setProperty("conditions",o1,true);j._sOldKey=j.getValue();n1.call(this,true);return;}var q1=j.getValue();var r1=j._sOldKey;var s1=F.getOperator(q1);var t1=r1&&F.getOperator(r1);if(s1&&t1){var u1=false;if(!d(s1.valueTypes[0],t1.valueTypes[0])&&s1.valueTypes[0]!==O.ValueType.Static){if(p1>=0){n.values.forEach(function(v1,w1){if(v1!==null){if((s1.valueTypes[w1]===O.ValueType.Self&&t1.valueTypes[w1]===O.ValueType.SelfNoParse)||(s1.valueTypes[w1]===O.ValueType.SelfNoParse&&t1.valueTypes[w1]===O.ValueType.Self)){var x1=y.call(this,s1.name,w1);var y1=y.call(this,t1.name,w1);var z1=y1.formatValue(n.values[w1],"string");var A1=x1.parseValue(z1,"string");if(A1!==n.values[w1]){n.values[w1]=x1.parseValue(z1,"string");u1=true;}}else{n.values[w1]=null;u1=true;}}}.bind(this));}}if(p1>=0&&s1.valueDefaults){n.values.forEach(function(v1,w1){if((n.isInitial&&v1!==s1.valueDefaults[w1])||(v1===null)){n.values[w1]=s1.valueDefaults[w1];n.isInitial=true;u1=true;}});}if(!s1.valueTypes[1]&&t1.valueTypes[1]){if(p1>=0){if(n.values.length>1&&n.values[1]){n.values=n.values.slice(0,1);u1=true;}}}if(n.invalid){delete n.invalid;u1=true;}if(u1){F.checkConditionsEmpty(n,H.call(this));this.setProperty("conditions",o1,true);n1.call(this,false);}}delete j._sOldKey;},onPaste:function(n){var o1;var p1=n.srcControl;var q1=this.getFormatOptions();var r1=q1.hasOwnProperty("maxConditions")?q1.maxConditions:-1;var s1=p1.getBindingContext("$condition").getPath();var t1=parseInt(s1.split("/")[2]);if(window.clipboardData){o1=window.clipboardData.getData("Text");}else{o1=n.originalEvent.clipboardData.getData('text/plain');}var u1=o1.split(/\r\n|\r|\n/g);if(u1&&u1.length>1){setTimeout(function(){var q1=m({},this.getFormatOptions());delete q1.fieldHelpID;delete q1.conditionModelName;q1.maxConditions=1;q1.display=c.Value;var v1=new b(q1);var w1=u1.length;var x1=this.getConditions();for(var i=0;i<w1;i++){if(u1[i]){var y1=u1[i].trim();var z1=y1.split(/\t/g);if(z1.length==2&&z1[0]&&z1[1]){var A1=F.getOperator("BT");y1=A1.tokenFormat;for(var j=0;j<2;j++){y1=y1.replace(new RegExp("\\{"+j+"\\}","g"),z1[j]);}}try{var B1=v1.parseValue(y1,"string");v1.validateValue(B1);if(x1.length>t1){x1.splice(t1,1,B1);}else{x1.push(B1);}t1++;}catch(C1){r.error("Paste handling","the pasted value '"+y1+"' could not be handled! "+C1.message);}}}if(r1>=0&&x1.length>r1){x1.splice(r1,x1.length-r1);}if(p1.setDOMValue){p1.setDOMValue("");}F.checkConditionsEmpty(x1);this.setProperty("conditions",x1,true);this.fireConditionProcessed();}.bind(this),0);}},cleanUp:function(){var j=this.byId("conditions");var n=j.getContent();for(var i=0;i<n.length;i++){var o1=n[i];if(o1 instanceof f&&o1.hasOwnProperty("_iValueIndex")){if(o1._bParseError){o1.setValue();}}}this.setProperty("inputOK",true,true);}});function _(i){if(i.name==="value"){w.call(this,i.object,i.current,i.old);}if(i.name==="formatOptions"){var j=this.getConditions();var n=i.current&&i.current.operators;var o1=i.old&&i.old.operators;var p1=false;if(!d(n,o1)){p1=true;N.call(this);}var q1=i.current&&i.current.valueType&&i.current.valueType.getMetadata().getName();var r1=i.old&&i.old.valueType&&i.old.valueType.getMetadata().getName();if(q1!==r1&&j.length>0){if(!p1){N.call(this);}this._bUpdateType=true;b1.call(this);this._bUpdateType=false;Y.call(this,j,true,true);}}if(i.name==="conditions"){if(this._sConditionsTimer){clearTimeout(this._sConditionsTimer);this._sConditionsTimer=null;}this._sConditionsTimer=setTimeout(function(){this._sConditionsTimer=null;this.updateDefineConditions();b1.call(this);}.bind(this),0);}}function w(j,n,o1){j._sOldKey=o1;var p1=0;if(n&&o1){var q1=F.getOperator(n);var r1=F.getOperator(o1);var s1=j.getParent();var t1;var u1;p1=s1.indexOfContent(j);t1=s1.getContent()[p1+2];if(t1&&t1.hasOwnProperty("_iValueIndex")&&t1._iValueIndex===0){if(t1 instanceof f&&!t1._bParseError){t1.setValueState(V.None);t1.setValueStateText();}u1=s1.getContent()[p1+3];if(u1&&u1.hasOwnProperty("_iValueIndex")&&u1._iValueIndex===1){if(u1 instanceof f&&!u1._bParseError){u1.setValueState(V.None);u1.setValueStateText();}}else{u1=undefined;}}else{t1=undefined;}if(q1.createControl||r1.createControl){if(t1){t1.destroy();}if(u1){u1.destroy();}}else{if(t1&&q1.valueTypes[0]!==r1.valueTypes[0]){t1.unbindProperty("value");}if(u1&&q1.valueTypes[1]!==r1.valueTypes[1]&&r1.valueTypes[1]){u1.unbindProperty("value");}}}if(!n){var v1=j.getBindingContext("$this").getObject();if(v1){var w1=this.getConditions();p1=F.indexOfCondition(v1,w1);if(p1>=0){v1=w1[p1];v1.operator=o1;this.setProperty("conditions",w1,true);}}}var x1=this.oOperatorModel.getData();var y1;for(var i=0;i<x1.length;i++){var z1=x1[i];if(z1.key===n){y1=z1.text;break;}}j.setAdditionalValue(y1);this.onChange();}function x(i,j,n,o1){var p1=F.getOperator(i.operator);if(!p1||!p1.valueTypes[j]){return null;}var q1=y.call(this,p1.name,j);var r1=this._oManagedObjectModel.getContext(o1.getPath()+"values/"+j+"/");var s1;if(p1.createControl){s1=p1.createControl(q1,"$this>",j,n);}if(!s1){s1=new f(n,{delegate:X.call(this),value:{path:"$this>",type:q1,mode:'TwoWay',targetType:'raw'},editMode:{parts:[{path:"$condition>operator"},{path:"$condition>invalid"}],formatter:e1},multipleLines:false,width:"100%"});}if(s1.getMetadata().hasProperty("placeholder")){if(j===0){s1.bindProperty("placeholder",{path:"$condition>operator",formatter:i1});}else{s1.bindProperty("placeholder",{path:"$condition>operator",formatter:j1});}}s1._iValueIndex=j;if(s1.attachChange){s1.attachChange(this.onChange.bind(this));}s1.onpaste=this.onPaste.bind(this);s1.setLayoutData(new o({span:{parts:[{path:"$condition>"},{path:"$this>/formatOptions"}],formatter:h1.bind(this)}}));s1.setBindingContext(r1,"$this");s1.setBindingContext(o1,"$condition");s1.setFieldGroupIds([o1.getPath()]);return s1;}function y(i,j){var n=T.call(this);var o1=F.getOperator(i);if(o1.valueTypes[j]&&[O.ValueType.Self,O.ValueType.Static].indexOf(o1.valueTypes[j])===-1){n=o1._createLocalType(o1.valueTypes[j],n);}var p1=false;if(o1.valueTypes[j]===O.ValueType.Static){p1=true;n=U.call(this);}var q1=p1?B.String:W.call(this,n);var r1;switch(q1){case B.Numeric:var s1=n.getFormatOptions();if(s1&&s1.hasOwnProperty("emptyString")&&s1.emptyString===null){r1=n;}else{r1=z(n,{emptyString:null});}break;case B.Date:case B.Time:case B.DateTime:r1=n;break;default:if(n.getConstraints()&&n.getConstraints().hasOwnProperty("nullable")&&n.getConstraints().nullable===false){r1=z(n);if(n._bCreatedByOperator){r1=o1._createLocalType(o1.valueTypes[j],n);}}else{r1=n;}break;}return r1;}function z(i,n,j){var o1=sap.ui.require(i.getMetadata().getName().replace(/\./g,"/"));var p1=m(i.getFormatOptions(),n||{});var q1=m(i.getConstraints(),j||{});if(q1.hasOwnProperty("nullable")&&q1.nullable===false){q1.nullable=true;}return new o1(p1,q1);}function A(){var j=H.call(this);var n;var o1=this.getFormatOptions().defaultOperatorName;if(o1){n=F.getOperator(o1);}else{var p1=T.call(this);var q1=W.call(this,p1);n=F.getDefaultOperator(q1);}if(n&&j.indexOf(n.name)<0){for(var i=0;i<j.length;i++){n=F.getOperator(j[i]);if(!n||n.exclude||!n.hasRequiredValues()){n=undefined;}else{break;}}}if(!n){n=F.getOperator(j[0]);}return n;}function H(){var i=this.getFormatOptions();var j=i&&i.operators;if(!j||j.length===0){j=F.getOperatorsForType(B.String);}return j;}function K(){var j;var n=H.call(this);for(var i=0;i<n.length;i++){var o1=n[i];var p1=F.getOperator(o1);if(!j){j=p1.group.id;}else if(j!==p1.group.id){return true;}}return false;}function N(){if(!this.oOperatorModel){return;}var j=T.call(this);var n=H.call(this);var o1=[];var p1=K.call(this);var q1=this.getId()+"--rowSelect-help";var r1=sap.ui.getCore().byId(q1);var s1;if(p1){s1=new g({key:"{om>key}",text:"{om>text}",additionalText:"{om>additionalText}",groupKey:"{om>groupId}",groupText:"{om>groupText}"});}else{s1=new l({key:"{om>key}",text:"{om>text}",additionalText:"{om>additionalText}"});}r1.bindAggregation("items",{path:'om>/',templateShareable:false,template:s1});for(var i=0;i<n.length;i++){var t1=n[i];var u1=F.getOperator(t1);if(!u1||(u1.showInSuggest!==undefined&&u1.showInSuggest==false)){continue;}var v1=u1.textKey||"operators."+u1.name+".longText";var w1=u1.getTypeText(v1,W.call(this,j).toLowerCase());if(w1===v1){w1=u1.longText;}var x1=u1.additionalInfo;if(x1===undefined){if(x1!==""&&u1.formatRange){x1=u1.formatRange(u1._getRange(undefined,j),j);}else if(!p1){x1=u1.group.text;}}o1.push({key:u1.name,text:w1,additionalText:x1,groupId:u1.group.id,groupText:u1.group.text});}this.oOperatorModel.setData(o1);}function T(){var i=this.getFormatOptions();var j=i&&i.valueType;if(!j){j=U.call(this);}return j;}function U(){if(!this._oDefaultType){this._oDefaultType=new S();}return this._oDefaultType;}function W(i){var j=i.getMetadata().getName();var n=i.getFormatOptions();var o1=i.getConstraints();var p1=this.getFormatOptions().delegate;var q1=this.getFormatOptions().payload;var r1=p1?p1.getTypeUtil(q1).getBaseType(j,n,o1):B.String;if(r1===B.Unit){r1=B.Numeric;}return r1;}function X(){var i=this.getFormatOptions();var n=i.delegateName||"sap/ui/mdc/field/FieldBaseDelegate";var j=i.payload;return{name:n,payload:j};}function Y(j,n,o1){var p1=T.call(this);var q1=[];var i=0;for(i=0;i<j.length;i++){var r1=j[i];var s1=F.getOperator(r1.operator);if(s1&&s1.valueTypes[0]===O.ValueType.Static&&(r1.values.length===0||o1)){if(s1.getStaticText){var t1=s1.getStaticText(p1,W.call(this,p1));if(r1.values.length>0){r1.values[0]=t1;}else{r1.values.push(t1);}q1.push(i);}}}if(q1.length>0){this.setProperty("conditions",j,true);}}function Z(){var i=new I(this.getId()+"--ivtOperator",{text:"{$i18n>valuehelp.DEFINECONDITIONS_OPERATORLABEL}"});var j=new P({headerText:"{$this>/label}",expanded:true,height:"100%",backgroundDesign:"Transparent"}).addStyleClass("sapMdcDefineconditionPanel");j.addDependent(new L(this.getId()+"--rowSelect-help",{filterList:false,useFirstMatch:true}));var n=new G(this.getId()+"--conditions",{width:"100%",hSpacing:0,vSpacing:0,containerQuery:true}).addStyleClass("sapUiMdcDefineConditionGrid");d1.call(this,undefined,n,0,null,0);j.addContent(i);j.addContent(n);this._oInvisibleAddOperatorButtonText=new I({text:t.getText("valuehelp.DEFINECONDITIONS_ADDCONDITION_DESCRIPTION")});j.addContent(this._oInvisibleAddOperatorButtonText);var o1=new q(this.getId()+"--addBtn",{press:this.addCondition.bind(this),type:u.Default,text:"{$i18n>valuehelp.DEFINECONDITIONS_ADDCONDITION}",layoutData:new o({span:"XL2 L3 M3 S3",indent:"XL9 L8 M8 S7",linebreak:true,visibleS:{parts:[{path:"$this>/conditions"},{path:"$this>/formatOptions"}],formatter:$.bind(this)},visibleM:{parts:[{path:"$this>/conditions"},{path:"$this>/formatOptions"}],formatter:$.bind(this)},visibleL:{parts:[{path:"$this>/conditions"},{path:"$this>/formatOptions"}],formatter:$.bind(this)},visibleXL:{parts:[{path:"$this>/conditions"},{path:"$this>/formatOptions"}],formatter:$.bind(this)}}),ariaDescribedBy:this._oInvisibleAddOperatorButtonText});n.addContent(o1);n.attachValidateFieldGroup(l1,this);this.setAggregation("_content",j);}function $(i,j){var n=j.hasOwnProperty("maxConditions")?j.maxConditions:-1;return n===-1||i.length<n;}function a1(i,j){var n=j.hasOwnProperty("maxConditions")?j.maxConditions:-1;return n!==1;}function b1(){var j=this.getConditions();var n=this.byId("conditions");var o1;var p1=-1;var q1=0;for(var i=0;i<j.length;i++){var r1=j[i];var s1=F.getOperator(r1.operator);if(r1.validated!==e.Validated||s1.exclude){var t1=this._oManagedObjectModel.getContext("/conditions/"+i+"/");p1++;if(!this.oOperatorModel){this.oOperatorModel=new J();this.setModel(this.oOperatorModel,"om");N.call(this);}o1=n.getContent();if(o1[q1]&&o1[q1].isA("sap.ui.mdc.Field")){q1=k1.call(this,r1,n,q1,t1,p1);}else{q1=d1.call(this,r1,n,q1,t1,p1);}}}o1=n.getContent();while(o1[q1]&&o1[q1]!==this.byId("addBtn")){o1[q1].destroy();q1++;}if(this._bFocusLastCondition){o1[0].focus();this._bFocusLastCondition=false;}if(this._bFocusLastRemoveBtn){q1=c1.call(this,["-removeBtnLarge","-removeBtnSmall"]);o1[q1].focus();this._bFocusLastRemoveBtn=false;}}function c1(j){var o1=this.byId("conditions");var p1=o1.getContent();var n=p1.length-1;if(!Array.isArray(j)){j=[j];}var i=0;var q1=j[i];while(n>=0&&q1!==undefined){var r1=p1[n];if(r1.getId().endsWith(q1)){var s1=Q(r1.getDomRef());if(s1.is(":visible")){return n;}else{i++;q1=j[i];}}n--;}return 0;}function d1(j,n,o1,p1,q1){var r1=this.getId()+"--"+q1;if(!this._oOperatorFieldType){this._oOperatorFieldType=new S({},{minLength:1});}var s1=new f(r1+"-operator",{value:{path:"$this>operator",type:this._oOperatorFieldType},width:"100%",display:c.Description,editMode:E.Editable,multipleLines:false,fieldHelp:this.getId()+"--rowSelect-help",change:this.onSelectChange.bind(this),ariaLabelledBy:this.getId()+"--ivtOperator"}).setLayoutData(new o({span:{parts:[{path:"$this>/conditions"},{path:"$this>/formatOptions"}],formatter:g1.bind(this)},linebreak:true})).setBindingContext(p1,"$this");if(p1){s1.setFieldGroupIds([p1.getPath()]);}this._oObserver.observe(s1,{properties:["value"]});n.insertContent(s1,o1);o1++;var t1=new q(r1+"--removeBtnSmall",{press:this.removeCondition.bind(this),type:u.Transparent,icon:"sap-icon://decline",tooltip:"{$i18n>valuehelp.DEFINECONDITIONS_REMOVECONDITION}"}).setLayoutData(new o({span:"XL1 L1 M1 S2",indent:{path:"$this>operator",formatter:f1},visibleS:{parts:[{path:"$this>/conditions"},{path:"$this>/formatOptions"}],formatter:a1.bind(this)},visibleM:false,visibleL:false,visibleXL:false})).setBindingContext(p1,"$this");if(p1){t1.setFieldGroupIds([p1.getPath()]);}n.insertContent(t1,o1);o1++;if(j){for(var i=0;i<j.values.length;i++){var u1=x.call(this,j,i,r1+"-values"+i,p1);if(u1){n.insertContent(u1,o1);o1++;}}}var v1=new q(r1+"--removeBtnLarge",{press:this.removeCondition.bind(this),type:u.Transparent,icon:"sap-icon://decline",tooltip:"{$i18n>valuehelp.DEFINECONDITIONS_REMOVECONDITION}"}).setLayoutData(new o({span:"XL1 L1 M1 S1",indent:{path:"$this>operator",formatter:f1},visibleS:false,visibleM:{parts:[{path:"$this>/conditions"},{path:"$this>/formatOptions"}],formatter:a1.bind(this)},visibleL:{parts:[{path:"$this>/conditions"},{path:"$this>/formatOptions"}],formatter:a1.bind(this)},visibleXL:{parts:[{path:"$this>/conditions"},{path:"$this>/formatOptions"}],formatter:a1.bind(this)}})).setBindingContext(p1,"$this");n.insertContent(v1,o1);o1++;return o1;}function e1(i,j){if(!i){return E.Display;}else if(j){return E.ReadOnly;}var n=F.getOperator(i);var o1=false;if(n&&n.valueTypes[0]===O.ValueType.Static){o1=true;}return o1?E.Display:E.Editable;}function f1(i){var j=i&&F.getOperator(i);if(!j||!j.valueTypes[0]||(j.valueTypes[0]===O.ValueType.Static&&!j.getStaticText)){return"XL8 L8 M8 S0";}else{return"";}}function g1(i,j){var n=j.hasOwnProperty("maxConditions")?j.maxConditions:-1;var o1="XL3 L3 M3 ";if(n===1){o1+="S12";}else{o1+="S10";}return o1;}function h1(i,j){var n=j.hasOwnProperty("maxConditions")?j.maxConditions:-1;var o1=i&&F.getOperator(i.operator);var p1="";if(o1&&o1.valueTypes[1]){p1="XL4 L4 M4 ";}else{p1="XL8 L8 M8 ";}if(n===1){p1+="S12";}else{p1+="S10";}return p1;}function i1(i){var j=i&&F.getOperator(i);if(j&&j.aLabels){return j.aLabels[0];}else if(j&&j.valueTypes[1]){return t.getText("valuehelp.DEFINECONDITIONS_FROM");}else{return t.getText("valuehelp.DEFINECONDITIONS_VALUE");}}function j1(i){var j=i&&F.getOperator(i);if(j&&j.aLabels){return j.aLabels[1];}else if(j&&j.valueTypes[1]){return t.getText("valuehelp.DEFINECONDITIONS_TO");}}function k1(j,n,o1,p1,q1){var r1=this.getId()+"--"+q1;var s1=n.getContent();var t1;var u1=s1[o1];u1.setBindingContext(p1,"$this");if(p1){u1.setFieldGroupIds([p1.getPath()]);}if(u1.getValueState()===V.Error&&!j.invalid){u1.setValue(u1.getValue());}o1++;var v1=s1[o1];v1.setBindingContext(p1,"$this");if(p1){v1.setFieldGroupIds([p1.getPath()]);}o1++;var w1;var x1=s1[o1];var y1;if(x1.hasOwnProperty("_iValueIndex")&&x1._iValueIndex===0){if(j.values.length>0){w1=this._oManagedObjectModel.getContext(p1.getPath()+"values/0/");x1.setBindingContext(w1,"$this");x1.setBindingContext(p1,"$condition");if(x1.getMetadata().hasProperty("value")&&(this._bUpdateType||!x1.getBindingInfo("value"))){t1=y.call(this,j.operator,0);x1.bindProperty("value",{path:"$this>",type:t1});}o1++;y1=s1[o1];if(y1.hasOwnProperty("_iValueIndex")&&y1._iValueIndex===1){if(j.values.length>1){w1=this._oManagedObjectModel.getContext(p1.getPath()+"values/1/");y1.setBindingContext(w1,"$this");if(y1.getMetadata().hasProperty("value")&&(this._bUpdateType||!y1.getBindingInfo("value"))){t1=y.call(this,j.operator,1);y1.bindProperty("value",{path:"$this>",type:t1});}o1++;}else{y1.destroy();}}else if(j.values.length>1){y1=x.call(this,j,1,r1+"-values1",p1);if(y1){n.insertContent(y1,o1);o1++;}}}else{x1.destroy();x1=undefined;y1=s1[o1+1];if(y1&&y1.hasOwnProperty("_iValueIndex")&&y1._iValueIndex===1){y1.destroy();}}}else if(j.values.length>0){for(var i=0;i<j.values.length;i++){var z1=x.call(this,j,i,r1+"-values"+i,p1);if(z1){n.insertContent(z1,o1);o1++;}}}s1=n.getContent();var A1=s1[o1];A1.setBindingContext(p1,"$this");o1++;return o1;}function l1(i){var j=i.getSource();while(!(j.getParent()instanceof G)){j=j.getParent();}m1.call(this,j);}function m1(i){var j=i.getParent();var n=j.indexOfContent(i);var o1;if(i.getId().endsWith("-operator")){o1=i.getBindingContext("$this");n=n+2;i=j.getContent()[n];}else if(i.getId().endsWith("-removeBtnSmall")){o1=i.getBindingContext("$this");n=n+1;i=j.getContent()[n];}else{o1=i.getBindingContext("$condition");}var p1;var q1=o1.getObject();var r1=F.getOperator(q1.operator);var s1=!!q1.invalid;if(!s1&&r1.valueTypes.length>0&&r1.valueTypes[0]!==O.ValueType.Static){if(r1.valueTypes.length>1&&r1.valueTypes[1]){if(i.hasOwnProperty("_iValueIndex")&&i._iValueIndex===0){p1=j.getContent()[n+1];}else if(i.hasOwnProperty("_iValueIndex")&&i._iValueIndex===1){p1=j.getContent()[n-1];}}if(i.getMetadata().getAllProperties().valueState&&!i._bParseError&&(!p1||!p1._bParseError)){var t1=i.getBinding("value").getType();try{r1.validate(q1.values,t1);i.setValueState(V.None);i.setValueStateText();if(p1&&p1.getMetadata().getAllProperties().valueState){p1.setValueState(V.None);p1.setValueStateText();}}catch(u1){s1=true;i.setValueState(V.Error);i.setValueStateText(u1.message);if(p1&&p1.getMetadata().getAllProperties().valueState){p1.setValueState(V.Error);p1.setValueStateText(u1.message);}}}}n1.call(this,s1);this.fireConditionProcessed();}function n1(j){var i=0;if(j!==true){var n=this.getConditions();for(i=0;i<n.length;i++){if(n[i].invalid){j=true;break;}}}if(j!==true){var o1=this.byId("conditions");var p1=o1.getContent();j=false;for(i=0;i<p1.length;i++){var q1=p1[i];if(q1.hasOwnProperty("_iValueIndex")&&q1.getValueState&&q1.getValueState()===V.Error){j=true;break;}}}this.setProperty("inputOK",!j,true);}return D;});
