/*!
 * OpenUI5
 * (c) Copyright 2009-2022 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(['sap/ui/mdc/library','sap/ui/mdc/field/FieldBase','sap/ui/mdc/field/FieldBaseRenderer','sap/ui/mdc/condition/Condition','sap/ui/mdc/enum/ConditionValidated'],function(l,F,a,C,b){"use strict";var c=F.extend("sap.ui.mdc.MultiValueField",{metadata:{library:"sap.ui.mdc",designtime:"sap/ui/mdc/designtime/field/MultiValueField.designtime",properties:{delegate:{type:"object",defaultValue:{name:"sap/ui/mdc/field/MultiValueFieldDelegate",payload:{}}}},aggregations:{items:{type:"sap.ui.mdc.field.MultiValueFieldItem",multiple:true,singularName:"item"}},defaultAggregation:"items",events:{change:{parameters:{items:{type:"sap.ui.mdc.field.MultiValueFieldItem[]"},valid:{type:"boolean"},promise:{type:"Promise"}}}}},renderer:a});c.prototype.init=function(){F.prototype.init.apply(this,arguments);this._oObserver.observe(this,{aggregations:["items"]});};c.prototype.exit=function(){F.prototype.exit.apply(this,arguments);if(this._iConditionUpdateTimer){clearTimeout(this._iConditionUpdateTimer);delete this._iConditionUpdateTimer;}};c.prototype.bindAggregation=function(n,B){if(n==="items"&&!B.formatter){_.call(this,B);}F.prototype.bindAggregation.apply(this,arguments);};function _(B){if(B.template&&B.template.mBindingInfos.key){var k=B.template.mBindingInfos.key;if(k.type&&(!this._oDataType||this._oDataType.getMetadata().getName()!==k.type.getMetadata().getName())){this._oContentFactory.setDataType(k.type);this.invalidate();}}}c.prototype._handleModelContextChange=function(E){F.prototype._handleModelContextChange.apply(this,arguments);if(!this._oDataType){var B=this.getBinding("items");if(B){_.call(this,B);}}};c.prototype._initDataType=function(){F.prototype._initDataType.apply(this,arguments);var B=this.getBindingInfo("items");if(B){_.call(this,B);}};c.prototype.setMaxConditions=function(m){if(m===1){throw new Error("Multiple Conditions needed on MultiValueField "+this);}return this.setProperty("maxConditions",m,true);};c.prototype._observeChanges=function(o){F.prototype._observeChanges.apply(this,arguments);if(o.name==="items"){d.call(this,o.child,o.mutation);}if(o.name==="key"){f.call(this);}if(o.name==="description"){f.call(this);}if(o.name==="conditions"){e.call(this,o.current);}};function d(i,m){if(m==="insert"){this._oObserver.observe(i,{properties:true});}else{this._oObserver.unobserve(i);}if(!this._bMyItemUpdate){f.call(this);}}function e(h){if(this._bConditionsUpdateFromItems){return;}if(!this.bDelegateInitialized){this.awaitControlDelegate().then(function(){if(!this.bIsDestroyed){e.call(this.getConditions());}}.bind(this));return;}this.getControlDelegate().updateItems(this.getPayload(),h,this);}function f(){if(!this.bDelegateInitialized){this.awaitControlDelegate().then(function(){if(!this.bIsDestroyed){f.call(this);}}.bind(this));return;}if(!this._iConditionUpdateTimer){this._iConditionUpdateTimer=setTimeout(function(){g.call(this);this._iConditionUpdateTimer=undefined;}.bind(this),0);}}function g(){var I=this.getItems();var h=[];for(var i=0;i<I.length;i++){var o=I[i];var j=C.createItemCondition(o.getKey(),o.getDescription());j.validated=b.Validated;h.push(j);}this._bConditionsUpdateFromItems=true;this.setConditions(h);this._bConditionsUpdateFromItems=false;}c.prototype._fireChange=function(h,v,w,p){this.fireChange({items:this.getItems(),valid:v,promise:p});};c.prototype._getResultForPromise=function(h){return this.getItems();};c.prototype._getOperators=function(){return["EQ"];};c.prototype._checkCreateInternalContent=function(){if(!this.bIsDestroyed&&this._oContentFactory.getDataType()&&!this._isPropertyInitial("editMode")){F.prototype._checkCreateInternalContent.apply(this,arguments);}};return c;});
