/*
* ! {copyright}
*/
sap.ui.define(["sap/base/util/merge","sap/ui/core/util/reflection/JsControlTreeModifier"],function(m,J){"use strict";var x={};x.enhanceConfig=function(c,M){var p=M.propertyBag;var o=p?p.modifier:J;var C;var X;return o.getControlMetadata(c).then(function(r){C=r;M.controlMetadata=C;return o.getAggregation(c,"customData");}).then(function(a){return Promise.all(a.map(function(b){return o.getProperty(b,"key");})).then(function(b){return a.reduce(function(r,d,i){return b[i]==="xConfig"?d:r;},undefined);});}).then(function(r){X=r;if(X){return o.getProperty(X,"value").then(function(s){return m({},JSON.parse(s.replace(/\\/g,'')));});}return{aggregations:{}};}).then(function(e){var a=x.createConfigObject(c,M,e);var A=p?p.appComponent:undefined;var b=Promise.resolve();if(X&&c.isA){b=o.removeAggregation(c,"customData",X).then(function(){return o.destroy(X);});}return b.then(function(){return o.createAndAddCustomData(c,"xConfig",JSON.stringify(a),A).then(function(){return m({},a);});});});};x.readConfig=function(c,M){var C,a;if(M){var o=M.propertyBag?M.propertyBag.modifier:J;return o.getAggregation(c,"customData").then(function(b){return Promise.all(b.map(function(d){return o.getProperty(d,"key");})).then(function(d){return b.reduce(function(r,e,i){return d[i]==="xConfig"?e:r;},undefined);});}).then(function(a){if(a){return o.getProperty(a,"value").then(function(v){return m({},JSON.parse(v.replace(/\\/g,'')));});}return null;});}var g=function(p,A){var f=function(c,A){if(c){if(c.getMetadata){var d=c.getMetadata();var e=d.getAllAggregations();if(e){return e[A];}}}return undefined;};var b=f(p,A);if(b){return p[b._sGetter]();}return undefined;};var G=function(c,p){var b=c.getMetadata().getPropertyLikeSetting(p);if(b){var P=b._sGetter;return c[P]();}return undefined;};a=g(c,"customData").find(function(b){return G(b,"key")=="xConfig";});C=a?m({},JSON.parse(G(a,"value").replace(/\\/g,''))):null;return C;};x.createConfigObject=function(c,M,e){var p=M.name;var C=M.controlMeta;var a=C.property;var v=M.value;var o=M.controlMetadata||c.getMetadata();var A=C.aggregation;var s=A?A:o.getDefaultAggregation().name;var b=e||{aggregations:{}};if(!b.aggregations.hasOwnProperty(s)){if(o.hasAggregation(s)){b.aggregations[s]={};}else{throw new Error("The aggregation "+s+" does not exist for"+c);}}if(!b.aggregations.hasOwnProperty(p)){b.aggregations[s][p]={};}if(v!==null){b.aggregations[s][p][a]=v;}else{delete b.aggregations[s][p][a];if(Object.keys(b.aggregations[s][p]).length===0){delete b.aggregations[s][p];if(Object.keys(b.aggregations[s]).length===0){delete b.aggregations[s];}}}return b;};return x;});
