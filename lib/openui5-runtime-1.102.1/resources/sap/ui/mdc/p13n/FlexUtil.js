/*
* ! OpenUI5
 * (c) Copyright 2009-2022 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
*/
sap.ui.define(['sap/base/util/merge','sap/base/util/deepEqual','sap/ui/mdc/condition/FilterOperatorUtil','sap/base/Log'],function(m,d,F,L){"use strict";var a={getPropertySetterChanges:function(D){var c=D.control;var e=D.existingState;var C=D.changedState;var o=D.operation;var s=D.deltaAttribute;var S=[];C.forEach(function(i){if(i.hasOwnProperty(s)){var E=e.find(function(b){return b.name==i.name;});var O=E&&E.hasOwnProperty(s)&&E[s];var n=i[s];var v=O!==n;if(v){S.push(this.createChange(c,o,{name:i.name,value:i[s]}));}}}.bind(this));return S;},_getChangeContent:function(p,D){var c={};if(p.index>=0){c.index=p.index;}D.forEach(function(A){if(p.hasOwnProperty(A)){c[A]=p[A];}});return c;},getConditionDeltaChanges:function(D){var c=[];var n=D.changedState;var p=D.existingState;var A=D.control;var b=D.hasOwnProperty("applyAbsolute")?D.applyAbsolute:true;var P=D.propertyInfo;for(var f in n){var v=a._hasProperty(P,f);if(!v){L.warning("property '"+f+"' not supported");continue;}var e=a._diffConditionPath(f,n[f],p[f],A,b);c=c.concat(e);}return c;},_hasProperty:function(p,n){return p.some(function(P){var v=P.name===n||n=="$search";v=v?v:P.path===n;return v;});},_diffConditionPath:function(f,c,o,C,A){var b,e=[];var O=m([],c);var s=o?m([],o):[];if(d(c,s)){return e;}var r=function(c,s){var R;do{R=false;for(var i=0;i<c.length;i++){var n=c[i];var g=F.indexOfCondition(n,s);if(g>-1){c.splice(i,1);if(A){s.splice(g,1);}R=true;break;}}}while(R);};r(c,s);if((c.length>0)||(s.length>0)){s.forEach(function(g){var n=F.indexOfCondition(g,O);var N=n>-1&&O[n].filtered===false;if(A||N){b=a.createConditionChange("removeCondition",C,f,g);e.push(b);}});c.forEach(function(g){if(A||(!g.hasOwnProperty("filtered")||g.filtered!==false)){b=a.createConditionChange("addCondition",C,f,g);e.push(b);}});}return e;},createChange:function(c,o,C){var A={selectorElement:c,changeSpecificData:{changeType:o,content:C}};return A;},createConditionChange:function(c,C,f,o){delete o.filtered;var b={selectorElement:C,changeSpecificData:{changeType:c,content:{name:f,condition:o}}};return b;},handleChanges:function(c,i,u){return new Promise(function(r,b){sap.ui.require(["sap/ui/fl/write/api/ControlPersonalizationWriteAPI"],function(C){C.add({changes:c,ignoreVariantManagement:i,useStaticArea:u}).then(function(D){r(D);},b);});});},saveChanges:function(c,D){return new Promise(function(r,b){sap.ui.require(["sap/ui/fl/write/api/ControlPersonalizationWriteAPI"],function(C){C.save({selector:c,changes:D}).then(r);});});},restore:function(p){return new Promise(function(r,b){sap.ui.require(["sap/ui/fl/write/api/ControlPersonalizationWriteAPI"],function(C){C.restore(p).then(function(){r();},b);});});},reset:function(p){return new Promise(function(r,b){sap.ui.require(["sap/ui/fl/write/api/ControlPersonalizationWriteAPI"],function(C){C.reset(p).then(function(){r();},b);});});}};return a;});
