/*
 * ! OpenUI5
 * (c) Copyright 2009-2022 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(['sap/ui/mdc/condition/FilterOperatorUtil','./BaseController','sap/ui/mdc/p13n/P13nBuilder','sap/ui/mdc/p13n/FlexUtil','sap/base/Log','sap/base/util/merge'],function(F,B,P,a,L,m){"use strict";var b=B.extend("sap.ui.mdc.p13n.subcontroller.FilterController",{constructor:function(){B.apply(this,arguments);this._bResetEnabled=true;}});b.prototype.getStateKey=function(){return"filter";};b.prototype.getUISettings=function(){return{title:sap.ui.getCore().getLibraryResourceBundle("sap.ui.mdc").getText("filter.PERSONALIZATION_DIALOG_TITLE"),tabText:sap.ui.getCore().getLibraryResourceBundle("sap.ui.mdc").getText("p13nDialog.TAB_Filter"),afterClose:function(e){var d=e.getSource();if(d){var D=d.getContent()[0];if(D.isA("sap.m.p13n.Container")){D.removeView("Filter");}else{d.removeAllContent();}}d.destroy();}};};b.prototype.getChangeOperations=function(){return{add:"addCondition",remove:"removeCondition"};};b.prototype.getBeforeApply=function(){var A=this.getAdaptationControl().getInbuiltFilter();var p=A?A.createConditionChanges():Promise.resolve([]);return p;};b.prototype.getFilterControl=function(){return this.getAdaptationControl().isA("sap.ui.mdc.IFilter")?this.getAdaptationControl():this.getAdaptationControl()._oP13nFilter;};b.prototype.sanityCheck=function(s){b.checkConditionOperatorSanity(s);return s;};b.checkConditionOperatorSanity=function(c){for(var f in c){var C=c[f];for(var i=0;i<C.length;i++){var o=C[i];var O=o.operator;if(!F.getOperator(O)){C.splice(i,1);if(c[f].length==0){delete c[f];}L.warning("The provided conditions for field '"+f+"' contain unsupported operators - these conditions will be neglected.");}}}};b.prototype._getPresenceAttribute=function(c){return"isFiltered";};b.prototype.getAdaptationUI=function(p,w){var A=this._getP13nModel(p);return this.getAdaptationControl().retrieveInbuiltFilter().then(function(o){o.setP13nData(A.oData);o.setLiveMode(false);this._oAdaptationFB=o;return o.createFilterFields().then(function(){return o;});}.bind(this));};b.prototype.update=function(){B.prototype.update.apply(this,arguments);var A=this.getAdaptationControl();var i=A&&A.getInbuiltFilter();if(i){i.createFilterFields();}};b.prototype.getDelta=function(p){p.applyAbsolute=true;return a.getConditionDeltaChanges(p);};b.prototype.model2State=function(){var i={},f=this.getCurrentState();this._oAdaptationModel.getProperty("/items").forEach(function(I){if(I.active&&Object.keys(f).includes(I.name)){i[I.name]=f[I.name];}});return i;};b.prototype.mixInfoAndState=function(p){var e=this.getCurrentState()||{};var o=P.prepareAdaptationData(p,function(i,c){var n=c.name;var E=e[n];i.active=E&&E.length>0?true:false;return!(c.filterable===false);});P.sortP13nData({visible:undefined,position:undefined},o.items);return o;};b.prototype.changesToState=function(c,o,n){var s={};c.forEach(function(C){var d=m({},C.changeSpecificData.content);var N=d.name;s[N]=n[N];});return s;};return b;});
