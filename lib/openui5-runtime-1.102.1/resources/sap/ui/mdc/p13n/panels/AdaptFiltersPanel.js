/*
 * ! OpenUI5
 * (c) Copyright 2009-2022 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/m/p13n/AbstractContainer","sap/m/p13n/AbstractContainerItem","sap/m/p13n/SelectionPanel","./GroupView","sap/ui/model/Filter","sap/m/Button","sap/m/Bar","sap/m/ToolbarSpacer","sap/m/Select","sap/m/SegmentedButton","sap/m/SegmentedButtonItem","sap/m/SearchField","sap/m/OverflowToolbarLayoutData","sap/ui/core/Item","sap/m/library","sap/ui/model/json/JSONModel"],function(A,a,S,G,F,B,b,T,c,d,e,f,O,I,l,J){"use strict";var g=l.BarDesign;var h=A.extend("sap.ui.mdc.p13n.panels.AdaptFiltersPanel",{metadata:{library:"sap.ui.mdc",properties:{itemFactory:{type:"function"},enableReorder:{type:"boolean",defaultValue:true}}},renderer:{apiVersion:2}});h.prototype.GROUP_KEY="group";h.prototype.LIST_KEY="list";h.prototype.P13N_MODEL="$p13n";h.prototype.applySettings=function(s){this.addView(new a({key:this.LIST_KEY,content:new S(this.getId()+"-listView",{activeColumn:this._getResourceText("p13nDialog.LIST_VIEW_ACTIVE"),change:function(E){this.getP13nModel().setProperty("/items",E.getSource().getP13nData());}.bind(this)})}));this.addView(new a({key:this.GROUP_KEY,content:new G(this.getId()+"-groupView",{change:function(E){this.getP13nModel().setProperty("/itemsGrouped",E.getSource().getP13nData());}.bind(this)})}));A.prototype.applySettings.apply(this,arguments);this.getView(this.LIST_KEY).getContent().setEnableReorder(this.getEnableReorder());var q=this._getQuickFilter();var v=this._getViewSwitch();var o=this._getShowHideBtn();var H=new b({contentMiddle:[q,new T(),o,v]});H.setDesign(g.SubHeader);this.setHeader(H);var i=new b({contentMiddle:[this._getSearchField()]});i.addStyleClass("sapUiMDCAdaptFiltersSearchBar");i.setDesign(g.SubHeader);this.setSubHeader(i);this.addStyleClass("sapUiMDCAdaptFiltersPanel");};h.prototype.setItemFactory=function(i){this.setProperty("itemFactory",i);this.getViews().forEach(function(v){var p=v.getContent();p.setItemFactory(i);});return this;};h.prototype.switchView=function(k){var s=k;A.prototype.switchView.call(this,s);this._getShowHideBtn().setVisible(!this._isCustomView());this._getViewSwitch().setSelectedKey(this.getCurrentViewKey());if(!this._isCustomView(k)){this.showFactory(this.getCurrentViewContent()._getShowFactory());}this._filterByModeAndSearch();};h.prototype.addCustomView=function(v){var i=v.item;var k=i.getKey();var C=v.content;var o=v.search;var s=v.selectionChange;var D=v.filterSelect;if(!k){throw new Error("Please provide an item of type sap.m.SegmentedButtonItem with a key");}if(this._oViewSwitch){this._oViewSwitch.attachSelectionChange(function(E){if(s){s(E.getParameter("item").getKey());}if(this._isCustomView()){if(o instanceof Function){o(this._getSearchField().getValue());}if(D instanceof Function){D(this._getQuickFilter().getSelectedKey());}}}.bind(this));}if(o instanceof Function){this._getSearchField().attachLiveChange(function(E){if(this._isCustomView()){o(this._getSearchField().getValue());}}.bind(this));}if(D instanceof Function){this._getQuickFilter().attachChange(function(E){if(this._isCustomView()){D(this._getQuickFilter().getSelectedKey());}}.bind(this));}this.addView(new a({key:k,content:C.addStyleClass("sapUiMDCPanelPadding")}));var V=this._getViewSwitch();V.addItem(i);};h.prototype.showFactory=function(s){if(this.getCurrentViewContent().showFactory){this.getCurrentViewContent().showFactory(s);}};h.prototype.getSelectedFields=function(){return this.getCurrentViewContent().getSelectedFields();};h.prototype.setGroupExpanded=function(s,E){this.getView(this.GROUP_KEY).getContent().setGroupExpanded(s,E);};h.prototype.setP13nModel=function(m){this.setModel(m,this.P13N_MODEL);this.getView(this.LIST_KEY).getContent().setP13nData(m.getProperty("/items"));this.getView(this.GROUP_KEY).getContent().setP13nData(m.getProperty("/itemsGrouped"));this._filterByModeAndSearch();};h.prototype.setP13nData=function(p){var P=this.getP13nModel();if(!P){this.setP13nModel(new J(p));}else{this.getView(this.LIST_KEY).getContent().setP13nData(P.getProperty("/items"));this.getView(this.GROUP_KEY).getContent().setP13nData(P.getProperty("/itemsGrouped"));}};h.prototype.restoreDefaults=function(){this._getSearchField().setValue("");this._filterByModeAndSearch();};h.prototype.getP13nModel=function(){return this.getModel(this.P13N_MODEL);};h.prototype._getShowHideBtn=function(){var s=this._getResourceText("filterbar.ADAPT_SHOW_VALUE");var H=this._getResourceText("filterbar.ADAPT_HIDE_VALUE");if(!this._oShowHideBtn){this._oShowHideBtn=new B({press:function(E){this.showFactory(!this.getCurrentViewContent()._getShowFactory());var o=E.oSource;var n=o.getText()===s?H:s;o.setText(n);}.bind(this)});}this._oShowHideBtn.setText(!this._isCustomView()&&this.getCurrentViewContent()._getShowFactory()?H:s);return this._oShowHideBtn;};h.prototype._getQuickFilter=function(){if(!this._oGroupModeSelect){this._oGroupModeSelect=new c({items:[new I({key:"all",text:this._getResourceText("p13nDialog.GROUPMODE_ALL")}),new I({key:"visible",text:this._getResourceText("p13nDialog.GROUPMODE_VISIBLE")}),new I({key:"active",text:this._getResourceText("p13nDialog.GROUPMODE_ACTIVE")}),new I({key:"visibleactive",text:this._getResourceText("p13nDialog.GROUPMODE_VISIBLE_ACTIVE")}),new I({key:"mandatory",text:this._getResourceText("p13nDialog.GROUPMODE_MANDATORY")})],tooltip:this._getResourceText("p13nDialog.QUICK_FILTER"),change:this._onGroupModeChange.bind(this)});}return this._oGroupModeSelect;};h.prototype._getSearchField=function(){if(!this._oSearchField){this._oSearchField=new f(this.getId()+"-searchField",{liveChange:[this._filterByModeAndSearch,this],width:"100%",layoutData:new O({shrinkable:true,moveToOverflow:true,priority:"High",maxWidth:"16rem"})});this._oSearchField.setPlaceholder(this._getResourceText("p13nDialog.ADAPT_FILTER_SEARCH"));}return this._oSearchField;};h.prototype._onGroupModeChange=function(E){this._sModeKey=E.getParameters().selectedItem.getKey();this._filterByModeAndSearch();};h.prototype._getViewSwitch=function(){if(!this._oViewSwitch){this._oViewSwitch=new d({items:[new e({tooltip:this._getResourceText("filterbar.ADAPT_LIST_VIEW"),icon:"sap-icon://list",key:this.LIST_KEY}),new e({tooltip:this._getResourceText("filterbar.ADAPT_GROUP_VIEW"),icon:"sap-icon://group-2",key:this.GROUP_KEY})],selectionChange:function(E){if(this.getCurrentViewKey()===this.LIST_KEY){this.getCurrentViewContent()._removeMoveButtons();}var k=E.getParameter("item").getKey();this.switchView(k);}.bind(this)});}return this._oViewSwitch;};h.prototype._isCustomView=function(){return this._sCurrentView!=this.GROUP_KEY&&this._sCurrentView!=this.LIST_KEY;};h.prototype._filterByModeAndSearch=function(){if(this._isCustomView(this.getCurrentViewKey())){return;}this._sSearchString=this._getSearchField().getValue();var i=this._createFilterQuery();this._getSearchField().setValue(this._sSearchString);this.getCurrentViewContent().filterContent(i);return i;};h.prototype._getResourceText=function(k){return sap.ui.getCore().getLibraryResourceBundle("sap.ui.mdc").getText(k);};h.prototype._createFilterQuery=function(){var i=[],v=[],q=[];if(this._sSearchString){i=[new F("label","Contains",this._sSearchString),new F("tooltip","Contains",this._sSearchString)];q=new F(i,false);}switch(this._sModeKey){case"visible":v=new F("visible","EQ",true);break;case"active":v=new F("active","EQ",true);break;case"mandatory":v=new F("required","EQ",true);break;case"visibleactive":v=new F([new F("active","EQ",true),new F("visible","EQ",true)],true);break;default:}var V=new F("visibleInDialog","EQ",true);return new F([].concat(q,v,V),true);};h.prototype.exit=function(){A.prototype.exit.apply(this,arguments);this._sModeKey=null;this._sSearchString=null;};return h;});
