/*!
 * OpenUI5
 * (c) Copyright 2009-2022 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/base/util/Deferred","sap/ui/mdc/util/loadModules","sap/base/Log"],function(D,l,L){"use strict";var P={};P.init=function(i){return function(){this._oPropertyHelper=null;this._oPropertyHelperDeferred=new D();this._oApplySettingsDeferred=new D();this._bPropertyHelperFinal=false;this._bPropertyHelperInitializing=false;this._sPropertyInfoStore=null;if(i){i.apply(this,arguments);}};};P.applySettings=function(A){return function(){if(A){A.apply(this,arguments);}if(this._sPropertyInfoStore&&(!arguments[0]||!arguments[0].hasOwnProperty(this._sPropertyInfoStore))){_.call(this,[],false);}this._oApplySettingsDeferred.resolve(this);return this;};};P.initPropertyHelper=function(d,p,F){if(d){this._setPropertyHelperClass(d);}return _.call(this,p,F);};P.updatePropertyHelper=function(p,F){return _.call(this,p,F);};P.finalizePropertyHelper=function(){this._pHelperFinalizationPromise=this._pHelperFinalizationPromise||c(this).then(function(r){return _.call(this,r,true);}.bind(this));return this._pHelperFinalizationPromise;};P.isPropertyHelperFinal=function(){return this._bPropertyHelperFinal;};P.awaitPropertyHelper=function(){return this._oPropertyHelperDeferred.promise;};P.getPropertyHelper=function(){return this._oPropertyHelper;};P.exit=function(e){return function(){this._oPropertyHelper=null;this._oPropertyHelperDeferred=null;this._oApplySettingsDeferred=null;this._bPropertyHelperFinal=null;this._bPropertyHelperInitializing=null;this._pHelperFinalizationPromise=null;this._oPropertyHelperClass=null;this._sPropertyInfoStore=null;if(this._oPropertyInfoStoreMutatorOverride){this[this._oPropertyInfoStoreMutatorOverride.key]=this._oPropertyInfoStoreMutatorOverride.mutator;this._oPropertyInfoStoreMutatorOverride=null;}if(e){e.apply(this,arguments);}};};P._setupPropertyInfoStore=function(p){var o=this.getMetadata().getAllProperties();var d=o&&o[p];if(!d){throw new Error("PropertyHelperMixin: Property '"+p+"' not found.");}var j=this.getMetadata().getJSONKeys()[p];this._oPropertyInfoStoreMutatorOverride={key:j._sMutator,mutator:this[j._sMutator]};this[j._sMutator]=function(){this._oPropertyInfoStoreMutatorOverride.mutator.apply(this,arguments);if(!this._bPropertyHelperFinal){_.call(this,this[j._sGetter](),false);}return this;};this._sPropertyInfoStore=p;};P._setPropertyHelperClass=function(d){if(this._oPropertyHelper||this._bPropertyHelperInitializing){throw new Error("PropertyHelper already initializing/ed.");}if(d&&(!d.getMetadata||!d.getMetadata().isA("sap.ui.mdc.util.PropertyHelper"))){throw new Error("The custom property helper class must be sap.ui.mdc.util.PropertyHelper or a subclass of it.");}this._oPropertyHelperClass=d;};P._getPropertyByName=function(n){return this._oPropertyHelper&&this._oPropertyHelper.getProperty(n);};P._getPropertyByNameAsync=function(n){var p=this._getPropertyByName(n);if(!p){return this.finalizePropertyHelper().then(function(o){return this._getPropertyByName(n);}.bind(this));}return Promise.resolve(p);};function _(p,F){if(!this.bIsDestroyed){if(this._bPropertyHelperInitializing&&typeof p!=="undefined"){return this._oPropertyHelperDeferred.promise.then(function(){return b.call(this,p,F);}.bind(this));}if(this._oPropertyHelper&&typeof p!=="undefined"){b.call(this,p,F);}if(!this._oPropertyHelper){a.call(this,p,F);}}return this._oPropertyHelperDeferred&&this._oPropertyHelperDeferred.promise;}function a(p,F){this._bPropertyHelperInitializing=true;if(F||!p){F=true;this._pHelperFinalizationPromise=this._oPropertyHelperDeferred.promise;}var d;return this._oApplySettingsDeferred.promise.then(function(){return this.initControlDelegate();}.bind(this)).then(function(C){d=C;return F?c(this):p;}.bind(this)).then(function(p){if(this.bIsDestroyed){return[];}var r=[p];if(d&&typeof d.fetchPropertyExtensions==="function"){return d.fetchPropertyExtensions(this,p).then(function(e){return r.concat(e);});}return r.concat(undefined);}.bind(this)).then(function(r){if(this.bIsDestroyed){return[];}return f(this,d,r[0],r[1]).then(function(e){return r.concat(e);});}.bind(this)).then(function(r){if(this.bIsDestroyed){return undefined;}var p=r[0];var e=r[1];var g=r[2];this._oPropertyHelper=new g(p,e,this,undefined,undefined);this._bPropertyHelperInitializing=false;if(F){this._bPropertyHelperFinal=true;}return this._oPropertyHelperDeferred.resolve(this._oPropertyHelper);}.bind(this)).catch(function(e){return this._oPropertyHelperDeferred&&this._oPropertyHelperDeferred.reject(e);}.bind(this));}function b(p,F){if(this._bPropertyHelperFinal){throw new Error("This property helper is already final and cannot be updated further.");}this._oPropertyHelper.setProperties(p);this._bPropertyHelperFinal=F||this._bPropertyHelperFinal;return this._oPropertyHelper;}function c(C){return C.initControlDelegate().then(function(){return C.getControlDelegate(C).fetchProperties(C);});}function f(C,d,p){if(d&&typeof d.getPropertyHelperClass==="function"){var o=d.getPropertyHelperClass();var B=C._oPropertyHelperClass?C._oPropertyHelperClass.getMetadata().getName():"sap.ui.mdc.util.PropertyHelper";if(!o||!o.getMetadata||!o.getMetadata().isA(B)){throw new Error("The property helper class must be "+B+" or a subclass of it.");}return Promise.resolve(o);}if(C._oPropertyHelperClass){return Promise.resolve(C._oPropertyHelperClass);}return l("sap/ui/mdc/util/PropertyHelper").then(function(r){return r[0];});}return function(){this.init=P.init(this.init);this.exit=P.exit(this.exit);this.applySettings=P.applySettings(this.applySettings);this.initPropertyHelper=P.initPropertyHelper;this.awaitPropertyHelper=P.awaitPropertyHelper;this.getPropertyHelper=P.getPropertyHelper;this.finalizePropertyHelper=P.finalizePropertyHelper;this.isPropertyHelperFinal=P.isPropertyHelperFinal;this._getPropertyByName=P._getPropertyByName;this._getPropertyByNameAsync=P._getPropertyByNameAsync;this._setPropertyHelperClass=P._setPropertyHelperClass;this._setupPropertyInfoStore=P._setupPropertyInfoStore;};});
