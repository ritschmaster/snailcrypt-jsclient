/*
 * ! OpenUI5
 * (c) Copyright 2009-2022 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["../ChartDelegate","../../../util/loadModules","sap/ui/core/Core","sap/m/library","sap/m/Text","sap/ui/mdc/library","sap/ui/mdc/odata/v4/ODataMetaModelUtil","sap/base/Log",'sap/ui/mdc/util/FilterUtil','sap/ui/mdc/odata/v4/util/DelegateUtil',"sap/ui/mdc/chart/ChartTypeButton","sap/ui/mdc/chart/Item","sap/ui/model/Sorter","sap/m/VBox","sap/ui/base/ManagedObjectObserver","sap/ui/core/ResizeHandler","sap/ui/mdc/p13n/panels/ChartItemPanel","sap/m/MessageStrip","../TypeUtil","../FilterBarDelegate","sap/ui/model/Filter","sap/ui/mdc/odata/v4/ChartPropertyHelper","sap/ui/thirdparty/jquery"],function(V,l,C,m,T,M,O,L,F,D,c,d,S,f,g,R,h,n,o,p,q,P,Q){"use strict";var r=Object.assign({},V);var s=m.FlexJustifyContent;var t=m.FlexAlignItems;var u=new window.WeakMap();var v;var w;var x;var y;r._getState=function(a){if(u.has(a)){return u.get(a);}L.info("Couldn't get state for "+a.getId());};r._setState=function(a,b){u.set(a,b);};r.getTypeUtil=function(){return o;};r.getFilterDelegate=function(){return p;};r.addCondition=function(a,b,e){return Promise.resolve();};r.removeCondition=function(a,b,e){return Promise.resolve();};r._deleteState=function(a){if(this._getState(a).vizTooltip){this._getState(a).vizTooltip.destroy();}if(this._getState(a).observer){this._getState(a).observer.disconnect();this._getState(a).observer=null;}return u.delete(a);};r._getChart=function(a){if(u.has(a)){return u.get(a).innerChart;}L.info("Couldn't get state for "+a.getId());return undefined;};r._setChart=function(a,i){if(u.has(a)){u.get(a).innerChart=i;}else{u.set(a,{innerChart:i});}};r._getInnerStructure=function(a){if(u.has(a)){return u.get(a).innerStructure;}L.info("Couldn't get state for "+a.getId());return undefined;};r._setInnerStructure=function(a,i){if(u.has(a)){u.get(a).innerStructure=i;}else{u.set(a,{innerStructure:i});}};r._getBindingInfoFromState=function(a){if(u.has(a)){return u.get(a).bindingInfo;}L.info("Couldn't get state for "+a.getId());return undefined;};r._setBindingInfoForState=function(a,b){if(u.has(a)){u.get(a).bindingInfo=b;}else{u.set(a,{bindingInfo:b});}};r._setUpChartObserver=function(a){var b=this._getState(a);if(!b.observer){b.observer=new g(function(e){if(e.type==="destroy"){this.exit(e.object);}}.bind(this));}b.observer.observe(a,{destroy:true});};r.exit=function(a){if(this._getInnerStructure(a)){this._getInnerStructure(a).destroy();}this._deleteState(a);};r.zoomIn=function(a,i){this._getChart(a).zoom({direction:"in"});};r.zoomOut=function(a,i){this._getChart(a).zoom({direction:"out"});};r.getZoomState=function(a){if(this._getChart(a)){return this._getChart(a).getZoomInfo(this);}};r.getInnerChartSelectionHandler=function(a){return{eventId:"_selectionDetails",listener:this._getChart(a)};};r.getChartTypeLayoutConfig=function(){if(this._aChartTypeLayout){return this._aChartTypeLayout;}var a=[M.ChartItemRoleType.axis1,M.ChartItemRoleType.category,M.ChartItemRoleType.series];var b=[M.ChartItemRoleType.axis1,M.ChartItemRoleType.axis2,M.ChartItemRoleType.category,M.ChartItemRoleType.series];var e=[M.ChartItemRoleType.axis1,M.ChartItemRoleType.category,M.ChartItemRoleType.category2];var i=[M.ChartItemRoleType.axis1,M.ChartItemRoleType.axis2,M.ChartItemRoleType.axis3,M.ChartItemRoleType.category,M.ChartItemRoleType.series];this._aChartTypeLayout=[{key:"column",allowedLayoutOptions:a},{key:"bar",allowedLayoutOptions:a},{key:"line",allowedLayoutOptions:a},{key:"combination",allowedLayoutOptions:a},{key:"pie",allowedLayoutOptions:a},{key:"donut",allowedLayoutOptions:a},{key:"dual_column",allowedLayoutOptions:b},{key:"dual_bar",allowedLayoutOptions:b},{key:"dual_line",allowedLayoutOptions:b},{key:"stacked_bar",allowedLayoutOptions:a},{key:"scatter",allowedLayoutOptions:b},{key:"bubble",allowedLayoutOptions:i},{key:"heatmap",allowedLayoutOptions:e},{key:"bullet",allowedLayoutOptions:a},{key:"vertical_bullet",allowedLayoutOptions:a},{key:"dual_stacked_bar",allowedLayoutOptions:b},{key:"100_stacked_bar",allowedLayoutOptions:a},{key:"stacked_column",allowedLayoutOptions:a},{key:"dual_stacked_column",allowedLayoutOptions:b},{key:"100_stacked_column",allowedLayoutOptions:a},{key:"dual_combination",allowedLayoutOptions:b},{key:"dual_horizontal_combination",allowedLayoutOptions:b},{key:"dual_horizontal_combination",allowedLayoutOptions:b},{key:"dual_stacked_combination",allowedLayoutOptions:b},{key:"dual_horizontal_stacked_combination",allowedLayoutOptions:b},{key:"stacked_combination",allowedLayoutOptions:a},{key:"100_dual_stacked_bar",allowedLayoutOptions:a},{key:"100_dual_stacked_column",allowedLayoutOptions:a},{key:"horizontal_stacked_combination",allowedLayoutOptions:a},{key:"waterfall",allowedLayoutOptions:e},{key:"horizontal_waterfall",allowedLayoutOptions:e}];return this._aChartTypeLayout;};r.getAdaptionUI=function(a){return Promise.resolve(this._setupAdaptionUI(a));};r._setupAdaptionUI=function(a){var b=this.getChartTypeLayoutConfig().find(function(H){return H.key===a.getChartType();});if(!b){var e=[M.ChartItemRoleType.axis1,M.ChartItemRoleType.axis2,M.ChartItemRoleType.axis3,M.ChartItemRoleType.category,M.ChartItemRoleType.category2,M.ChartItemRoleType.series];b={key:a.getChartType(),allowedLayoutOptions:e};}var i=[{kind:"Groupable"},{kind:"Aggregatable"}];b.templateConfig=i;var j={panelConfig:b};var k=new h(j);if(a.getChartType()==="heatmap"){var G=sap.ui.getCore().getLibraryResourceBundle("sap.ui.mdc");k.setMessageStrip(new n({text:G.getText("chart.PERSONALIZATION_DIALOG_MEASURE_WARNING"),type:"Warning"}));}return k;};r.setLegendVisible=function(a,b){if(this._getChart(a)){this._getChart(a).setVizProperties({'legend':{'visible':b},'sizeLegend':{'visible':b}});}else{L.error("Could not set legend visibility since inner chart is not yet initialized!");}};r.getSorterForItem=function(a,b){if(a.getType()==="aggregatable"){return new S(this._getAggregatedMeasureNameForMDCItem(a),b.descending);}else if(a.getType()==="groupable"){return new S(this.getInternalChartNameFromPropertyNameAndKind(b.name,"groupable",a.getParent()),b.descending);}};r.insertItemToInnerChart=function(a,b,i){if(b.getType()==="groupable"){var I=this.getInternalChartNameFromPropertyNameAndKind(b.getName(),"groupable",a);var e=this._getChart(a).getDimensionByName(I);if(!e){this.createInnerDimension(a,b);}else{e.setLabel(b.getLabel());e.setRole(b.getRole()?b.getRole():"category");}var j=this._getChart(a).getVisibleDimensions();j.splice(i,0,I);this._getChart(a).setVisibleDimensions(j);}else if(b.getType()==="aggregatable"){this.createInnerMeasure(a,b);var k=this._getChart(a).getVisibleMeasures();k.splice(i,0,this._getAggregatedMeasureNameForMDCItem(b));this._getChart(a).setVisibleMeasures(k);}this._prepareColoringForItem(b).then(function(){this._updateColoring(a,this._getChart(a).getVisibleDimensions(),this._getChart(a).getVisibleMeasures());}.bind(this));this._updateSemanticalPattern(a);};r.removeItemFromInnerChart=function(a,b){if(b.getType()==="groupable"&&this._getChart(a).getVisibleDimensions().includes(this.getInternalChartNameFromPropertyNameAndKind(b.getName(),"groupable",a))){var i=this.getInternalChartNameFromPropertyNameAndKind(b.getName(),"groupable",a);var N=this._getChart(a).getVisibleDimensions().filter(function(e){return e!==i;});if(this._getState(a).inResultDimensions.length>0){this._getChart(a).setInResultDimensions(this._getState(a).inResultDimensions);}this._getChart(a).setVisibleDimensions(N);}else if(b.getType()==="aggregatable"&&this._getChart(a).getVisibleMeasures().includes(this._getAggregatedMeasureNameForMDCItem(b))){var j=[];a.getItems().filter(function(I){return I.getType()==="aggregatable";}).filter(function(I){return I!==b;}).forEach(function(I){j.push(this._getAggregatedMeasureNameForMDCItem(I));}.bind(this));this._getChart(a).setVisibleMeasures(j);this._getChart(a).removeMeasure(this._getChart(a).getMeasureByName(this._getAggregatedMeasureNameForMDCItem(b)));}this._updateColoring(a,this._getChart(a).getVisibleDimensions(),this._getChart(a).getVisibleMeasures());this._updateSemanticalPattern(a);};r.addItem=function(a,b,e,i){if(b.getModel){return Promise.resolve(this._createMDCChartItem(a,b,i));}};r.removeItem=function(a,b){return Promise.resolve(true);};r.checkAndUpdateMDCItems=function(a){return new Promise(function(b,e){var i=[];a.getItems().forEach(function(j){var I=j.getName()&&j.getLabel()&&j.getType()&&j.getRole();if(!I){i.push(this._getPropertyInfosByName(j.getName(),a).then(function(k){j.setLabel(k.label);if(k.groupable){j.setType("groupable");j.setRole(j.getRole()?j.getRole():"category");}else if(k.aggregatable){j.setType("aggregatable");j.setRole(j.getRole()?j.getRole():"axis1");}}));}}.bind(this));Promise.all(i).then(function(){b();});}.bind(this));};r._createMDCChartItem=function(a,b,e){return this._getPropertyInfosByName(a,b).then(function(i){if(!i){return null;}return this._createMDCItemFromProperty(i,b.getId(),e);}.bind(this));};r._createMDCItemFromProperty=function(a,i,b){if(a.groupable){return new d(i+"--GroupableItem--"+a.name,{name:a.name,label:a.label,type:"groupable",role:b?b:"category"});}if(a.aggregatable){return new d(i+"--AggregatableItem--"+a.name,{name:a.name,label:a.label,type:"aggregatable",role:b?b:"axis1"});}return null;};r.initializeInnerChart=function(a){return new Promise(function(b,e){this._loadChart().then(function(i){var j=this._calculateInnerChartHeight(a);this._setInnerStructure(a,new f({justifyContent:"Center",alignItems:"Center",height:j,width:"100%"}));var k=new T();k.setText(a.getNoDataText());this._getInnerStructure(a).addItem(k);this._setUpChartObserver(a);b(this._getInnerStructure(a));}.bind(this));}.bind(this));};r.createInitialChartContent=function(a){};r._createContentFromItems=function(a){return new Promise(function(b,e){var i=[];var j=[];var k=[];var G=[];a.getItems().forEach(function(I,H){j.push(this._getPropertyInfosByName(I.getName(),a).then(function(J){if(!J){L.error("sap.ui.mdc.Chart: Item "+I.getName()+" has no property info representing it in the metadata. Make sure the name is correct and the metadata is defined correctly. Skipping the item!");return;}switch(I.getType()){case"groupable":k.push(this.getInternalChartNameFromPropertyNameAndKind(I.getName(),"groupable",a));this._addInnerDimension(a,I,J);break;case"aggregatable":G.push(this._getAggregatedMeasureNameForMDCItem(I));this._addInnerMeasure(a,I,J);break;default:L.error("MDC Chart Item "+I.getId()+" with label "+I.getLabel()+" has no known type. Supported typed are: \"groupable\" & \"aggregatable\"");}i.push(this._prepareColoringForItem(I));}.bind(this)));}.bind(this));Promise.all(j).then(function(){this._getState(a).aColMeasures.forEach(function(K){if(this._getState(a).aInSettings.indexOf(K)==-1){i.push(new Promise(function(b,e){a._getPropertyByNameAsync(K).then(function(H){var I=H.aggregationMethod;var J=H.propertyPath;var N=this.getInternalChartNameFromPropertyNameAndKind(K,"aggregatable",a);var U={name:N,label:H.label,role:"axis1"};if(I&&J){U.analyticalInfo={propertyPath:J,"with":I};}var W=new x(U);G.push(W);this._getChart(a).addMeasure(W);b();});}));}}.bind(this));Promise.all(i).then(function(){this._getChart(a).setVisibleDimensions(k);this._getChart(a).setVisibleMeasures(G);var I=a.getDelegate().inResultDimensions;if(I&&I instanceof Array&&I.length!=0){var H=[];I.forEach(function(J){H.push(this._getPropertyInfosByName(J,a).then(function(K){var N=this.getInternalChartNameFromPropertyNameAndKind(K.name,"groupable",a);var U=new w({name:N,label:K.label});this._getState(a).inResultDimensions.push(N);this._getChart(a).addDimension(U);}.bind(this)));}.bind(this));Promise.all(H).then(function(){this._getChart(a).setInResultDimensions(this._getState(a).inResultDimensions);}.bind(this));}this._updateColoring(a,k,G);this._updateSemanticalPattern(a);b();}.bind(this));}.bind(this));}.bind(this));};r.getInnerChart=function(a){return this._getChart(a);};r._prepareColoringForItem=function(i){return this._addCriticality(i).then(function(){this._getState(i.getParent()).aInSettings.push(i.getName());if(i.getType==="aggregatable"){this._getPropertyInfosByName(i.getName(),i.getParent()).then(function(a){for(var j=0;j<this._getAdditionalColoringMeasuresForItem(a);j++){if(this._getState(i.getParent()).aColMeasures.indexOf(this._getAdditionalColoringMeasuresForItem(a)[j])==-1){this._getState(i.getParent()).aColMeasures.push(this._getAdditionalColoringMeasuresForItem(a)[j]);}}}.bind(this));}}.bind(this));};r._getAdditionalColoringMeasuresForItem=function(a){var b=[];var e=a.datapoint?a.datapoint.criticality:null;if(e&&e.DynamicThresholds){b=e.DynamicThresholds.usedMeasures;}return b;};r._addCriticality=function(i){return this._getPropertyInfosByName(i.getName(),i.getParent()).then(function(a){if(a.criticality||(a.datapoint&&a.datapoint.criticality)){var b=this._getState(i.getParent()).oColorings||{Criticality:{DimensionValues:{},MeasureValues:{}}};var e={};if(i.getType()=="groupable"){var j=a.criticality?a.criticality:[];for(var k in j){e[k]={Values:j[k]};}var G=this.getInternalChartNameFromPropertyNameAndKind(i.getName(),"groupable",i.getParent());b.Criticality.DimensionValues[G]=e;}else{var j=a.datapoint&&a.datapoint.criticality?a.datapoint.criticality:[];for(var k in j){e[k]=j[k];}var H=this.getInternalChartNameFromPropertyNameAndKind(i.getName(),"aggregatable",i.getParent());b.Criticality.MeasureValues[H]=e;}var I=this._getState(i.getParent());I.oColorings=b;this._setState(i.getParent(),I);}}.bind(this));};r._updateColoring=function(a,b,e){var i=Q.extend(true,{},this._getState(a).oColorings),k;if(i&&i.Criticality){var j;for(k=0;k<b.length;k++){if(this._getState(a).oColorings.Criticality.DimensionValues[b[k]]){j={coloring:"Criticality",parameters:{dimension:b[k]}};delete i.Criticality.MeasureValues;break;}}if(!j){delete i.Criticality.DimensionValues;for(var G in i.Criticality.MeasureValues){if(e.indexOf(G)==-1){delete i.Criticality.MeasureValues[G];}}j={coloring:"Criticality",parameters:{measure:e}};}if(j){this._getChart(a).setColorings(i);this._getChart(a).setActiveColoring(j);}}};r._updateSemanticalPattern=function(a){var b=this._getChart(a).getVisibleMeasures();b.forEach(function(e){var i=this.getPropertyFromNameAndKind(e,"aggregatable",a);if(!i){return;}var j=i.datapoint;if(j){if(j.targetValue||j.foreCastValue){var k=this._getChart(a).getMeasureByName(e);k.setSemantics("actual");if(j.targetValue!=null){var G=this._getChart(a).getMeasureByName(j.targetValue);if(G){G.setSemantics("reference");}else{L.error("sap.ui.mdc.Chart: "+j.targetValue+" is not a valid measure");}}if(j.foreCastValue){var H=this._getChart(a).getMeasureByName(j.foreCastValue);if(H){H.setSemantics("projected");}else{L.error("sap.ui.comp.SmartChart: "+j.ForecastValue.Path+" is not a valid measure");}}k.setSemanticallyRelatedMeasures({referenceValueMeasure:j.targetValue,projectedValueMeasure:j.foreCastValue});}}}.bind(this));};r.getChartTypeInfo=function(a){if(!this._getChart(a)){throw'inner chart is not bound';}var b=a.getChartType(),e=C.getLibraryResourceBundle("sap.ui.mdc");var i={icon:c.mMatchingIcon[b],text:e.getText("chart.CHART_TYPE_TOOLTIP",[b])};return i;};r.getAvailableChartTypes=function(a){var b=[];if(this._getChart(a)){var e=this._getChart(a).getAvailableChartTypes().available;if(b){var j=C.getLibraryResourceBundle("sap.chart.messages");for(var i=0;i<e.length;i++){var k=e[i].chart;b.push({key:k,icon:c.mMatchingIcon[k],text:j.getText("info/"+k),selected:(k==a.getChartType())});}}}return b;};r.getDrillStackInfo=function(){};r.getDrillStack=function(a){var b=[];b=Object.assign(b,this._getChart(a).getDrillStack());b.forEach(function(e){e.dimension=e.dimension.map(function(i){var j=this.getPropertyFromNameAndKind(i,"groupable",a);if(j){return j.name;}else{L.error("MDC Chart Delegate: Couldn't map chart dimension to groupable property: "+i);return i;}}.bind(this));}.bind(this));return b;};r.getSortedDimensions=function(a){return new Promise(function(b,e){if(a.isPropertyHelperFinal()){b(this._sortPropertyDimensions(a.getPropertyHelper().getProperties()));}else{a.finalizePropertyHelper().then(function(){b(this._sortPropertyDimensions(a.getPropertyHelper().getProperties()));}.bind(this));}}.bind(this));};r._sortPropertyDimensions=function(e){var i=e.filter(function(I){return I.groupable;});if(i){i.sort(function(a,b){if(a.label&&b.label){return a.label.localeCompare(b.label);}});}return i;};r.getDrillableItems=function(a){var b=a.getItems().filter(function(i){return i.getType()==="groupable";});return b;};r.setChartType=function(a,b){this._getChart(a).setChartType(b);};r.createInnerChartContent=function(a,b){return new Promise(function(e,i){this._setChart(a,new v({id:a.getId()+"--innerChart",chartType:"column",width:"100%",isAnalytical:true}));this._getChart(a).setCustomMessages({'NO_DATA':a.getNoDataText()});this._getState(a).inResultDimensions=[];if(a.getHeight()){this._getChart(a).setHeight(this._calculateInnerChartHeight(a));}R.register(a,function(){this.adjustChartHeight(a);}.bind(this));var j=this._getState(a);j.aColMeasures=[];j.aInSettings=[];this._setState(a,j);this._createContentFromItems(a).then(function(){this._getChart(a).attachRenderComplete(function(){if(this._getState(a).toolbarUpdateRequested){a._updateToolbar();this._getState(a).toolbarUpdateRequested=false;}}.bind(this));this._getInnerStructure(a).removeAllItems();this._getInnerStructure(a).setJustifyContent(s.Start);this._getInnerStructure(a).setAlignItems(t.Stretch);this._getInnerStructure(a).addItem(this._getChart(a));j.dataLoadedCallback=b;this._setState(a,j);var k=this._getBindingInfo(a);this.updateBindingInfo(a,k);this._performInitialBind(a,k);e();}.bind(this));}.bind(this));};r._performInitialBind=function(a,b){if(a&&b&&this._getChart(a)){this._addBindingListener(b,"dataReceived",this._getState(a).dataLoadedCallback.bind(a));this._getChart(a).bindData(b);this._setBindingInfoForState(a,b);var e=this._getState(a);e.innerChartBound=true;}};r._calculateInnerChartHeight=function(a){var i=Q(a.getDomRef()).height();var b=0;var e=a.getAggregation("_toolbar");var j=0;var k=a.getAggregation("_breadcrumbs");if(e){b=Q(e.getDomRef()).outerHeight(true);}if(k){j=Q(k.getDomRef()).outerHeight(true);}var G=j+b;if(!i){return"480px";}return i-G+"px";};r.adjustChartHeight=function(a){if(a.getHeight()&&this._getChart(a)){var H=this._calculateInnerChartHeight(a);this._getInnerStructure(a).setHeight(H);this._getChart(a).setHeight(H);}};r.requestToolbarUpdate=function(a){this._getState(a).toolbarUpdateRequested=true;};r.createInnerDimension=function(a,b){this._getPropertyInfosByName(b.getName(),a).then(function(e){this._addInnerDimension(a,b,e);}.bind(this));};r.createInnerMeasure=function(a,b){this._getPropertyInfosByName(b.getName(),a).then(function(e){this._addInnerMeasure(a,b,e);}.bind(this));};r._addInnerDimension=function(a,b,e){var i=new w({name:this.getInternalChartNameFromPropertyNameAndKind(b.getName(),"groupable",a),role:b.getRole()?b.getRole():"category",label:b.getLabel()});if(e.textProperty){i.setTextProperty(e.textProperty);if(e.textFormatter){i.setTextFormatter(this._formatText.bind(e));}i.setDisplayText(true);}this._getChart(a).addDimension(i);};r._addInnerMeasure=function(a,b,e){var i=e.aggregationMethod;var j=e.propertyPath;var k={name:this._getAggregatedMeasureNameForMDCItem(b),label:b.getLabel(),role:b.getRole()?b.getRole():"axis1"};if(i&&j){k.analyticalInfo={propertyPath:j,"with":i};}var G=new x(k);this._getChart(a).addMeasure(G);};r._getAggregatedMeasureNameForProperty=function(a){return a.aggregationMethod+a.name;};r.rebindChart=function(a,b){this.rebind(a,b);};r.rebind=function(a,b){if(a&&b&&this._getChart(a)){this._addBindingListener(b,"dataReceived",this._getState(a).dataLoadedCallback.bind(a));if(b.binding){b.binding.bHasAnalyticalInfo=true;}this._getChart(a).bindData(b);this._setBindingInfoForState(a,b);var e=this._getState(a);e.innerChartBound=true;}};r._getBindingInfo=function(a){if(this._getBindingInfoFromState(a)){return this._getBindingInfoFromState(a);}var b=a.getDelegate().payload;var e="/"+b.collectionName;var i={path:e};return i;};r.getInnerChartBound=function(a){var b=this._getState(a);if(!b){return false;}return b.innerChartBound?true:false;};r.updateBindingInfo=function(a,b){var e=z.call(this,a).concat(A.call(this,a));B(a,b);b.filters=new q(e,true);b.sorter=this.getSorters(a);};function z(a){var b=a.getP13nMode().indexOf("Filter")>-1;var e=[];if(b){var i=a.getPropertyHelper().getProperties();var I=F.getFilterInfo(this.getTypeUtil(),a.getConditions(),i);if(I.filters){e.push(I.filters);}}return e;}function A(a){var b=C.byId(a.getFilter());var e=[];if(!b){return e;}var i=b.getConditions();if(i){var j=b.getPropertyInfoSet?b.getPropertyInfoSet():null;var k=D.getParameterNames(b);var G=F.getFilterInfo(this.getTypeUtil(),i,j,k);if(G.filters){e.push(G.filters);}}return e;}function B(a,b){var e=C.byId(a.getFilter());if(!e){return;}var i=e.getConditions();var j=e.getSearch instanceof Function?e.getSearch():"";if(i){var k=D.getParametersInfo(e,i);if(k){b.path=k;}}if(!b.parameters){b.parameters={};}b.parameters["$search"]=j||undefined;}r.getSorters=function(a){var b;var e=a.getSortConditions()?a.getSortConditions().sorters:[];e.forEach(function(i){var j=a.getItems().find(function(G){return G.getName()===i.name;});if(!j){return;}var k=this.getSorterForItem(j,i);if(b){b.push(k);}else{b=[k];}}.bind(this));return b;};r._getAggregatedMeasureNameForMDCItem=function(a){return this.getInternalChartNameFromPropertyNameAndKind(a.getName(),"aggregatable",a.getParent());};r.getInternalChartNameFromPropertyNameAndKind=function(N,k,a){return N;};r.getPropertyFromNameAndKind=function(N,k,a){return a.getPropertyHelper().getProperty(N);};r.addInnerItem=function(a,b,e){return Promise.resolve(null);};r.insertInnerItem=function(a,b,e){};r.removeInnerItem=function(a,b,e){return Promise.resolve(true);};r.setChartTooltipVisibility=function(a,b){if(this._getChart(a)){if(b){if(!this._getState(a).vizTooltip){var e=this._getState(a);e.vizTooltip=new y();this._setState(a,e);}this._getState(a).vizTooltip.connect(this._getChart(a).getVizUid());}else if(this._getState(a).vizTooltip){this._getState(a).vizTooltip.destroy();}}else{L.error("Trying to set chart tooltip while inner chart was not yet initialized");}};r._loadChart=function(){return new Promise(function(a){var N=['sap/chart/library','sap/chart/Chart','sap/chart/data/Dimension','sap/chart/data/HierarchyDimension','sap/chart/data/TimeDimension','sap/chart/data/Measure','sap/viz/ui5/controls/VizTooltip'];function b(e,i,j,H,k,G,I){v=i;w=j;x=G;y=I;a();}sap.ui.require(N,b);});};r.getPropertyHelperClass=function(){return P;};r._formatText=function(k,a){return k;};r.setNoDataText=function(a,b){this._getChart(a).setCustomMessages({'NO_DATA':b});};r.fetchProperties=function(a){var b=this._getModel(a);var e;if(!b){e=new Promise(function(i){a.attachModelContextChange({resolver:i},E,this);}.bind(this)).then(function(b){return this._createPropertyInfos(a.getDelegate().payload,b);}.bind(this));}else{e=this._createPropertyInfos(a.getDelegate().payload,b);}return e.then(function(i){if(a.data){a.data("$mdcChartPropertyInfo",i);}return i;});};function E(e,a){var b=e.getSource();var i=this._getModel(b);if(i){b.detachModelContextChange(E);a.resolver(i);}}r._createPropertyInfos=function(a,b){var e=[];var i="/"+a.collectionName;var j=b.getMetaModel();return Promise.all([j.requestObject(i+"/"),j.requestObject(i+"@")]).then(function(k){var G=k[0],H=k[1];var I=H["@Org.OData.Capabilities.V1.SortRestrictions"]||{};var J=O.getSortRestrictionsInfo(I);var K=H["@Org.OData.Capabilities.V1.FilterRestrictions"];var N=O.getFilterRestrictionsInfo(K);for(var U in G){var W=G[U];if(W&&W.$kind==="Property"){if(W.$isCollection){continue;}var X=j.getObject(i+"/"+U+"@");if(!X["@Org.OData.Aggregation.V1.Aggregatable"]&&!X["@Org.OData.Aggregation.V1.Groupable"]){continue;}if(X["@Org.OData.Aggregation.V1.Aggregatable"]){e=e.concat(this._createPropertyInfosForAggregatable(U,X,W,N,J));}if(X["@Org.OData.Aggregation.V1.Groupable"]){e.push({name:U,propertyPath:U,label:X["@com.sap.vocabularies.Common.v1.Label"]||U,sortable:J[U]?J[U].sortable:true,filterable:N[U]?N[U].filterable:true,groupable:true,aggregatable:false,maxConditions:O.isMultiValueFilterExpression(N.propertyInfo[U])?-1:1,sortKey:U,dataType:W.$Type,role:M.ChartItemRoleType.category,criticality:null,textProperty:X["@com.sap.vocabularies.Common.v1.Text"]?X["@com.sap.vocabularies.Common.v1.Text"].$Path:null});}}}return e;}.bind(this));};r._createPropertyInfosForAggregatable=function(k,a,b,e,i){var j=[];if(a["@Org.OData.Aggregation.V1.SupportedAggregationMethods"]){a["@Org.OData.Aggregation.V1.SupportedAggregationMethods"].forEach(function(G){j.push({name:G+k,propertyPath:k,label:a["@com.sap.vocabularies.Common.v1.Label"]+" ("+G+")"||k+" ("+G+")",sortable:i[k]?i[k].sortable:true,filterable:e[k]?e[k].filterable:true,groupable:false,aggregatable:a["@Org.OData.Aggregation.V1.Aggregatable"],aggregationMethod:G,maxConditions:O.isMultiValueFilterExpression(e.propertyInfo[k])?-1:1,dataType:b.$Type,datapoint:null});});}return j;};r._getPropertyInfosByName=function(N,a){return a._getPropertyByNameAsync(N);};r._getModel=function(a){var b=a.getDelegate().payload;return a.getModel(b.model);};r._addBindingListener=function(b,e,H){if(!b.events){b.events={};}if(!b.events[e]){b.events[e]=H;}else{var a=b.events[e];b.events[e]=function(){H.apply(this,arguments);a.apply(this,arguments);};}};return r;});
