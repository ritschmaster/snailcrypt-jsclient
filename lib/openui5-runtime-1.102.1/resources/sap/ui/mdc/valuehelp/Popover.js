/*
 * ! OpenUI5
 * (c) Copyright 2009-2022 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(['sap/ui/mdc/valuehelp/base/Container','sap/ui/mdc/util/loadModules',"sap/ui/dom/units/Rem","sap/ui/thirdparty/jquery"],function(C,l,R,q){"use strict";var M,a,T,b;var P=C.extend("sap.ui.mdc.valuehelp.Popover",{metadata:{library:"sap.ui.mdc",interfaces:["sap.ui.mdc.valuehelp.ITypeaheadContainer","sap.ui.mdc.valuehelp.IDialogContainer"],properties:{},defaultAggregation:"content"}});P.prototype.invalidate=function(o){if(o){var p=this.getAggregation("_container");var c=this._oCurrentContent;if(p&&c&&o===c&&!this._bIsBeingDestroyed){p.invalidate(o);}else{C.prototype.invalidate.apply(this,arguments);}}};P.prototype._getUIAreaForContent=function(){var p=this.getAggregation("_container");if(p){return p.getUIArea();}return C.prototype._getUIAreaForContent.apply(this,arguments);};P.prototype._getContent=function(){var c=this.getContent();return c&&c[0];};P.prototype._getContainer=function(){var p=this.getAggregation("_container");if(!p){return l(["sap/m/Popover","sap/m/library","sap/m/Toolbar","sap/m/ToolbarSpacer"]).then(function(L){M=L[0];a=L[1];T=L[2];b=L[3];p=new M(this.getId()+"-pop",{contentHeight:"auto",placement:a.PlacementType.VerticalPreferredBottom,showHeader:false,showArrow:false,title:this.getTitle(),titleAlignment:a.TitleAlignment.Center,afterOpen:this._handleOpened.bind(this),afterClose:this._handleClosed.bind(this)}).addStyleClass("sapMdcValueHelpPopover").addStyleClass("sapMComboBoxBasePicker").addStyleClass("sapMComboBoxBasePicker-CTX");p.addStyleClass(this._isSingleSelect()?"sapMdcValueHelpSingleSelect":"sapMdcValueHelpMultiSelect");p.addDelegate({onsapshow:this._handleRequestSwitchToDialog.bind(this)});p._getAllContent=function(){var d=this.getParent();var e=[];if(d){if(this._oCurrentContent){e.push(this._oCurrentContent);}}return e;}.bind(this);var c=this._getContent();var o=this._getContainerConfig(c);if(o){p.setShowArrow(!!o.showArrow);p.setShowHeader(!!o.showHeader);p.setResizable(!!o.resizable);if(o.getContentWidth){p.setContentWidth(o.getContentWidth());}}this.setAggregation("_container",p,true);return p;}.bind(this));}return p;};var _=function(){var c=this.getAggregation("_container");var o=this._getContent();var d=o&&this._getContainerConfig(o);if(c&&d&&d.getContentHeight){var h=d.getContentHeight();var i=c.$().find(".sapMPopoverCont").height();var e=i<R.toPx("30rem");c.setContentHeight(!h||e||i>=h?"auto":"30rem");c.invalidate();}};P.prototype.providesScrolling=function(){return true;};P.prototype._observeChanges=function(c){if(c.name==="content"){var o=c.child;if(c.mutation==="remove"){o.detachEvent("contentUpdated",_,this);o.detachNavigated(this._handleNavigated,this);}else{o.attachEvent("contentUpdated",_,this);}}C.prototype._observeChanges.apply(this,arguments);};P.prototype._placeContent=function(p){var c=this._getContent();var o=c&&c.getContent();var B=c&&c.onBeforeShow();var d=this._getContainerConfig(c);var f=d&&d.getFooter&&d.getFooter();return Promise.all([o,f,B]).then(function(e){this._oCurrentContent=e[0];var F=e[1];if(F&&p.getFooter()!=F&&F.isA&&F.isA("sap.m.Toolbar")){p.setFooter(F);return p;}if(F){if(!p.getFooter()){var t=[new b(this.getId()+"-Spacer")].concat(F);var g=new T(this.getId()+"-TB",{content:t}).setModel(this._oManagedObjectModel,"$help");p.setFooter(g);}else{}}else if(p.getFooter()){p.setFooter();}return p;}.bind(this));};P.prototype._open=function(p){if(p.isOpen()){return;}var c=this._getControl();var t=c&&c.getFocusElementForValueHelp?c.getFocusElementForValueHelp(this.isTypeahead()):c;if(t&&t.getDomRef()){p.setContentMinWidth(q(t.getDomRef()).outerWidth()+"px");if(!this.isFocusInHelp()){p.setInitialFocus(t);}p.openBy(t);}};P.prototype._close=function(){var p=this.getAggregation("_container");if(p){p.close();}};P.prototype._handleOpened=function(){_.call(this);C.prototype._handleOpened.apply(this,arguments);var c=this._getContent();if(c){c.onShow();}};P.prototype._handleConfirmed=function(e){this.fireConfirm({close:e.getParameter("close")||this._isSingleSelect()});};P.prototype._handleClosed=function(e){var c=this._getContent();if(c){c.onHide();}var p=this.getAggregation("_container");if(p){p._oPreviousFocus=null;}C.prototype._handleClosed.apply(this,arguments);};P.prototype.removeFocus=function(){var c=this._getContent();if(c){c.removeFocus();}};P.prototype._navigate=function(s){var c=this._getContent();if(c){return c.navigate(s);}};P.prototype.getItemForValue=function(c){var o=this._getContent();if(o){return o.getItemForValue(c);}};P.prototype.isValidationSupported=function(c){var o=this._getContent();if(o){return o.isValidationSupported();}};P.prototype.getUseAsValueHelp=function(){var c=this._getContent();return c&&c.getUseAsValueHelp&&c.getUseAsValueHelp();};P.prototype.getValueHelpIcon=function(){var c=this._getContent();return c&&c.getValueHelpIcon();};P.prototype.getAriaAttributes=function(m){var c=this._getContent();var o=c&&c.getAriaAttributes(m);if(o){return{contentId:o.contentId,ariaHasPopup:o.ariaHasPopup,role:this.getUseAsValueHelp()?"combobox":null,roleDescription:o.roleDescription};}return C.prototype.getAriaAttributes.apply(this,arguments);};P.prototype.shouldOpenOnClick=function(){var c=this._getContent();return!!c&&c.shouldOpenOnClick();};P.prototype.shouldOpenOnNavigate=function(){var c=this._getContent();return!!c&&c.shouldOpenOnNavigate();};P.prototype.isFocusInHelp=function(){var c=this._getContent();return!!c&&c.isFocusInHelp();};P.prototype.isMultiSelect=function(){var c=this._getContent();return!!c&&c.isMultiSelect();};P.prototype.isTypeaheadSupported=function(){var c=this._getContent();return c&&c.isSearchSupported();};P.prototype.exit=function(){if(this._oCurrentContent){if(!this._oCurrentContent.bIsDestroyed){this._oCurrentContent.destroy();}this._oCurrentContent=null;}};return P;});
