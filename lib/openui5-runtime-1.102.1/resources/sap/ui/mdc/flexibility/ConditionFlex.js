/*
 * ! OpenUI5
 * (c) Copyright 2009-2022 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(['sap/base/util/merge','sap/base/Log','sap/ui/mdc/condition/FilterOperatorUtil'],function(m,L,F){"use strict";var q=function(C,t){var f=function(p){if(C._pQueue===p){delete C._pQueue;}};C._pQueue=C._pQueue instanceof Promise?C._pQueue.then(t):t();C._pQueue.then(f.bind(null,C._pQueue));return C._pQueue;};var g=function(D){return new Promise(function(R,f){sap.ui.require([D],R,f);});};var d=function(C){var o=C&&C.getEngine?C.getEngine().getController(C,"Filter"):null;return o?o.getFilterControl():null;};var a=function(C,o,b,p,i){var f=d(b);if(f&&f.applyConditionsAfterChangesApplied){f.applyConditionsAfterChangesApplied(b);}return q(b,function(){var e,h=null,M=p.modifier;return M.getProperty(b,"filterConditions").then(function(j){e=m({},j);if(e){for(var s in e){if(s===o.name){h=e[s];break;}}}if(!h){e[o.name]=[];h=e[o.name];}var n=F.indexOfCondition(o.condition,h);if(n<0){h.push(o.condition);M.setProperty(b,"filterConditions",e);if(!i){C.setRevertData({name:o.name,condition:o.condition});}return M.getProperty(b,"delegate").then(function(D){return g(D.name);}).then(function(D){var k=D&&(D.getFilterDelegate?D.getFilterDelegate().addCondition:D.addCondition);if(k){return k(o.name,b,p).catch(function(E){L.error("Error during Delegate.addCondition call: "+E);});}}).finally(function(){if(f&&f.addCondition){return f.addCondition(o.name,o.condition);}});}});});};var r=function(C,o,b,p,i){var f=d(b);if(f&&f.applyConditionsAfterChangesApplied){f.applyConditionsAfterChangesApplied(b);}return q(b,function(){var e,h,n=-1,M=p.modifier;return M.getProperty(b,"filterConditions").then(function(j){e=m({},j);if(e){for(var s in e){if(s===o.name){h=e[s];break;}}}if(h&&(h.length>0)){n=F.indexOfCondition(o.condition,h);if(n>=0){h.splice(n,1);M.setProperty(b,"filterConditions",e);if(!i){C.setRevertData({name:o.name,condition:o.condition});}return M.getProperty(b,"delegate").then(function(D){return g(D.name);}).then(function(D){var k=D&&(D.getFilterDelegate?D.getFilterDelegate().removeCondition:D.removeCondition);if(k){return k(o.name,b,p).catch(function(E){L.error("Error during Delegate.removeCondition call: "+E);});}}).finally(function(){if(f&&f.removeCondition){return f.removeCondition(o.name,o.condition);}});}}});});};var c={};c.addCondition={"changeHandler":{applyChange:function(C,o,p){return a(C,C.getContent(),o,p,false);},completeChangeContent:function(C,b,p){},revertChange:function(C,o,p){return r(C,C.getRevertData(),o,p,true).then(function(){C.resetRevertData();});}},"layers":{"USER":true}};c.removeCondition={"changeHandler":{applyChange:function(C,o,p){return r(C,C.getContent(),o,p,false);},completeChangeContent:function(C,b,p){},revertChange:function(C,o,p){return a(C,C.getRevertData(),o,p,true).then(function(){C.resetRevertData();});}},"layers":{"USER":true}};return c;});
