/*
 * ! OpenUI5
 * (c) Copyright 2009-2022 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["./GridTableType","./ResponsiveTableType","sap/m/library","sap/m/Label","sap/ui/model/json/JSONModel","sap/ui/model/base/ManagedObjectModel","sap/ui/core/Control","sap/ui/core/Core"],function(G,R,M,L,J,a,C,b){"use strict";var c=C.extend("sap.ui.mdc.table.Column",{metadata:{library:"sap.ui.mdc",defaultAggregation:"template",properties:{width:{type:"sap.ui.core.CSSSize",group:"Dimension",defaultValue:null},minWidth:{type:"float",group:"Behavior",defaultValue:8},header:{type:"string"},headerVisible:{type:"boolean",group:"Misc",defaultValue:true},hAlign:{type:"sap.ui.core.HorizontalAlign",defaultValue:"Begin"},importance:{type:"sap.ui.core.Priority",group:"Behavior",defaultValue:"None"},initialIndex:{type:"int",defaultValue:-1},dataProperty:{type:"string"}},aggregations:{template:{type:"sap.ui.core.Control",multiple:false},creationTemplate:{type:"sap.ui.core.Control",multiple:false}}},renderer:{apiVersion:2,render:function(r,o){r.openStart("div",o);r.openEnd();if(o._oColumnHeaderLabel){r.renderControl(o._oColumnHeaderLabel.getLabel());}r.close("div");}}});c.prototype.init=function(){this.mSkipPropagation={template:true,creationTemplate:true};this._oManagedObjectModel=new a(this);this._oSettingsModel=new J({width:this.getWidth(),calculatedWidth:null,p13nWidth:null,resizable:false});};c.prototype.getInnerColumn=function(){var t=this.getTable();if(t&&(!this._oInnerColumn||this._oInnerColumn.isDestroyed())){this._oInnerColumn=this._createInnerColumn();}return this._oInnerColumn;};c.prototype._createInnerColumn=function(){var t=this.getTable();var o;var w={parts:[{path:"$this>/width"},{path:"$columnSettings>/calculatedWidth"},{path:"$columnSettings>/p13nWidth"}],formatter:function(W,s,p){return p||s||W;}};this._readP13nValues();if(t._bMobileTable){o=R.createColumn(this.getId()+"-innerColumn",{width:w,autoPopinWidth:"{$this>/minWidth}",hAlign:"{$this>/hAlign}",header:this._getColumnHeaderLabel(),importance:"{$this>/importance}",popinDisplay:"Inline"});}else{o=G.createColumn(this.getId()+"-innerColumn",{width:w,minWidth:{path:"$this>/minWidth",formatter:function(m){return Math.round(m*parseFloat(M.BaseFontSize));}},hAlign:"{$this>/hAlign}",label:this._getColumnHeaderLabel(),resizable:"{$columnSettings>/resizable}",autoResizable:"{$columnSettings>/resizable}",template:this.getTemplateClone()});o.setCreationTemplate(this.getCreationTemplateClone());}o.setModel(this._oManagedObjectModel,"$this");o.setModel(this._oSettingsModel,"$columnSettings");return o;};var d=C.extend("sap.ui.mdc.table.ColumnHeaderLabel",{metadata:{"final":true,aggregations:{label:{type:"sap.m.Label",multiple:false}},associations:{column:{type:"sap.ui.mdc.table.Column"}}},renderer:{apiVersion:2,render:function(r,o){r.openStart("div",o);r.style("width","100%");r.openEnd();r.renderControl(b.byId(o.getColumn()));r.close("div");}},getText:function(){return this.getLabel().getText();},clone:function(){return this.getLabel().clone();}});c.prototype._getColumnHeaderLabel=function(){var t=this.getTable();if(t&&(!this._oColumnHeaderLabel||this._oColumnHeaderLabel.isDestroyed())){this._oColumnHeaderLabel=new d({column:this,label:new L({width:"{= ${$this>/headerVisible} ? null : '0px' }",text:"{$this>/header}",textAlign:"{$this>/hAlign}",wrapping:{parts:[{path:"$this>/headerVisible"},{path:"$columnSettings>/resizable"}],formatter:function(h,r){return t._bMobileTable&&h&&!r;}},wrappingType:t._bMobileTable?"Hyphenated":null})});}return this._oColumnHeaderLabel;};c.prototype.getTemplateClone=function(){var t=this.getTable();var T=this.getTemplate();if(t&&T&&(!this._oTemplateClone||this._oTemplateClone.isDestroyed())){this._oTemplateClone=T.clone();if(!t._bMobileTable){if(this._oTemplateClone.setWrapping){this._oTemplateClone.setWrapping(false);}if(this._oTemplateClone.setRenderWhitespace){this._oTemplateClone.setRenderWhitespace(false);}}}return this._oTemplateClone;};c.prototype.getCreationTemplateClone=function(){var t=this.getTable();var o=this.getCreationTemplate();if(t&&o&&(!this._oCreationTemplateClone||this._oCreationTemplateClone.isDestroyed())){this._oCreationTemplateClone=o.clone();if(!t._bMobileTable){if(this._oCreationTemplateClone.setWrapping){this._oCreationTemplateClone.setWrapping(false);}if(this._oCreationTemplateClone.setRenderWhitespace){this._oCreationTemplateClone.setRenderWhitespace(false);}}}return this._oCreationTemplateClone;};c.prototype.setHeader=function(h){this.setProperty("header",h,true);var l=this.getDomRef();if(l){l.textContent=this.getHeader();}return this;};c.prototype._onTableChange=function(e){if(e.getParameter("name")==="enableColumnResize"){this._readTableSettings();}};c.prototype._readTableSettings=function(){var t=this.getTable();this._oSettingsModel.setProperty("/resizable",t.getEnableColumnResize());};c.prototype.setParent=function(p){var P=this.getTable();C.prototype.setParent.apply(this,arguments);if(this._bIsBeingMoved){return;}this._disconnectFromTable(P);this._connectToTable();};c.prototype._connectToTable=function(){var t=this.getTable();if(!t){return;}this._calculateColumnWidth();this._readP13nValues();this._readTableSettings();t.attachEvent("_change",this._onTableChange,this);};c.prototype._disconnectFromTable=function(t){t=t||this.getTable();if(!t){return;}if(this._oInnerColumn){this._oInnerColumn.destroy("KeepDom");t.invalidate();}};c.prototype._onModifications=function(){this._readP13nValues();};c.prototype._calculateColumnWidth=function(){var t=this.getTable();if(!t||!t.getEnableAutoColumnWidth()||!this.isPropertyInitial("width")){return;}var p=t.getPropertyHelper();if(p){this._oSettingsModel.setProperty("/calculatedWidth",p.calculateColumnWidth(this));}else{t.awaitPropertyHelper().then(this._calculateColumnWidth.bind(this));}};c.prototype._readP13nValues=function(){var t=this.getTable();var x=t.getCurrentState().xConfig;var p=this.getDataProperty();if(x instanceof Promise){x.then(this._readP13nValues.bind(this));return;}var w=x&&x.aggregations&&x.aggregations.columns&&x.aggregations.columns[p]&&x.aggregations.columns[p].width;this._oSettingsModel.setProperty("/p13nWidth",w);};c.prototype.getTable=function(){var p=this.getParent();return p&&p.isA("sap.ui.mdc.Table")?p:null;};c.prototype.exit=function(){this._disconnectFromTable();["_oManagedObjectModel","_oSettingsModel","_oInnerColumn","_oTemplateClone","_oCreationTemplateClone","_oColumnHeaderLabel"].forEach(function(o){if(this[o]){this[o].destroy();delete this[o];}},this);};return c;});
