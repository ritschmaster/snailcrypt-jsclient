/*!
 * OpenUI5
 * (c) Copyright 2009-2022 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/core/Core","sap/m/ResponsivePopover","sap/m/List","sap/m/Bar","sap/m/StandardListItem","sap/ui/core/InvisibleText","sap/m/library","sap/ui/Device","sap/base/Log"],function(C,R,L,B,S,I,M,D,a){"use strict";var P=M.PlacementType;var b=M.ListType;var c=M.ListMode;function _(m){var e=m.getControlDelegate().getDrillStack(m);var s=[];e.forEach(function(o){o.dimension.forEach(function(f){if(f!=null&&f!=""&&s.indexOf(f)==-1){s.push(f);}});});return s;}var d=function(){};d.createDrillDownPopover=function(m){var s=new B();var p=new R({id:m.getId()+"-drilldownPopover",contentWidth:"25rem",contentHeight:"20rem",placement:P.Bottom,subHeader:s});var l=new L({mode:c.SingleSelectMaster,selectionChange:function(o){var e=o.getParameter("listItem");if(e){m.getEngine().createChanges({control:m,key:"Item",state:[{name:e.data("dim").dim.name,position:m.getItems().length}]});}p.close();}});p.attachAfterClose(function(){p.destroy();});var r=C.getLibraryResourceBundle("sap.ui.mdc");if(D.system.desktop){var i=new I({text:r.getText("chart.CHART_DRILLDOWN_TITLE")});p.setShowHeader(false);p.addContent(i);p.addAriaLabelledBy(i);}else{p.setTitle(r.getText("chart.CHART_DRILLDOWN_TITLE"));}p.addContent(l);m._oDrillDownPopover=p;return p;};d.showDrillDownPopover=function(m,o){var p=m.getControlDelegate().getSortedDimensions(m);return p.then(function(s){var e=m._oDrillDownPopover;var f,g,l;var F=e.getContent().filter(function(E){return E.getMetadata().getClass()==L;});var h=F.length>0?F[0]:null;if(!h){a.error("MDC Chart: Could not determine list to show drilldown. This should not happen. Did the application modify the drill-down popover?");return;}h.destroyItems();f=_(m);for(var i=0;i<s.length;i++){g=s[i];if(f.indexOf(g.name)>-1){continue;}l=new S({title:g.label,type:b.Active});l.data("dim",{dim:g});h.addItem(l);}return new Promise(function(r,j){e.attachEventOnce("afterOpen",function n(k){r(e);});e.openBy(o);});});};return d;});
