sap.ui.define(["sap/ui/webc/common/thirdparty/base/locale/getLocale","sap/ui/webc/common/thirdparty/base/config/FormatSettings","sap/ui/webc/common/thirdparty/localization/getCachedLocaleDataInstance","sap/ui/webc/common/thirdparty/base/Keys","sap/ui/webc/common/thirdparty/base/types/Integer","sap/ui/webc/common/thirdparty/localization/dates/CalendarDate","sap/ui/webc/common/thirdparty/localization/dates/calculateWeekNumber","sap/ui/webc/common/thirdparty/base/types/CalendarType","./types/CalendarSelectionMode","./CalendarPart","./generated/templates/DayPickerTemplate.lit","./generated/i18n/i18n-defaults","./generated/themes/DayPicker.css"],function(e,t,s,i,a,n,r,o,d,l,h,m,c){"use strict";function p(e){return e&&typeof e==="object"&&"default"in e?e["default"]:e}var y=p(e);var f=p(s);var u=p(a);var _=p(n);var g=p(r);var D=p(o);const T={tag:"ui5-daypicker",properties:{selectedDates:{type:u,multiple:true,compareValues:true},selectionMode:{type:d,defaultValue:d.Single},hideWeekNumbers:{type:Boolean},_weeks:{type:Object,multiple:true},_dayNames:{type:Object,multiple:true},_hidden:{type:Boolean,noAttribute:true},_secondTimestamp:{type:String}},events:{change:{},navigate:{}}};const S=(e,t,s)=>e>Math.min(t,s)&&e<Math.max(t,s);const w=7;class b extends l{static get metadata(){return T}static get template(){return h}static get styles(){return c}onBeforeRendering(){const e=f(y());this._buildWeeks(e);this._buildDayNames(e)}_buildWeeks(e){if(this._hidden){return}this._weeks=[];const s=this._getFirstDayOfWeek();const i=e.getMonths("wide",this._primaryCalendarType);const a=this.hasSecondaryCalendarType&&e.getMonths("wide",this.secondaryCalendarType);const n=b.i18nBundle.getText(m.DAY_PICKER_NON_WORKING_DAY);const r=b.i18nBundle.getText(m.DAY_PICKER_TODAY);const o=this._getFirstDay();const d=_.fromLocalJSDate(new Date,this._primaryCalendarType);const l=this._calendarDate;const h=this._minDate;const c=this._maxDate;const p=this.hasSecondaryCalendarType&&this._getSecondaryDay(o);let f=[];for(let m=0;m<w*6;m++){const m=o.valueOf()/1e3;let u=o.getDay()-s;if(u<0){u+=w}const _=o.getMonth()===l.getMonth()&&o.getDate()===l.getDate();const D=this._isDaySelected(m);const T=this._isDayInsideSelectionRange(m);const S=o.getMonth()!==l.getMonth();const b=this._isWeekend(o);const M=o.valueOf()<h.valueOf()||o.valueOf()>c.valueOf();const C=o.isSame(d);const k=o.getDay()===s;const v=b?`${n} `:"";const N=C?`${r} `:"";const O=this.hasSecondaryCalendarType?`${N}${v}${i[o.getMonth()]} ${o.getDate()}, ${o.getYear()}; ${a[p.getMonth()]} ${p.getDate()}, ${p.getYear()}`:`${N}${v}${i[o.getMonth()]} ${o.getDate()}, ${o.getYear()}`;const E={timestamp:m.toString(),focusRef:_,_tabIndex:_?"0":"-1",selected:D,day:o.getDate(),secondDay:this.hasSecondaryCalendarType&&p.getDate(),_isSecondaryCalendarType:this.hasSecondaryCalendarType,classes:`ui5-dp-item ui5-dp-wday${u}`,ariaLabel:O,ariaSelected:D?"true":"false",ariaDisabled:S?"true":undefined,disabled:M};if(k){E.classes+=" ui5-dp-firstday"}if(D){E.classes+=" ui5-dp-item--selected"}if(T){E.classes+=" ui5-dp-item--selected-between"}if(C){E.classes+=" ui5-dp-item--now"}if(S){E.classes+=" ui5-dp-item--othermonth"}if(b){E.classes+=" ui5-dp-item--weeekend"}if(M){E.classes+=" ui5-dp-item--disabled"}if(this.hasSecondaryCalendarType){E.classes+=" ui5-dp-item--withsecondtype"}f.push(E);if(u===w-1){f.unshift({weekNum:g(t.getFirstDayOfWeek(),o.toUTCJSDate(),o.getYear(),y(),e),isHidden:this.shouldHideWeekNumbers})}if(f.length===w+1){this._weeks.push(f);f=[]}o.setDate(o.getDate()+1);if(this.hasSecondaryCalendarType){p.setDate(p.getDate()+1)}}}_buildDayNames(e){if(this._hidden){return}let t;const s=e.getDays("wide",this._primaryCalendarType);const i=e.getDays("abbreviated",this._primaryCalendarType);let a;this._dayNames=[];this._dayNames.push({classes:"ui5-dp-dayname",name:b.i18nBundle.getText(m.DAY_PICKER_WEEK_NUMBER_TEXT)});for(let e=0;e<w;e++){t=e+this._getFirstDayOfWeek();if(t>w-1){t-=w}a={name:s[t],ultraShortName:i[t],classes:"ui5-dp-dayname"};this._dayNames.push(a)}this._dayNames[1].classes+=" ui5-dp-firstday";if(this.shouldHideWeekNumbers){this._dayNames.shift()}}onAfterRendering(){if(this._autoFocus&&!this._hidden){this.focus()}}_onfocusin(){this._autoFocus=true}_onfocusout(){this._autoFocus=false}_isDaySelected(e){if(this.selectionMode===d.Single){return e===this.selectedDates[0]}return this.selectedDates.includes(e)}_isDayInsideSelectionRange(e){if(this.selectionMode!==d.Range||!this.selectedDates.length){return false}if(this.selectedDates.length===1&&this._secondTimestamp){return S(e,this.selectedDates[0],this._secondTimestamp)}return S(e,this.selectedDates[0],this.selectedDates[1])}_selectDate(e,t){const s=e.target;if(!this._isDayPressed(s)){return}const i=this._getTimestampFromDom(s);this._safelySetTimestamp(i);this._updateSecondTimestamp();if(this.selectionMode===d.Single){this.selectedDates=[i]}else if(this.selectionMode===d.Multiple){if(this.selectedDates.length>0&&t){this._multipleSelection(i)}else{this._toggleTimestampInSelection(i)}}else{this.selectedDates=this.selectedDates.length===1?[...this.selectedDates,i]:[i]}this.fireEvent("change",{timestamp:this.timestamp,dates:this.selectedDates})}_selectWeek(e){this._weeks.forEach(e=>{const t=e.findIndex(e=>{const t=_.fromTimestamp(parseInt(e.timestamp)*1e3);return t.getMonth()===this._calendarDate.getMonth()&&t.getDate()===this._calendarDate.getDate()})!==-1;if(t){const t=e.some(e=>e.timestamp&&!this.selectedDates.includes(parseInt(e.timestamp)));if(t){e.filter(e=>e.timestamp).forEach(e=>{this._addTimestampToSelection(parseInt(e.timestamp))})}else{e.filter(e=>e.timestamp).forEach(e=>{this._removeTimestampFromSelection(parseInt(e.timestamp))})}}});this.fireEvent("change",{timestamp:this.timestamp,dates:this.selectedDates})}_toggleTimestampInSelection(e){if(this.selectedDates.includes(e)){this._removeTimestampFromSelection(e)}else{this._addTimestampToSelection(e)}}_addTimestampToSelection(e){if(!this.selectedDates.includes(e)){this.selectedDates=[...this.selectedDates,e]}}_removeTimestampFromSelection(e){this.selectedDates=this.selectedDates.filter(t=>t!==e)}_multipleSelection(e){const t=Math.min(...this.selectedDates);const s=Math.max(...this.selectedDates);let i;let a;let n=false;if(e<t){i=e;a=t}else if(e>=t&&e<=s){const r=Math.abs(e-t);const o=Math.abs(e-s);if(r<o){i=e;a=s}else{i=t;a=e}n=true}else{i=s;a=e}const r=_.fromTimestamp(i*1e3);const o=_.fromTimestamp(a*1e3);while(r.valueOf()<=o.valueOf()){this[n?"_toggleTimestampInSelection":"_addTimestampToSelection"](r.valueOf()/1e3);r.setDate(r.getDate()+1)}}_onmouseover(e){const t=e.target.closest(".ui5-dp-item");if(t&&this.selectionMode===d.Range&&this.selectedDates.length===1){this._secondTimestamp=this._getTimestampFromDom(t)}}_onkeydown(e){let t=true;if(i.isEnter(e)||i.isEnterShift(e)){this._selectDate(e,i.isEnterShift(e))}else if(i.isSpace(e)||i.isSpaceShift(e)){e.preventDefault()}else if(i.isLeft(e)){this._modifyTimestampBy(-1,"day")}else if(i.isRight(e)){this._modifyTimestampBy(1,"day")}else if(i.isUp(e)){this._modifyTimestampBy(-7,"day")}else if(i.isDown(e)){this._modifyTimestampBy(7,"day")}else if(i.isPageUp(e)){this._modifyTimestampBy(-1,"month")}else if(i.isPageDown(e)){this._modifyTimestampBy(1,"month")}else if(i.isPageUpShift(e)||i.isPageUpAlt(e)){this._modifyTimestampBy(-1,"year")}else if(i.isPageDownShift(e)||i.isPageDownAlt(e)){this._modifyTimestampBy(1,"year")}else if(i.isPageUpShiftCtrl(e)){this._modifyTimestampBy(-10,"year")}else if(i.isPageDownShiftCtrl(e)){this._modifyTimestampBy(10,"year")}else if(i.isHome(e)||i.isEnd(e)){this._onHomeOrEnd(i.isHome(e))}else if(i.isHomeCtrl(e)){const e=new _(this._calendarDate,this._primaryCalendarType);e.setDate(1);this._setTimestamp(e.valueOf()/1e3)}else if(i.isEndCtrl(e)){const e=new _(this._calendarDate,this._primaryCalendarType);e.setMonth(e.getMonth()+1);e.setDate(0);this._setTimestamp(e.valueOf()/1e3)}else{t=false}if(t){e.preventDefault()}}_onkeyup(e){if(i.isSpace(e)||i.isSpaceShift(e)&&this.selectionMode!==d.Multiple){this._selectDate(e,false)}else if(i.isSpaceShift(e)){this._selectWeek(e)}}_onclick(e){this._selectDate(e,e.shiftKey)}_onHomeOrEnd(e){this._weeks.forEach(t=>{const s=t.findIndex(e=>{const t=_.fromTimestamp(parseInt(e.timestamp)*1e3);return t.getMonth()===this._calendarDate.getMonth()&&t.getDate()===this._calendarDate.getDate()})!==-1;if(s){const s=e?1:7;this._setTimestamp(parseInt(t[s].timestamp))}})}_hasPreviousPage(){return!(this._calendarDate.getMonth()===this._minDate.getMonth()&&this._calendarDate.getYear()===this._minDate.getYear())}_hasNextPage(){return!(this._calendarDate.getMonth()===this._maxDate.getMonth()&&this._calendarDate.getYear()===this._maxDate.getYear())}_showPreviousPage(){this._modifyTimestampBy(-1,"month")}_showNextPage(){this._modifyTimestampBy(1,"month")}_modifyTimestampBy(e,t){this._safelyModifyTimestampBy(e,t);this._updateSecondTimestamp();this.fireEvent("navigate",{timestamp:this.timestamp})}_setTimestamp(e){this._safelySetTimestamp(e);this._updateSecondTimestamp();this.fireEvent("navigate",{timestamp:this.timestamp})}_updateSecondTimestamp(){if(this.selectionMode===d.Range&&this.selectedDates.length===1){this._secondTimestamp=this.timestamp}}get shouldHideWeekNumbers(){if(this._primaryCalendarType!==D.Gregorian){return true}return this.hideWeekNumbers}get hasSecondaryCalendarType(){return!!this.secondaryCalendarType}_isWeekend(e){const t=f(y());const s=e.getDay(),i=t.getWeekendStart(),a=t.getWeekendEnd();return s>=i&&s<=a||a<i&&(s>=i||s<=a)}_isDayPressed(e){const t=e.parentNode;return e.className.indexOf("ui5-dp-item")>-1||t&&t.classList&&t.classList.contains("ui5-dp-item")}_getSecondaryDay(e){return new _(e,this.secondaryCalendarType)}_getFirstDay(){let e;const t=this._getFirstDayOfWeek();const s=new _(this._calendarDate,this._primaryCalendarType);s.setDate(1);e=s.getDay()-t;if(e<0){e=7+e}if(e>0){s.setDate(1-e)}return s}_getFirstDayOfWeek(){const e=f(y());const s=t.getFirstDayOfWeek();return Number.isInteger(s)?s:e.getFirstDayOfWeek()}get styles(){return{wrapper:{display:this._hidden?"none":"flex","justify-content":"center"},main:{width:"100%"}}}get ariaRoledescription(){return this.hasSecondaryCalendarType?`${this._primaryCalendarType} calendar with secondary ${this.secondaryCalendarType} calendar`:`${this._primaryCalendarType} calendar`}}b.define();return b});