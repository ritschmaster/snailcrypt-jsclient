sap.ui.define(["sap/ui/webc/common/thirdparty/base/UI5Element","sap/ui/webc/common/thirdparty/base/renderer/LitRenderer","sap/ui/webc/common/thirdparty/base/delegate/ResizeHandler","sap/ui/webc/common/thirdparty/base/types/ValueState","sap/ui/webc/common/thirdparty/base/Keys","sap/ui/webc/common/thirdparty/base/types/Integer","sap/ui/webc/common/thirdparty/icons/slim-arrow-down","sap/ui/webc/common/thirdparty/base/Device","sap/ui/webc/common/thirdparty/base/i18nBundle","sap/ui/webc/common/thirdparty/icons/decline","sap/ui/webc/common/thirdparty/icons/multiselect-all","sap/ui/webc/common/thirdparty/icons/not-editable","sap/ui/webc/common/thirdparty/icons/error","sap/ui/webc/common/thirdparty/icons/alert","sap/ui/webc/common/thirdparty/icons/sys-enter-2","sap/ui/webc/common/thirdparty/icons/information","sap/ui/webc/common/thirdparty/base/FeaturesRegistry","./MultiComboBoxItem","./Tokenizer","./Token","./Icon","./Popover","./ResponsivePopover","./List","./StandardListItem","./ToggleButton","./_chunks/ComboBoxFilters","./Button","./generated/i18n/i18n-defaults","./generated/templates/MultiComboBoxTemplate.lit","./generated/templates/MultiComboBoxPopoverTemplate.lit","./generated/themes/MultiComboBox.css","./generated/themes/ResponsivePopoverCommon.css","./generated/themes/ValueStateMessage.css","./generated/themes/Suggestions.css"],function(e,t,i,s,o,n,r,a,l,h,u,c,d,f,p,m,_,g,v,S,I,y,w,T,P,b,x,k,D,C,E,R,V,A,B){"use strict";function M(e){return e&&typeof e==="object"&&"default"in e?e["default"]:e}var z=M(e);var L=M(t);var O=M(i);var F=M(s);var N=M(n);const H={tag:"ui5-multi-combobox",languageAware:true,managedSlots:true,slots:{default:{propertyName:"items",type:HTMLElement,invalidateOnChildChange:true},icon:{type:HTMLElement},valueStateMessage:{type:HTMLElement}},properties:{value:{type:String,defaultValue:""},placeholder:{type:String,defaultValue:""},allowCustomValues:{type:Boolean},disabled:{type:Boolean},valueState:{type:F,defaultValue:F.None},readonly:{type:Boolean},required:{type:Boolean},filter:{type:String,defaultValue:"StartsWithPerTerm"},open:{type:Boolean},_filteredItems:{type:Object},filterSelected:{type:Boolean},focused:{type:Boolean},_tokenizerFocused:{type:Boolean},_iconPressed:{type:Boolean,noAttribute:true},_inputWidth:{type:N,noAttribute:true},_listWidth:{type:N,defaultValue:0,noAttribute:true},_performingSelectionTwice:{type:Boolean}},events:{change:{},input:{},"open-change":{},"selection-change":{detail:{items:{type:Array}}}}};class U extends z{static get metadata(){return H}static get render(){return L}static get template(){return C}static get staticAreaTemplate(){return E}static get styles(){return R}static get staticAreaStyles(){return[V,A,B]}static get dependencies(){return[g,v,S,I,w,y,T,P,b,k]}constructor(){super();this._filteredItems=[];this.selectedValues=[];this._inputLastValue="";this._valueBeforeOpen="";this._deleting=false;this._validationTimeout=null;this._handleResizeBound=this._handleResize.bind(this);this.currentItemIdx=-1;this.FormSupport=undefined}onEnterDOM(){O.register(this,this._handleResizeBound)}onExitDOM(){O.deregister(this,this._handleResizeBound)}_handleResize(){this._inputWidth=this.offsetWidth}_inputChange(){this.fireEvent("change")}togglePopover(){this.allItemsPopover.toggle(this)}togglePopoverByDropdownIcon(){this._shouldFilterItems=false;this.allItemsPopover.toggle(this)}_showFilteredItems(){this.filterSelected=true;this._showMorePressed=true;this.togglePopover()}filterSelectedItems(e){this.filterSelected=e.target.pressed;this.selectedItems=this._filteredItems.filter(e=>e.selected)}get _showAllItemsButtonPressed(){return this.filterSelected}get _inputDom(){return this.shadowRoot.querySelector("#ui5-multi-combobox-input")}_inputLiveChange(e){const t=e.target;const i=t.value;const s=this._filterItems(i);const o=this.valueState;this._shouldFilterItems=true;if(this.filterSelected){this.filterSelected=false}const n=this._inputDom.value===this.value&&a.isIE()&&!this._keyDown&&!!this.placeholder;if(n){e.preventDefault();return}if(this._validationTimeout){t.value=this._inputLastValue;return}if(!s.length&&i&&!this.allowCustomValues){t.value=this._inputLastValue;this.valueState="Error";this._resetValueState(o);return}this._inputLastValue=t.value;this.value=t.value;this._filteredItems=s;if(!a.isPhone()){if(s.length===0){this.allItemsPopover.close()}else{this.allItemsPopover.showAt(this)}}this.fireEvent("input")}_tokenDelete(e){const t=e.detail.ref;const i=this.items.find(e=>e._id===t.getAttribute("data-ui5-id"));i.selected=false;this._deleting=true;this.fireSelectionChange()}get _getPlaceholder(){if(this._getSelectedItems().length){return""}return this.placeholder}_handleArrowLeft(){const e=this.getDomRef().querySelector(`input`).selectionStart;const t=this.getDomRef().querySelector(`input`).selectionEnd-e>0;if(e===0&&!t){this._tokenizer._focusLastToken()}}_tokenizerFocusOut(e){this._tokenizerFocused=false;const t=this._tokenizer.tokens.length;const i=this._selectedTokensCount;const s=t-1===0&&this._deleting;const o=i===t&&this._deleting;if(!e.relatedTarget||!e.relatedTarget.hasAttribute("ui5-token")){this._tokenizer.tokens.forEach(e=>{e.selected=false});this._tokenizer.scrollToStart()}if(o||s){setTimeout(()=>{if(!a.isPhone()){this.shadowRoot.querySelector("input").focus()}this._deleting=false},0)}}_tokenizerFocusIn(){this._tokenizerFocused=true;this.focused=false}_onkeyup(){this._keyDown=false}async _onkeydown(e){const t=o.isDownCtrl(e);if(o.isShow(e)&&!this.disabled){this._handleShow(e);return}if(o.isDownShift(e)||o.isUpShift(e)){e.preventDefault();return}if(o.isUp(e)||o.isDown(e)||o.isUpCtrl(e)||t){this._handleArrowNavigation(e,t);return}if(t&&!this.allItemsPopover.opened){setTimeout(()=>this._inputDom.setSelectionRange(0,this._inputDom.value.length),0)}if(o.isLeftCtrl(e)||o.isRightCtrl(e)){this._handleArrowCtrl(e);return}if(o.isCtrlV(e)||o.isInsertShift(e)){this._handlePaste(e);return}if(o.isSpaceShift(e)){e.preventDefault()}this._keyDown=true;this[`_handle${e.key}`]&&this[`_handle${e.key}`](e)}async _handlePaste(e){const t=await navigator.clipboard.readText();if(!t){return}const i=t.split(/\r\n|\r|\n/g);const s=this.items.filter(e=>i.indexOf(e.text)>-1&&!e.selected);if(s.length){s.forEach(e=>{e.selected=true;this.value="";this.fireSelectionChange()})}else{this.value=t;this.fireEvent("input")}}_handleShow(e){const t=this.items;const i=this._getSelectedItems()[0];const s=this._tokenizer.tokens.find(e=>e.focused);const o=this.value;const n=this.items.find(e=>e.text.localeCompare(o,undefined,{sensitivity:"base"})===0);e.preventDefault();if(this.readonly){return}this._isOpenedByKeyboard=true;this._shouldFilterItems=false;this._filteredItems=this.items;this.togglePopover();if(!s&&n){this._itemToFocus=n;return}if(i&&!s){this._itemToFocus=i}else if(s&&e.target===s){this._itemToFocus=t.find(e=>e.text===s.text)}else{this._itemToFocus=t[0]}}_handlePageUp(e){e.preventDefault()}_handlePageDown(e){e.preventDefault()}_handleBackspace(e){if(e.target.value===""){e.preventDefault();this._tokenizer._focusLastToken()}}_handleEscape(e){if(!this.allowCustomValues||!this.open&&this.allowCustomValues){this.value=this._lastValue}}_handleHome(e){const t=this._isFocusInside&&e.target.selectionStart===0&&this._tokenizer.tokens.length>0;if(t){e.preventDefault();this._tokenizer.tokens[0].focus()}}_handleEnd(e){const t=this._tokenizer.tokens;const i=t.length-1;const s=e.target===t[i]&&t[i]===this.shadowRoot.activeElement;if(s){e.preventDefault();this._inputDom.focus()}}_handleTab(e){this.allItemsPopover.close()}_handleSelectAll(e){const t=this._filteredItems;const i=t.every(e=>e.selected);t.forEach(e=>{e.selected=!i});this.fireSelectionChange()}_onValueStateKeydown(e){const t=o.isDown(e);const i=o.isUp(e);if(o.isTabNext(e)||o.isTabPrevious(e)){this._onItemTab(e);return}e.preventDefault();if(t||o.isDownCtrl(e)){this._handleArrowDown(e)}if(i||o.isUpCtrl(e)){this._inputDom.focus()}}async _onItemKeydown(e){const t=this.list.items[0]===e.target;const i=o.isUp(e)||o.isUpCtrl(e);if(this.hasValueStateMessage&&!this.valueStateHeader){await this._setValueStateHeader()}if(o.isTabNext(e)||o.isTabPrevious(e)){this._onItemTab(e);return}if(o.isHomeCtrl(e)){this.list._itemNavigation._handleHome(e);this.list.items[this.list._itemNavigation._currentIndex].focus()}if(o.isEndCtrl(e)){this.list._itemNavigation._handleEnd(e);this.list.items[this.list._itemNavigation._currentIndex].focus()}e.preventDefault();if(o.isDownShift(e)||o.isUpShift(e)){this._handleItemRangeSelection(e);return}if(o.isUpCtrl(e)&&!t){this.list._itemNavigation._handleUp(e);this.list.items[this.list._itemNavigation._currentIndex].focus()}if(o.isDownCtrl(e)){this.list._itemNavigation._handleDown(e);this.list.items[this.list._itemNavigation._currentIndex].focus()}if(o.isShow(e)){this.togglePopover()}if(o.isCtrlA(e)){this._handleSelectAll(e);return}if((i&&t||o.isHome(e))&&this.valueStateHeader){this.valueStateHeader.focus()}if(!this.valueStateHeader&&t&&i){this._inputDom.focus()}}_handleArrowCtrl(e){const t=this._inputDom;const i=o.isLeftCtrl(e);if(i&&t.selectionStart===0&&t.selectionEnd===0){e.preventDefault()}if(i&&t.selectionEnd-t.selectionStart>0){t.setSelectionRange(0,0)}}_onItemTab(e){this._inputDom.focus();this.allItemsPopover.close()}async _handleArrowNavigation(e,t){const i=t||o.isDown(e);const s=this.items.length;const n=this.allItemsPopover.opened;e.preventDefault();if(this.hasValueStateMessage&&!this.valueStateHeader){await this._setValueStateHeader()}if(i&&n&&this.valueStateHeader){this.valueStateHeader.focus();return}if(i&&s){this._handleArrowDown(e)}if(!i&&!n&&!this.readonly){this._navigateToPrevItem()}}_handleArrowDown(e){const t=this.allItemsPopover.opened;const i=this.list.items[0];if(t){this.list._itemNavigation.setCurrentItem(i);i.focus()}else if(!this.readonly){this._navigateToNextItem()}}_handleItemRangeSelection(e){const t=this.items;const i=this.list.items;const s=i.indexOf(e.target);const n=s+1;const r=s-1;if(o.isDownShift(e)&&t[n]){t[n].selected=t[s].selected;t[n].focus()}if(o.isUpShift(e)&&t[r]){t[r].selected=t[s].selected;t[r].focus()}this.fireSelectionChange()}_navigateToNextItem(){const e=this.items;const t=e.length;const i=this.currentItemIdx;if(i>-1&&e[i].text!==this.value){this.currentItemIdx=-1}if(i>=t-1){return}let s=this.items[++this.currentItemIdx];while(this.currentItemIdx<t-1&&s.selected){s=this.items[++this.currentItemIdx]}if(s.selected===true){this.currentItemIdx=i;return}this.value=s.text;this._innerInput.value=s.text;this._innerInput.setSelectionRange(0,s.text.length)}_navigateToPrevItem(){const e=this.items;let t=this.currentItemIdx;if(!this.value&&t!==-1||t!==-1&&this.value&&this.value!==e[t].text){t=-1}if(t===-1){this.currentItemIdx=e.length}if(t===0){this.currentItemIdx=0;return}let i=this.items[--this.currentItemIdx];while(i&&i.selected&&this.currentItemIdx>0){i=this.items[--this.currentItemIdx]}if(!i){return}if(i.selected){this.currentItemIdx=t;return}this.value=i.text;this._innerInput.value=i.text;this._innerInput.setSelectionRange(0,i.text.length)}_handleEnter(){const e=this.value.toLowerCase();const t=this.items.find(t=>t.text.toLowerCase()===e);const i=this.valueState;if(this.FormSupport){this.FormSupport.triggerFormSubmit(this)}if(t){if(t.selected){if(this._validationTimeout){return}this.valueState="Error";this._performingSelectionTwice=true;this._resetValueState(i,()=>{this._performingSelectionTwice=false})}else{t.selected=true;this.value="";this.fireSelectionChange()}this.allItemsPopover.close()}}_resetValueState(e,t){this._validationTimeout=setTimeout(()=>{this.valueState=e;this._validationTimeout=null;t&&t()},2e3)}_onTokenizerKeydown(e){const t=!!(e.metaKey||e.ctrlKey);if(o.isRight(e)){const t=this._tokenizer.tokens.length-1;if(e.target===this._tokenizer.tokens[t]){setTimeout(()=>{this.shadowRoot.querySelector("input").focus()},0)}}if(t&&["c","x"].includes(e.key.toLowerCase())||o.isDeleteShift(e)||o.isInsertCtrl(e)){e.preventDefault();const t=e.key.toLowerCase()==="x"||o.isDeleteShift(e);const i=this._tokenizer.tokens.filter(e=>e.selected);if(t){const t=this._tokenizer._fillClipboard("cut",i);i.forEach(t=>{this._tokenizer._tokenDelete(e,t)});this.focus();return t}return this._tokenizer._fillClipboard("copy",i)}if(o.isCtrlV(e)||o.isInsertShift(e)){this._handlePaste(e)}if(o.isHome(e)){this._handleHome(e)}if(o.isEnd(e)){this._handleEnd(e)}if(o.isShow(e)&&!this.readonly&&!this.disabled){this._handleShow(e)}}_filterItems(e){return(x.Filters[this.filter]||x.StartsWithPerTerm)(e,this.items)}_afterOpenPicker(){this._toggle();if(!a.isPhone()&&!this._isOpenedByKeyboard){this._innerInput.focus()}else if(this._isOpenedByKeyboard){this._itemToFocus.focus()}else{this.allItemsPopover.focus()}this._isOpenedByKeyboard=false}_toggle(){this.open=!this.open;this.fireEvent("open-change")}_getSelectedItems(){this.selectedValues=this.items.filter(e=>e.selected);return this.selectedValues}_listSelectionChange(e){this.syncItems(e.target.items);if(!a.isPhone()){this.fireSelectionChange()}if(!e.detail.selectionComponentPressed&&!o.isSpace(e.detail)&&!o.isSpaceCtrl(e.detail)){this.allItemsPopover.close();this.value="";if(a.isPhone()){this.fireSelectionChange()}this.fireEvent("input")}}syncItems(e){e.forEach(e=>{this.items.forEach(t=>{if(t._id===e.getAttribute("data-ui5-token-id")){t.selected=e.selected}})})}fireSelectionChange(){this.fireEvent("selection-change",{items:this._getSelectedItems()});this.fireEvent("value-changed")}async _getRespPopover(){const e=await this.getStaticAreaItemDomRef();this.allItemsPopover=e.querySelector(`.ui5-multi-combobox-all-items-responsive-popover`)}async _getList(){const e=await this.getStaticAreaItemDomRef();this.list=e.querySelector(".ui5-multi-combobox-all-items-list")}_click(e){if(a.isPhone()&&!this.readonly&&!this._showMorePressed&&!this._deleting){this.allItemsPopover.showAt(this)}this._showMorePressed=false}_afterClosePicker(){if(a.isPhone()){this.blur()}this._toggle();this._iconPressed=false;this.filterSelected=false}_beforeOpen(){this._itemsBeforeOpen=this.items.map(e=>({ref:e,selected:e.selected}));this._valueBeforeOpen=this.value;if(this.filterSelected){this.selectedItems=this._filteredItems.filter(e=>e.selected)}}onBeforeRendering(){const e=this.shadowRoot.querySelector("input");this.FormSupport=_.getFeature("FormSupport");this._inputLastValue=this.value;if(e&&!e.value){this._filteredItems=this.items}this.items.forEach(e=>{e._getRealDomRef=()=>this.allItemsPopover.querySelector(`*[data-ui5-stable=${e.stableDomRef}]`)});if(this._shouldFilterItems){this._filteredItems=this._filterItems(this.value)}else{this._filteredItems=this.items}}async onAfterRendering(){await this._getRespPopover();await this._getList();this.toggle(this.shouldDisplayOnlyValueStateMessage);this.storeResponsivePopoverWidth();this._deleting=false}get _isPhone(){return a.isPhone()}_onIconMousedown(){this._iconPressed=true}storeResponsivePopoverWidth(){if(this.open&&!this._listWidth){this._listWidth=this.list.offsetWidth}}toggle(e){if(e&&!this.open){this.openPopover()}else{this.closePopover()}}handleCancel(){this._itemsBeforeOpen.forEach(e=>{e.ref.selected=e.selected});this.togglePopover();this.value=this._valueBeforeOpen}handleOK(){if(a.isPhone()){this.fireSelectionChange()}this.togglePopover()}async openPopover(){const e=await this._getPopover();if(e){e.showAt(this)}}_forwardFocusToInner(){this._innerInput.focus()}async closePopover(){const e=await this._getPopover();e&&e.close()}async _getPopover(){const e=await this.getStaticAreaItemDomRef();return e.querySelector("[ui5-popover]")}async _getResponsivePopover(){const e=await this.getStaticAreaItemDomRef();return e.querySelector("[ui5-responsive-popover]")}async _setValueStateHeader(){const e=await this._getResponsivePopover();this.valueStateHeader=e.querySelector("div.ui5-responsive-popover-header.ui5-valuestatemessage-root")}get _tokenizer(){return this.shadowRoot.querySelector("[ui5-tokenizer]")}inputFocusIn(){if(!a.isPhone()||this.readonly){this.focused=true}else{this._innerInput.blur()}!a.isPhone()&&this._innerInput.setSelectionRange(0,this.value.length);this._lastValue=this.value}inputFocusOut(e){if(!this.shadowRoot.contains(e.relatedTarget)&&!this._deleting){this.focused=false;if(!a.isPhone()&&!this.allowCustomValues&&this.staticAreaItem!==e.relatedTarget){this.value=""}}}get editable(){return!this.readonly}get _isFocusInside(){return!a.isPhone()&&(this.focused||this._tokenizerFocused)}get selectedItemsListMode(){return this.readonly?"None":"MultiSelect"}get _listItemsType(){return this.readonly?"Inactive":"Active"}get hasValueState(){return this.valueState!==F.None}get hasValueStateMessage(){return this.hasValueState&&this.valueState!==F.Success}get valueStateText(){let e=this.valueState;if(this._performingSelectionTwice){e="Error_Selection"}return this.valueStateTextMappings[e]}get valueStateTextId(){return this.hasValueState?`${this._id}-valueStateDesc`:undefined}get valueStateMessageText(){return this.getSlottedNodes("valueStateMessage").map(e=>e.cloneNode(true))}get _valueStateMessageIcon(){const e={Error:"error",Warning:"alert",Success:"sys-enter-2",Information:"information"};return this.valueState!==F.None?e[this.valueState]:""}get _tokensCountText(){if(!this._tokenizer){return}return this._tokenizer._tokensCountText()}get _tokensCountTextId(){return`${this._id}-hiddenText-nMore`}get _selectedTokensCount(){return this._tokenizer.tokens.filter(e=>e.selected).length}get ariaDescribedByText(){return this.valueStateTextId?`${this._tokensCountTextId} ${this.valueStateTextId}`:`${this._tokensCountTextId}`}get shouldDisplayDefaultValueStateMessage(){return!this.valueStateMessage.length&&this.hasValueStateMessage}get shouldDisplayOnlyValueStateMessage(){return this.focused&&!this.readonly&&this.hasValueStateMessage&&!this._iconPressed}get valueStateTextMappings(){return{Success:U.i18nBundle.getText(D.VALUE_STATE_SUCCESS),Error:U.i18nBundle.getText(D.VALUE_STATE_ERROR),Error_Selection:U.i18nBundle.getText(D.VALUE_STATE_ERROR_ALREADY_SELECTED),Warning:U.i18nBundle.getText(D.VALUE_STATE_WARNING),Information:U.i18nBundle.getText(D.VALUE_STATE_INFORMATION)}}get _innerInput(){if(a.isPhone()){if(this.allItemsPopover.opened){return this.allItemsPopover.querySelector("input")}}return this.getDomRef().querySelector("#ui5-multi-combobox-input")}get _headerTitleText(){return U.i18nBundle.getText(D.INPUT_SUGGESTIONS_TITLE)}get _iconAccessibleNameText(){return U.i18nBundle.getText(D.SELECT_OPTIONS)}get _dialogOkButton(){return U.i18nBundle.getText(D.MULTICOMBOBOX_DIALOG_OK_BUTTON)}get _tokenizerExpanded(){return(this._isFocusInside||this.open)&&!this.readonly}get _valueStatePopoverHorizontalAlign(){return this.effectiveDir!=="rtl"?"Left":"Right"}get classes(){return{popover:{"ui5-multi-combobox-all-items-responsive-popover":true,"ui5-suggestions-popover":!this.isPhone,"ui5-suggestions-popover-with-value-state-header":!this.isPhone&&this.hasValueStateMessage},popoverValueState:{"ui5-valuestatemessage-root":true,"ui5-valuestatemessage-header":true,"ui5-valuestatemessage--success":this.valueState===F.Success,"ui5-valuestatemessage--error":this.valueState===F.Error,"ui5-valuestatemessage--warning":this.valueState===F.Warning,"ui5-valuestatemessage--information":this.valueState===F.Information}}}get styles(){return{popoverValueStateMessage:{width:`${this._listWidth}px`,display:this._listWidth===0?"none":"inline-block"},popoverHeader:{"max-width":a.isPhone()?"100%":`${this._inputWidth}px`}}}static async onDefine(){U.i18nBundle=await l.getI18nBundle("@ui5/webcomponents")}}U.define();return U});