sap.ui.define(["sap/ui/webc/common/thirdparty/base/types/Integer","sap/ui/webc/common/thirdparty/base/Device","sap/ui/webc/common/thirdparty/base/util/PopupUtils","sap/ui/webc/common/thirdparty/base/util/clamp","./Popup","./types/PopoverPlacementType","./types/PopoverVerticalAlign","./types/PopoverHorizontalAlign","./popup-utils/PopoverRegistry","./generated/templates/PopoverTemplate.lit","./generated/themes/BrowserScrollbar.css","./generated/themes/PopupsCommon.css","./generated/themes/Popover.css"],function(t,e,i,o,r,s,n,h,a,l,p,c,d){"use strict";function u(t){return t&&typeof t==="object"&&"default"in t?t["default"]:t}var g=u(t);var m=u(o);const f=8;const w={tag:"ui5-popover",properties:{headerText:{type:String},placementType:{type:s,defaultValue:s.Right},horizontalAlign:{type:h,defaultValue:h.Center},verticalAlign:{type:n,defaultValue:n.Center},modal:{type:Boolean},hideBackdrop:{type:Boolean},hideArrow:{type:Boolean},allowTargetOverlap:{type:Boolean},opener:{type:String},disableScrolling:{type:Boolean},arrowTranslateX:{type:g,defaultValue:0,noAttribute:true},arrowTranslateY:{type:g,defaultValue:0,noAttribute:true},actualPlacementType:{type:s,defaultValue:s.Right},_maxHeight:{type:g,noAttribute:true},_maxWidth:{type:g,noAttribute:true}},managedSlots:true,slots:{header:{type:HTMLElement},footer:{type:HTMLElement}},events:{}};class y extends r{constructor(){super()}static get metadata(){return w}static get styles(){return[p,c,d]}static get template(){return l}static get VIEWPORT_MARGIN(){return 10}onAfterRendering(){if(!this.isOpen()&&this.open){const t=document.getElementById(this.opener);if(!t){console.warn("Valid opener id is required.");return}this.showAt(t)}else if(this.isOpen()&&!this.open){this.close()}}isOpenerClicked(t){const e=t.target;return e===this._opener||e.getFocusDomRef&&e.getFocusDomRef()===this._opener||t.composedPath().indexOf(this._opener)>-1}async showAt(t,e=false){if(!t||this.opened){return}this._opener=t;this._openerRect=t.getBoundingClientRect();await super._open(e)}_addOpenedPopup(){a.addOpenedPopover(this)}_removeOpenedPopup(){a.removeOpenedPopover(this)}shouldCloseDueToOverflow(t,e){const o=32;const r={Right:e.right,Left:e.left,Top:e.top,Bottom:e.bottom};const s=i.getClosedPopupParent(this._opener);let n=false;let h=false;if(s.showAt){const t=s.contentDOM.getBoundingClientRect();n=e.top>t.top+t.height;h=e.top+e.height<t.top}return r[t]<0||r[t]+o>s.innerHeight||n||h}shouldCloseDueToNoOpener(t){return t.top===0&&t.bottom===0&&t.left===0&&t.right===0}isOpenerOutsideViewport(t){return t.bottom<0||t.top>window.innerHeight||t.right<0||t.left>window.innerWidth}_resize(){super._resize();if(this.opened){this.reposition()}}reposition(){this._show()}_show(){let t;const e=this.getPopoverSize();if(e.width===0||e.height===0){return}if(this.isOpen()){this._openerRect=this._opener.getBoundingClientRect()}if(this.shouldCloseDueToNoOpener(this._openerRect)&&this.isFocusWithin()){t=this._oldPlacement}else{t=this.calcPlacement(this._openerRect,e)}const i=this.horizontalAlign===h.Stretch;if(this._preventRepositionAndClose||this.isOpenerOutsideViewport(this._openerRect)){return this.close()}this._oldPlacement=t;this.actualPlacementType=t.placementType;let o=m(this._left,y.VIEWPORT_MARGIN,document.documentElement.clientWidth-e.width-y.VIEWPORT_MARGIN);if(this.actualPlacementType===s.Right){o=Math.max(o,this._left)}let r=m(this._top,y.VIEWPORT_MARGIN,document.documentElement.clientHeight-e.height-y.VIEWPORT_MARGIN);if(this.actualPlacementType===s.Bottom){r=Math.max(r,this._top)}this.arrowTranslateX=t.arrow.x;this.arrowTranslateY=t.arrow.y;r=this._adjustForIOSKeyboard(r);Object.assign(this.style,{top:`${r}px`,left:`${o}px`});super._show();if(i&&this._width){this.style.width=this._width}}_adjustForIOSKeyboard(t){if(!e.isIOS()){return t}const i=Math.ceil(this.getBoundingClientRect().top);return t+(Number.parseInt(this.style.top||"0")-i)}getPopoverSize(){if(!this.opened){Object.assign(this.style,{display:"block",top:"-10000px",left:"-10000px"})}const t=this.getBoundingClientRect(),e=t.width,i=t.height;return{width:e,height:i}}get arrowDOM(){return this.shadowRoot.querySelector(".ui5-popover-arrow")}calcPlacement(t,e){let i=0;let o=0;const r=this.allowTargetOverlap;const a=document.documentElement.clientWidth;const l=document.documentElement.clientHeight;let p=l;let c=a;const d=this.getActualPlacementType(t,e);this._preventRepositionAndClose=this.shouldCloseDueToNoOpener(t)||this.shouldCloseDueToOverflow(d,t);const u=d===s.Top||d===s.Bottom;if(this.horizontalAlign===h.Stretch&&u){e.width=t.width;this._width=`${t.width}px`}else if(this.verticalAlign===n.Stretch&&!u){e.height=t.height}const g=this.hideArrow?0:f;switch(d){case s.Top:i=this.getVerticalLeft(t,e);o=Math.max(t.top-e.height-g,0);if(!r){p=t.top-g}break;case s.Bottom:i=this.getVerticalLeft(t,e);o=t.bottom+g;if(r){o=Math.max(Math.min(o,l-e.height),0)}else{p=l-t.bottom-g}break;case s.Left:i=Math.max(t.left-e.width-g,0);o=this.getHorizontalTop(t,e);if(!r){c=t.left-g}break;case s.Right:i=t.left+t.width+g;o=this.getHorizontalTop(t,e);if(r){i=Math.max(Math.min(i,a-e.width),0)}else{c=a-t.right-g}break}if(u){if(e.width>a||i<0){i=0}else if(i+e.width>a){i-=i+e.width-a}}else{if(e.height>l||o<0){o=0}else if(o+e.height>l){o-=o+e.height-l}}this._maxHeight=Math.round(p-y.VIEWPORT_MARGIN);this._maxWidth=Math.round(c-y.VIEWPORT_MARGIN);if(this._left===undefined||Math.abs(this._left-i)>1.5){this._left=Math.round(i)}if(this._top===undefined||Math.abs(this._top-o)>1.5){this._top=Math.round(o)}const m=Number.parseInt(window.getComputedStyle(this).getPropertyValue("border-radius"));const w=this.getArrowPosition(t,e,i,o,u,m);return{arrow:w,top:this._top,left:this._left,placementType:d}}getArrowPosition(t,{width:e,height:i},o,r,s,n){let a=this.horizontalAlign===h.Center||this.horizontalAlign===h.Stretch;if(this.horizontalAlign===h.Right&&o<=t.left){a=true}if(this.horizontalAlign===h.Left&&o+e>=t.left+t.width){a=true}let l=0;if(s&&a){l=t.left+t.width/2-o-e/2}let p=0;if(!s){p=t.top+t.height/2-r-i/2}const c=i/2-n-f/2;p=m(p,-c,c);const d=e/2-n-f/2;l=m(l,-d,d);return{x:Math.round(l),y:Math.round(p)}}fallbackPlacement(t,e,i,o){if(i.left>o.width){return s.Left}if(t-i.right>i.left){return s.Right}if(e-i.bottom>o.height){return s.Bottom}if(e-i.bottom<i.top){return s.Top}}getActualPlacementType(t,e){const i=this.placementType;let o=i;const r=document.documentElement.clientWidth;const n=document.documentElement.clientHeight;switch(i){case s.Top:if(t.top<e.height&&t.top<n-t.bottom){o=s.Bottom}break;case s.Bottom:if(n-t.bottom<e.height&&n-t.bottom<t.top){o=s.Top}break;case s.Left:if(t.left<e.width){o=this.fallbackPlacement(r,n,t,e)||i}break;case s.Right:if(r-t.right<e.width){o=this.fallbackPlacement(r,n,t,e)||i}break}return o}getVerticalLeft(t,e){let i;switch(this.horizontalAlign){case h.Center:case h.Stretch:i=t.left-(e.width-t.width)/2;break;case h.Left:i=t.left;break;case h.Right:i=t.right-e.width;break}return i}getHorizontalTop(t,e){let i;switch(this.verticalAlign){case n.Center:case n.Stretch:i=t.top-(e.height-t.height)/2;break;case n.Top:i=t.top;break;case n.Bottom:i=t.bottom-e.height;break}return i}get isModal(){return this.modal}get shouldHideBackdrop(){return this.hideBackdrop}get _ariaLabelledBy(){return this._ariaLabel?undefined:"ui5-popup-header"}get _ariaModal(){return true}get styles(){return{...super.styles,root:{"max-height":`${this._maxHeight}px`,"max-width":`${this._maxWidth}px`},arrow:{transform:`translate(${this.arrowTranslateX}px, ${this.arrowTranslateY}px)`}}}get classes(){const t=super.classes;t.root["ui5-popover-root"]=true;return t}get _displayHeader(){return this.header.length||this.headerText}get _displayFooter(){return true}}y.define();return y});