sap.ui.define(["sap/ui/webc/common/thirdparty/base/UI5Element","sap/ui/webc/common/thirdparty/base/renderer/LitRenderer","sap/ui/webc/common/thirdparty/base/types/ValueState","sap/ui/webc/common/thirdparty/base/Device","sap/ui/webc/common/thirdparty/base/types/Integer","sap/ui/webc/common/thirdparty/base/util/AriaLabelHelper","sap/ui/webc/common/thirdparty/base/util/InvisibleMessage","sap/ui/webc/common/thirdparty/icons/slim-arrow-down","sap/ui/webc/common/thirdparty/icons/decline","sap/ui/webc/common/thirdparty/icons/not-editable","sap/ui/webc/common/thirdparty/icons/error","sap/ui/webc/common/thirdparty/icons/alert","sap/ui/webc/common/thirdparty/icons/sys-enter-2","sap/ui/webc/common/thirdparty/icons/information","sap/ui/webc/common/thirdparty/base/i18nBundle","sap/ui/webc/common/thirdparty/base/FeaturesRegistry","sap/ui/webc/common/thirdparty/base/Keys","./_chunks/ComboBoxFilters","./generated/i18n/i18n-defaults","./generated/templates/ComboBoxTemplate.lit","./generated/templates/ComboBoxPopoverTemplate.lit","./generated/themes/ComboBox.css","./generated/themes/ComboBoxPopover.css","./generated/themes/ResponsivePopoverCommon.css","./generated/themes/ValueStateMessage.css","./generated/themes/Suggestions.css","./ComboBoxItem","./Icon","./Popover","./ResponsivePopover","./List","./BusyIndicator","./Button","./StandardListItem","./ComboBoxGroupItem","./GroupHeaderListItem"],function(e,t,s,i,o,a,r,n,l,h,u,c,p,d,m,f,_,g,v,S,I,P,y,T,V,b,E,x,w,F,R,A,M,C,N,B){"use strict";function L(e){return e&&typeof e==="object"&&"default"in e?e["default"]:e}var D=L(e);var G=L(t);var W=L(s);var O=L(o);var U=L(r);const H={tag:"ui5-combobox",languageAware:true,properties:{value:{type:String,defaultValue:""},filterValue:{type:String,defaultValue:""},placeholder:{type:String,defaultValue:""},disabled:{type:Boolean},valueState:{type:W,defaultValue:W.None},readonly:{type:Boolean},required:{type:Boolean},loading:{type:Boolean},filter:{type:String,defaultValue:"StartsWithPerTerm"},focused:{type:Boolean},_isValueStateFocused:{type:Boolean},accessibleName:{type:String,defaultValue:undefined},accessibleNameRef:{type:String,defaultValue:""},_iconPressed:{type:Boolean,noAttribute:true},_filteredItems:{type:Object},_listWidth:{type:O,defaultValue:0,noAttribute:true}},managedSlots:true,slots:{default:{propertyName:"items",type:HTMLElement,invalidateOnChildChange:true},valueStateMessage:{type:HTMLElement},icon:{type:HTMLElement}},events:{change:{},input:{},"selection-change":{detail:{item:{type:HTMLElement}}}}};class K extends D{static get metadata(){return H}static get render(){return G}static get styles(){return P}static get staticAreaStyles(){return[T,V,y,b]}static get template(){return S}static get staticAreaTemplate(){return I}constructor(e){super(e);this._filteredItems=[];this._initialRendering=true;this._itemFocused=false;this._selectionChanged=false;this.FormSupport=undefined}onBeforeRendering(){this.FormSupport=f.getFeature("FormSupport");if(this._initialRendering){this._filteredItems=this.items}if(!this._initialRendering&&this.popover&&document.activeElement===this&&!this._filteredItems.length){this.popover.close()}this._selectMatchingItem();this._initialRendering=false}async onAfterRendering(){await this._respPopover();if(i.isPhone()&&this.responsivePopover.opened){this.inner.focus()}if(this.shouldClosePopover()&&!i.isPhone()){this.responsivePopover.close(false,false,true);this._clearFocus();this._itemFocused=false}this.toggleValueStatePopover(this.shouldOpenValueStateMessagePopover);this.storeResponsivePopoverWidth();if(i.isSafari()&&this._autocomplete&&this.filterValue!==this.value){this.inner.setSelectionRange(this._isKeyNavigation?0:this.filterValue.length,this.value.length)}}shouldClosePopover(){return this.responsivePopover.opened&&!this.focused&&!this._itemFocused&&!this._isValueStateFocused}_focusin(e){this.focused=true;this._lastValue=this.value;this._autocomplete=false;!i.isPhone()&&e.target.setSelectionRange(0,this.value.length)}_focusout(e){const t=e.relatedTarget&&e.relatedTarget.shadowRoot&&e.relatedTarget.shadowRoot.querySelector(".ui5-valuestatemessage-root");this._fireChangeEvent();if(t){e.stopImmediatePropagation();return}if(!this.shadowRoot.contains(e.relatedTarget)&&this.staticAreaItem!==e.relatedTarget){this.focused=false;!i.isPhone()&&this._closeRespPopover(e)}}_afterOpenPopover(){this._iconPressed=true}_afterClosePopover(){this._iconPressed=false;this._filteredItems=this.items;if(i.isPhone()){this.blur()}if(this._selectionPerformed){this._lastValue=this.value;this._selectionPerformed=false}}_toggleRespPopover(){if(this.responsivePopover.opened){this._closeRespPopover()}else{this._openRespPopover()}}storeResponsivePopoverWidth(){if(this.open&&!this._listWidth){this._listWidth=this.responsivePopover.offsetWidth}}toggleValueStatePopover(e){if(e){this.openValueStatePopover()}else{this.closeValueStatePopover()}}async openValueStatePopover(){this.popover=await this._getPopover();this.popover&&this.popover.showAt(this)}async closeValueStatePopover(){this.popover=await this._getPopover();this.popover&&this.popover.close()}async _getPopover(){const e=await this.getStaticAreaItemDomRef();return e.querySelector(".ui5-valuestatemessage-popover")}_resetFilter(){this._userTypedValue=null;this.inner.setSelectionRange(0,this.value.length);this._filteredItems=this._filterItems("");this._selectMatchingItem()}_arrowClick(){this.inner.focus();this._resetFilter();this._toggleRespPopover()}_input(e){const{value:t}=e.target;if(e.target===this.inner){e.stopImmediatePropagation();this.focused=true;this._isValueStateFocused=false}this._filteredItems=this._filterItems(t);this.value=t;this.filterValue=t;this._clearFocus();if(this._autocomplete&&!i.isAndroid()){const e=this._getFirstMatchingItem(t);this._applyAtomicValueAndSelection(e,t,true);if(t!==""&&!this._selectionChanged&&(e&&!e.selected&&!e.isGroupItem)){this.fireEvent("selection-change",{item:e});this._selectionChanged=false}}this.fireEvent("input");if(i.isPhone()){return}if(!this._filteredItems.length||t===""){this._closeRespPopover()}else{this._openRespPopover()}}_startsWithMatchingItems(e){return g.StartsWith(e,this._filteredItems)}_clearFocus(){this._filteredItems.map(e=>{e.focused=false;return e})}handleNavKeyPress(e){if(this.focused&&(_.isHome(e)||_.isEnd(e))&&this.value){return}const t=this.open;const s=this._filteredItems.find(e=>t?e.focused:e.selected);const i=this._filteredItems.indexOf(s);e.preventDefault();if(this.focused&&t&&(_.isUp(e)||_.isPageUp(e)||_.isPageDown(e))){return}if(this._filteredItems.length-1===i&&_.isDown(e)){return}this._isKeyNavigation=true;this[`_handle${e.key}`](e,i)}_handleItemNavigation(e,t,s){const i=this.open;const o=this._filteredItems[t];const a=s?this._filteredItems[t+1]:this._filteredItems[t-1];const r=o&&o.isGroupItem;if(!i&&(r&&!a||!r&&!o)){return}this._clearFocus();if(i){this._itemFocused=true;this.value=r?"":o.text;this.focused=false;o.focused=true}else{this.focused=true;this.value=r?a.text:o.text;o.focused=false}this._isValueStateFocused=false;this._selectionChanged=true;if(r&&i){return}this._announceSelectedItem(t);const n=this._getFirstMatchingItem(this.value);this._applyAtomicValueAndSelection(n,this.open?this._userTypedValue:null,true);if(n&&!n.selected){this.fireEvent("selection-change",{item:n})}this.fireEvent("input");this._fireChangeEvent()}_handleArrowDown(e,t){const s=this.open;if(this.focused&&t===-1&&this.hasValueStateText&&s){this._isValueStateFocused=true;this.focused=false;return}t=!s&&this.hasValueState&&t===-1?0:t;this._handleItemNavigation(e,++t,true)}_handleArrowUp(e,t){const s=this.open;if(t===0&&!this.hasValueStateText){this._clearFocus();this.focused=true;this._itemFocused=false;return}if(t===0&&this.hasValueStateText&&s){this._clearFocus();this._itemFocused=false;this._isValueStateFocused=true;this._filteredItems[0].selected=false;return}if(this._isValueStateFocused){this.focused=true;this._isValueStateFocused=false;return}t=!s&&this.hasValueState&&t===-1?0:t;this._handleItemNavigation(e,--t,false)}_handlePageUp(e,t){const s=t-K.SKIP_ITEMS_SIZE>-1;t=s?t-K.SKIP_ITEMS_SIZE:0;const i=this._filteredItems[t].isGroupItem&&!this.open;if(!s&&this.hasValueStateText&&this.open){this._clearFocus();this._itemFocused=false;this._isValueStateFocused=true;return}this._handleItemNavigation(e,t,i)}_handlePageDown(e,t){const s=this._filteredItems.length;const i=t+K.SKIP_ITEMS_SIZE<s;t=i?t+K.SKIP_ITEMS_SIZE:s-1;const o=this._filteredItems[t].isGroupItem&&!this.open;this._handleItemNavigation(e,t,o)}_handleHome(e,t){const s=this._filteredItems[0].isGroupItem&&!this.open;if(this.hasValueStateText&&this.open){this._clearFocus();this._itemFocused=false;this._isValueStateFocused=true;return}this._handleItemNavigation(e,0,s)}_handleEnd(e,t){this._handleItemNavigation(e,this._filteredItems.length-1,true)}_keyup(e){this._userTypedValue=this.value.substring(0,this.inner.selectionStart)}_keydown(e){const t=_.isDown(e)||_.isUp(e)||_.isPageUp(e)||_.isPageDown(e)||_.isHome(e)||_.isEnd(e);this._autocomplete=!(_.isBackSpace(e)||_.isDelete(e));this._isKeyNavigation=false;if(t&&!this.readonly&&this._filteredItems.length){this.handleNavKeyPress(e)}if(_.isEnter(e)){if(this.responsivePopover.opened){this._fireChangeEvent();this._closeRespPopover();this.focused=true}else if(this.FormSupport){this.FormSupport.triggerFormSubmit(this)}}if(_.isEscape(e)){this.focused=true;this.value=!this.open?this._lastValue:this.value;this._isValueStateFocused=false}if((_.isTabNext(e)||_.isTabPrevious(e))&&this.open){this._closeRespPopover()}if(_.isShow(e)&&!this.readonly&&!this.disabled){e.preventDefault();this._resetFilter();this._toggleRespPopover();const t=this._filteredItems.find(e=>e.selected);if(t&&this.open){this._itemFocused=true;t.focused=true;this.focused=false}else if(this.open&&this._filteredItems.length){this._handleItemNavigation(e,0,true)}else{this.focused=true}}}_click(e){if(i.isPhone()&&!this.readonly){this._openRespPopover()}}_closeRespPopover(e){if(i.isPhone()&&e&&e.target.classList.contains("ui5-responsive-popover-close-btn")&&this._selectedItemText){this.value=this._selectedItemText;this.filterValue=this._selectedItemText}this._isValueStateFocused=false;this._clearFocus();this.responsivePopover.close()}_openRespPopover(){this.responsivePopover.showAt(this)}_filterItems(e){const t=this.items.filter(e=>!e.isGroupItem);const s=(g.Filters[this.filter]||g.StartsWithPerTerm)(e,t);return this.items.filter((e,t,i)=>K._groupItemFilter(e,++t,i,s)||s.indexOf(e)!==-1)}static _groupItemFilter(e,t,s,i){if(e.isGroupItem){let e;while(s[t]&&!s[t].isGroupItem&&!e){e=i.indexOf(s[t])!==-1;t++}return e}}_getFirstMatchingItem(e){const t=this.items.find(e=>e.focused===true);if(t&&t.isGroupItem){this.value=this.filterValue;return}const s=this._startsWithMatchingItems(e).filter(e=>!e.isGroupItem);if(s.length){return s[0]}}_applyAtomicValueAndSelection(e,t,s){if(!e){return}const i=e&&e.text||"";this.inner.value=i;if(s){t=t||"";this.inner.setSelectionRange(t.length,i.length)}this.value=i}_selectMatchingItem(){const e=this.items.find(e=>e.focused);const t=e&&e.isGroupItem;this._filteredItems=this._filteredItems.map(e=>{e.selected=!e.isGroupItem&&e.text===this.value&&!t;return e})}_fireChangeEvent(){if(this.value!==this._lastValue){this.fireEvent("change");this._lastValue=this.value}}_inputChange(e){e.preventDefault()}_itemMousedown(e){e.preventDefault()}_selectItem(e){const t=e.detail.item;this._selectedItemText=t.mappedItem.text;this._selectionPerformed=true;const s=this.value===this._selectedItemText;const i=this.value.toLowerCase()===this.filterValue.toLowerCase();if(s&&i){return this._closeRespPopover()}this.value=this._selectedItemText;if(!t.mappedItem.selected){this.fireEvent("selection-change",{item:t.mappedItem});this._selectionChanged=true}this._filteredItems.map(e=>{e.selected=e===t.mappedItem&&!e.isGroupItem;return e});this._fireChangeEvent();this._closeRespPopover();this.inner.setSelectionRange(this.value.length,this.value.length)}_onItemFocus(e){this._itemFocused=true}_announceSelectedItem(e){const t=K.i18nBundle.getText(v.LIST_ITEM_POSITION,e+1,this._filteredItems.length);const s=K.i18nBundle.getText(v.LIST_ITEM_SELECTED);U(`${t} ${s}`,"Polite")}get _headerTitleText(){return K.i18nBundle.getText(v.INPUT_SUGGESTIONS_TITLE)}get _iconAccessibleNameText(){return K.i18nBundle.getText(v.SELECT_OPTIONS)}get inner(){return i.isPhone()?this.responsivePopover.querySelector(".ui5-input-inner-phone"):this.shadowRoot.querySelector("[inner-input]")}async _respPopover(){const e=await this.getStaticAreaItemDomRef();this.responsivePopover=e.querySelector("[ui5-responsive-popover]");return this.responsivePopover}get editable(){return!this.readonly}get hasValueState(){return this.valueState!==W.None}get hasValueStateText(){return this.hasValueState&&this.valueState!==W.Success}get valueStateText(){return this.valueStateTextMappings[this.valueState]}get valueStateMessageText(){return this.getSlottedNodes("valueStateMessage").map(e=>e.cloneNode(true))}get valueStateTextId(){return this.hasValueState?`${this._id}-valueStateDesc`:undefined}get valueStateTextMappings(){return{Success:K.i18nBundle.getText(v.VALUE_STATE_SUCCESS),Error:K.i18nBundle.getText(v.VALUE_STATE_ERROR),Warning:K.i18nBundle.getText(v.VALUE_STATE_WARNING),Information:K.i18nBundle.getText(v.VALUE_STATE_INFORMATION)}}get shouldOpenValueStateMessagePopover(){return this.focused&&!this.readonly&&this.hasValueStateText&&!this._iconPressed&&!this.open&&!this._isPhone}get shouldDisplayDefaultValueStateMessage(){return!this.valueStateMessage.length&&this.hasValueStateText}get _valueStatePopoverHorizontalAlign(){return this.effectiveDir!=="rtl"?"Left":"Right"}get _valueStateMessageIcon(){const e={Error:"error",Warning:"alert",Success:"sys-enter-2",Information:"information"};return this.valueState!==W.None?e[this.valueState]:""}get open(){return this.responsivePopover?this.responsivePopover.opened:false}get _isPhone(){return i.isPhone()}get itemTabIndex(){return undefined}get ariaLabelText(){return a.getEffectiveAriaLabelText(this)}static get dependencies(){return[E,x,F,R,A,M,C,B,w,N]}static async onDefine(){K.i18nBundle=await m.getI18nBundle("@ui5/webcomponents")}get styles(){return{popoverHeader:{width:`${this.offsetWidth}px`},suggestionPopoverHeader:{display:this._listWidth===0?"none":"inline-block",width:`${this._listWidth}px`}}}get classes(){return{popover:{"ui5-suggestions-popover":!this.isPhone,"ui5-suggestions-popover-with-value-state-header":!this.isPhone&&this.hasValueStateText},popoverValueState:{"ui5-valuestatemessage-header":true,"ui5-valuestatemessage-root":true,"ui5-valuestatemessage--success":this.valueState===W.Success,"ui5-valuestatemessage--error":this.valueState===W.Error,"ui5-valuestatemessage--warning":this.valueState===W.Warning,"ui5-valuestatemessage--information":this.valueState===W.Information}}}}K.SKIP_ITEMS_SIZE=10;K.define();return K});