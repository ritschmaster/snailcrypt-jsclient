sap.ui.define(["./thirdparty/merge","./Boot","./UI5ElementMetadata","./EventProvider","./util/getSingletonElementInstance","./StaticAreaItem","./updateShadowRoot","./Render","./CustomElementsRegistry","./DOMObserver","./config/NoConflict","./locale/getEffectiveDir","./types/DataType","./util/StringHelper","./util/isValidPropertyName","./util/isDescendantOf","./util/SlotsHelper","./util/arraysAreEqual","./util/getClassCopy","./locale/RTLAwareRegistry","./theming/preloadLinks"],function(t,e,s,i,a,n,r,o,l,h,c,d,u,f,g,p,m,_,y,v,w){"use strict";let C=0;const b=new Map;const M=new Map;function A(t){if(this._suppressInvalidation){return}this.onInvalidation(t);this._changedState.push(t);o.renderDeferred(this);this._eventProvider.fireEvent("invalidate",{...t,target:this})}let S={};class E extends HTMLElement{constructor(){super();this._changedState=[];this._suppressInvalidation=true;this._inDOM=false;this._fullyConnected=false;this._childChangeListeners=new Map;this._slotChangeListeners=new Map;this._eventProvider=new i;let t;this._domRefReadyPromise=new Promise(e=>{t=e});this._domRefReadyPromise._deferredResolve=t;this._initializeState();this._upgradeAllProperties();if(this.constructor._needsShadowDOM()){this.attachShadow({mode:"open"})}}get _id(){if(!this.__id){this.__id=`ui5wc_${++C}`}return this.__id}async connectedCallback(){this.setAttribute(this.constructor.getMetadata().getPureTag(),"");if(this.constructor.getMetadata().supportsF6FastNavigation()){this.setAttribute("data-sap-ui-fastnavgroup","true")}const t=this.constructor.getMetadata().slotsAreManaged();this._inDOM=true;if(t){this._startObservingDOMChildren();await this._processChildren()}if(!this._inDOM){return}o.renderImmediately(this);this._domRefReadyPromise._deferredResolve();this._fullyConnected=true;if(typeof this.onEnterDOM==="function"){this.onEnterDOM()}}disconnectedCallback(){const t=this.constructor.getMetadata().slotsAreManaged();this._inDOM=false;if(t){this._stopObservingDOMChildren()}if(this._fullyConnected){if(typeof this.onExitDOM==="function"){this.onExitDOM()}this._fullyConnected=false}if(this.staticAreaItem&&this.staticAreaItem.parentElement){this.staticAreaItem.parentElement.removeChild(this.staticAreaItem)}o.cancelRender(this)}_startObservingDOMChildren(){const t=this.constructor.getMetadata().hasSlots();if(!t){return}const e=this.constructor.getMetadata().canSlotText();const s={childList:true,subtree:e,characterData:e};h.observeDOMNode(this,this._processChildren.bind(this),s)}_stopObservingDOMChildren(){h.unobserveDOMNode(this)}async _processChildren(){const t=this.constructor.getMetadata().hasSlots();if(t){await this._updateSlots()}}async _updateSlots(){const t=this.constructor.getMetadata().getSlots();const e=this.constructor.getMetadata().canSlotText();const s=Array.from(e?this.childNodes:this.children);const i=new Map;const a=new Map;for(const[e,s]of Object.entries(t)){const t=s.propertyName||e;a.set(t,e);i.set(t,[...this._state[t]]);this._clearSlot(e,s)}const n=new Map;const r=new Map;const o=s.map(async(e,s)=>{const i=m.getSlotName(e);const a=t[i];if(a===undefined){const s=Object.keys(t).join(", ");console.warn(`Unknown slotName: ${i}, ignoring`,e,`Valid values are: ${s}`);return}if(a.individualSlots){const t=(n.get(i)||0)+1;n.set(i,t);e._individualSlot=`${i}-${t}`}if(e instanceof HTMLElement){const t=e.localName;const s=t.includes("-");if(s){const s=window.customElements.get(t);if(!s){const e=window.customElements.whenDefined(t);let s=b.get(t);if(!s){s=new Promise(t=>setTimeout(t,1e3));b.set(t,s)}await Promise.race([e,s])}window.customElements.upgrade(e)}}e=this.constructor.getMetadata().constructor.validateSlotValue(e,a);if(e.isUI5Element&&a.invalidateOnChildChange){const t=(e.attachInvalidate||e._attachChange).bind(e);t(this._getChildChangeListener(i))}if(m.isSlot(e)){this._attachSlotChange(e,i)}const o=a.propertyName||i;if(r.has(o)){r.get(o).push({child:e,idx:s})}else{r.set(o,[{child:e,idx:s}])}});await Promise.all(o);r.forEach((t,e)=>{this._state[e]=t.sort((t,e)=>t.idx-e.idx).map(t=>t.child)});let l=false;for(const[e,s]of Object.entries(t)){const t=s.propertyName||e;if(!_(i.get(t),this._state[t])){A.call(this,{type:"slot",name:a.get(t),reason:"children"});l=true}}if(!l){A.call(this,{type:"slot",name:"default",reason:"textcontent"})}}_clearSlot(t,e){const s=e.propertyName||t;const i=this._state[s];i.forEach(e=>{if(e&&e.isUI5Element){const s=(e.detachInvalidate||e._detachChange).bind(e);s(this._getChildChangeListener(t))}if(m.isSlot(e)){this._detachSlotChange(e,t)}});this._state[s]=[]}attachInvalidate(t){this._eventProvider.attachEvent("invalidate",t)}detachInvalidate(t){this._eventProvider.detachEvent("invalidate",t)}_onChildChange(t,e){if(!this.constructor.getMetadata().shouldInvalidateOnChildChange(t,e.type,e.name)){return}A.call(this,{type:"slot",name:t,reason:"childchange",child:e.target})}attributeChangedCallback(t,e,s){const i=this.constructor.getMetadata().getProperties();const a=t.replace(/^ui5-/,"");const n=f.kebabToCamelCase(a);if(i.hasOwnProperty(n)){const t=i[n].type;if(t===Boolean){s=s!==null}else if(p(t,u)){s=t.attributeToProperty(s)}this[n]=s}}_updateAttribute(t,e){if(!this.constructor.getMetadata().hasAttribute(t)){return}const s=this.constructor.getMetadata().getProperties();const i=s[t].type;const a=f.camelToKebabCase(t);const n=this.getAttribute(a);if(i===Boolean){if(e===true&&n===null){this.setAttribute(a,"")}else if(e===false&&n!==null){this.removeAttribute(a)}}else if(p(i,u)){this.setAttribute(a,i.propertyToAttribute(e))}else if(typeof e!=="object"){if(n!==e){this.setAttribute(a,e)}}}_upgradeProperty(t){if(this.hasOwnProperty(t)){const e=this[t];delete this[t];this[t]=e}}_upgradeAllProperties(){const t=this.constructor.getMetadata().getPropertiesList();t.forEach(this._upgradeProperty,this)}_initializeState(){this._state={...this.constructor.getMetadata().getInitialState()}}_getChildChangeListener(t){if(!this._childChangeListeners.has(t)){this._childChangeListeners.set(t,this._onChildChange.bind(this,t))}return this._childChangeListeners.get(t)}_getSlotChangeListener(t){if(!this._slotChangeListeners.has(t)){this._slotChangeListeners.set(t,this._onSlotChange.bind(this,t))}return this._slotChangeListeners.get(t)}_attachSlotChange(t,e){t.addEventListener("slotchange",this._getSlotChangeListener(e))}_detachSlotChange(t,e){t.removeEventListener("slotchange",this._getSlotChangeListener(e))}_onSlotChange(t){A.call(this,{type:"slot",name:t,reason:"slotchange"})}onInvalidation(t){}_render(){const t=this.constructor.getMetadata().hasIndividualSlots();this._suppressInvalidation=true;if(typeof this.onBeforeRendering==="function"){this.onBeforeRendering()}if(this._onComponentStateFinalized){this._onComponentStateFinalized()}this._suppressInvalidation=false;this._changedState=[];if(this.constructor._needsShadowDOM()){r(this)}if(this.staticAreaItem){this.staticAreaItem.update()}if(t){this._assignIndividualSlotsToChildren()}if(typeof this.onAfterRendering==="function"){this.onAfterRendering()}}_assignIndividualSlotsToChildren(){const t=Array.from(this.children);t.forEach(t=>{if(t._individualSlot){t.setAttribute("slot",t._individualSlot)}})}_waitForDomRef(){return this._domRefReadyPromise}getDomRef(){if(typeof this._getRealDomRef==="function"){return this._getRealDomRef()}if(!this.shadowRoot||this.shadowRoot.children.length===0){return}const t=[...this.shadowRoot.children].filter(t=>!["link","style"].includes(t.localName));if(t.length!==1){console.warn(`The shadow DOM for ${this.constructor.getMetadata().getTag()} does not have a top level element, the getDomRef() method might not work as expected`)}return t[0]}getFocusDomRef(){const t=this.getDomRef();if(t){const e=t.querySelector("[data-sap-focus-ref]");return e||t}}async getFocusDomRefAsync(){await this._waitForDomRef();return this.getFocusDomRef()}async focus(){await this._waitForDomRef();const t=this.getFocusDomRef();if(t&&typeof t.focus==="function"){t.focus()}}fireEvent(t,e,s=false,i=true){const a=this._fireEvent(t,e,s,i);const n=f.kebabToCamelCase(t);if(n!==t){return a&&this._fireEvent(n,e,s)}return a}_fireEvent(t,e,s=false,i=true){const a=new CustomEvent(`ui5-${t}`,{detail:e,composed:false,bubbles:i,cancelable:s});const n=this.dispatchEvent(a);if(c.skipOriginalEvent(t)){return n}const r=new CustomEvent(t,{detail:e,composed:false,bubbles:i,cancelable:s});const o=this.dispatchEvent(r);return o&&n}getSlottedNodes(t){return m.getSlottedElementsList(this[t])}get effectiveDir(){v.markAsRtlAware(this.constructor);return d(this)}get isUI5Element(){return true}static get observedAttributes(){return this.getMetadata().getAttributesList()}static _needsShadowDOM(){return!!this.template}static _needsStaticArea(){return!!this.staticAreaTemplate}getStaticAreaItemDomRef(){if(!this.constructor._needsStaticArea()){throw new Error("This component does not use the static area")}if(!this.staticAreaItem){this.staticAreaItem=n.createInstance();this.staticAreaItem.setOwnerElement(this)}if(!this.staticAreaItem.parentElement){a("ui5-static-area").appendChild(this.staticAreaItem)}return this.staticAreaItem.getDomRef()}static _generateAccessors(){const t=this.prototype;const e=this.getMetadata().slotsAreManaged();const s=this.getMetadata().getProperties();for(const[e,i]of Object.entries(s)){if(!g(e)){console.warn(`"${e}" is not a valid property name. Use a name that does not collide with DOM APIs`)}if(i.type===Boolean&&i.defaultValue){throw new Error(`Cannot set a default value for property "${e}". All booleans are false by default.`)}if(i.type===Array){throw new Error(`Wrong type for property "${e}". Properties cannot be of type Array - use "multiple: true" and set "type" to the single value type, such as "String", "Object", etc...`)}if(i.type===Object&&i.defaultValue){throw new Error(`Cannot set a default value for property "${e}". All properties of type "Object" are empty objects by default.`)}if(i.multiple&&i.defaultValue){throw new Error(`Cannot set a default value for property "${e}". All multiple properties are empty arrays by default.`)}Object.defineProperty(t,e,{get(){if(this._state[e]!==undefined){return this._state[e]}const t=i.defaultValue;if(i.type===Boolean){return false}else if(i.type===String){return t}else if(i.multiple){return[]}else{return t}},set(t){let s;t=this.constructor.getMetadata().constructor.validatePropertyValue(t,i);const a=this._state[e];if(i.multiple&&i.compareValues){s=!_(a,t)}else if(p(i.type,u)){s=!i.type.valuesAreEqual(a,t)}else{s=a!==t}if(s){this._state[e]=t;A.call(this,{type:"property",name:e,newValue:t,oldValue:a});this._updateAttribute(e,t)}}})}if(e){const e=this.getMetadata().getSlots();for(const[s,i]of Object.entries(e)){if(!g(s)){console.warn(`"${s}" is not a valid property name. Use a name that does not collide with DOM APIs`)}const e=i.propertyName||s;Object.defineProperty(t,e,{get(){if(this._state[e]!==undefined){return this._state[e]}return[]},set(){throw new Error("Cannot set slot content directly, use the DOM APIs (appendChild, removeChild, etc...)")}})}}}static get metadata(){return S}static set metadata(t){S=t}static get styles(){return""}static get staticAreaStyles(){return""}static get dependencies(){return[]}static getUniqueDependencies(){if(!M.has(this)){const t=this.dependencies.filter((t,e,s)=>s.indexOf(t)===e);M.set(this,t)}return M.get(this)}static whenDependenciesDefined(){return Promise.all(this.getUniqueDependencies().map(t=>t.define()))}static async onDefine(){return Promise.resolve()}static async define(){await e.boot();await Promise.all([this.whenDependenciesDefined(),this.onDefine()]);const t=this.getMetadata().getTag();const s=this.getMetadata().getAltTag();const i=l.isTagRegistered(t);const a=customElements.get(t);if(a&&!i){l.recordTagRegistrationFailure(t)}else if(!a){this._generateAccessors();l.registerTag(t);window.customElements.define(t,this);w(this);if(s&&!customElements.get(s)){l.registerTag(s);window.customElements.define(s,y(this,()=>{console.log(`The ${s} tag is deprecated and will be removed in the next release, please use ${t} instead.`)}))}}return this}static getMetadata(){if(this.hasOwnProperty("_metadata")){return this._metadata}const e=[this.metadata];let i=this;while(i!==E){i=Object.getPrototypeOf(i);e.unshift(i.metadata)}const a=t({},...e);this._metadata=new s(a);return this._metadata}}return E});