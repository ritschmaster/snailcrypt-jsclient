sap.ui.define(["../Keys","../util/getActiveElement","../types/NavigationMode","../types/ItemNavigationBehavior"],function(e,t,i,n){"use strict";class s{constructor(e,t={}){this._setRootComponent(e);this._initOptions(t)}_setRootComponent(e){if(!e.isUI5Element){throw new Error("The root web component must be a UI5 Element instance")}this.rootWebComponent=e;this.rootWebComponent.addEventListener("keydown",this._onkeydown.bind(this));this.rootWebComponent._onComponentStateFinalized=()=>{this._init()}}_initOptions(e){if(typeof e.getItemsCallback!=="function"){throw new Error("getItemsCallback is required")}this._getItems=e.getItemsCallback;this._currentIndex=e.currentIndex||0;this._rowSize=e.rowSize||1;this._behavior=e.behavior||n.Static;this._navigationMode=e.navigationMode||i.Auto;this._affectedPropertiesNames=e.affectedPropertiesNames||[];this._skipItemsSize=e.skipItemsSize||null}setCurrentItem(e){const t=this._getItems().indexOf(e);if(t===-1){console.warn(`The provided item is not managed by ItemNavigation`,e);return}this._currentIndex=t;this._applyTabIndex()}setRowSize(e){this._rowSize=e}_init(){this._getItems().forEach((e,t)=>{e._tabIndex=t===this._currentIndex?"0":"-1"})}_onkeydown(t){if(!this._canNavigate()){return}const n=this._navigationMode===i.Horizontal||this._navigationMode===i.Auto;const s=this._navigationMode===i.Vertical||this._navigationMode===i.Auto;if(e.isUp(t)&&s){this._handleUp()}else if(e.isDown(t)&&s){this._handleDown()}else if(e.isLeft(t)&&n){this._handleLeft()}else if(e.isRight(t)&&n){this._handleRight()}else if(e.isHome(t)){this._handleHome()}else if(e.isEnd(t)){this._handleEnd()}else if(e.isPageUp(t)){this._handlePageUp()}else if(e.isPageDown(t)){this._handlePageDown()}else{return}t.preventDefault();this._applyTabIndex();this._focusCurrentItem()}_handleUp(){const e=this._getItems().length;if(this._currentIndex-this._rowSize>=0){this._currentIndex-=this._rowSize;return}if(this._behavior===n.Cyclic){const t=this._currentIndex%this._rowSize;const i=t===0?this._rowSize-1:t-1;const n=Math.ceil(e/this._rowSize);let s=i+(n-1)*this._rowSize;if(s>e-1){s-=this._rowSize}this._currentIndex=s}else{this._currentIndex=0}}_handleDown(){const e=this._getItems().length;if(this._currentIndex+this._rowSize<e){this._currentIndex+=this._rowSize;return}if(this._behavior===n.Cyclic){const e=this._currentIndex%this._rowSize;const t=(e+1)%this._rowSize;this._currentIndex=t}else{this._currentIndex=e-1}}_handleLeft(){const e=this._getItems().length;if(this._currentIndex>0){this._currentIndex-=1;return}if(this._behavior===n.Cyclic){this._currentIndex=e-1}}_handleRight(){const e=this._getItems().length;if(this._currentIndex<e-1){this._currentIndex+=1;return}if(this._behavior===n.Cyclic){this._currentIndex=0}}_handleHome(){const e=this._rowSize>1?this._rowSize:this._getItems().length;this._currentIndex-=this._currentIndex%e}_handleEnd(){const e=this._rowSize>1?this._rowSize:this._getItems().length;this._currentIndex+=e-1-this._currentIndex%e}_handlePageUp(){if(this._rowSize>1){return}this._handlePageUpFlat()}_handlePageDown(){if(this._rowSize>1){return}this._handlePageDownFlat()}_handlePageUpFlat(){if(this._skipItemsSize===null){this._currentIndex-=this._currentIndex}if(this._currentIndex+1>this._skipItemsSize){this._currentIndex-=this._skipItemsSize}else{this._currentIndex-=this._currentIndex}}_handlePageDownFlat(){if(this._skipItemsSize===null){this._currentIndex=this._getItems().length-1}const e=this._getItems().length-this._currentIndex-1;if(e>this._skipItemsSize){this._currentIndex+=this._skipItemsSize}else{this._currentIndex=this._getItems().length-1}}_applyTabIndex(){const e=this._getItems();for(let t=0;t<e.length;t++){e[t]._tabIndex=t===this._currentIndex?"0":"-1"}this._affectedPropertiesNames.forEach(e=>{const t=this.rootWebComponent[e];this.rootWebComponent[e]=Array.isArray(t)?[...t]:{...t}})}_focusCurrentItem(){const e=this._getCurrentItem();if(e){e.focus()}}_canNavigate(){const e=this._getCurrentItem();const i=t();return e&&e===i}_getCurrentItem(){const e=this._getItems();if(!e.length){return null}while(this._currentIndex>=e.length){this._currentIndex-=this._rowSize}if(this._currentIndex<0){this._currentIndex=0}const t=e[this._currentIndex];if(!t){return}if(t.isUI5Element){return t.getFocusDomRef()}if(!this.rootWebComponent.getDomRef()){return}return this.rootWebComponent.getDomRef().querySelector(`#${t.id}`)}}return s});