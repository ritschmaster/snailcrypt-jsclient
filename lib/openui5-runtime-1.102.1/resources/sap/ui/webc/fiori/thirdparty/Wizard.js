sap.ui.define(["sap/ui/webc/common/thirdparty/base/UI5Element","sap/ui/webc/common/thirdparty/base/renderer/LitRenderer","sap/ui/webc/common/thirdparty/base/i18nBundle","sap/ui/webc/common/thirdparty/base/delegate/ItemNavigation","sap/ui/webc/common/thirdparty/base/types/NavigationMode","sap/ui/webc/common/thirdparty/base/types/Float","sap/ui/webc/common/thirdparty/base/util/clamp","sap/ui/webc/common/thirdparty/base/delegate/ResizeHandler","sap/ui/webc/common/thirdparty/base/Device","sap/ui/webc/common/thirdparty/base/util/debounce","sap/ui/webc/common/thirdparty/base/util/FocusableElements","sap/ui/webc/main/thirdparty/Button","sap/ui/webc/main/thirdparty/ResponsivePopover","./generated/i18n/i18n-defaults","./WizardTab","./WizardStep","./generated/templates/WizardTemplate.lit","./generated/templates/WizardPopoverTemplate.lit","./generated/themes/Wizard.css","./generated/themes/WizardPopover.css"],function(e,t,s,i,r,n,o,l,a,d,c,p,h,u,S,g,f,b,A,I){"use strict";function T(e){return e&&typeof e==="object"&&"default"in e?e["default"]:e}var _=T(e);var y=T(t);var m=T(i);var v=T(r);var x=T(n);var R=T(o);var w=T(l);var O=T(d);var B=T(p);var E=T(h);const C=64;const D=200;const L="data-ui5-wizard-expanded-tab";const z="data-ui5-wizard-expanded-tab-next";const H="data-ui5-wizard-after-current-tab";const P="data-ui5-wizard-expanded-tab-prev";const N={MIN:.5,DEFAULT:.7,MAX:1};const M={tag:"ui5-wizard",managedSlots:true,fastNavigation:true,properties:{width:{type:x},stepSwitchThreshold:{type:x,defaultValue:N.DEFAULT},contentHeight:{type:x},_groupedTabs:{type:String,multiple:true}},slots:{default:{propertyName:"steps",type:HTMLElement,individualSlots:true,invalidateOnChildChange:true}},events:{"step-change":{detail:{step:{type:HTMLElement},previousStep:{type:HTMLElement},changeWithClick:{Boolean:Boolean}}}}};class W extends _{constructor(){super();this.stepScrollOffsets=[];this._groupedTabs=[];this.selectedStepIndex=0;this.previouslySelectedStepIndex=0;this.selectionRequestedByClick=false;this._prevWidth=0;this._prevContentHeight=0;this.selectionRequestedByScroll=false;this._itemNavigation=new m(this,{navigationMode:v.Auto,getItemsCallback:()=>this.enabledStepsInHeaderDOM});this._onStepResize=this.onStepResize.bind(this)}static get metadata(){return M}static get render(){return y}get classes(){return{popover:{"ui5-wizard-responsive-popover":true,"ui5-wizard-popover":!a.isPhone(),"ui5-wizard-dialog":a.isPhone()}}}static get styles(){return A}static get staticAreaStyles(){return I}static get template(){return f}static get dependencies(){return[S,g,E,B]}static async onDefine(){W.i18nBundle=await s.getI18nBundle("@ui5/webcomponents-fiori")}static get PHONE_BREAKPOINT(){return 599}static get SCROLL_DEBOUNCE_RATE(){return 25}static get staticAreaTemplate(){return b}onExitDOM(){this.detachStepsResizeObserver()}onBeforeRendering(){this.syncSelection()}onAfterRendering(){this.storeStepScrollOffsets();if(this.previouslySelectedStepIndex!==this.selectedStepIndex){this.scrollToSelectedStep()}this.attachStepsResizeObserver();this.previouslySelectedStepIndex=this.selectedStepIndex}syncSelection(){if(this.stepsCount===0){return}if(this.selectedStepsCount===0){this.selectFirstStep();console.warn("Selecting the first step: no selected step is defined.")}if(this.selectedStepsCount>1){this.selectLastSelectedStep();console.warn(`Selecting the last step defined as selected: multiple selected steps are defined.`)}if(this.selectedStep&&this.selectedStep.disabled){console.warn("The selected step is disabled: you need to enable it in order to interact with the step.")}this.selectedStepIndex=this.getSelectedStepIndex()}selectFirstStep(){this.deselectAll();this.slottedSteps[0].selected=true;this.slottedSteps[0].disabled=false}selectLastSelectedStep(){const e=this.lastSelectedStep;if(e){this.deselectAll();e.selected=true;e.disabled=false}}deselectAll(){this.slottedSteps.forEach(e=>{e.selected=false})}storeStepScrollOffsets(){this.stepScrollOffsets=this.slottedSteps.map(e=>{const t=this.getStepWrapperByRefId(e._id);return t.offsetTop+t.offsetHeight})}onSelectionChangeRequested(e){this.selectionRequestedByClick=true;this.changeSelectionByStepAction(e.target)}onScroll(e){if(this.selectionRequestedByClick){this.selectionRequestedByClick=false;return}O(this.changeSelectionByScroll.bind(this,e.target.scrollTop),W.SCROLL_DEBOUNCE_RATE)}onStepInHeaderFocused(e){this._itemNavigation.setCurrentItem(e.target)}onStepResize(){this.width=this.getBoundingClientRect().width;this.contentHeight=this.getContentHeight();if(this._prevWidth!==this.width||this.contentHeight!==this._prevContentHeight){this._closeRespPopover()}this._prevWidth=this.width;this._prevContentHeight=this.contentHeight}attachStepsResizeObserver(){this.stepsDOM.forEach(e=>{w.deregister(e,this._onStepResize);w.register(e,this._onStepResize)})}detachStepsResizeObserver(){this.stepsDOM.forEach(e=>{w.deregister(e,this._onStepResize)})}_adjustHeaderOverflow(){let e=0;let t=true;const s=this.width;const i=this.getSelectedStepIndex();const r=this.steps.length?Math.floor(s/D):Math.floor(s/C);const n=this.shadowRoot.querySelectorAll("[ui5-wizard-tab]");if(!n.length){return}[].forEach.call(n,(e,t)=>{e.setAttribute(L,false);e.setAttribute(P,false);e.setAttribute(z,false);if(t>i){n[t].setAttribute(H,true)}else{n[t].removeAttribute(H)}});if(n[i]){n[i].setAttribute(L,true)}for(let s=1;s<r;s++){if(t){e+=1}if(t&&n[i+e]){n[i+e].setAttribute(L,true);t=!t}else if(!t&&n[i-e]){n[i-e].setAttribute(L,true);t=!t}else if(n[i+e+1]){e+=1;n[i+e].setAttribute(L,true);t=true}else if(n[i-e]){n[i-e].setAttribute(L,true);e+=1;t=false}}for(let e=0;e<n.length;e++){if(n[e].getAttribute(L)==="true"&&n[e-1]&&n[e-1].getAttribute(L)==="false"){n[e-1].setAttribute(P,true)}if(n[e].getAttribute(L)==="false"&&n[e-1]&&n[e-1].getAttribute(L)==="true"){n[e].setAttribute(z,true);break}}}_isGroupAtStart(e){const t=this.stepsInHeaderDOM.indexOf(e);return e.getAttribute(L)==="false"&&e.getAttribute(P)==="true"&&t>0}_isGroupAtEnd(e){const t=this.stepsInHeaderDOM.indexOf(e);return e.getAttribute(L)==="false"&&e.getAttribute(z)==="true"&&t+1<this.steps.length}async _showPopover(e,t){const s=Array.from(this.shadowRoot.querySelectorAll("[ui5-wizard-tab]"));this._groupedTabs=[];const i=t?0:this.stepsInHeaderDOM.indexOf(e);const r=t?this.stepsInHeaderDOM.indexOf(e):s.length-1;for(let e=i;e<=r;e++){this._groupedTabs.push(s[e])}const n=await this._respPopover();n.showAt(e)}async _onGroupedTabClick(e){if(this._isGroupAtStart(e.target)){return this._showPopover(e.target,true)}if(this._isGroupAtEnd(e.target)){return this._showPopover(e.target,false)}}_onOverflowStepButtonClick(e){const t=Array.from(this.shadowRoot.querySelectorAll("[ui5-wizard-tab]"));const s=e.target.getAttribute("data-ui5-header-tab-ref-id");const i=this.slottedSteps[s-1];const r=this.selectedStep;const n=this.slottedSteps.indexOf(i);this.switchSelectionFromOldToNewStep(r,i,n,true);this._closeRespPopover();t[n].focus()}async _closeRespPopover(){const e=await this._respPopover();e&&e.close()}async _respPopover(){const e=await this.getStaticAreaItemDomRef();return e.querySelector(`.ui5-wizard-responsive-popover`)}changeSelectionByScroll(e){const t=this.getClosestStepIndexByScrollPos(e);if(this.selectedStepIndex===t){return}if(t>=0&&t<=this.stepsCount-1){const e=this.slottedSteps[t];this.switchSelectionFromOldToNewStep(this.selectedStep,e,t,false);this.selectionRequestedByScroll=true}}async changeSelectionByStepAction(e){const t=e.getAttribute("data-ui5-content-ref-id");const s=this.selectedStep;const i=this.getStepByRefId(t);const r=e.getAttribute(L)==="true";const n=this.slottedSteps.indexOf(i);const o=await c.getFirstFocusableElement(i.firstElementChild);if(o){o.focus()}if(s===i){this.scrollToContentItem(this.selectedStepIndex);return}if(r||!r&&(n===0||n===this.steps.length-1)){this.switchSelectionFromOldToNewStep(s,i,n,true)}}getContentHeight(){let e=0;this.stepsDOM.forEach(t=>{e+=t.getBoundingClientRect().height});return e}getStepAriaLabelText(e,t){return W.i18nBundle.getText(u.WIZARD_STEP_ARIA_LABEL,t)}get stepsDOM(){return Array.from(this.shadowRoot.querySelectorAll(".ui5-wiz-content-item"))}get _stepsInHeader(){return this.getStepsInfo()}get _steps(){const e=this.getLastEnabledStepIndex();const t=this.getStepsInfo();return this.steps.map((s,i)=>{s.stretch=i===e;s.stepContentAriaLabel=`${this.navStepDefaultHeading} ${t[i].number} ${t[i].titleText}`;return s})}get stepsCount(){return this.slottedSteps.length}get selectedStep(){if(this.selectedStepsCount){return this.selectedSteps[0]}return null}get lastSelectedStep(){if(this.selectedStepsCount){return this.selectedSteps[this.selectedStepsCount-1]}return null}get selectedSteps(){return this.slottedSteps.filter(e=>e.selected)}get enabledSteps(){return this.slottedSteps.filter(e=>!e.disabled)}get selectedStepsCount(){return this.selectedSteps.length}get slottedSteps(){return this.getSlottedNodes("steps")}get contentDOM(){return this.shadowRoot.querySelector(`.ui5-wiz-content`)}get stepsInHeaderDOM(){return Array.from(this.shadowRoot.querySelectorAll("[ui5-wizard-tab]"))}get enabledStepsInHeaderDOM(){return this.stepsInHeaderDOM}get phoneMode(){if(a.isPhone()){return true}return this.width<=W.PHONE_BREAKPOINT}get navAriaRoleDescription(){return W.i18nBundle.getText(u.WIZARD_NAV_ARIA_ROLE_DESCRIPTION)}get navAriaLabelText(){return W.i18nBundle.getText(u.WIZARD_NAV_ARIA_LABEL)}get navAriaDescribedbyText(){return W.i18nBundle.getText(u.WIZARD_LIST_ARIA_DESCRIBEDBY)}get listAriaLabelText(){return W.i18nBundle.getText(u.WIZARD_LIST_ARIA_LABEL)}get actionSheetStepsText(){return W.i18nBundle.getText(u.WIZARD_ACTIONSHEET_STEPS_ARIA_LABEL)}get navStepDefaultHeading(){return W.i18nBundle.getText(u.WIZARD_NAV_STEP_DEFAULT_HEADING)}get optionalStepText(){return W.i18nBundle.getText(u.WIZARD_OPTIONAL_STEP_ARIA_LABEL)}get activeStepText(){return W.i18nBundle.getText(u.WIZARD_STEP_ACTIVE)}get inactiveStepText(){return W.i18nBundle.getText(u.WIZARD_STEP_INACTIVE)}get ariaLabelText(){return W.i18nBundle.getText(u.WIZARD_NAV_ARIA_ROLE_DESCRIPTION)}get effectiveStepSwitchThreshold(){return R(this.stepSwitchThreshold,N.MIN,N.MAX)}getStepsInfo(){const e=this.getLastEnabledStepIndex();const t=this.stepsCount;const s=this.getSelectedStepIndex();let i=this.steps.length+10;let r;this._adjustHeaderOverflow();return this.steps.map((n,o)=>{const l=o+1;const a=o===t-1&&!n.branching;const d=n.subtitleText?this.optionalStepText:"";const c=n.disabled?this.inactiveStepText:this.activeStepText;const p=(n.titleText?`${l} ${n.titleText} ${c} ${d}`:`${this.navStepDefaultHeading} ${l} ${c} ${d}`).trim();const h=o>s;r={ariaSetsize:t,ariaPosinset:l,ariaLabel:this.getStepAriaLabelText(n,p)};return{icon:n.icon,titleText:n.titleText,subtitleText:n.subtitleText,number:l,selected:n.selected,disabled:n.disabled,hideSeparator:a,activeSeparator:o<e&&!n.disabled,branchingSeparator:n.branching,pos:l,accInfo:r,refStepId:n._id,tabIndex:this.selectedStepIndex===o?"0":"-1",styles:{zIndex:h?--i:1}}})}getSelectedStepIndex(){if(this.selectedStep){return this.slottedSteps.indexOf(this.selectedStep)}return 0}getLastEnabledStepIndex(){let e=0;this.slottedSteps.forEach((t,s)=>{if(!t.disabled){e=s}});return e}getStepByRefId(e){return this.slottedSteps.find(t=>t._id===e)}getStepWrapperByRefId(e){return this.shadowRoot.querySelector(`[data-ui5-content-item-ref-id=${e}]`)}getStepWrapperByIdx(e){return this.getStepWrapperByRefId(this.steps[e]._id)}scrollToSelectedStep(){if(!this.selectionRequestedByScroll){this.scrollToContentItem(this.selectedStepIndex)}this.selectionRequestedByScroll=false}scrollToContentItem(e){this.contentDOM.scrollTop=this.getClosestScrollPosByStepIndex(e)}getClosestScrollPosByStepIndex(e){if(e===0){return 0}for(let t=e-1;t>=0;t--){if(this.stepScrollOffsets[t]>0){return this.stepScrollOffsets[t]}}return 0}getClosestStepIndexByScrollPos(e){for(let t=0;t<=this.stepScrollOffsets.length-1;t++){const s=this.stepScrollOffsets[t];const i=this.getStepWrapperByIdx(t);const r=i.offsetTop+i.offsetHeight*this.effectiveStepSwitchThreshold;if(s>0&&e<s){if(e>r){return t+1}return t}}return this.selectedStepIndex}switchSelectionFromOldToNewStep(e,t,s,i){if(e&&t){if(!t.disabled){e.selected=false;t.selected=true}this.fireEvent("step-change",{step:t,previousStep:e,changeWithClick:i});this.selectedStepIndex=s}}sortAscending(e,t){if(e<t){return-1}if(e>t){return 1}return 0}}W.define();return W});