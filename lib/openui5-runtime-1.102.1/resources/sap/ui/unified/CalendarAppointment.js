/*!
 * OpenUI5
 * (c) Copyright 2009-2022 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(['./DateTypeRange','sap/ui/core/format/DateFormat','sap/ui/core/format/NumberFormat','sap/ui/core/format/TimezoneUtil','sap/ui/core/Core','./calendar/CalendarUtils','./library',"sap/base/Log"],function(D,a,N,T,C,b,l,L){"use strict";var c=D.extend("sap.ui.unified.CalendarAppointment",{metadata:{library:"sap.ui.unified",properties:{title:{type:"string",group:"Data"},text:{type:"string",group:"Data"},description:{type:"string",group:"Data"},icon:{type:"sap.ui.core.URI",group:"Data",defaultValue:null},tentative:{type:"boolean",group:"Data",defaultValue:false},selected:{type:"boolean",group:"Data",defaultValue:false},key:{type:"string",group:"Data",defaultValue:null},color:{type:"sap.ui.core.CSSColor",group:"Appearance",defaultValue:null}},aggregations:{customContent:{type:"sap.ui.core.Control",multiple:true}}}});c.prototype.init=function(){this._sAppointmentPartSuffix=null;};c.prototype.applyFocusInfo=function(f){var p=this.getParent();if(p){p.applyFocusInfo(f);}return this;};c.prototype._getDateRangeIntersectionText=function(o){var s=this._getStartDateWithTimezoneAdaptation(),e=this._getEndDateWithTimezoneAdaptation()?this._getEndDateWithTimezoneAdaptation():new Date(864000000000000),f,S,d=new Date(o.getFullYear(),o.getMonth(),o.getDate(),0,0,0),n=new Date(d.getFullYear(),d.getMonth(),d.getDate()+1),t=a.getTimeInstance({pattern:"HH:mm"}),r=sap.ui.getCore().getLibraryResourceBundle("sap.m"),h=N.getUnitInstance({allowedUnits:["duration-hour"]},sap.ui.getCore().getConfiguration().getFormatSettings().getFormatLocale()),m=N.getUnitInstance({allowedUnits:["duration-minute"]},sap.ui.getCore().getConfiguration().getFormatSettings().getFormatLocale()),H,M,g,i;if(s.getTime()>=n.getTime()||e.getTime()<=d.getTime()){f="";}else if(s.getTime()<=d.getTime()&&e.getTime()>=n.getTime()){f=r.getText("PLANNINGCALENDAR_ALLDAY");}else if(s.getTime()<d.getTime()){f=r.getText("PLANNINGCALENDAR_UNTIL");S=t.format(e);}else if(e.getTime()>n.getTime()){f=r.getText("PLANNINGCALENDAR_FROM");S=t.format(s);}else{f=t.format(s);if(e.getTime()-s.getTime()<3600000){M=(e.getTime()-s.getTime())/60000;S=m.format(M,"duration-minute");}else if(((e.getTime()-s.getTime())%3600000)===0){H=(e.getTime()-s.getTime())/3600000;S=h.format(H,"duration-hour");}else{H=Math.floor((e.getTime()-s.getTime())/3600000);g=h.format(H,"duration-hour");M=(e.getTime()-s.getTime())/60000%60;i=m.format(M,"duration-minute");S=r.getText("PLANNINGCALENDAR_APP_DURATION",[g,i]);}}return{start:f,end:S};};c._getComparer=function(d){var O=24*60*60*1000,i=new Date(d.getFullYear(),d.getMonth(),d.getDate(),0,0,0).getTime(),n=i+O;return function(A,o){var s=A.appointment._getStartDateWithTimezoneAdaptation().getTime(),S=o.appointment._getStartDateWithTimezoneAdaptation().getTime(),e=A.appointment._getEndDateWithTimezoneAdaptation()?A.appointment._getEndDateWithTimezoneAdaptation().getTime():864000000000000,E=o.appointment._getEndDateWithTimezoneAdaptation()?o.appointment._getEndDateWithTimezoneAdaptation().getTime():864000000000000,w=s<=i&&e>=n,W=S<=i&&E>=n,r;if((w&&W)||(!w&&!W)){r=s-S;if(r===0){r=E-e;}}else if(w){r=-1;}else{r=1;}return r;};};c.prototype.setColor=function(s){if(s&&!s.match(/^#[0-9a-f]{6}$/i)){L.warning("setColor accepts only full hex color value with pound symbol, but value is '"+s+"'");}return this.setProperty("color",s);};c.prototype._getCSSColorForBackground=function(h){return"rgba("+[parseInt(h.substr(1,2),16),parseInt(h.substr(3,2),16),parseInt(h.substr(5,2),16)].join(",")+", 0.2)";};c.prototype._setAppointmentPartSuffix=function(s){this._sAppointmentPartSuffix=s;return this;};c.prototype.getDomRef=function(s){if(document.getElementById(this.getId())){return document.getElementById(s?this.getId()+"-"+s:this.getId());}else if(this._sAppointmentPartSuffix){return document.getElementById(s?this.getId()+"-"+this._sAppointmentPartSuffix+"-"+s:this.getId()+"-"+this._sAppointmentPartSuffix);}var A=document.querySelectorAll(".sapUiCalendarRowApps[id^='"+this.getId()+"']");return A.length>0?A[0]:null;};c.prototype._getEndDateWithTimezoneAdaptation=function(){if(!this.getProperty("endDate")){return null;}var e=this._convertToTimezone(this.getEndDate());return e;};c.prototype._getStartDateWithTimezoneAdaptation=function(){if(!this.getProperty("startDate")){return null;}var s=this._convertToTimezone(this.getStartDate());return s;};c.prototype._convertToTimezone=function(d){var t=C.getConfiguration().getTimezone();var n=b._createUniversalUTCDate(d,undefined,true);n=new Date(d.getUTCFullYear(),d.getUTCMonth(),d.getUTCDate(),d.getUTCHours(),d.getUTCMinutes(),d.getUTCSeconds());n.setUTCFullYear(d.getUTCFullYear());n=T.convertToTimezone(n,t);return n;};return c;});
