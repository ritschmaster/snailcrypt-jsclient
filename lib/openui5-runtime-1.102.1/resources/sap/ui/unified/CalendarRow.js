/*!
 * OpenUI5
 * (c) Copyright 2009-2022 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(['sap/ui/core/Control','sap/ui/Device','sap/ui/core/LocaleData','sap/ui/unified/calendar/CalendarUtils','sap/ui/core/format/TimezoneUtil','sap/ui/core/Core','sap/ui/core/date/UniversalDate','./library','sap/ui/core/InvisibleText','sap/ui/core/format/DateFormat','sap/ui/core/ResizeHandler','sap/ui/core/Locale',"./CalendarRowRenderer","sap/ui/dom/containsOrEquals","sap/ui/thirdparty/jquery","sap/ui/unified/CalendarAppointment",'sap/ui/core/InvisibleMessage','sap/ui/core/library'],function(C,D,L,a,T,b,U,l,I,c,R,d,e,f,q,g,h,m){"use strict";var n=l.CalendarDayType;var o=l.CalendarAppointmentVisualization;var G=l.GroupAppointmentsMode;var r=l.CalendarIntervalType;var s=l.CalendarAppointmentHeight;var t=l.CalendarAppointmentRoundWidth;var u=m.InvisibleMessageMode;var v=C.extend("sap.ui.unified.CalendarRow",{metadata:{library:"sap.ui.unified",properties:{startDate:{type:"object",group:"Data"},intervals:{type:"int",group:"Appearance",defaultValue:12},intervalSize:{type:"int",group:"Appearance",defaultValue:1},intervalType:{type:"sap.ui.unified.CalendarIntervalType",group:"Appearance",defaultValue:r.Hour},showSubIntervals:{type:"boolean",group:"Appearance",defaultValue:false},showIntervalHeaders:{type:"boolean",group:"Appearance",defaultValue:true},showEmptyIntervalHeaders:{type:"boolean",group:"Appearance",defaultValue:true},nonWorkingDays:{type:"int[]",group:"Misc",defaultValue:null},nonWorkingHours:{type:"int[]",group:"Misc",defaultValue:null},width:{type:"sap.ui.core.CSSSize",group:"Dimension",defaultValue:null},height:{type:"sap.ui.core.CSSSize",group:"Dimension",defaultValue:null},checkResize:{type:"boolean",group:"Behavior",defaultValue:true},updateCurrentTime:{type:"boolean",group:"Behavior",defaultValue:true},groupAppointmentsMode:{type:"sap.ui.unified.GroupAppointmentsMode",group:"Appearance",defaultValue:G.Collapsed},appointmentsReducedHeight:{type:"boolean",group:"Appearance",defaultValue:false,deprecated:true},appointmentsVisualization:{type:"sap.ui.unified.CalendarAppointmentVisualization",group:"Appearance",defaultValue:o.Standard},appointmentHeight:{type:"sap.ui.unified.CalendarAppointmentHeight",group:"Appearance",defaultValue:s.Regular},appointmentRoundWidth:{type:"sap.ui.unified.CalendarAppointmentRoundWidth",group:"Appearance",defaultValue:t.None},multipleAppointmentsSelection:{type:"boolean",group:"Data",defaultValue:false}},aggregations:{appointments:{type:"sap.ui.unified.CalendarAppointment",multiple:true,singularName:"appointment"},intervalHeaders:{type:"sap.ui.unified.CalendarAppointment",multiple:true,singularName:"intervalHeader"},groupAppointments:{type:"sap.ui.unified.CalendarAppointment",multiple:true,singularName:"groupAppointment",visibility:"hidden"}},associations:{ariaLabelledBy:{type:"sap.ui.core.Control",multiple:true,singularName:"ariaLabelledBy"},legend:{type:"sap.ui.unified.CalendarLegend",multiple:false}},events:{select:{parameters:{appointment:{type:"sap.ui.unified.CalendarAppointment"},appointments:{type:"sap.ui.unified.CalendarAppointment[]"},multiSelect:{type:"boolean"},domRefId:{type:"string"}}},startDateChange:{},leaveRow:{parameters:{type:{type:"string"}}},intervalSelect:{parameters:{startDate:{type:"object"},endDate:{type:"object"},subInterval:{type:"boolean"}}}}},renderer:e});v.prototype.init=function(){this._bRTL=sap.ui.getCore().getConfiguration().getRTL();this._oRb=sap.ui.getCore().getLibraryResourceBundle("sap.ui.unified");this._oFormatAria=c.getDateTimeInstance({pattern:"EEEE dd/MM/YYYY 'at' "+x.call(this).getTimePattern("medium")});this._aVisibleAppointments=[];this._aVisibleIntervalHeaders=[];this.setStartDate(new Date());this._resizeProxy=q.proxy(this.handleResize,this);this.aSelectedAppointments=[];this._fnCustomSortedAppointments=undefined;};v.prototype.exit=function(){if(this._sResizeListener){R.deregister(this._sResizeListener);this._sResizeListener=undefined;}if(this._sUpdateCurrentTime){clearTimeout(this._sUpdateCurrentTime);this._sUpdateCurrentTime=undefined;}this._fnCustomSortedAppointments=undefined;};v.prototype.onBeforeRendering=function(){this._aVisibleAppointments=[];y.call(this);B.call(this);J.call(this);if(this._sUpdateCurrentTime){clearTimeout(this._sUpdateCurrentTime);this._sUpdateCurrentTime=undefined;}if(!this.getAppointments().length){this.aSelectedAppointments=[];}else{this.getAppointments().forEach(function(i){this._updateSelectedAppointmentsArray(i);}.bind(this));}this._oInvisibleMessage=h.getInstance();};v.prototype.onAfterRendering=function(){K.call(this);this.updateCurrentTimeVisualization();if(this.getCheckResize()&&!this._sResizeListener){this._sResizeListener=R.register(this,this._resizeProxy);}};v.prototype.onThemeChanged=function(j){if(this.getDomRef()){for(var i=0;i<this._aVisibleAppointments.length;i++){var k=this._aVisibleAppointments[i];k.level=-1;}this.handleResize(j);}};v.prototype.invalidate=function(j){if(j&&j instanceof g){var k=false;for(var i=0;i<this._aVisibleAppointments.length;i++){if(this._aVisibleAppointments[i].appointment==j){k=true;break;}}if(k){this._aVisibleAppointments=[];}this._updateSelectedAppointmentsArray(j);}C.prototype.invalidate.apply(this,arguments);};v.prototype.setStartDate=function(i){if(!i){i=new Date();}a._checkJSDateObject(i);var Y=i.getFullYear();a._checkYearInValidRange(Y);this._oUTCStartDate=a._createUniversalUTCDate(i,undefined,true);this.setProperty("startDate",i);return this;};v.prototype._getStartDate=function(){if(!this._oUTCStartDate){this._oUTCStartDate=a._createUniversalUTCDate(this.getStartDate(),undefined,true);}return this._oUTCStartDate;};v.prototype.setIntervalType=function(i){this.setProperty("intervalType",i);this._aVisibleAppointments=[];return this;};v.prototype._getAppointmentReducedHeight=function(i){var j=!D.system.phone&&this.getAppointmentsReducedHeight()&&i.size===s.Regular;return j;};v.prototype.onfocusin=function(j){if(q(j.target).hasClass("sapUiCalendarApp")){Q.call(this,j.target.id);}else{var k=this._getVisibleAppointments();var p=false;var Y;for(var i=0;i<k.length;i++){Y=k[i].appointment;if(f(Y.getDomRef(),j.target)){p=true;Y.focus();break;}}if(!p){Y=this.getFocusedAppointment();if(Y){Y.focus();}}}};v.prototype.applyFocusInfo=function(i){if(this._sFocusedAppointmentId){this.getFocusedAppointment().focus();}return this;};v.prototype.onsapleft=function(i){if(q(i.target).hasClass("sapUiCalendarApp")){S.call(this,this._bRTL,1);}i.preventDefault();i.stopPropagation();};v.prototype.onsapright=function(i){if(q(i.target).hasClass("sapUiCalendarApp")){S.call(this,!this._bRTL,1);}i.preventDefault();i.stopPropagation();};v.prototype.onsapup=function(i){this.fireLeaveRow({type:i.type});};v.prototype.onsapdown=function(i){this.fireLeaveRow({type:i.type});};v.prototype.onsaphome=function(i){V.call(this,i);i.preventDefault();i.stopPropagation();};v.prototype.onsapend=function(i){V.call(this,i);i.preventDefault();i.stopPropagation();};v.prototype.onsapselect=function(j){var k=this._getVisibleAppointments(),p;for(var i=0;i<k.length;i++){var Y=k[i].appointment;if(f(Y.getDomRef(),j.target)){var Z=!(this.getMultipleAppointmentsSelection()||j.ctrlKey||j.metaKey);M.call(this,Y,Z);p=Y.getSelected()?"APPOINTMENT_SELECTED":"APPOINTMENT_UNSELECTED";break;}}this._oInvisibleMessage.announce(this._oRb.getText(p),u.Polite);j.stopPropagation();j.preventDefault();};v.prototype.ontap=function(i){var j=this.$("Apps").children(".sapUiCalendarRowAppsInt");var k=0;var p=false;for(k=0;k<j.length;k++){var Y=j[k];if(!this._isOneMonthsRowOnSmallSizes()&&f(Y,i.target)){p=true;break;}}if(p){W.call(this,k,i.target);}else{this.onsapselect(i);}};v.prototype.onsapselectmodifiers=function(i){this.onsapselect(i);};v.prototype.handleResize=function(i){if(i&&i.size&&i.size.width<=0){return this;}var $=this.$("DummyApp");$.css("display","");K.call(this);return this;};v.prototype.updateCurrentTimeVisualization=function(){var $=this.$("Now");var i=a._createUniversalUTCDate(new Date(),undefined,true);var j=this.getIntervals();var k=this.getIntervalType();var p=this._getStartDate();var Y=p.getTime();var Z=this._oUTCEndDate;var a1=Z.getTime();this._sUpdateCurrentTime=undefined;i=this._convertToTimezone(i);if(i.getTime()<=a1&&i.getTime()>=Y){var b1=F.call(this,k,j,p,Z,Y,i);var c1=0;if(this._bRTL){$.css("right",b1+"%");}else{$.css("left",b1+"%");}$.css("display","");if(this.getUpdateCurrentTime()){switch(k){case r.Hour:c1=60000;break;case r.Day:case r.Week:case r.OneMonth:case"OneMonth":c1=1800000;break;default:c1=-1;break;}if(c1>0){this._sUpdateCurrentTime=setTimeout(this.updateCurrentTimeVisualization.bind(this),c1);}}}else{$.css("display","none");}return this;};v.prototype._convertToTimezone=function(i){var j=b.getConfiguration().getTimezone();var k=a._createUniversalUTCDate(i,undefined,true);k=new Date(i.getUTCFullYear(),i.getUTCMonth(),i.getUTCDate(),i.getUTCHours(),i.getUTCMinutes(),i.getUTCSeconds());k.setUTCFullYear(i.getUTCFullYear());k=T.convertToTimezone(k,j);return k;};v.prototype.getFocusedAppointment=function(){var j=this._getAppointmentsSorted();var k=this.getAggregation("groupAppointments",[]);var p;var i=0;for(i=0;i<k.length;i++){if(k[i].getId()==this._sFocusedAppointmentId){p=k[i];break;}}if(!p){for(i=0;i<j.length;i++){if(j[i].getId()==this._sFocusedAppointmentId){p=j[i];break;}}}return p;};v.prototype.focusAppointment=function(i){if(!i||!(i instanceof g)){throw new Error("Appointment must be a CalendarAppointment; "+this);}var j=i.getId();if(this._sFocusedAppointmentId!=j){Q.call(this,j);}else{i.focus();}return this;};v.prototype.focusNearestAppointment=function(j){a._checkJSDateObject(j);var k=this._getAppointmentsSorted();var p;var Y;var Z;for(var i=0;i<k.length;i++){p=k[i];if(p._getStartDateWithTimezoneAdaptation()>j){if(i>0){Y=k[i-1];}else{Y=p;}break;}}if(p){if(Y&&Math.abs(p._getStartDateWithTimezoneAdaptation()-j)>=Math.abs(Y._getStartDateWithTimezoneAdaptation()-j)){Z=Y;}else{Z=p;}this.focusAppointment(Z);}return this;};v.prototype._getVisibleAppointments=function(){return this._aVisibleAppointments;};v.prototype._getVisibleIntervalHeaders=function(){return this._aVisibleIntervalHeaders;};v.prototype._getNonWorkingDays=function(){if(this.getIntervalSize()!==1){return[];}var j=this.getNonWorkingDays();if(!j){var k=x.call(this);var p=k.getWeekendStart();var Y=k.getWeekendEnd();j=[];for(var i=0;i<=6;i++){if((p<=Y&&i>=p&&i<=Y)||(p>Y&&(i>=p||i<=Y))){j.push(i);}}}else if(!Array.isArray(j)){j=[];}return j;};v.prototype._isOneMonthsRowOnSmallSizes=function(){return(this.getIntervalType()===r.OneMonth||this.getIntervalType()==="OneMonth")&&this.getIntervals()===1;};v.prototype._getAppointmentsSorted=function(){var i=this.getAppointments(),j=X;i.sort(this._fnCustomSortedAppointments?this._fnCustomSortedAppointments:j);return i;};v.prototype._setCustomAppointmentsSorterCallback=function(i){this._fnCustomSortedAppointments=i;this.invalidate();};v.prototype._calculateAppoitnmentVisualCue=function(i){if(_(this,i)){return{appTimeUnitsDifRowStart:0,appTimeUnitsDifRowEnd:0};}var j=i._getStartDateWithTimezoneAdaptation(),k=i._getEndDateWithTimezoneAdaptation(),p=new U(j.getFullYear(),j.getMonth(),j.getDate(),j.getHours(),j.getMinutes()),Y=new U(k.getFullYear(),k.getMonth(),k.getDate(),k.getHours(),k.getMinutes()),Z=this.getIntervalType(),$=this.getStartDate(),a1=Z==="Hour"?new U($.getFullYear(),$.getMonth(),$.getDate(),$.getHours()):new U($.getFullYear(),$.getMonth(),$.getDate()),b1=this.getIntervals(),c1;switch(Z){case"Hour":c1=new U($.getFullYear(),$.getMonth(),$.getDate(),$.getHours()+b1);break;case"Day":case"Week":case"One Month":c1=new U($.getFullYear(),$.getMonth(),$.getDate()+b1);break;case"Month":c1=new U($.getFullYear(),$.getMonth()+b1,$.getDate());break;default:break;}return{appTimeUnitsDifRowStart:a1.getTime()-p.getTime(),appTimeUnitsDifRowEnd:Y.getTime()-c1.getTime()};};v.prototype._updateSelectedAppointmentsArray=function(i){if(i.getSelected()){if(this.aSelectedAppointments.indexOf(i.getId())===-1){this.aSelectedAppointments.push(i.getId());}}else{this.aSelectedAppointments=this.aSelectedAppointments.filter(function(j){return j!==i.getId();});}};function _(j,k){var p=j.getAggregation("groupAppointments",[]);var i;for(i=0;i<p.length;++i){if(k===p[i]){return true;}}return false;}function w(){if(!this._sLocale){this._sLocale=sap.ui.getCore().getConfiguration().getFormatSettings().getFormatLocale().toString();}return this._sLocale;}function x(){if(!this._oLocaleData){var i=w.call(this);var j=new d(i);this._oLocaleData=L.getInstance(j);}return this._oLocaleData;}function y(){var i=this.getStartDate();var j;var k=this.getIntervals();var p=this.getIntervalType();this._oUTCStartDate=z.call(this,i);switch(p){case r.Hour:j=new U(this._oUTCStartDate.getTime());j.setUTCHours(j.getUTCHours()+k);break;case r.Day:case r.Week:case r.OneMonth:case"OneMonth":j=new U(this._oUTCStartDate.getTime());j.setUTCDate(j.getUTCDate()+k*this.getIntervalSize());break;case r.Month:j=new U(this._oUTCStartDate.getTime());j.setUTCMonth(j.getUTCMonth()+k);break;default:throw new Error("Unknown IntervalType: "+p+"; "+this);}j.setUTCMilliseconds(-1);this._iRowSize=j.getTime()-this._oUTCStartDate.getTime();this._iIntervalSize=Math.floor(this._iRowSize/k);this._oUTCEndDate=j;}function z(i){var j=this.getIntervalType();var k=a._createUniversalUTCDate(i,undefined,true);switch(j){case r.Hour:k.setUTCMinutes(0);k.setUTCSeconds(0);k.setUTCMilliseconds(0);break;case r.Day:case r.Week:case r.OneMonth:case"OneMonth":k.setUTCHours(0);k.setUTCMinutes(0);k.setUTCSeconds(0);k.setUTCMilliseconds(0);break;case r.Month:k.setUTCDate(1);k.setUTCHours(0);k.setUTCMinutes(0);k.setUTCSeconds(0);k.setUTCMilliseconds(0);break;default:throw new Error("Unknown IntervalType: "+j+"; "+this);}return k;}function A(){return D.system.phone||(this.getGroupAppointmentsMode()===G.Collapsed);}function B(){var p=this._getAppointmentsSorted();var Y;var Z;var $;var a1=this.getIntervals();var b1=this.getIntervalType();var c1=this._getStartDate();var d1=c1.getTime();var e1=this._oUTCEndDate;var f1=e1.getTime();var g1=[];var h1=false;var i=0;var j=0;var i1=A.call(this);var j1=this._needAppointmentHorizontalFit();this.destroyAggregation("groupAppointments",true);for(i=0;i<p.length;i++){Y=p[i];var k1=a._createUniversalUTCDate(Y._getStartDateWithTimezoneAdaptation(),undefined,true);var l1=k1.getTime();k1.setUTCSeconds(0);k1.setUTCMilliseconds(0);var m1=Y._getEndDateWithTimezoneAdaptation()?a._createUniversalUTCDate(Y._getEndDateWithTimezoneAdaptation(),undefined,true):a._createUniversalUTCDate(new Date(864000000000000),undefined,true);var n1=m1.getTime();m1.setUTCSeconds(0);m1.setUTCMilliseconds(0);var o1=false;if(k1.getTime()<d1&&m1.getTime()>=d1){k1=new U(d1);o1=true;}if(m1.getTime()>f1&&k1.getTime()<=f1){m1=new U(f1);o1=true;}var p1=(m1.getTime()-k1.getTime())/60000;if(o1&&p1==0){continue;}var q1=0;var r1=0;var s1=-1;Z=undefined;$=undefined;if(k1&&k1.getTime()<=f1&&m1&&m1.getTime()>=d1&&l1<=n1){if(i1&&(b1==r.Month)&&((m1.getTime()-k1.getTime())<604800000)){Z=E.call(this,k1,Y,b1,a1,c1,e1,d1,g1);var t1=a._createUniversalUTCDate(Z._getEndDateWithTimezoneAdaptation(),undefined,true);if(m1.getTime()>t1.getTime()){$=E.call(this,m1,Y,b1,a1,c1,e1,d1,g1);}}if(j1){this._setHorizontalRoundingWidth(Y,k1,m1);}q1=F.call(this,b1,a1,c1,e1,d1,k1);r1=H.call(this,b1,a1,c1,e1,d1,m1);if(Z){Z._iBegin=q1;Z._iEnd=r1;Z._iLevel=s1;if($){$._iBegin=q1;$._iEnd=r1;$._iLevel=s1;}continue;}g1.push({appointment:Y,begin:q1,end:r1,calculatedEnd:r1,level:s1,size:this.getProperty("appointmentHeight")});if(this._sFocusedAppointmentId&&this._sFocusedAppointmentId==Y.getId()){h1=true;}}}var u1=this.getAggregation("groupAppointments",[]);if(u1.length>0){for(i=0;i<g1.length;i++){Y=g1[i];if(Y.appointment._aAppointments&&Y.appointment._aAppointments.length<=1){Z=Y.appointment;var v1=false;if(Z._aAppointments.length==0){v1=true;}else{for(j=0;j<g1.length;j++){if(g1[j].appointment==Z._aAppointments[0]){v1=true;break;}}}if(!v1){for(j=0;j<u1.length;j++){$=u1[j];if(Z!=$){for(var k=0;k<$._aAppointments.length;k++){if(Z._aAppointments[0]==$._aAppointments[k]){$._aAppointments.splice(k,1);if($._aAppointments.length==1){this.removeAggregation("groupAppointments",$);$.destroy();u1=this.getAggregation("groupAppointments",[]);}else{$.setProperty("title",$._aAppointments.length,true);}break;}}}}Y.begin=Z._iBegin;Y.end=Z._iEnd;Y.calculatedEnd=Z._iEnd;Y.level=Z._iLevel;Y.appointment=Z._aAppointments[0];}else{g1.splice(i,1);i--;}this.removeAggregation("groupAppointments",Z);Z.destroy();u1=this.getAggregation("groupAppointments",[]);}}}if(!h1){if(g1.length>0){this._sFocusedAppointmentId=g1[0].appointment.getId();}else{this._sFocusedAppointmentId=undefined;}}this._aVisibleAppointments=g1;return this._aVisibleAppointments;}function E(i,k,p,Y,Z,$,a1,b1){var c1=this.getAggregation("groupAppointments",[]);var d1;var e1=x.call(this);var f1=e1.getFirstDayOfWeek();var g1=i.getUTCDay();var h1=new U(i.getTime());h1.setUTCHours(0);h1.setUTCMinutes(0);h1.setUTCSeconds(0);h1.setUTCMilliseconds(0);if(f1<=g1){h1.setDate(h1.getDate()-(g1-f1));}else{h1.setDate(h1.getDate()-(7-g1-f1));}for(var j=0;j<c1.length;j++){d1=c1[j];var i1=a._createUniversalUTCDate(d1._getStartDateWithTimezoneAdaptation(),undefined,true);if(i1.getTime()==h1.getTime()){break;}d1=undefined;}if(!d1){var j1=new U(h1.getTime());j1.setDate(j1.getDate()+7);j1.setMilliseconds(-1);d1=new g(this.getId()+"-Group"+c1.length,{type:k.getType(),startDate:a._createLocalDate(new Date(h1.getTime()),true),endDate:a._createLocalDate(new Date(j1.getTime()),true)});d1._aAppointments=[];this.addAggregation("groupAppointments",d1,true);var k1=F.call(this,p,Y,Z,$,a1,h1);var l1=H.call(this,p,Y,Z,$,a1,j1);b1.push({appointment:d1,begin:k1,end:l1,calculatedEnd:l1,level:-1,size:this.getProperty("appointmentHeight")});}d1._aAppointments.push(k);if(d1.getType()!=n.None&&d1.getType()!=k.getType()){d1.setType(n.None);}d1.setProperty("title",d1._aAppointments.length,true);return d1;}function F(i,j,k,p,Y,Z){var $=0;if(i!=r.Month){$=100*(Z.getTime()-Y)/this._iRowSize;}else{var a1=new U(Z.getTime());a1.setUTCDate(1);a1.setUTCHours(0);a1.setUTCMinutes(0);a1.setUTCSeconds(0);a1.setUTCMilliseconds(0);var b1=new U(a1.getTime());b1.setUTCMonth(b1.getUTCMonth()+1);b1.setMilliseconds(-1);var c1=b1.getTime()-a1.getTime();var d1=(a1.getUTCFullYear()-k.getUTCFullYear())*12+a1.getUTCMonth()-k.getUTCMonth();$=(100*d1/j)+(100*(Z.getTime()-a1.getTime())/c1)/j;}if($<0){$=0;}$=Math.round($*100000)/100000;return $;}function H(i,j,k,p,Y,Z){var $=0;if(i!=r.Month){$=100-(100*(Z.getTime()-Y)/this._iRowSize);}else{var a1=new U(Z.getTime());a1.setUTCDate(1);a1.setUTCHours(0);a1.setUTCMinutes(0);a1.setUTCSeconds(0);a1.setUTCMilliseconds(0);var b1=new U(a1.getTime());b1.setUTCMonth(b1.getUTCMonth()+1);b1.setMilliseconds(-1);var c1=b1.getTime()-a1.getTime();var d1=(a1.getUTCFullYear()-k.getUTCFullYear())*12+a1.getUTCMonth()-k.getUTCMonth();$=100-((100*d1/j)+(100*(Z.getTime()-a1.getTime())/c1)/j);}if($<0){$=0;}$=Math.round($*100000)/100000;return $;}function J(){var k=[];if(this.getShowIntervalHeaders()){var p=this.getIntervalHeaders();var Y;var Z=this.getIntervals();var $=this.getIntervalType();var a1=this._getStartDate();var b1=a1.getTime();var c1=this._oUTCEndDate;var d1=c1.getTime();var i=0;var j=0;for(i=0;i<p.length;i++){Y=p[i];var e1=a._createUniversalUTCDate(Y._getStartDateWithTimezoneAdaptation(),undefined,true);e1.setUTCSeconds(0);e1.setUTCMilliseconds(0);var f1=Y._getEndDateWithTimezoneAdaptation()?a._createUniversalUTCDate(Y._getEndDateWithTimezoneAdaptation(),undefined,true):a._createUniversalUTCDate(new Date(864000000000000),undefined,true);f1.setUTCSeconds(0);f1.setUTCMilliseconds(0);if(e1&&e1.getTime()<=d1&&f1&&f1.getTime()>=b1){var g1=new U(a1.getTime());var h1=new U(a1.getTime());h1.setUTCMinutes(h1.getUTCMinutes()-1);var i1=-1;var j1=-1;for(j=0;j<Z;j++){switch($){case r.Hour:h1.setUTCHours(h1.getUTCHours()+1);if(j>0){g1.setUTCHours(g1.getUTCHours()+1);}break;case r.Day:case r.Week:case r.OneMonth:case"OneMonth":h1.setUTCDate(h1.getUTCDate()+1);if(j>0){g1.setUTCDate(g1.getUTCDate()+1);}break;case r.Month:h1.setUTCDate(1);h1.setUTCMonth(h1.getUTCMonth()+2);h1.setUTCDate(0);if(j>0){g1.setUTCMonth(g1.getUTCMonth()+1);}break;default:throw new Error("Unknown IntervalType: "+$+"; "+this);}if(e1&&e1.getTime()<=g1.getTime()&&f1&&f1.getTime()>=h1.getTime()){if(i1<0){i1=j;}j1=j;}}if(i1>=0){k.push({interval:i1,appointment:Y,last:j1});}}}}this._aVisibleIntervalHeaders=k;return this._aVisibleIntervalHeaders;}function K(){if(this._isOneMonthsRowOnSmallSizes()){return;}var $=this.$("Apps");var k=$.innerWidth();if(k<=0){return;}var p=this.$("DummyApp");var Y=p.outerHeight(true);if(Y<=0){return;}var Z=4;var a1=p.outerWidth();var b1=a1/k*100;var c1=Math.ceil(1000*b1)/1000;var d1;var e1;var f1=0;var g1=0;var i=0;var h1=false;var i1;var j1=this._needAppointmentHorizontalFit();if(this.getShowIntervalHeaders()&&(this.getShowEmptyIntervalHeaders()||this._getVisibleIntervalHeaders().length>0)){f1=q(this.$("AppsInt0").children(".sapUiCalendarRowAppsIntHead")[0]).outerHeight(true);h1=true;}for(i=0;i<this._aVisibleAppointments.length;i++){d1=this._aVisibleAppointments[i];e1=d1.appointment.$();var k1=Math.floor(1000*(100-d1.calculatedEnd-d1.begin))/1000;var l1=false;if(k1<c1){d1.end=100-d1.begin-b1;if(d1.end<0){d1.end=0;}l1=true;e1.addClass("sapUiCalendarAppSmall");}else if(e1.hasClass("sapUiCalendarAppSmall")){d1.end=d1.calculatedEnd;l1=true;e1.removeClass("sapUiCalendarAppSmall");}if(l1){d1.level=-1;}if(l1&&!j1){if(this._bRTL){e1.css("left",d1.end+"%");}else{e1.css("right",d1.end+"%");}}if(j1){d1.end=d1.calculatedEnd;}}for(i=0;i<this._aVisibleAppointments.length;i++){d1=this._aVisibleAppointments[i];e1=d1.appointment.$();var m1={};if(d1.level<0){for(var j=0;j<this._aVisibleAppointments.length;j++){var n1=this._aVisibleAppointments[j];if(d1!=n1&&d1.begin<(Math.floor(1000*(100-n1.end))/1000)&&(Math.floor(1000*(100-d1.end))/1000)>n1.begin&&n1.level>=0){this._setBlockedLevelsForAppointment(n1,m1);}}d1.level=this._getAppointmetLevel(m1,d1);e1.attr("data-sap-level",d1.level);}i1=Y*d1.level+f1;if(!h1){i1+=Z;}e1.css("top",i1+"px");var o1=d1.level;o1+=this._getAppointmentRowCount(d1)-1;if(g1<o1){g1=o1;}}g1++;Y=Y*g1+f1;if(!h1){Y+=Z;}if(!this.getHeight()){$.outerHeight(Y);}else{var p1=this.$("Apps").children(".sapUiCalendarRowAppsInt");for(i=0;i<p1.length;i++){var q1=q(p1[i]);q1.outerHeight(Y);}}p.css("display","none");}function M(j,k){var i=0;var p;var Y;var Z;var $;var a1=I.getStaticId("sap.ui.unified","APPOINTMENT_SELECTED");var b1=!j.getSelected();if(k){var c1=this.getAppointments();var d1=this.getAggregation("groupAppointments",[]);q.merge(c1,d1);for(i=0;i<c1.length;i++){p=c1[i];if(p.getId()!==j.getId()&&p.getSelected()){p.setProperty("selected",false,true);p.$().removeClass("sapUiCalendarAppSel");for(var i=0;i<this.aSelectedAppointments.length;i++){if(this.aSelectedAppointments[i]!==p.getId()){this.aSelectedAppointments.splice(i);}}Y=p.$().attr("aria-labelledby");Z=Y?Y.replace(a1,""):"";p.$().attr("aria-labelledby",Z);}}}$=j.$().attr("aria-labelledby")+" "+a1;Z=j.$().attr("aria-labelledby").replace(a1,"").trim();if(j.getSelected()){j.setProperty("selected",false,true);j.$().removeClass("sapUiCalendarAppSel");j.$().attr("aria-labelledby",Z);O(this,k);}else{j.setProperty("selected",true,true);j.$().addClass("sapUiCalendarAppSel");j.$().attr("aria-labelledby",$);O(this,k);}this._updateSelectedAppointmentsArray(j);if(j._aAppointments){for(i=0;i<j._aAppointments.length;i++){p=j._aAppointments[i];p.setProperty("selected",b1,true);$=p.$().attr("aria-labelledby")+" "+a1;p.$().attr("aria-labelledby",$);}this.fireSelect({appointments:j._aAppointments,multiSelect:!k,domRefId:j.getId()});}else{this.fireSelect({appointment:j,multiSelect:!k,domRefId:j.getId()});}}function N(i){var p=this._getPlanningCalendar();if(p){p["_onRow"+i]();}}v.prototype._needAppointmentHorizontalFit=function(){var p=this._getPlanningCalendar(),k,i,j;if(!p||this.getAppointmentRoundWidth()===t.None){return false;}k=p.getViewKey();i=p._getView(k);j=p._getIntervals(i);return j>=20;};v.prototype._setHorizontalRoundingWidth=function(i,j,k){var p;switch(this.getAppointmentRoundWidth()){case t.HalfColumn:p=12;break;}this._roundAppointment(i,j,k,p);};v.prototype._roundAppointment=function(i,j,k,p){var Y,Z;Y=i._getStartDateWithTimezoneAdaptation().getHours()-i._getStartDateWithTimezoneAdaptation().getHours()%p;j.setUTCHours(Y);j.setUTCMinutes(0);j.setUTCSeconds(0);j.setUTCMilliseconds(0);Z=i._getEndDateWithTimezoneAdaptation().getHours()-i._getEndDateWithTimezoneAdaptation().getHours()%p+p;k.setUTCHours(Z);k.setUTCMinutes(0);k.setUTCSeconds(0);k.setUTCMilliseconds(0);};v.prototype._setBlockedLevelsForAppointment=function(i,j){var k=this._getAppointmentRowCount(i);for(var p=0;p<k;p++){j[i.level+p]=true;}return j;};v.prototype._getAppointmentRowCount=function(i){var j,k=this._getAppointmentReducedHeight(i);switch(i.size){case s.HalfSize:j=1;break;case s.Regular:j=2;if(k&&!i.appointment.getText()&&!i.appointment.getDescription()){j=1;}break;case s.Large:j=3;break;case s.Automatic:j=1;if(i.appointment.getText()){j+=1;}if(i.appointment.getDescription()){j+=1;}break;}return j;};v.prototype._getAppointmetLevel=function(i,j){var k=0;var p=this._getAppointmentRowCount(j);var Y=true;while(Y){Y=this._isPosibleToPositionAppointment(k,i,p);if(!Y){Y=true;k+=1;}else{Y=false;}}return k;};v.prototype._isPosibleToPositionAppointment=function(i,j,k){for(var p=i;p<k+i;p++){if(j[p]){return false;}}return true;};v.prototype._getPlanningCalendar=function(){var p=this;while(p.getParent()!==null){if(p.isA("sap.m.PlanningCalendar")){return p;}p=p.getParent();}};function O(i,j){if(j){N.call(i,"DeselectAppointment");}}function P(k){var p=this.getAggregation("groupAppointments",[]);var Y;var Z=false;for(var i=0;i<p.length;i++){var $=p[i]._aAppointments;for(var j=0;j<$.length;j++){if($[j].getId()==k){Y=p[i];Z=true;break;}}if(Z){break;}}return Y;}function Q(j){if(this._sFocusedAppointmentId!=j){var k=this._getAppointmentsSorted();var p=this._aVisibleAppointments;var Y;var i=0;Y=P.call(this,j);if(Y){j=Y.getId();Y=undefined;}for(i=0;i<p.length;i++){if(p[i].appointment.getId()==j){Y=p[i].appointment;break;}}if(Y){var $=this.getFocusedAppointment().$();var Z=Y.$();this._sFocusedAppointmentId=Y.getId();$.attr("tabindex","-1");Z.attr("tabindex","0");Z.trigger("focus");}else{for(i=0;i<k.length;i++){if(k[i].getId()==j){Y=k[i];break;}}if(Y){this._sFocusedAppointmentId=Y.getId();var a1=z.call(this,Y._getStartDateWithTimezoneAdaptation());this.setStartDate(a._createLocalDate(a1,true));if(!f(this.getDomRef(),document.activeElement)){setTimeout(function(){this.getFocusedAppointment().focus();}.bind(this),0);}this.fireStartDateChange();}}}}function S(j,k){var p=this._sFocusedAppointmentId;var Y=this._getAppointmentsSorted();var Z=this.getAggregation("groupAppointments",[]);var $;var a1=0;var i=0;for(i=0;i<Z.length;i++){if(Z[i].getId()==p){var b1=Z[i]._aAppointments;if(j){p=b1[b1.length-1].getId();}else{p=b1[0].getId();}break;}}for(i=0;i<Y.length;i++){if(Y[i].getId()==p){a1=i;break;}}if(j){a1=a1+k;}else{a1=a1-k;}if(a1<0){a1=0;}else if(a1>=Y.length){a1=Y.length-1;}$=Y[a1];Q.call(this,$.getId());}function V(j){var k=this._getAppointmentsSorted();var p;var Y=new U(this._getStartDate());var Z=new U(this._oUTCEndDate);var $=this.getIntervalType();var a1;var b1;Y.setUTCHours(0);Z.setUTCHours(0);Z.setUTCMinutes(0);Z.setUTCSeconds(0);switch($){case r.Hour:Z.setUTCDate(Z.getUTCDate()+1);Z.setUTCMilliseconds(-1);break;case r.Day:case r.Week:case r.OneMonth:case"OneMonth":Y.setUTCDate(1);Z.setUTCMonth(Z.getUTCMonth()+1);Z.setUTCDate(1);Z.setUTCMilliseconds(-1);break;case r.Month:Y.setUTCMonth(0);Y.setUTCDate(1);Z.setUTCFullYear(Z.getUTCFullYear()+1);Z.setUTCMonth(1);Z.setUTCDate(1);Z.setUTCMilliseconds(-1);break;default:throw new Error("Unknown IntervalType: "+$+"; "+this);}var c1=a._createLocalDate(Y,true);var d1=a._createLocalDate(Z,true);for(var i=0;i<k.length;i++){if(k[i]._getStartDateWithTimezoneAdaptation()>=c1&&k[i]._getStartDateWithTimezoneAdaptation()<=d1){p=k[i];a1=p.getId();if(j.type=="saphome"){break;}}else if(k[i]._getStartDateWithTimezoneAdaptation()>d1){break;}}b1=P.call(this,a1);if(b1){p=b1;a1=p.getId();}if(a1&&a1!=this._sFocusedAppointmentId){Q.call(this,a1);}else if(j._bPlanningCalendar&&p){p.focus();}else{this.fireLeaveRow({type:j.type});}}function W(i,j){var k=this.getIntervalType();var p=this._getStartDate();var Y=new U(p.getTime());var Z;var $=false;var a1=0;var b1=0;if(q(j).hasClass("sapUiCalendarRowAppsSubInt")){$=true;var c1=q(q(j).parent()).children(".sapUiCalendarRowAppsSubInt");b1=c1.length;for(a1=0;a1<b1;a1++){var d1=c1[a1];if(d1==j){break;}}}switch(k){case r.Hour:Y.setUTCHours(Y.getUTCHours()+i);if($){Y.setUTCMinutes(Y.getUTCMinutes()+a1*60/b1);Z=new U(Y.getTime());Z.setUTCMinutes(Z.getUTCMinutes()+60/b1);}else{Z=new U(Y.getTime());Z.setUTCHours(Z.getUTCHours()+1);}break;case r.Day:case r.Week:case r.OneMonth:case"OneMonth":Y.setUTCDate(Y.getUTCDate()+i);if($){Y.setUTCHours(Y.getUTCHours()+a1*24/b1);Z=new U(Y.getTime());Z.setUTCHours(Z.getUTCHours()+24/b1);}else{Z=new U(Y.getTime());Z.setUTCDate(Z.getUTCDate()+1);}break;case r.Month:Y.setUTCMonth(Y.getUTCMonth()+i);if($){Y.setUTCDate(Y.getUTCDate()+a1);Z=new U(Y.getTime());Z.setUTCDate(Z.getUTCDate()+1);}else{Z=new U(Y.getTime());Z.setUTCMonth(Z.getUTCMonth()+1);}break;default:throw new Error("Unknown IntervalType: "+k+"; "+this);}Z.setUTCMilliseconds(Z.getUTCMilliseconds()-1);Y=a._createLocalDate(Y,true);Z=a._createLocalDate(Z,true);this.fireIntervalSelect({startDate:Y,endDate:Z,subInterval:$});}function X(i,j){var k=i._getStartDateWithTimezoneAdaptation()-j._getStartDateWithTimezoneAdaptation();if(k==0){k=j._getEndDateWithTimezoneAdaptation()-i._getEndDateWithTimezoneAdaptation();}return k;}return v;});
