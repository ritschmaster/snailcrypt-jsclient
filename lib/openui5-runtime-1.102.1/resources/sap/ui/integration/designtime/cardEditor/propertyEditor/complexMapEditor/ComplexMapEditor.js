/*!
 * OpenUI5
 * (c) Copyright 2009-2022 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/integration/designtime/baseEditor/propertyEditor/BasePropertyEditor","sap/base/util/restricted/_omit","sap/base/util/restricted/_merge","sap/base/util/deepClone","sap/ui/integration/cards/filters/DateRangeFilter"],function(B,_,a,d,D){"use strict";var C=B.extend("sap.ui.integration.designtime.cardEditor.propertyEditor.complexMapEditor.ComplexMapEditor",{xmlFragment:"sap.ui.integration.designtime.cardEditor.propertyEditor.complexMapEditor.ComplexMapEditor",metadata:{library:"sap.ui.integration"},renderer:B.getMetadata().getRenderer().render});C.configMetadata=Object.assign({},B.configMetadata,{allowKeyChange:{defaultValue:true,mergeStrategy:"mostRestrictiveWins"},allowAddAndRemove:{defaultValue:true,mergeStrategy:"mostRestrictiveWins"},keyLabel:{defaultValue:"{i18n>CARD_EDITOR.COMPLEX_MAP.KEY}"}});C.prototype.getExpectedWrapperCount=function(){return 1;};C.prototype.onFragmentReady=function(){this._oNestedArrayEditor=this.getContent();this._oNestedArrayEditor.attachValueChange(function(e){var p=e.getParameter("previousValue")||[];var v=d(e.getParameter("value")||[]);var n={};var b=this.getDesigntimeProperties();v=v.map(function(V,i){if(typeof V.key==="undefined"){var k="key";var c=0;var f=function(E){return E.key===k;};while(v.some(f)){k="key"+ ++c;}V.key=k;}var o={};b.forEach(function(P){o[P]=d(V[P]);});n[V.key]={__value:o};return _(V,b);});var N=this._processOutputValue(v);p.forEach(function(P){var o=P.key;if(o!==undefined&&!N.hasOwnProperty(o)){n[o]=null;}});this.setValue(N);this.setDesigntimeMetadata(a({},this.getConfig().designtime,n));},this);};C.prototype._processInputValue=function(v){var b=this.getDesigntimeProperties();if(!v){v={};}var f=Object.keys(v).map(function(k){var F=d(v[k]);F.key=k;var c=this.getNestedDesigntimeMetadataValue(k);b.forEach(function(p){F[p]=c[p];});return F;}.bind(this));if(this.getConfig().type==="filters"){for(var i=0;i<f.length;i++){if(!f[i].options){var o=this._getDefaultFilterOptions();f[i].options=o;}if(f[i].type===undefined){f[i].selectedOptions=[];}if(f[i].type==="Select"){f[i].sValue=f[i].value;delete f[i].value;f[i].selectedOptions=[];}else if(f[i].type==="DateRange"){if(!f[i].value){f[i].value={option:'today',values:[]};}f[i].dValue=f[i].value;delete f[i].value;var s=[];for(var j=0;j<f[i].options.length;j++){s.push({key:f[i].options[j],title:f[i].options[j]});}f[i].selectedOptions=s;}}}return f;};C.prototype.getDesigntimeProperties=function(){return[];};C.prototype.onBeforeConfigChange=function(c){var t={};if(c["allowKeyChange"]){t={key:{label:c["keyLabel"],type:"string",path:"key",validators:{uniqueKey:{type:"isUniqueKey",config:{keys:function(){return Object.keys(this.getValue());}.bind(this),currentKey:function(p){return p.getValue();}}}}}};}var A=a({},{template:t,allowSorting:false},c,{type:"array",path:""});this._oDefaultModel.setData(Object.assign({},this._oDefaultModel.getData(),{nestedConfig:A}));return c;};C.prototype.setValue=function(v){var f=this._processInputValue(v);this._oDefaultModel.setData(Object.assign({},this._oDefaultModel.getData(),{nestedValue:f}));B.prototype.setValue.call(this,v);};C.prototype._processOutputValue=function(v){if(this.getConfig().type==="filters"){for(var i=0;i<v.length;i++){if(v[i].type==="Select"){v[i].value=v[i].sValue;delete v[i].sValue;}else if(v[i].type==="DateRange"&&v[i].selectedOptions){v[i].value=v[i].dValue;delete v[i].dValue;delete v[i].selectedOptions;}}}var f={};v.forEach(function(V){f[V.key]=_(V,"key");});return f;};C.prototype._getDefaultFilterOptions=function(){var b=new D();var o=b._getDefaultOptions();return o;};return C;});
