/*!
* OpenUI5
 * (c) Copyright 2009-2022 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
*/
sap.ui.define(["../library","sap/m/library","sap/ui/base/EventProvider","sap/ui/core/Core","sap/ui/core/Control","sap/ui/core/Configuration",'sap/ui/core/Icon','./PaginatorRenderer'],function(l,L,E,C,a,b,I){"use strict";var A=C.getConfiguration().getAnimationMode(),h=A!==b.AnimationMode.none&&A!==b.AnimationMode.minimal,s=200;var P=a.extend("sap.ui.integration.controls.Paginator",{metadata:{library:"sap.ui.integration",properties:{card:{type:"object"},pageNumber:{type:"int",defaultValue:0},pageCount:{type:"int",defaultValue:0},pageSize:{type:"int",defaultValue:0},totalCount:{type:"int"},skip:{type:"int"}},aggregations:{_prevIcon:{type:"sap.ui.core.Icon",multiple:false,visibility:"hidden"},_nextIcon:{type:"sap.ui.core.Icon",multiple:false,visibility:"hidden"}}}});P.create=function(c,o){if(!o){return null;}return new P({card:c,totalCount:o.totalCount,pageSize:o.pageSize,skip:o.skip});};P.prototype.init=function(){this._listUpdateFinishedHandler=this._listUpdateFinished.bind(this);this.setAggregation("_prevIcon",new I({src:"sap-icon://slim-arrow-left",useIconTooltip:false,decorative:false,press:this._previous.bind(this)}));this.setAggregation("_nextIcon",new I({src:"sap-icon://slim-arrow-right",useIconTooltip:false,decorative:false,press:this._next.bind(this)}));};P.prototype.exit=function(){var c=this.getCard(),o,d;if(c){if(this._dataChangedHandler){c.detachEvent("_contentDataChange",this._dataChangedHandler);}o=c.getCardContent();if(o){d=o.getAggregation("_content");if(d&&E.hasListener(d,"updateFinished",this._listUpdateFinishedHandler)){d.detachEvent("updateFinished",this._listUpdateFinishedHandler);}}}delete this._listUpdateFinishedHandler;delete this._iPreviousStartIndex;delete this._oClonedContent;};P.prototype.isServerSide=function(){return this.getTotalCount();};P.prototype._dataChanged=function(){var c=this.getCard(),o=c.getCardContent(),d,t,i;if(!o||!o.isA("sap.ui.integration.cards.BaseContent")){this.setPageCount(0);return;}this.setModel(o.getModel());d=o.getAggregation("_content");i=E.hasListener(d,"updateFinished",this._listUpdateFinishedHandler);if(this._hasAnimation()&&!i){d.attachEvent("updateFinished",this._listUpdateFinishedHandler);if(this.isServerSide()){o.getAggregation("_loadingProvider")._oContentPlaceholder.addDelegate({onAfterRendering:this.onPlaceholderAfterRendering.bind(this)});}}if(i){this._clearAnimation(this);}t=this.getTotalCount()||o.getDataLength();this.setPageCount(Math.ceil(t/this.getPageSize()));this.setPageNumber(Math.min(Math.max(0,this.getPageNumber()),this.getPageCount()-1));this.sliceData();};P.prototype.setCard=function(c){this.setProperty("card",c,true);this._dataChangedHandler=this._dataChanged.bind(this);if(c){c.attachEvent("_contentDataChange",this._dataChangedHandler);}return this;};P.prototype.sliceData=function(){var c=this.getCard(),o,S,i;if(!c){return;}o=c.getCardContent();S=this.getPageNumber()*this.getPageSize();i=this._iPreviousStartIndex!==undefined&&this._iPreviousStartIndex!==S;if(i){this._prepareAnimation(S);}if(this.isServerSide()){if(i){this.getModel("paginator").setData({skip:S,size:this.getPageSize(),pageIndex:this.getPageNumber()});if(this._hasAnimation()){o.getAggregation("_loadingProvider")._bAwaitPagination=true;c.getAggregation("_loadingProvider")._bAwaitPagination=true;}}}else{o.sliceData(S,S+this.getPageSize());}this._iPreviousStartIndex=S;};P.prototype._prepareAnimation=function(S){if(!this._hasAnimation()){return;}var c=this.getCard().getCardContent().getDomRef(),o=c.cloneNode(true);this._bActiveAnimation=true;this._bReverseAnimation=this._iPreviousStartIndex>S;o.removeAttribute("id");o.querySelectorAll("*[id]").forEach(function(e){e.removeAttribute("id");});o.classList.add("sapFCardContentCloned");if(this._bReverseAnimation){o.classList.add("sapFCardContentReverseAnim");}if(this.isServerSide()){this._oClonedContent=o;}else{c.classList.add("sapFCardContentOriginal");if(this._bReverseAnimation){c.classList.add("sapFCardContentReverseAnim");}c.parentElement.insertBefore(o,c);}};P.prototype._clearAnimation=function(){if(!this._hasAnimation()){return;}var c=this.getCard(),o=c.getCardContent(),d=o.getDomRef(),e=d.previousSibling,f,g;f=c.getAggregation("_loadingProvider");g=o.getAggregation("_loadingProvider");if(g._bAwaitPagination){g._bAwaitPagination=false;f._bAwaitPagination=false;}else{e.parentNode.removeChild(e);d.classList.remove("sapFCardContentOriginal");d.classList.remove("sapFCardContentTransition");d.classList.remove("sapFCardContentReverseAnim");o.hideLoadingPlaceholders();f.setLoading(false);this._bActiveAnimation=false;}};P.prototype._listUpdateFinished=function(){if(!this._bActiveAnimation||this.isServerSide()){return;}var c=this.getCard().getCardContent(),o=c.getDomRef(),d=o.previousSibling;d.addEventListener("transitionend",function(){d.parentNode.removeChild(d);o.classList.remove("sapFCardContentOriginal");o.classList.remove("sapFCardContentTransition");o.classList.remove("sapFCardContentReverseAnim");this._bActiveAnimation=false;}.bind(this));o.classList.add("sapFCardContentTransition");d.classList.add("sapFCardContentTransition");};P.prototype.onPlaceholderAfterRendering=function(){if(!this._oClonedContent){return;}var c=this.getCard(),o=c.getCardContent(),d=o.getDomRef(),e=this._oClonedContent;d.classList.add("sapFCardContentOriginal");d.parentElement.insertBefore(e,d);if(this._bReverseAnimation){d.classList.add("sapFCardContentReverseAnim");}this._oClonedContent.addEventListener("transitionend",function(){setTimeout(this._clearAnimation.bind(this),s);}.bind(this));this._oClonedContent=null;setTimeout(function(){e.classList.add("sapFCardContentTransition");d.classList.add("sapFCardContentTransition");},30);};P.prototype._getNavigationArrow=function(d){return this.getAggregation("_"+d+"Icon");};P.prototype._hasAnimation=function(){return h&&this.getCard().getCardContent().isA("sap.ui.integration.cards.ListContent");};P.prototype._previous=function(){if(this._bActiveAnimation){return;}this.setPageNumber(Math.max(0,this.getPageNumber()-1));this.sliceData();};P.prototype._next=function(){if(this._bActiveAnimation){return;}this.setPageNumber(Math.min(this.getPageCount()-1,this.getPageNumber()+1));this.sliceData();};P.prototype.onmousedown=function(e){var t=e.target,d=t.getAttribute("data-slide");if(d&&!t.classList.contains("sapMCrslActive")){this.setPageNumber(parseInt(d)-1);this.sliceData();}};return P;});
