/*!
* OpenUI5
 * (c) Copyright 2009-2022 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
*/
sap.ui.define(["./BaseContent","./ObjectContentRenderer","sap/ui/integration/library","sap/m/library","sap/m/FlexItemData","sap/m/HBox","sap/m/VBox","sap/m/Text","sap/m/Title","sap/m/Avatar","sap/m/Link","sap/m/Label","sap/m/ObjectStatus","sap/base/Log","sap/ui/core/ResizeHandler","sap/ui/layout/AlignedFlowLayout","sap/ui/dom/units/Rem","sap/ui/integration/util/BindingHelper","sap/ui/integration/util/BindingResolver","sap/ui/integration/util/Utils","sap/f/AvatarGroup","sap/f/AvatarGroupItem","sap/f/cards/NumericIndicators","sap/f/cards/NumericSideIndicator","sap/f/library","sap/m/OverflowToolbar","sap/m/OverflowToolbarButton"],function(B,O,l,L,F,H,V,T,a,A,b,c,d,e,R,f,g,h,j,U,k,m,N,n,o,p,q){"use strict";var r=L.AvatarSize;var s=L.AvatarColor;var t=L.ButtonType;var u=L.FlexRendertype;var v=l.CardActionArea;var w=o.AvatarGroupType;var x=L.ToolbarStyle;var y=B.extend("sap.ui.integration.cards.ObjectContent",{metadata:{library:"sap.ui.integration"},renderer:O});y.prototype.exit=function(){B.prototype.exit.apply(this,arguments);if(this._sResizeListenerId){R.deregister(this._sResizeListenerId);this._sResizeListenerId="";}};y.prototype.setConfiguration=function(C){B.prototype.setConfiguration.apply(this,arguments);C=this.getParsedConfiguration();if(!C){return this;}if(C.groups){this._addGroups(C);}return this;};y.prototype._getRootContainer=function(){var i=this.getAggregation("_content");if(!i){i=new V({renderType:u.Bare});this.setAggregation("_content",i);this._sResizeListenerId=R.register(i,this._onResize.bind(this));}return i;};y.prototype._addGroups=function(C){var z=this._getRootContainer(),D,E=true,G=C.groups||[];G.forEach(function(I,i){var J=this._createGroup(I);if(I.alignment==="Stretch"){J.setLayoutData(new F({growFactor:1}));if(i===G.length-1){J.addStyleClass("sapFCardObjectGroupLastInColumn");}z.addItem(J);E=true;}else{if(E){D=this._createAFLayout();z.addItem(D);E=false;}D.addContent(J);}},this);this._oActions.attach({area:v.Content,actions:C.actions,control:this});};y.prototype._createGroup=function(G){var i;if(typeof G.visible=="string"){i=!U.hasFalsyValueAsString(G.visible);}else{i=G.visible;}var z=new V({visible:i,renderType:u.Bare}).addStyleClass("sapFCardObjectGroup");if(G.title){z.addItem(new a({text:G.title}).addStyleClass("sapFCardObjectItemTitle"));z.addStyleClass("sapFCardObjectGroupWithTitle");}G.items.forEach(function(I){this._createGroupItems(I).forEach(z.addItem,z);},this);return z;};y.prototype._createGroupItems=function(i){var z=i.label,C,D,E;if(typeof i.visible=="string"){D=!U.hasFalsyValueAsString(i.visible);}else{D=i.visible;}if(z){z=h.formattedProperty(z,function(J){return J&&J[J.length-1]===":"?J:J+":";});C=new c({text:z,visible:D}).addStyleClass("sapFCardObjectItemLabel");}E=this._createItem(i,D,C);if(E){E.addStyleClass("sapFCardObjectItemValue");}if(i.icon){var G=new V({renderType:u.Bare,items:[C,E]});var I=new H({visible:D,renderType:u.Bare,items:[this._createGroupItemAvatar(i.icon),G]}).addStyleClass("sapFCardObjectItemLabel");return[I];}else{return[C,E];}};y.prototype._createGroupItemAvatar=function(i){var S=h.formattedProperty(i.src,function(C){return this._oIconFormatter.formatSrc(C);}.bind(this));var z=new A({displaySize:i.size||r.XS,src:S,initials:i.text,displayShape:i.shape,tooltip:i.alt,backgroundColor:i.backgroundColor||(i.text?undefined:s.Transparent)}).addStyleClass("sapFCardObjectItemAvatar sapFCardIcon");return z;};y.prototype._createItem=function(i,z,C){var D,E=i.value,G;switch(i.type){case"NumericData":D=this._createNumericDataItem(i,z);break;case"Status":D=this._createStatusItem(i,z);break;case"IconGroup":D=this._createIconGroupItem(i,z);break;case"ButtonGroup":D=this._createButtonGroupItem(i,z);break;case"link":e.warning("Usage of Object Group Item property 'type' with value 'link' is deprecated. Use Card Actions for navigation instead.",null,"sap.ui.integration.widgets.Card");D=new b({href:i.url||E,text:E,target:i.target||'_blank',visible:h.reuse(z)});break;case"email":e.warning("Usage of Object Group Item property 'type' with value 'email' is deprecated. Use Card Actions for navigation instead.",null,"sap.ui.integration.widgets.Card");var I=[];if(i.value){I.push(i.value);}if(i.emailSubject){I.push(i.emailSubject);}G=h.formattedProperty(I,function(J,K){if(K){return"mailto:"+J+"?subject="+K;}else{return"mailto:"+J;}});D=new b({href:G,text:E,visible:h.reuse(z)});break;case"phone":e.warning("Usage of Object Group Item property 'type' with value 'phone' is deprecated. Use Card Actions for navigation instead.",null,"sap.ui.integration.widgets.Card");G=h.formattedProperty(E,function(J){return"tel:"+J;});D=new b({href:G,text:E,visible:h.reuse(z)});break;default:D=this._createTextItem(i,z,C);}return D;};y.prototype._createNumericDataItem=function(i,z){var C=new V({visible:h.reuse(z)});var D=new N({number:i.mainIndicator.number,numberSize:i.mainIndicator.size,scale:i.mainIndicator.unit,trend:i.mainIndicator.trend,state:i.mainIndicator.state}).addStyleClass("sapUiIntOCNumericIndicators");C.addItem(D);if(i.sideIndicators){i.sideIndicators.forEach(function(I){D.addSideIndicator(new n({title:I.title,number:I.number,unit:I.unit,state:I.state}));});}if(i.details){C.addItem(new T({text:i.details,maxLines:1}).addStyleClass("sapUiIntOCNumericIndicatorsDetails"));}return C;};y.prototype._createStatusItem=function(i,z){var C=new d({text:i.value,visible:h.reuse(z),state:i.state});return C;};y.prototype._createTextItem=function(i,z,C){var D=i.value,E;if(D&&i.actions){E=new b({text:D,visible:h.reuse(z)});if(C){E.addAriaLabelledBy(C);}else{e.warning("Missing label for Object group item with actions.",null,"sap.ui.integration.widgets.Card");}this._oActions.attach({area:v.ContentItemDetail,actions:i.actions,control:this,actionControl:E,enabledPropertyName:"enabled"});}else if(D){E=new T({text:D,visible:h.reuse(z),maxLines:i.maxLines});}return E;};y.prototype._createButtonGroupItem=function(i,z){var C=i.template;if(!C){return null;}var D=new p({visible:h.reuse(z),style:x.Clear});D.addStyleClass("sapUiIntCardObjectButtonGroup");var I=new q({icon:h.formattedProperty(C.icon,function(E){return this._oIconFormatter.formatSrc(E);}.bind(this)),text:C.text||C.tooltip,tooltip:C.tooltip||C.text,type:t.Transparent,visible:C.visible});if(C.actions){I.attachPress(function(E){this._onButtonGroupPress(E,C.actions);}.bind(this));}D.bindAggregation("content",{path:i.path||"/",template:I,templateShareable:false});return D;};y.prototype._onButtonGroupPress=function(E,i){var I=E.getSource();var z=j.resolveValue(i,I,I.getBindingContext().getPath());var C=z[0];this.getActions().fireAction(this,C.type,C.parameters);};y.prototype._createIconGroupItem=function(i,z){var C=i.template;if(!C){return null;}var I=new k({avatarDisplaySize:i.size||r.XS,groupType:w.Individual,visible:h.reuse(z)});I._oShowMoreButton.setType(t.Transparent);I._oShowMoreButton.setEnabled(false);if(C.actions){I.attachPress(function(E){this._onIconGroupPress(E,C.actions);}.bind(this));}else{I._setInteractive(false);}var D=new m({src:h.formattedProperty(C.icon.src,function(E){return this._oIconFormatter.formatSrc(E);}.bind(this)),initials:C.icon.text,tooltip:C.icon.alt});I.bindAggregation("items",{path:i.path||"/",template:D,templateShareable:false});return I;};y.prototype._onIconGroupPress=function(E,i){if(E.getParameter("overflowButtonPressed")){}else{var I=E.getParameter("eventSource");var z=j.resolveValue(i,I,I.getBindingContext().getPath());var C=z[0];this.getActions().fireAction(this,C.type,C.parameters);}};y.prototype._createAFLayout=function(){var i=new f();i.addEventDelegate({"onAfterRendering":function(){this.getContent().forEach(function(E){if(!E.getVisible()){document.getElementById("sap-ui-invisible-"+E.getId()).parentElement.classList.add("sapFCardInvisibleContent");}});}},i);return i;};y.prototype._onResize=function(E){if(E.size.width===E.oldSize.width){return;}var I=this._getRootContainer().getItems();I.forEach(function(z,i){if(z.isA("sap.ui.layout.AlignedFlowLayout")){this._onAlignedFlowLayoutResize(z,E,i===I.length-1);}}.bind(this));};y.prototype._onAlignedFlowLayoutResize=function(i,E,z){var M=i.getMinItemWidth(),C,D=i.getContent().filter(function(K){return K.getVisible();}).length;if(M.lastIndexOf("rem")!==-1){C=g.toPx(M);}else if(M.lastIndexOf("px")!==-1){C=parseFloat(M);}var G=Math.floor(E.size.width/C);if(G>D){G=D;}var I=G-1,J=Math.ceil(D/G);i.getContent().forEach(function(K,P){K.addStyleClass("sapFCardObjectSpaceBetweenGroup");if(I===P&&I<D){K.removeStyleClass("sapFCardObjectSpaceBetweenGroup");I+=G;}if(z&&P+1>(J-1)*G){K.addStyleClass("sapFCardObjectGroupLastInColumn");}else{K.removeStyleClass("sapFCardObjectGroupLastInColumn");}});};return y;});
