/*!
 * OpenUI5
 * (c) Copyright 2009-2022 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["./BaseContentRenderer","sap/m/MessageStrip","sap/m/VBox","sap/m/library","sap/ui/core/Core","sap/ui/core/Control","sap/ui/core/InvisibleMessage","sap/ui/core/library","sap/ui/integration/model/ObservableModel","sap/ui/base/ManagedObjectObserver","sap/ui/integration/util/LoadingProvider","sap/ui/integration/util/BindingHelper","sap/base/util/merge"],function(B,M,V,l,C,a,I,c,O,b,L,d,m){"use strict";var e=c.InvisibleMessageMode;var f=a.extend("sap.ui.integration.cards.BaseContent",{metadata:{library:"sap.ui.integration",aggregations:{_content:{multiple:false,visibility:"hidden"},_loadingProvider:{type:"sap.ui.core.Element",multiple:false,visibility:"hidden"},_messageContainer:{type:"sap.m.VBox",multiple:false,visibility:"hidden"}},associations:{card:{type:"sap.ui.integration.widgets.Card",multiple:false}},events:{press:{},ready:{}}},renderer:B});f.prototype.init=function(){this._oAwaitedEvents=new Set();this._bReady=false;this._mObservers={};this.setAggregation("_loadingProvider",new L());};f.prototype.ontap=function(E){if(!E.isMarked()){this.firePress({});}};f.prototype.exit=function(){this._oAwaitedEvents=null;if(this._mObservers){Object.keys(this._mObservers).forEach(function(k){this._mObservers[k].disconnect();delete this._mObservers[k];},this);}this._oServiceManager=null;this._oDataProviderFactory=null;this._oIconFormatter=null;if(this._oDataProvider){this._oDataProvider.destroy();this._oDataProvider=null;}if(this._oActions){this._oActions.destroy();this._oActions=null;}if(this._oLoadingPlaceholder){this._oLoadingPlaceholder.destroy();this._oLoadingPlaceholder=null;}this._sContentBindingPath=null;};f.prototype.loadDependencies=function(o){return Promise.resolve();};f.prototype.getActions=function(){return this._oActions;};f.prototype.setActions=function(A){this._oActions=A;};f.prototype.awaitEvent=function(E){if(this._oAwaitedEvents.has(E)){return;}this._bReady=false;this._oAwaitedEvents.add(E);this.showLoadingPlaceholders();this.attachEventOnce(E,function(){this._oAwaitedEvents.delete(E);if(this._oAwaitedEvents.size===0){this._bReady=true;this.hideLoadingPlaceholders();this.fireReady();}}.bind(this));};f.prototype.setConfiguration=function(o,t){this._oConfiguration=o;this.awaitEvent("_dataReady");this.awaitEvent("_actionContentReady");if(!o){return this;}this._oLoadingPlaceholder=this.getAggregation("_loadingProvider").createContentPlaceholder(o,t,this.getCardInstance());this._setDataConfiguration(o.data);return this;};f.prototype.getConfiguration=function(){return this._oConfiguration;};f.prototype.getParsedConfiguration=function(){var r=m({},this._oConfiguration),D=r.data;delete r.data;r=d.createBindingInfos(r,this.getCardInstance().getBindingNamespaces());if(D){r.data=D;}return r;};f.prototype.getStaticConfiguration=function(){return this.getConfiguration();};f.prototype.showMessage=function(s,t){var o=this._getMessageContainer();var g=new M({text:s,type:t,showCloseButton:true,showIcon:true,close:function(){this._getMessageContainer().destroy();}.bind(this)}).addStyleClass("sapFCardContentMessage");o.destroyItems();o.addItem(g);if(this.getDomRef().contains(document.activeElement)){I.getInstance().announce(s,e.Assertive);}else{I.getInstance().announce(s,e.Polite);}};f.prototype._setDataConfiguration=function(D){var o=this.getCardInstance(),g;if(!D){this._sContentBindingPath=null;this.fireEvent("_dataReady");return;}this._sContentBindingPath=D.path||"/";this.bindObject(this._sContentBindingPath);if(this._oDataProvider){this._oDataProvider.destroy();}this._oDataProvider=this._oDataProviderFactory.create(D,this._oServiceManager);this.getAggregation("_loadingProvider").setDataProvider(this._oDataProvider);if(D.name){g=o.getModel(D.name);}else if(this._oDataProvider){g=new O();this.setModel(g);}if(!g){this.fireEvent("_dataReady");return;}g.attachEvent("change",function(){if(!this.isDestroyed()){this.onDataChanged();this.onDataRequestComplete();}}.bind(this));if(this._oDataProvider){this._oDataProvider.attachDataRequested(function(){this.onDataRequested();}.bind(this));this._oDataProvider.attachDataChanged(function(E){g.setData(E.getParameter("data"));});this._oDataProvider.attachError(function(E){this.handleError(E.getParameter("message"));this.onDataRequestComplete();}.bind(this));this._oDataProvider.triggerDataUpdate();}else{this.fireEvent("_dataReady");}};f.prototype.onDataRequested=function(){this.awaitEvent("_dataReady");};f.prototype.onDataRequestComplete=function(){var o=this.getCardInstance();this.fireEvent("_dataReady");if(o){o._fireContentDataChange();}};f.prototype.refreshData=function(){if(this._oDataProvider){this._oDataProvider.triggerDataUpdate();}};f.prototype.showLoadingPlaceholders=function(){var o=this.getAggregation("_loadingProvider");if(o){o.setLoading(true);}};f.prototype.hideLoadingPlaceholders=function(){var o=this.getAggregation("_loadingProvider");if(o){o.setLoading(false);}};f.prototype.onDataChanged=function(){};f.prototype._bindAggregationToControl=function(A,o,g){var h;if(!g){return;}if(!g.path){g.path=this._sContentBindingPath;}if(!g.path){h=this.getCardInstance().getBindingContext();g.path=h&&h.getPath();}if(!g.path){return;}o.bindAggregation(A,g);this._observeAggregation(A,o);};f.prototype._observeAggregation=function(A,o){var p=this.getCardInstance().getModel("parameters"),g;if(this._mObservers[A]){return;}g=new b(function(h){var i;if(h.name!==A){return;}if(!(h.mutation==="insert"||h.mutation==="remove")){return;}i=o.getMetadata().getAggregation(A).get(o);p.setProperty("/visibleItems",i.length);});g.observe(o,{aggregations:[A]});this._mObservers[A]=g;};f.prototype.isReady=function(){return this._bReady;};f.prototype.handleError=function(s){this.fireEvent("_error",{logMessage:s});};f.prototype.setServiceManager=function(s){this._oServiceManager=s;return this;};f.prototype.setDataProviderFactory=function(D){this._oDataProviderFactory=D;return this;};f.prototype.setIconFormatter=function(i){this._oIconFormatter=i;return this;};f.prototype.isLoading=function(){var o=this.getAggregation("_loadingProvider"),g=this.getCardInstance();return!o.isDataProviderJson()&&(o.getLoading()||(g&&g.isLoading()));};f.prototype.attachPress=function(){var g=Array.prototype.slice.apply(arguments);g.unshift("press");a.prototype.attachEvent.apply(this,g);this.invalidate();return this;};f.prototype.detachPress=function(){var g=Array.prototype.slice.apply(arguments);g.unshift("press");a.prototype.detachEvent.apply(this,g);this.invalidate();return this;};f.prototype.onActionSubmitStart=function(F){};f.prototype.onActionSubmitEnd=function(r,E){};f.prototype.getCardInstance=function(){return C.byId(this.getCard());};f.prototype.isSkeleton=function(){var o=this.getCardInstance();return o&&o.isSkeleton();};f.prototype.sliceData=function(s,E){};f.prototype.getDataLength=function(){return 0;};f.prototype._getMessageContainer=function(){var o=this.getAggregation("_messageContainer");if(!o){o=new V({renderType:l.FlexRendertype.Bare,alignItems:l.FlexAlignItems.Center}).addStyleClass("sapFCardContentMessageContainer");this.setAggregation("_messageContainer",o);}return o;};return f;});
