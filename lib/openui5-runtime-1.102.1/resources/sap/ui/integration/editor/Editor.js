/*!
 * OpenUI5
 * (c) Copyright 2009-2022 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["ui5loader","sap/ui/core/Control","sap/ui/core/Core","sap/ui/core/Manifest","sap/base/util/deepClone","sap/base/util/deepEqual","sap/base/util/merge","sap/ui/base/Interface","sap/ui/integration/Designtime","sap/ui/model/json/JSONModel","sap/ui/model/odata/v4/ODataModel","sap/ui/integration/util/Utils","sap/ui/integration/util/Destinations","sap/ui/integration/util/DataProviderFactory","sap/m/Label","sap/m/Title","sap/m/Panel","sap/m/HBox","sap/m/VBox","sap/ui/core/Icon","sap/m/ResponsivePopover","sap/m/Popover","sap/m/Text","sap/base/Log","sap/ui/core/Popup","sap/base/i18n/ResourceBundle","sap/ui/integration/editor/EditorResourceBundles","sap/ui/thirdparty/URI","sap/ui/dom/includeStylesheet","sap/base/util/LoaderExtensions","sap/ui/core/theming/Parameters","sap/base/util/ObjectPath","sap/m/FormattedText","sap/m/MessageStrip","sap/m/ToolbarSpacer","sap/base/util/includes","sap/ui/model/resource/ResourceModel","./Manifest","./Merger","./Settings","sap/m/FlexItemData","sap/m/FlexBox","sap/m/Button","sap/m/OverflowToolbar","sap/m/IconTabBar","sap/m/IconTabFilter"],function(u,C,c,M,d,f,g,I,D,J,O,U,h,p,L,T,P,H,V,q,R,r,t,v,w,x,E,y,A,B,F,G,K,N,S,Q,W,X,Y,Z,$,_,a1,b1,c1,d1){"use strict";var e1=r.prototype.init;r.prototype.init=function(){e1.apply(this,arguments);var a=this.oPopup._applyPosition,b=this;this.oPopup._applyPosition=function(){var e=b.close;b.close=function(){};a.apply(this,arguments);b.close=e;};};function f1(s){if(s&&s.nodeType!==1){return 0;}var z=parseInt(window.getComputedStyle(s).getPropertyValue('z-index'));if(isNaN(z)){return f1(s.parentNode);}return z+1;}var g1=/\{\{(?!parameters.)(?!destinations.)([^\}\}]+)\}\}/g,h1=/\{\{parameters\.([^\}\}]+)/g,i1=5000,j1=c.getLibraryResourceBundle("sap.ui.integration"),k1="__strip0";var l1=C.extend("sap.ui.integration.editor.Editor",{metadata:{library:"sap.ui.integration",properties:{mode:{type:"string",defaultValue:"admin"},language:{type:"string",defaultValue:""},allowDynamicValues:{type:"boolean",defaultValue:false},allowSettings:{type:"boolean",defaultValue:false},designtime:{type:"object"},section:{type:"string",defaultValue:"sap.card"},host:{type:"string",defaultValue:""},baseUrl:{type:"sap.ui.core.URI",defaultValue:null},json:{type:"object"},previewPosition:{type:"string",defaultValue:"right"},width:{type:"sap.ui.core.CSSSize",defaultValue:""},height:{type:"sap.ui.core.CSSSize",defaultValue:""}},aggregations:{_formContent:{type:"sap.ui.core.Control",multiple:true,visibility:"hidden"},_preview:{type:"sap.ui.core.Control",multiple:false,visibility:"hidden"},_messageStrip:{type:"sap.m.MessageStrip",multiple:false,visibility:"hidden"},_extension:{type:"sap.ui.integration.editor.Extension",multiple:false,visibility:"hidden"}},events:{ready:{},manifestReady:{}}},renderer:function(o,a){var b=a.getAggregation("_preview");var s=a.getMode()!=="translation"&&a.hasPreview();var e=a.getPreviewPosition();if(s&&(e==="top"||e==="bottom")){o.openStart("div");o.writeElementData(a);o.openEnd();if(a.isReady()&&e==="top"){o.renderControl(b);o.close("div");}}o.openStart("div");o.addClass("sapUiIntegrationEditor");if(s&&e==="left"){o.writeElementData(a);o.openEnd();if(a.isReady()){o.renderControl(b);o.close("div");}}else if(s&&(e==="bottom"||e==="top")){o.openEnd();}else{o.writeElementData(a);o.openEnd();}if(a.isReady()){o.openStart("div");o.addClass("sapUiIntegrationEditorForm");if(a.getMode()!=="translation"){o.addClass("settingsButtonSpace");}o.openEnd();if(a.getMode()!=="translation"){o.renderControl(a.getAggregation("_messageStrip"));}var k=a.getAggregation("_formContent");if(k){var z;var m1;var n1;var o1;var p1=[];var q1=[];var r1;var s1=function(){if(p1.length>0){var m=2-p1.length;for(var n=0;n<m;n++){p1.push(new V());}z.addContent(new _({alignItems:"Start",justifyContent:"SpaceBetween",items:p1}));p1=[];}};var t1=function(){if(q1.length>0){var m=2-q1.length;for(var n=0;n<m;n++){q1.push(new V());}m1.addContent(new _({alignItems:"Start",justifyContent:"SpaceBetween",items:q1}));q1=[];}};var u1=function(z){if(z.getContent().length>0){var m=z.getContent();if(m.length===1&&m[0].isA("sap.m.MessageStrip")){return;}if(m[0].isA("sap.m.MessageStrip")){z.removeContent(0);z.addContent(m[0]);}o.renderControl(z);if(z._messageStrip){o.renderControl(z._messageStrip);}}};var v1=function(z,m1){if(z&&m1.getContent().length>0){var m=m1.getContent();if(m[0].isA("sap.m.MessageStrip")){m1.removeContent(0);m1.addContent(m[0]);}z.addContent(m1);if(m1._messageStrip){z.addContent(m1._messageStrip);}}else{m1=null;}};var w1=function(z,m1){var n=z.getContent(),X1;if(n.length>0){for(var m=0;m<n.length;m++){if(n[m].isA("sap.m.IconTabBar")){X1=n[m];}}}if(X1&&m1.getContent().length>0){X1.addItem(m1);}};for(var i=0;i<k.length;i++){var x1=k[i];if(a.getMode()!=="translation"){if(x1.isA("sap.m.Panel")||x1.isA("sap.m.IconTabBar")){if(m1){t1();if(x1.isA("sap.m.Panel")&&m1.isA("sap.m.Panel")){v1(z,m1);}else{w1(z,m1);}}var y1=0;if(x1.isA("sap.m.Panel")){y1=x1._level;}else if(x1.isA("sap.m.IconTabBar")){y1="1";}if(y1==="1"){if(p1.length>0){s1();}if(x1.isA("sap.m.IconTabBar")){var z1=z.getContent(),A1=false,B1;if(z1.length>0){for(var j=0;j<z1.length;j++){if(z1[j].isA("sap.m.IconTabBar")){A1=true;B1=z1[j];}}}if(!A1){m1=x1.getItems()[0];m1._subItems=[];x1.removeItem(x1.getItems()[0]);if(x1.isA("sap.m.IconTabBar")&&x1._messageStrip){z.addContent(x1._messageStrip);}x1.addStyleClass("sapUiIntegrationEditorSubTab");z.addContent(x1);}else{m1=x1.getItems()[0];m1._subItems=[];B1.addItem(x1.getItems()[0]);x1.destroy();}}else{m1=x1;m1._subItems=[];m1.addStyleClass("sapUiIntegrationEditorSubGroup");}}else{if(z){s1();u1(z);m1=null;}z=x1;z._subItems=[];z.addStyleClass("sapUiIntegrationEditorItem");}if(i===k.length-1){s1();u1(z);}continue;}if(x1.isA("sap.m.FormattedText")){if(m1){m1.addContent(x1.addStyleClass("sapUiIntegrationEditorHint"));}else{z.addContent(x1.addStyleClass("sapUiIntegrationEditorHint"));}if(i===k.length-1){if(m1){t1();v1(z,m1);}s1();u1(z);}continue;}var C1=x1._layout;if(x1.isA("sap.m.Label")){x1.addStyleClass("sapUiIntegrationEditorItemLabel");if(C1&&!f(C1,{})){if(C1.alignment&&C1.alignment.label==="end"){x1.setTextAlign("End");}o1=x1;}else{if(x1._cols===2){if(m1){t1();}else{s1();}}else if(q1.length===2){t1();}else if(p1.length===2){s1();}if(m1){m1.addContent(x1);}else{z.addContent(x1);}}}else if(x1.isA("sap.m.ToolbarSpacer")){if(x1._hasLine){x1.addStyleClass("sapUiIntegrationEditorSpacerWithLine");}else{x1.addStyleClass("sapUiIntegrationEditorSpacerWithoutLine");}if(m1){t1();m1.addContent(x1);}else{s1();z.addContent(x1);}}else{var D1=x1.getConfiguration(),E1=new H(),F1=0.1,G1=0,H1;if(x1._descriptionIcon){E1.addItem(x1._descriptionIcon);F1+=0.9;}var I1=c.byId(x1.getAssociation("_messageIcon"));if(x1.getAssociation("_messageIcon")&&I1){E1.addItem(I1);F1+=1.2;}if(x1._settingsButton){x1._settingsButton.addStyleClass("sapUiIntegrationEditorSettingsButton");G1=2;}var J1=new $({growFactor:10,maxWidth:"calc(100% - "+G1+"rem)"});var K1=new $({maxWidth:"calc(100% - "+F1+"rem)"});if(o1){var L1,M1,N1="50%";if(C1&&C1["label-width"]){N1=C1["label-width"];}var O1=parseInt(N1);var P1=100-O1;if(x1._cols===2){O1=O1-0.5;P1=P1-0.5;}if(C1.alignment&&C1.alignment.field==="end"){x1.addStyleClass("sapUiIntegrationEditorFieldAlignEnd");}if(C1.alignment&&C1.alignment.label==="end"){o1.setLayoutData(new $({maxWidth:"calc(100% - "+F1+"rem)",minWidth:"calc(100% - "+F1+"rem)"}));}else{o1.setLayoutData(K1);}if(E1.getItems().length>0){o1.addStyleClass("sapUiIntegrationEditorItemLabelWithInfo");H1=new H({items:[o1,E1]});}else{H1=o1;}if(C1&&C1.position&&C1.position==="field-label"){H1.setLayoutData(J1);M1=new H({alignItems:"Start",justifyContent:"SpaceBetween",items:[H1,x1._settingsButton]});M1.setLayoutData(new $({growFactor:O1,maxWidth:O1+"%"}));x1.setLayoutData(new $({growFactor:P1,maxWidth:P1+"%"}));L1=new H({alignItems:"Start",justifyContent:"SpaceBetween",items:[x1,M1]});}else{x1.setLayoutData(J1);M1=new H({alignItems:"Start",justifyContent:"SpaceBetween",items:[x1,x1._settingsButton]});H1.setLayoutData(new $({growFactor:O1,maxWidth:O1+"%"}));M1.setLayoutData(new $({growFactor:P1,maxWidth:P1+"%"}));L1=new H({alignItems:"Start",justifyContent:"SpaceBetween",items:[H1,M1]});}if(x1._cols===1){if(m1){if(q1.length===2){t1();}if(D1.hint){var Q1=a._createHint(D1.hint);var R1=new V({items:[L1,Q1.addStyleClass("sapUiIntegrationEditorHint")]});R1.addStyleClass("col1");q1.push(R1);}else{L1.addStyleClass("col1");q1.push(L1);}}else{if(p1.length===2){s1();}if(D1.hint){var Q1=a._createHint(D1.hint);var R1=new V({items:[L1,Q1.addStyleClass("sapUiIntegrationEditorHint")]});R1.addStyleClass("col1");p1.push(R1);}else{L1.addStyleClass("col1");p1.push(L1);}}}else if(m1){t1();m1.addContent(L1);}else{s1();z.addContent(L1);}o1=null;}else{var S1;if(m1){S1=m1.getContent().pop();}else{S1=z.getContent().pop();}S1.setLayoutData(K1);if(E1.getItems().length>0){S1.addStyleClass("sapUiIntegrationEditorItemLabelWithInfo");H1=new H({items:[S1,E1]});}else{H1=S1;}H1.setLayoutData(J1);var T1=new _({alignItems:"Start",justifyContent:"SpaceBetween",items:[H1,x1._settingsButton]});if(x1._cols===1){var R1=new V({items:[T1,x1]});if(D1.hint){var Q1=a._createHint(D1.hint);R1.addItem(Q1.addStyleClass("sapUiIntegrationEditorHint"));}R1.addStyleClass("col1");if(m1){q1.push(R1);}else{p1.push(R1);}}else if(m1){m1.addContent(T1);m1.addContent(x1);}else{z.addContent(T1);z.addContent(x1);}}if(m1){m1._subItems.push({"settingspath":x1.getConfiguration()._settingspath,"itemId":x1.getId()});}z._subItems.push({"settingspath":x1.getConfiguration()._settingspath,"itemId":x1.getId()});}if(i===k.length-1){if(m1){t1();if(m1.isA("sap.m.Panel")){v1(z,m1);}else{w1(z,m1);}}s1();u1(z);}}else{if(i===0){n1=x1;o.renderControl(n1);n1.addStyleClass("sapUiIntegrationEditorTranslationPanel");continue;}if(x1.isA("sap.m.Panel")||x1.isA("sap.m.IconTabBar")){if(m1){if(x1.isA("sap.m.Panel")&&m1.isA("sap.m.Panel")){v1(z,m1);}else{w1(z,m1);}}var U1=0;if(x1.isA("sap.m.Panel")){U1=x1._level;}else if(x1.isA("sap.m.IconTabBar")){if(x1.getItems().length>0&&x1.getItems()[0]._level){U1=x1.getItems()[0]._level;}}if(U1==="1"){if(x1.isA("sap.m.IconTabBar")){if(i!==k.length-1||(i<k.length&&(k[i].isA("sap.m.IconTabBar")||k[i].isA("sap.m.Panel")))){var V1=z.getContent(),W1=false;if(V1.length>0){for(var l=0;l<V1.length;l++){if(V1[l].isA("sap.m.IconTabBar")){W1=true;}}}if(!W1){m1=x1.getItems()[0];x1.removeItem(x1.getItems()[0]);z.addContent(x1);}else{m1=x1.getItems()[0];}}}else{m1=x1;m1.addStyleClass("sapUiIntegrationEditorSubGroup");}}else{m1=null;if(z&&z.getContent().length>0){n1.addContent(z);}z=x1;z.addStyleClass("sapUiIntegrationEditorSubGroup");}if(i===k.length-1){s1();u1(z);}continue;}if(x1.isA("sap.m.ToolbarSpacer")){continue;}if(x1.isA("sap.m.FormattedText")){continue;}if(x1.isA("sap.m.Label")){if(m1){m1.addContent(x1);}else{z.addContent(x1);}continue;}if(x1.isOrigLangField){r1=x1;continue;}r1.addStyleClass("sapUiIntegrationFieldTranslationText");var L1=new H({items:[r1,x1]}).addStyleClass("notWrappingRow");if(m1){m1.addContent(L1);}else{z.addContent(L1);}if(i===k.length-1){if(m1){if(m1.isA("sap.m.Panel")){v1(z,m1);}else{w1(z,m1);}}n1.addContent(z);}}}}o.close("div");if(s&&e==="right"){o.renderControl(b);}}o.close("div");if(a.isReady()&&s&&e==="bottom"){o.renderControl(b);o.close("div");}}});l1.prototype.init=function(){this._ready=false;this._aFieldReadyPromise=[];this._oResourceBundle=c.getLibraryResourceBundle("sap.ui.integration");this._appliedLayerManifestChanges=[];this._currentLayerManifestChanges={};this._mDestinationDataProviders={};var m=new N({showIcon:false});m.addStyleClass("sapUiIntegrationEditorFieldMessageStrip");this.setAggregation("_messageStrip",m);k1=m.getId();this.setLanguage(c.getConfiguration().getLanguage());this._oLimitedInterface=new I(this,["getParameters","resolveDestination","request","getModel"]);};l1.prototype.getParameters=function(){if(!this._isManifestReady){v.error("The manifest is not ready. Consider using the 'manifestReady' event.","sap.ui.integration.editor.Editor");return null;}var o=this._oEditorManifest.getProcessedParameters(),a={},k;for(k in o){a[k]=o[k].value;}return a;};l1.prototype.resolveDestination=function(k){return this._oDestinations.getUrl(k);};l1.prototype.isReady=function(){return this._ready;};l1.prototype.hasPreview=function(){var o=this.getAggregation("_preview");if(o&&o.visible!==false){return true;}return false;};l1.prototype.flattenData=function(o,s,a,b){b=b||"";a=a||[];if(typeof o==="object"){if(!o[s]){for(var n in o){this.flattenData(o[n],s,a,b+"/"+n);}}else{if(o.type){a.push({path:o.pathvalue||b.substring(1),value:o.pathvalue||"{context>"+b.substring(1)+"/value}",object:o});}else{a.push({path:b.substring(1),object:o});for(var n in o){this.flattenData(o[n],s,a,b+"/"+n);}}}}return a;};l1.prototype.setJson=function(i,s){this._ready=false;if(f(i,this._preIdOrSettings)){return this;}this._preIdOrSettings=d(i,500);if(typeof i==="string"){try{i=JSON.parse(i);}catch(e){}}if(typeof i==="object"){if(i.manifestChanges){this._filterManifestChangesByLayer(i);}if(this._manifestModel){return;}if(this._oDesigntimeInstance){this._oDesigntimeInstance.destroy();}if(i.host){this.setProperty("host",i.host);}if(i.baseUrl){this.setProperty("baseUrl",i.baseUrl);}this._appliedLayerManifestChanges=i.manifestChanges;this.createManifest(i,s);}};l1.prototype.createManifest=function(i,s){var b=this.getBaseUrl();var o={},m=i.manifest;this._isManifestReady=false;if(typeof m==="string"){o.manifestUrl=m;m=null;}if(this._oEditorManifest){this._oEditorManifest.destroy();}this.destroyAggregation("_extension");var a=Y.layers[this.getMode()];this._oEditorManifest=new X(this.getSection(),m,b,i.manifestChanges);this._oEditorManifest.load(o).then(function(){this._registerManifestModulePath();this._oInitialManifestModel=new J(this._oEditorManifest._oInitialJson);this.setProperty("json",this._oEditorManifest._oInitialJson,s);var e=this._oEditorManifest.oJson;var j=g({},e);this._beforeManifestModel=new J(j);if(a<Y.layers["translation"]&&this._currentLayerManifestChanges){e=Y.mergeDelta(e,[this._currentLayerManifestChanges],this.getSection());}this._manifestModel=new J(e);this._isManifestReady=true;this.fireManifestReady();var k=this._oEditorManifest.get("/sap.app/i18n");var l=this.getBaseUrl()+k;if(k&&E.getResourceBundleURL()!==l){E.setResourceBundleURL(l);}this._loadDefaultTranslations();this._createContextModel();if(this._oEditorManifest.getResourceBundle()){this._enhanceI18nModel(this._oEditorManifest.getResourceBundle());}return this._loadExtension().then(function(){this._initInternal();}.bind(this));}.bind(this));};l1.prototype._registerManifestModulePath=function(){if(!this._oEditorManifest){return;}this._sAppId=this._oEditorManifest.get("/sap.app/id");if(this._sAppId){B.registerResourcePath(this._sAppId.replace(/\./g,"/"),this._oEditorManifest.getUrl()||"/");}else{v.error("sap.app/id entry in the manifest is mandatory");}};l1.prototype._loadDefaultTranslations=function(){if(this._defaultTranslationsLoaded){return;}var j1=c.getLibraryResourceBundle("sap.ui.integration");var o=new W({bundle:j1});this.setModel(o,"i18n");this._oResourceBundle=j1;this._defaultTranslationsLoaded=true;};l1.prototype._enhanceI18nModel=function(j1){var o=this.getModel("i18n");if(o.getResourceBundle().oUrlInfo.url!==j1.oUrlInfo.url){o.enhance(j1);this._oResourceBundle=o.getResourceBundle();}};l1.prototype._loadExtension=function(){var e=this._oEditorManifest.get(this.getConfigurationPath()+"/extension")||this._oEditorManifest.get("/"+this.getSection()+"/extension");if(!e){v.info("Extension is not defined in manifest, do not load it.");return new Promise(function(a,b){a();});}var s=this._sAppId.replace(/\./g,"/")+"/"+e;return new Promise(function(a,b){sap.ui.require([s],function(i){var o=new i();o._setEditor(this,this._oLimitedInterface);this.setAggregation("_extension",o);a();}.bind(this),function(i){v.error("Failed to load "+e+". Check if the path is correct. Reason: "+i);b(i);});}.bind(this));};l1.prototype.request=function(o){return this._oDataProviderFactory.create({request:o}).setAllowCustomDataType(true).getData();};l1.prototype.initDestinations=function(a){var o=this.getHostInstance();if(a&&!o){v.error("Host with id '"+a+"' is not available during editor initialization. It must be available for host specific features to work.","Make sure that the host already exists, before assigning it to the editor.","sap.ui.integration.editor.Editor");}if(this._oDestinations){this._oDestinations.setHost(o);}else{var s=this.getConfigurationPath();this._oDestinations=new h(o,this._manifestModel.getProperty(s+"/destinations"));}};l1.prototype.initDataProviderFactory=function(){if(this._oDataProviderFactory){this._oDataProviderFactory.destroy();}var e=this.getAggregation("_extension");this._oDataProviderFactory=new p({destinations:this._oDestinations,extension:e,editor:this});};l1.prototype.getRuntimeUrl=function(s){var a=this._sAppId,b,e=s&&s.trim().replace(/^\//,"");if(a===null){v.error("The manifest is not ready so the URL can not be resolved. Consider using the 'manifestReady' event.","sap.ui.integration.editor.Editor");return null;}if(!a||s.startsWith("http://")||s.startsWith("https://")||s.startsWith("//")){return s;}b=a.replace(/\./g,"/");return sap.ui.require.toUrl(b)+"/"+e;};l1.prototype.getBindingNamespaces=function(){var n={},e=this.getAggregation("_extension");if(e){n.extension={formatters:e.getFormatters()};}return n;};l1.prototype.getHostInstance=function(){var s=this.getHost();if(!s){return null;}return c.byId(s);};l1.prototype.setLanguage=function(s,b){if(!s||typeof s!=="string"){return this;}this._language=s.replaceAll('_','-');if(this.getLanguage()!=s){this._loadDefaultTranslations();}this.setProperty("language",s,b);if(!l1._languages[this._language]){this._language=this._language.split("-")[0];}if(!l1._languages[this._language]){v.warning("The language: "+s+" is currently unknown, some UI controls might show "+s+" instead of the language name.");}return this;};l1.prototype.onAfterRendering=function(){if(this.getDomRef()){this._iZIndex=f1(this.getDomRef());w.setInitialZIndex(this._iZIndex);}};l1.prototype._filterManifestChangesByLayer=function(m){var a=[],b=this,o={},e={":layer":Y.layers[this.getMode()]},i=Y.layers[b.getMode()];m.manifestChanges.forEach(function(j){var l=j.hasOwnProperty(":layer")?j[":layer"]:1000;if(l===Y.layers["translation"]){var k=b._language;if(k===""){k=c.getConfiguration().getLanguage().replaceAll('_','-');}var n={"texts":{}};delete j.texts;n.texts[k]={};Object.keys(j).forEach(function(s){if(s.charAt(0)==="/"){n.texts[k][s]=j[s];}else{n[s]=j[s];}});j=n;}if(l<i){a.push(j);o=g(o,j);}else if(l===i){e=j;}});m.manifestChanges=a;this._currentLayerManifestChanges=e;this._beforeLayerManifestChanges=o;};l1.prototype._initInternal=function(){var a=this;var s=a.getConfigurationPath();var b=a._oEditorManifest.get(s+"/editor");if(!b){b=a._oEditorManifest.get("/"+a.getSection()+"/designtime");}var o=a._manifestModel.getProperty(s),e,i=a.getDesigntime();if(i){if(typeof i==="function"){e=new Promise(function(j,k){var l=new i();a._applyDesigntimeDefaults(l.getSettings());j(l);});}else if(typeof i==="object"){e=new Promise(function(j,k){sap.ui.require(["sap/ui/integration/Designtime"],function(D){var l=D.extend("test.Designtime");l.prototype.create=function(){return i;};var m=new l();a._applyDesigntimeDefaults(m.getSettings());j(m);});});}}else if(b){e=a.loadDesigntime().then(function(j){a._applyDesigntimeDefaults(j.getSettings());return j;});}else{e=Promise.resolve(a._createParameterDesigntime(o));}e.then(function(j){a._oDesigntimeInstance=j;a.initDestinations();a.initDataProviderFactory();if(a.getMode()==="admin"||a.getMode()==="all"){a._addDestinationSettings(o,a._oDesigntimeInstance);}a._settingsModel=new J(a._oDesigntimeInstance.getSettings());a.setModel(a._settingsModel,"currentSettings");a.setModel(a._settingsModel,"items");return a._loadValueContextInDesigntime();}).then(function(){a._applyDesigntimeLayers();return a._requestExtensionData();}).then(function(){a._requireFields().then(function(){a._startEditor();});});};l1.prototype.loadDesigntime=function(){if(this._oDesigntime){return Promise.resolve(this._oDesigntime);}if(!this._oEditorManifest){return new Promise(function(a,b){this.attachManifestReady(function(){this.loadDesigntime().then(a,b);}.bind(this));}.bind(this));}if(!this._sAppId){return Promise.reject("App id not maintained");}return new Promise(function(a,b){var s=this._oEditorManifest.get(this.getConfigurationPath()+"/editor");if(!s){s=this._oEditorManifest.get("/"+this.getSection()+"/designtime");}var e=this._sAppId.replace(/\./g,"/")+"/"+s;if(e){sap.ui.require([e],function(o){o=new o();o._readyPromise(this._oLimitedInterface,this).then(function(){this._oDesigntime=o;a(o);}.bind(this));}.bind(this),function(){b({error:e+" not found"});});}else{b();}}.bind(this));};l1.prototype.getConfigurationPath=function(){return"/"+this.getSection()+"/configuration";};l1.prototype.getCurrentSettings=function(){var s=this._settingsModel.getProperty("/"),m={},a;if(s&&s.form&&s.form.items){for(var n in s.form.items){var i=s.form.items[n];if(i.editable&&i.visible){if(this.getMode()!=="translation"){if(i.translatable&&!i._changed&&i._translatedPlaceholder&&!this._currentLayerManifestChanges[i.manifestpath]){}else{if(i.valueItems){m[i.manifestpath.substring(0,i.manifestpath.lastIndexOf("/"))+"/valueItems"]=i.valueItems;}if(i.valueTokens){m[i.manifestpath.substring(0,i.manifestpath.lastIndexOf("/"))+"/valueTokens"]=i.valueTokens;}switch(i.type){case"string":if(!i.translatable){m[i.manifestpath]=i.value;}else if(i._hasDynamicValue){m[i.manifestpath]=i.value;this.deleteAllTranslationValuesInTexts(i.manifestpath);}else if(i._beforeValue&&(i._beforeValue.indexOf("{context>")===0||i._beforeValue.indexOf("{{parameters")===0)){m[i.manifestpath]=i.value;}break;case"group":break;case"object":case"object[]":if(i.value&&i.value!==""){m[i.manifestpath]=i.value;}break;default:m[i.manifestpath]=i.value;}}}else if(i.translatable&&i.value){m[i.manifestpath]=i.value;}if(i._next&&(this.getAllowSettings())){var b=typeof(i.visibleToUser)==="undefined"?true:i.visibleToUser;var e=typeof(i.editableToUser)==="undefined"?true:i.editableToUser;if(i._next.visible===!b){a=a||{};a[i._settingspath+"/visible"]=i._next.visible;}if(i._next.editable===!e){a=a||{};a[i._settingspath+"/editable"]=i._next.editable;}if(i._next.pageAdminValues){a=a||{};a[i._settingspath+"/pageAdminValues"]=i._next.pageAdminValues;}if(typeof i._next.allowDynamicValues==="boolean"&&this.getAllowDynamicValues()){a=a||{};a[i._settingspath+"/allowDynamicValues"]=i._next.allowDynamicValues;}}}}}if(this.getMode()==="translation"){delete m.texts;}else if(s.texts){m.texts=d(s.texts,500)||{};for(var l in m.texts){for(var k in m.texts[l]){if(typeof m.texts[l][k]==="object"){var j=m[k];if(!j||typeof j!=="object"||f(j,{})||f(j,[])){delete m.texts[l][k];}else if(Array.isArray(j)){var o=j.map(function(o1){return o1._dt?o1._dt._uuid||"":"";});for(var z in m.texts[l][k]){if(!Q(o,z)){delete m.texts[l][k][z];}}}else{var m1=j._dt?j._dt._uuid||"":"";if(m1!==""){var n1=m.texts[l][k][m1];if(!n1){delete m.texts[l][k];}else{m.texts[l][k]={};m.texts[l][k][m1]=n1;}}else{delete m.texts[l][k];}}}}if(f(m.texts[l],{})){delete m.texts[l];}}if(f(m.texts,{})){delete m.texts;}}m[":layer"]=Y.layers[this.getMode()];m[":errors"]=this.checkCurrentSettings()[":errors"];if(a){m[":designtime"]=a;}if(s[":designtime"]){m[":designtime"]=g(m[":designtime"],s[":designtime"]);}return m;};l1.prototype.checkCurrentSettings=function(){var s=this._settingsModel.getProperty("/"),m={};if(s&&s.form&&s.form.items){for(var n in s.form.items){var i=s.form.items[n];if(i.editable){if((i.isValid||i.required)&&!(this.getMode()==="translation"&&i.translatable)){if(i.isValid){m[i.manifestpath]=i.isValid(i);}m[i.manifestpath]=true;var a=i.value;var b=i.type;if(b==="string"&&a===""){m[i.manifestpath]=a;}if((b==="date"||b==="datetime")&&isNaN(Date.parse(a))){m[i.manifestpath]=a;}if(b==="integer"){if(isNaN(parseInt(a))){m[i.manifestpath]=a;}else if(a<i.min||a>i.max){m[i.manifestpath]=a;}}if(b==="number"){if(isNaN(parseFloat(a))){m[i.manifestpath]=a;}else if(a<i.min||a>i.max){m[i.manifestpath]=a;}}}}}m[":layer"]=Y.layers[this.getMode()];}m[":errors"]=Object.values(m).indexOf(false)>-1;return m;};l1.prototype._createContextModel=function(){var b=this.getHostInstance(),e=new J({}),i=new J([]);this.setModel(e,"context");this.setModel(i,"contextflat");e._aPendingPromises=[];i._getPathObject=function(s){var a=this.getData().filter(function(o){if(o.path===s){return true;}});return a.length?a[0]:null;};i._getValueObject=function(s){var a=this.getData()||[];a=a.filter(function(o){if(o.value===s||o.object.value===s){return true;}});return a.length?a[0]:null;};var j=new Promise(function(a,k){if(b&&b.getContext){var l=false;setTimeout(function(){if(l){return;}v.error("Editor context could not be determined with "+i1+".");l=true;a({});},i1);b.getContext().then(function(o){if(l){v.error("Editor context returned after more than "+i1+". Context is ignored.");}l=true;a(o||{});});}else{a({});}});j.then(function(o){var a=this._mergeContextData(o);e.setData(a);i.setData(this.flattenData(a,"label"));}.bind(this));e.getProperty=function(s,o){if(s&&!s.startsWith("/")&&!o){s="/"+s;}var a=this.resolve(s,o),k;if(a.endsWith("/value")){this._mValues=this._mValues||{};if(this._mValues.hasOwnProperty(a)){return this._mValues[a];}this._mValues[a]=undefined;k=U.timeoutPromise(b.getContextValue(a.substring(1)));k=k.then(function(l){this._mValues[a]=l;this.checkUpdate();}.bind(this)).catch(function(l){this._mValues[a]=null;this.checkUpdate();v.error("Path "+a+" could not be resolved. Reason: "+l);}.bind(this));this._aPendingPromises.push(k);return undefined;}else{return J.prototype.getProperty.apply(this,arguments);}};};l1.prototype._mergeContextData=function(o){var a={};a["empty"]=l1._contextEntries.empty;for(var n in o){a[n]=o[n];}a["editor.internal"]=l1._contextEntries["editor.internal"];return a;};l1.prototype._loadValueContextInDesigntime=function(){var o=this.getModel("context");var s=this._oDesigntimeInstance.getSettings();var i;if(s&&s.form&&s.form.items){i=JSON.stringify(s.form.items);}if(i){var a=/\{context\>[\/?\w+.]+\}/g;var b=i.match(a);var e;if(b&&b.length>0){b=b.filter(function(j){return j.endsWith("value}");});e=b.map(function(j){return j.substring("{context>".length,j.length-1);});e.forEach(function(j){o.getProperty(j);});return Promise.all(o._aPendingPromises).then(function(){o._aPendingPromises=[];});}}return Promise.resolve();};l1.fieldMap={"string":"sap/ui/integration/editor/fields/StringField","string[]":"sap/ui/integration/editor/fields/StringListField","integer":"sap/ui/integration/editor/fields/IntegerField","number":"sap/ui/integration/editor/fields/NumberField","boolean":"sap/ui/integration/editor/fields/BooleanField","date":"sap/ui/integration/editor/fields/DateField","datetime":"sap/ui/integration/editor/fields/DateTimeField","object":"sap/ui/integration/editor/fields/ObjectField","object[]":"sap/ui/integration/editor/fields/ObjectListField","destination":"sap/ui/integration/editor/fields/DestinationField"};l1.Fields=null;l1.prototype._requireFields=function(){if(l1.Fields){return Promise.resolve();}return new Promise(function(a){sap.ui.require(Object.values(l1.fieldMap),function(){l1.Fields={};for(var n in l1.fieldMap){l1.Fields[n]=arguments[Object.keys(l1.fieldMap).indexOf(n)];}a();});});};l1.prototype._createDescription=function(o){var a=new q({src:"sap-icon://message-information",color:"Marker",size:"12px",useIconTooltip:false,visible:o.visible,objectBindings:{currentSettings:{path:"currentSettings>"+o._settingspath},items:{path:"items>/form/items"},context:{path:"context>/"}}});a.addStyleClass("sapUiIntegrationEditorDescriptionIcon");a.onmouseover=function(a){this._getPopover().getContent()[0].applySettings({text:o.description});this._getPopover().openBy(a);a.addDependent(this._getPopover());}.bind(this,a);a.onmouseout=function(a){this._getPopover().close();a.removeDependent(this._getPopover());}.bind(this,a);return a;};l1.prototype._createMessageIcon=function(o){var a=o.getConfiguration();var m=new q({src:"sap-icon://message-information",size:"12px",visible:a.visible,useIconTooltip:false,objectBindings:{currentSettings:{path:"currentSettings>"+a._settingspath},items:{path:"items>/form/items"},context:{path:"context>/"}}});m.onmouseover=function(o){o._showMessage();}.bind(this,o);m.onmouseout=function(o){o._hideMessage();}.bind(this,o);m.addStyleClass("sapUiIntegrationEditorMessageIcon");return m;};l1.prototype._createLabel=function(o){var l=new L({text:o.label,tooltip:o.tooltip||o.label,required:o.required&&o.editable||false,visible:o.visible,objectBindings:{currentSettings:{path:"currentSettings>"+o._settingspath},items:{path:"items>/form/items"},context:{path:"context>/"}}});l._cols=o.cols||2;if(o.layout){l._layout=o.layout;}l._sOriginalType=o.type;return l;};l1.prototype._createSettingsButton=function(o){var a=o.getConfiguration();var s=new a1({icon:"{= ${currentSettings>_hasDynamicValue} ? 'sap-icon://display-more' : 'sap-icon://enter-more'}",type:"Transparent",tooltip:this._oResourceBundle.getText("EDITOR_FIELD_MORE_SETTINGS"),press:function(e){this._openSettingsDialog(200,e.oSource,o);}.bind(this),visible:a.visible,objectBindings:{currentSettings:{path:"currentSettings>"+a._settingspath},items:{path:"items>/form/items"},context:{path:"context>/"}}});return s;};l1.prototype._getSettingsPanel=function(o){if(!o._oSettingsPanel){o._oSettingsPanel=new Z();}return o._oSettingsPanel;};l1.prototype._openSettingsDialog=function(i,s,o){var a=this._getSettingsPanel(o);window.setTimeout(function(){a.setConfiguration(o.getConfiguration());var b=this.getAggregation("_preview");a.open(s,s,b,o.getHost(),o,o._applySettings.bind(o),o._cancelSettings.bind(o));}.bind(this),i||600);};l1.prototype._getPopover=function(){if(this._oPopover){return this._oPopover;}var o=new t({text:""});o.addStyleClass("sapUiTinyMargin sapUiIntegrationEditorDescriptionText");this._oPopover=new R({showHeader:false,content:[o]});this._oPopover.addStyleClass("sapUiIntegrationEditorPopover");return this._oPopover;};l1.prototype._createField=function(o){var a=new l1.Fields[o.type]({configuration:o,mode:this.getMode(),host:this.getHostInstance(),objectBindings:{currentSettings:{path:"currentSettings>"+o._settingspath},items:{path:"items>/form/items"},context:{path:"context>/"}},visible:o.visible});this._aFieldReadyPromise.push(a._readyPromise.then(function(){if(o.require||o.validation||(o.validations&&o.validations.length>0)||(o.values&&o.values.data&&!o.values.data.json)){var m=this._createMessageIcon(a);a.setAssociation("_messageIcon",m);}if(o.description&&this.getMode()!=="translation"){a._descriptionIcon=this._createDescription(o);}if(o._changeDynamicValues){a._settingsButton=this._createSettingsButton(a);a._applyButtonStyles();}}.bind(this)));a._oValueBinding=this._settingsModel.bindProperty(o._settingspath+"/value");a._oValueBinding.attachChange(function(){if(!this._bIgnoreUpdates){o._changed=true;if(o._dependentFields&&o._dependentFields.length>0){this._updateEditor(o._dependentFields);}this._updatePreview();}}.bind(this));if(a.isFilterBackend()){var s=this._settingsModel.bindProperty(o._settingspath+"/suggestValue");s.attachChange(function(){var b=g({},o);b._cancel=false;this._addValueListModel(b,a);}.bind(this));}if(o.values){if(o.values.metadata){this._addMetadataModel(o,a);}if(o.type==="string[]"&&a.isFilterBackend()&&o.visualization&&o.visualization.type==="MultiInput"){a.setModel(new J({}),undefined);}else{this._addValueListModel(o,a);}}this._createDependentFields(o,a);a._cols=o.cols||2;if(o.layout){a._layout=o.layout;}a._oDataProviderFactory=this._oDataProviderFactory;a.setAssociation("_messageStrip",k1);a._previewPosition=this.getPreviewPosition();return a;};l1.prototype._updateEditor=function(a){if(this._ready){if(a.length===0){return;}for(var i=0;i<a.length;i++){var o=a[i];o.config._cancel=true;}if(!this._oDataProviderFactory){return;}this._bIgnoreUpdates=true;for(var i=0;i<a.length;i++){var o=a[i];o.config._cancel=false;this._addValueListModel(o.config,o.field,500*i);}this._bIgnoreUpdates=false;}};l1.prototype._updatePreview=function(){var o=this.getAggregation("_preview");if(o&&o.update){o.update();}};l1.prototype._requestData=function(o,a){var b=this._oDataProviderFactory.create(o.values.data);b.bindObject({path:"items>/form/items"});b.bindObject({path:"currentSettings>"+o._settingspath});b.bindObject({path:"context>/"});var e=b.getData();e.then(function(m){if(o._cancel){o._values=[];this._settingsModel.setProperty(o._settingspath+"/_loading",false);return;}var s=o.values.data.path,z,m1=[];if(s&&s!=="/"){if(s.startsWith("/")){s=s.substring(1);}if(s.endsWith("/")){s=s.substring(0,s.length-1);}z=s.split("/");m1=G.get(z,m);}else{m1=m;}if(o.type==="object"||o.type==="object[]"){m1.forEach(function(x1){x1._dt={_editable:false};});}if(this.getMode()==="content"&&o.pageAdminValues&&o.pageAdminValues.length>0){var n1=o.pageAdminValues,o1=o.value,p1=o.valueItems,q1=[],r1=[],s1=[];this.prepareFieldsInKey(o);if(n1.length>0){for(var i=0;i<n1.length;i++){for(var j=0;j<m1.length;j++){var t1=this.getKeyFromItem(m1[j]);if(n1[i]===t1){q1.push(m1[j]);}}if(Array.isArray(o1)){for(var k=0;k<o1.length;k++){if(n1[i]===o1[k]){r1.push(o1[k]);}}for(var l=0;l<p1.length;l++){var u1=this.getKeyFromItem(p1[l]);if(n1[i]===u1){s1.push(p1[l]);}}}}if(r1.length>0){o.value=[];o.value=r1;}if(s1.length>0){o.valueItems=[];o.valueItems=s1;}}if(o.values.data.path&&o.values.data.path!=="/"){delete m[z];G.set(z,q1,m);}else{m=[];m=q1;}}var v1=a.getConfiguration();if(o.type==="string[]"){var w1=o.values.data.path;if(w1&&w1!=="/"){if(w1.startsWith("/")){w1=w1.substring(1);}if(w1.endsWith("/")){w1=w1.substring(0,w1.length-1);}var z=w1.split("/");var x1=G.get(z,m);if(Array.isArray(x1)){for(var n in x1){var y1=a.getKeyFromItem(x1[n]);if(Array.isArray(v1.value)&&v1.value.length>0&&Q(v1.value,y1)){x1[n].Selected=this._oResourceBundle.getText("EDITOR_ITEM_SELECTED");}else{x1[n].Selected=this._oResourceBundle.getText("EDITOR_ITEM_UNSELECTED");}}G.set(z,x1,m);}}else if(Array.isArray(m)){for(var n in m){var y1=a.getKeyFromItem(m[n]);if(Array.isArray(v1.value)&&v1.value.length>0&&Q(v1.value,y1)){m[n].Selected=this._oResourceBundle.getText("EDITOR_ITEM_SELECTED");}else{m[n].Selected=this._oResourceBundle.getText("EDITOR_ITEM_UNSELECTED");}}}}o._values=m;var z1=a.getModel();z1.setData(m);z1.checkUpdate(true);z1.firePropertyChange();this._settingsModel.setProperty(o._settingspath+"/_loading",false);a._hideValueState(true,true);if(o.type==="object"||o.type==="object[]"){a.mergeValueWithRequestResult(m1);}}.bind(this)).catch(function(i){this._settingsModel.setProperty(o._settingspath+"/_loading",false);var s=this._oResourceBundle.getText("EDITOR_BAD_REQUEST");if(Array.isArray(i)&&i.length>0){s=i[0];var j=i[1];if(j){var k;if(j.responseJSON){k=j.responseJSON.error;}else if(j.responseText){if(U.isJson(j.responseText)){k=JSON.parse(j.responseText).error;}else{s=j.responseText;}}if(k){s=(k.code||k.errorCode||j.status)+": "+k.message;}}}else if(typeof(i)==="string"){s=i;}var l=a.getModel();l.firePropertyChange();if(o.type==="object"||o.type==="object[]"){a.mergeValueWithRequestResult();}a._showValueState("error",s,true);}.bind(this));};l1.prototype._requestExtensionData=function(){var e=this.getAggregation("_extension");if(!e){v.info("Extension is not defined or created, do not load data of it.");return new Promise(function(k,l){k();});}var b=false;var o={};var a=this._oEditorManifest.get(this.getConfigurationPath()+"/data/extension");var s;if(a){b=true;s=this._oEditorManifest.get(this.getConfigurationPath()+"/data/path");o={"extension":a};if(s){o.path=s;}}else{a=this._oEditorManifest.get("/"+this.getSection()+"/data/extension");if(a){b=true;s=this._oEditorManifest.get("/"+this.getSection()+"/data/path");o={"extension":a};if(s){o.path=s;}}}if(!b){v.info("Extension data is not defined in manifest, do not load data of it.");return new Promise(function(k,l){k();});}var i=this._oDataProviderFactory.create(o);var j=i.getData();return j.then(function(k){var l=e.getModel();if(!l){l=new J(k||{});e.setModel(l,undefined);}else{l.setData(k);}l.checkUpdate(true);}).catch(function(k){var l=this._oResourceBundle.getText("EDITOR_BAD_REQUEST");if(Array.isArray(k)&&k.length>0){l=k[0];var m=k[1];if(m){var n;if(m.responseJSON){n=m.responseJSON.error;}else if(m.responseText){if(U.isJson(m.responseText)){n=JSON.parse(m.responseText).error;}else{l=m.responseText;}}if(n){l=(n.code||n.errorCode||m.status)+": "+n.message;}}}else if(typeof(k)==="string"){l=k;}v.error("Request extension data failed, "+l);}.bind(this));};l1.prototype._addValueListModel=function(o,a,n){if(o.values){var b;if(o.values.data){if(this._oDataProviderFactory){b=a.getModel();if(!b){b=new J({});a.setModel(b,undefined);}this._settingsModel.setProperty(o._settingspath+"/_loading",true);if(!n){this._requestData(o,a);}else{setTimeout(function(){this._requestData(o,a);}.bind(this),n);}}a.bindObject({path:o.values.data.path||"/"});}else if(this.getAggregation("_extension")){b=this.getAggregation("_extension").getModel();if(b&&this.getMode()==="content"&&o.pageAdminValues&&o.pageAdminValues.length>0){this.prepareFieldsInKey(o);var e=o.values.path;if(e.length>1){e=e.substring(1);}var i=G.get([e],b.getData()),k=o.pageAdminValues,l=[];for(var m=0;m<k.length;m++){for(var j=0;j<i.length;j++){var s=this.getKeyFromItem(i[j]);if(k[m]===s){l.push(i[j]);}}}delete i[e];G.set(e,l,i);b.setData(i);}a.bindObject({path:o.values.path||"/"});a.setModel(b,undefined);}}};l1.prototype._addMetadataModel=function(o,a){if(o.values&&o.values.metadata){var b={"synchronizationMode":"None"};b=g(b,o.values.metadata.request);var e={url:b.serviceUrl};var i=Promise.resolve(e);if(this._oDestinations){i=this._oDestinations.process(e);}i.then(function(j){if(!j.url.endsWith("/")){j.url=j.url+"/";}b.serviceUrl=j.url;var m=new O(b);m.oMetaModel.fetchData().then(function(k){a.setModel(new J(k),"meta");});});}};l1.prototype._createDependentFields=function(o,a){if(o.values){var s=JSON.stringify(o.values.data);if(s){var b=/parameters\.([^\}\}]+)|destinations\.([^\}\}]+)|\{items\>[\/?\w+]+\}/g,e=s.match(b);if(e){for(var i=0;i<e.length;i++){var j="/value";var k=this.getConfigurationPath();if(e[i].indexOf("destinations.")===0||e[i].indexOf("parameters.")===0){if(e[i].indexOf("destinations.")===0){j="/name";}k=k+"/"+e[i].replace(".","/")+j;}else if(e[i].indexOf("{items>")===0){k=k+"/parameters/"+e[i].slice(7,-1);}var l=this._mItemsByPaths[k];if(l){if(l._settingspath===o._settingspath){o=g({},o);}l._dependentFields=l._dependentFields||[];l._dependentFields.push({field:a,config:o});}}}}}};l1.prototype.getBeforeLayerChange=function(m){if(!this._beforeLayerManifestChanges){this._beforeLayerManifestChanges={};}return this._beforeLayerManifestChanges[m];};l1.prototype.getTranslationValueInTexts=function(l,m){var s="/texts/"+l;var o=this._settingsModel.getProperty(s)||{};return o[m];};l1.prototype.deleteAllTranslationValuesInTexts=function(m){var a=this;var o=a._settingsModel.getData();if(!o||!o.texts){return;}var s="/texts";var b=d(o.texts,500);for(var n in b){if(b[n][m]){delete b[n][m];}}this._settingsModel.setProperty(s,b);};l1.prototype._handleITBValidation=function(e,i,s){var j1=e._oResourceBundle;if(i.getItems().length>0&&i._oExpandButton){var a=i._oExpandButton;var b=null;if(s==="Error"){b=j1.getText("EDITOR_GROUP_ERRORS");a.setIcon("sap-icon://message-error");a.addStyleClass("errorBTNImage");}else if(s==="Warning"){b=j1.getText("EDITOR_GROUP_WARNINGS");a.setIcon("sap-icon://message-warning");a.addStyleClass("warningBTNImage");}a.setTooltip(null);a.addEventDelegate({onAfterRendering:function(o){var k=document.getElementById(a.getId());k.setAttribute("aria-label","With validation errors");k.setAttribute("title","");}});a.setEnabled(false);a.addStyleClass("errorBTN").addStyleClass("errorBTNDisabled");var j=a.getParent().getParent().getParent();var m=c.byId(j.getId()+"_strip");a.addEventDelegate({onmouseover:function(){m.setVisible(true);m.setType(s);m.setText(b);},onmouseout:function(){m.setVisible(false);}},e);}};l1.prototype._delayHandleITBValidation=function(e,i,s){var a=setInterval(function(){if(i._oExpandButton){e._handleITBValidation(e,i,s);clearInterval(a);}},50);};l1.prototype._addItem=function(o){var m=this.getMode(),a=this;if(this.getAllowDynamicValues()===false||!o.allowDynamicValues){o.allowDynamicValues=false;}if(this.getAllowSettings()===false){o.allowSettings=false;}o.__cols=o.cols||2;if(o.visible===false||(!o.translatable&&m==="translation"&&o.type!=="group")){return;}if(o.type==="group"){o.expanded=o.expanded!==false;if(o.visualization&&o.visualization.type==="Tab"){var b=new c1({expandable:o.expandable!==false,visible:o.visible,expanded:"{currentSettings>expanded}",objectBindings:{currentSettings:{path:"currentSettings>"+o._settingspath},items:{path:"items>/form/items"},context:{path:"context>/"}},select:function(v1){var w1=v1.getSource(),x1=w1.getSelectedKey(),y1=w1.getItems(),z1=w1.getExpanded(),A1=false;for(var n=0;n<y1.length;n++){if(!z1){A1=true;}else if(y1[n].getId()!==x1){A1=true;}else if(y1[n].getId()===x1){A1=false;}if(A1){var B1=false,C1="None";if(y1[n]._subItems&&y1[n]._subItems.length>0){var D1=y1[n].getModel("currentSettings");for(var i=0;i<y1[n]._subItems.length;i++){var E1=y1[n]._subItems[i].settingspath;var F1=c.byId(y1[n]._subItems[i].itemId);if(D1.getProperty(E1+"/hasError")===true&&F1.getVisible()){B1=true;var G1=D1.getProperty(E1+"/errorType");if(G1==="Error"){C1="Error";break;}else if(G1==="Warning"&&C1!=="Error"){C1="Warning";}}}D1.setProperty("hasError",B1,w1.getBindingContext("currentSettings"));D1.setProperty("errorType",C1,w1.getBindingContext("currentSettings"));}if(B1){var H1=new d1(),I1=y1[n];if(I1.getItems().length>0){I1.removeAllItems();}I1.addItem(H1);a._handleITBValidation(a,I1,C1);if(I1._oExpandButton===undefined){a._delayHandleITBValidation(a,I1,C1);}else{a._handleITBValidation(a,I1,C1);}}}else if(y1[n].getItems().length>0){y1[n].removeItem(y1[n].getItems()[0]);if(y1[n]._oExpandButton){y1[n]._oExpandButton.visible=false;}var J1=w1.getParent().getParent().getAggregation("_messageStrip");if(J1===null){J1=c.byId(k1);}y1[n].addContent(J1);}}}});var e=new d1({text:o.label,visible:o.visible,objectBindings:{currentSettings:{path:"currentSettings>"+o._settingspath},items:{path:"items>/form/items"},context:{path:"context>/"}}});b.addItem(e);b.setBackgroundDesign("Transparent");b.setHeaderBackgroundDesign("Transparent");b.addStyleClass("sapUiIntegrationEditorSubGroup");if(m!=="translation"){var j=new N({id:b.getId()+"_strip",showIcon:false,visible:false});j.addStyleClass("sapUiIntegrationEditorTabMessageStrip");b._messageStrip=j;}this.addAggregation("_formContent",b);e._level=o.level||0;if(o.hint){this._addHint(o.hint);}return;}else{var k=new P({headerText:o.label,visible:o.visible,expandable:o.expandable!==false,expanded:"{currentSettings>expanded}",width:"auto",backgroundDesign:"Transparent",objectBindings:{currentSettings:{path:"currentSettings>"+o._settingspath},items:{path:"items>/form/items"},context:{path:"context>/"}},expand:function(n){var v1=n.getSource();var w1=n.getParameter("expand");var x1=v1._level==="1"?v1.getParent().getParent().getAggregation("_messageStrip"):v1.getParent().getAggregation("_messageStrip");if(x1===null){x1=c.byId(k1);}if(!w1&&v1._level==="1"){v1.getParent().addContent(x1);v1.getParent().focus();}else{v1.addContent(x1);v1.focus();}if(!w1&&v1._subItems&&v1._subItems.length>0){var y1=v1.getModel("currentSettings");var z1=false;var A1="None";for(var i=0;i<v1._subItems.length;i++){var B1=v1._subItems[i].settingspath;var C1=c.byId(v1._subItems[i].itemId);if(y1.getProperty(B1+"/hasError")===true&&C1.getVisible()){z1=true;var D1=y1.getProperty(B1+"/errorType");if(D1==="Error"){A1="Error";break;}else if(D1==="Warning"&&A1!=="Error"){A1="Warning";}}}y1.setProperty("hasError",z1,v1.getBindingContext("currentSettings"));y1.setProperty("errorType",A1,v1.getBindingContext("currentSettings"));}}});if(m!=="translation"){var j1=this._oResourceBundle;var l=new N({showIcon:false,visible:"{= !${currentSettings>expanded} && ${currentSettings>hasError} === true}",text:{path:'currentSettings>errorType',formatter:function(i){var n="";switch(i){case"Error":n=j1.getText("EDITOR_GROUP_ERRORS");break;case"Warning":n=j1.getText("EDITOR_GROUP_WARNINGS");break;default:}return n;}},type:"{currentSettings>errorType}",objectBindings:{currentSettings:{path:"currentSettings>"+o._settingspath}}});if(o.level!=="1"){l.setModel(this._settingsModel,"currentSettings");}l.addStyleClass("sapUiIntegrationEditorPanelMessageStrip");k._messageStrip=l;}this.addAggregation("_formContent",k);k._cols=o.cols||2;k._level=o.level||0;if(o.hint){this._addHint(o.hint);}var s={onAfterRendering:function(i){var n=document.getElementById(k.getId());n.setAttribute("aria-label",o.label);var v1=i.srcControl;var w1=v1._messageStrip;if(v1._level!=="1"&&w1){w1.rerender();}}};k.addEventDelegate(s);return;}}if(o.type==="separator"){var z=new S();this.addAggregation("_formContent",z);return;}var m1=null;var n1=c.getConfiguration().getLanguage().replaceAll('_','-');if(m==="translation"){if(o.type!=="string"){return;}if((typeof o.value==="string"&&o.value.indexOf("{")===0)||typeof o.values!=="undefined"){return;}o._language={value:o.value};o.cols=1;delete o.values;var o1=d(o,500);o1._settingspath+="/_language";o1.editable=false;o1.required=false;if(!l1._languages[n1]&&n1.indexOf("-")>-1){n1=n1.substring(0,n1.indexOf("-"));}if(l1._languages[n1]){var p1=this.getTranslationValueInTexts(n1,o.manifestpath);if(p1){o1.value=p1;}}if(!o1.value){o1.value="-";}var q1=this._createLabel(o1);this.addAggregation("_formContent",q1);var r1=this._createField(o1);r1.isOrigLangField=true;this.addAggregation("_formContent",r1);o.editable=o.visible=o.translatable;n1=this._language;if(!this.getBeforeLayerChange(o.manifestpath)){o.value=o._translatedValue||"";}var p1=this.getTranslationValueInTexts(n1,o.manifestpath);if(p1){o.value=p1;}o.label=o._translatedLabel||"";o.required=false;var s1=this._createField(o);this.addAggregation("_formContent",s1);}else{m1=this._createLabel(o);this.addAggregation("_formContent",m1);var t1=this.getBeforeLayerChange(o.manifestpath);if(t1){o._beforeLayerChange=t1;}if(this._currentLayerManifestChanges&&this._currentLayerManifestChanges[o.manifestpath]){o.value=this._currentLayerManifestChanges[o.manifestpath];o._beforeLayerChange=o.value;}if(o.type==="string"){n1=this._language;var p1=this.getTranslationValueInTexts(n1,o.manifestpath);if(p1){o.value=p1;}}var u1=this._createField(o);this.addAggregation("_formContent",u1);}if(o.hint&&(!o.cols||o.cols===2)){this._addHint(o.hint);}o.cols=o.__cols;delete o.__cols;};l1.prototype._createHint=function(s){s=s.replace(/<a href/g,"<a target='blank' href");var o=new K({htmlText:s});return o;};l1.prototype._addHint=function(s){var o=this._createHint(s);this.addAggregation("_formContent",o);};l1.prototype._getCurrentLanguageSpecificText=function(k){var l=this._language;if(this._oTranslationBundle){var s=this._oTranslationBundle.getText(k,[],true);if(s===undefined){return"";}return s;}if(!l){return"";}var i=this._oEditorManifest.get("/sap.app/i18n");if(!i){return"";}if(typeof i==="string"){var a=[l];if(l.indexOf("-")>-1){a.push(l.substring(0,l.indexOf("-")));}if(!Q(a,"en")){a.push("en");}this._oTranslationBundle=x.create({url:this.getBaseUrl()+i,async:false,locale:l,supportedLocales:a,fallbackLocale:"en"});return this._getCurrentLanguageSpecificText(k);}};l1.prototype._startEditor=function(){var o=this.getAggregation("_formContent");if(o&&o.length>0){this.destroyAggregation("_formContent");}var s=this._settingsModel.getData();var i;if(s.form&&s.form.items){i=s.form.items;var a=false;for(var m in i){var b=i[m];if(b.type==="group"&&b.level!=="1"){break;}else if(b.visible){a=true;break;}}if(a){i=g({generalPanel:{type:"group",translatable:true,expanded:true,label:this._oResourceBundle.getText("EDITOR_PARAMETERS_GENERALSETTINGS"),_settingspath:"/form/items/generalPanel"}},i);s.form.items=i;this._settingsModel.setData(s);}}var e=this._settingsModel.getProperty("/");this._mItemsByPaths={};if(e.form&&e.form.items){i=e.form.items;var l=this._language||this.getLanguage()||c.getConfiguration().getLanguage().replaceAll('_','-');if(this.getMode()==="translation"){this._addItem({type:"group",translatable:true,expandable:false,expanded:true,label:this._oResourceBundle.getText("EDITOR_ORIGINALLANG")+": "+l1._languages[l]});}for(var n in i){var b=i[n];if(b){b.label=b.label||n;var j;if(b.manifestpath){this._mItemsByPaths[b.manifestpath]=b;if(this.getMode()!=="translation"){j=this._currentLayerManifestChanges[b.manifestpath];}}b._changed=j!==undefined&&this.getMode()!=="translation";if(b.values){b.translatable=false;}b._beforeValue=this._getManifestBeforelValue(b.manifestpath);if(b.type==="string"){b._translatedDefaultPlaceholder=this._getManifestDefaultValue(b.manifestpath);var k=null,z=b._translatedDefaultPlaceholder;if(z){if(this._isValueWithParameterSyntax(z)){b.translatable=false;}if(this._isValueWithHandlebarsTranslation(z)){k=z.substring(2,z.length-2);}else if(z.startsWith("{i18n>")){k=z.substring(6,z.length-1);}if(k){b.translatable=true;}else if(b.translatable&&this.getMode()==="translation"&&!this.getBeforeLayerChange(b.manifestpath)){b._translatedValue=b._translatedDefaultPlaceholder;b.value=b._translatedValue;}}b._translatedPlaceholder=b._beforeValue;z=b._translatedPlaceholder;if(z){if(this._isValueWithParameterSyntax(z)){b.translatable=false;}if(this._isValueWithHandlebarsTranslation(z)){k=z.substring(2,z.length-2);}else if(z.startsWith("{i18n>")){k=z.substring(6,z.length-1);}}if(b.value&&(b.value.indexOf("{context>")===0||b.value.indexOf("{{parameters")===0)){this.deleteAllTranslationValuesInTexts(b.manifestpath);k=null;}var m1=this.getTranslationValueInTexts(l,b.manifestpath);if(k){b._translatedValue=this.getModel("i18n").getResourceBundle().getText(k);if(b._changed){b.value=j;}else if(b.value===b._translatedDefaultPlaceholder){b.value=b._translatedValue;}if(this.getMode()==="translation"){var n1=this._getCurrentLanguageSpecificText(k);if(n1!==""){b._translatedValue=n1;}}else if(m1){b.value=m1;}}else if(this.getMode()!=="translation"&&b.translatable&&m1){b.value=m1;}if(this.getMode()==="translation"){if(this._isValueWithHandlebarsTranslation(b.label)){b._translatedLabel=this._getCurrentLanguageSpecificText(b.label.substring(2,b.label.length-2),true);}else if(b.label&&b.label.startsWith("{i18n>")){b._translatedLabel=this._getCurrentLanguageSpecificText(b.label.substring(6,b.label.length-1),true);}}}else if(b.type==="string[]"){var o1=b.manifestpath.substring(0,b.manifestpath.lastIndexOf("/"))+"/valueItems";var p1=this._manifestModel.getProperty(o1);if(p1){b.valueItems=p1;}var q1=b.manifestpath.substring(0,b.manifestpath.lastIndexOf("/"))+"/valueTokens";var r1=this._manifestModel.getProperty(q1);if(r1){b.valueTokens=r1;}}else if(typeof b.value==="object"&&b.type==="object"){if(typeof b.value._editable==="boolean"){b.value._dt={"_editable":b.value._editable};delete b.value._editable;}}else if(Array.isArray(b.value)&&b.value.length>0&&b.type==="object[]"){b.value.forEach(function(v1){if(typeof v1._editable==="boolean"){v1._dt={"_editable":v1._editable};delete v1._editable;}});}if(b.label&&this._isValueWithHandlebarsTranslation(b.label)){var s1=b.label.substring(2,b.label.length-2);if(s1){b.label=this.getModel("i18n").getResourceBundle().getText(s1);}}}}}for(var n in i){var b=i[n];this._addItem(b);}var t1=this._settingsModel.getProperty("/form/height")!==undefined?this._settingsModel.getProperty("/form/height"):"350px",u1=this._settingsModel.getProperty("/form/width")!==undefined?this._settingsModel.getProperty("/form/width"):"100%";if(this.getProperty("height")===""){this.setProperty("height",t1);document.body.style.setProperty("--sapUiIntegrationEditorFormHeight",t1);}if(this.getProperty("width")===""){this.setProperty("width",u1);document.body.style.setProperty("--sapUiIntegrationEditorFormWidth",u1);}if(this.getMode()!=="translation"){Promise.resolve(this._initPreview()).then(function(){Promise.all(this._aFieldReadyPromise).then(function(){this._ready=true;this.fireReady();}.bind(this));}.bind(this));}else{Promise.all(this._aFieldReadyPromise).then(function(){this._ready=true;this.fireReady();}.bind(this));}};l1.prototype.setHeight=function(s){if(s){this.setProperty("height",s);document.body.style.setProperty("--sapUiIntegrationEditorFormHeight",s);}};l1.prototype.setWidth=function(s){if(s){this.setProperty("width",s);document.body.style.setProperty("--sapUiIntegrationEditorFormWidth",s);}};l1.prototype.destroy=function(){if(this._oPopover){this._oPopover.destroy();}if(this._oDesigntimeInstance){this._oDesigntimeInstance.destroy();}var o=this.getAggregation("_preview");if(o&&o.destroy){o.destroy();}var m=c.byId(k1);if(m){m.destroy();}this._manifestModel=null;this._beforeManifestModel=null;this._oInitialManifestModel=null;this._settingsModel=null;C.prototype.destroy.apply(this,arguments);};l1.prototype._initPreview=function(){return new Promise(function(a,b){a();});};l1.prototype._applyDesigntimeDefaults=function(s){s=s||{};s.form=s.form||{};s.form.items=s.form.items||{};var i=s.form.items||s.form.items;for(var n in i){var o=i[n];if(o.manifestpath){o.value=this._manifestModel.getProperty(o.manifestpath);}if(o.visible===undefined||o.visible===null){o.visible=true;}if(o.editable===undefined||o.editable===null){o.editable=true;}if(this.getMode()!=="admin"){if(o.visibleToUser!==undefined){o.visible=o.visibleToUser;}if(o.editableToUser!==undefined){o.editable=o.editableToUser;}}if(typeof o.translatable!=="boolean"){o.translatable=false;}if(!o.label){o.label=n;}if(!o.type||o.type==="enum"){o.type="string";}if(o.value===undefined||o.value===null){switch(o.type){case"boolean":o.value=false;break;case"integer":case"number":o.value=0;break;case"string[]":o.value=[];break;case"object":o.value=undefined;break;case"object[]":o.value=undefined;break;default:o.value="";}}if(o.type==="group"){if(o.visible===undefined||o.value===null){o.visible=true;}}o._settingspath="/form/items/"+n;}};l1.prototype._applyDesigntimeLayers=function(s){var o={};var a={};if(this._appliedLayerManifestChanges&&Array.isArray(this._appliedLayerManifestChanges)){for(var i=0;i<this._appliedLayerManifestChanges.length;i++){var b=this._appliedLayerManifestChanges[i][":designtime"];if(b){var k=Object.keys(b);for(var j=0;j<k.length;j++){var e=b[k[j]];if(typeof e==="object"){a[k[j]]=g(a[k[j]],e);continue;}this._settingsModel.setProperty(k[j],e);}}var l=this._appliedLayerManifestChanges[i]["texts"];if(l){o=g(o,l);}}}if(this._currentLayerManifestChanges){var b=this._currentLayerManifestChanges[":designtime"];if(b){var k=Object.keys(b);for(var j=0;j<k.length;j++){var m=k[j],e=b[m];n=m.substring(0,m.lastIndexOf("/")+1)+"_next";if(typeof e==="object"){a[m]=g(a[m],e);continue;}if(!this._settingsModel.getProperty(n)){this._settingsModel.setProperty(n,{});}var n=m.substring(0,m.lastIndexOf("/")+1)+"_next",z=m.substring(m.lastIndexOf("/")+1);this._settingsModel.setProperty(n+"/"+z,e);}}var m1=this._currentLayerManifestChanges["texts"];if(m1){o=g(o,m1);}}if(!f(o,{})){this._settingsModel.setProperty("/texts",o);}if(!f(a,{})){this._settingsModel.setProperty("/:designtime",a);}};l1.prototype._createParameterDesigntime=function(o){var s={},b=this.getConfigurationPath()+"/parameters",m=this.getMode();if(o&&o.parameters){s.form=s.form||{};s.form.items=s.form.items||{};var i=s.form.items;Object.keys(o.parameters).forEach(function(n){i[n]=g({manifestpath:b+"/"+n+"/value",editable:(m!=="translation"),_settingspath:"/form/items/"+n},o.parameters[n]);var a=i[n];if(!a.type){a.type="string";}if(!a.hasOwnProperty("visible")){a.visible=true;}});}return new D(s);};l1.prototype._addDestinationSettings=function(o){var s=this._oDesigntimeInstance.getSettings(),i=this.getConfigurationPath()+"/destinations";s.form=s.form||{};s.form.items=s.form.items||{};if(s&&o&&o.destinations){if(!s.form.items["destination.group"]){s.form.items["destination.group"]={label:this._oResourceBundle.getText("EDITOR_DESTINATIONS")||"Destinations",type:"group",expanded:true,visible:true,_settingspath:"/form/items/destination.group"};}var j=s.form.items,k=this.getHostInstance();Object.keys(o.destinations).forEach(function(n){j[n+".destinaton"]=g({manifestpath:i+"/"+n+"/name",visible:true,type:"destination",editable:true,allowDynamicValues:false,allowSettings:false,value:o.destinations[n].name,defaultValue:o.destinations[n].defaultUrl,_settingspath:"/form/items/"+[n+".destinaton"],_values:[],_destinationName:n},o.destinations[n]);if(typeof j[n+".destinaton"].label==="undefined"){j[n+".destinaton"].label=n;}if(k){j[n+".destinaton"]._loading=true;}});var l=false;if(k){this.getHostInstance().getDestinations().then(function(a){l=true;Object.keys(o.destinations).forEach(function(n){j[n+".destinaton"]._values=a;j[n+".destinaton"]._loading=false;this._settingsModel.checkUpdate(true);}.bind(this));}.bind(this)).catch(function(){return this.getHostInstance().getDestinations();}.bind(this)).then(function(b){if(l){return;}Object.keys(o.destinations).forEach(function(n){j[n+".destinaton"]._values=b;j[n+".destinaton"]._loading=false;this._settingsModel.checkUpdate(true);}.bind(this));}.bind(this)).catch(function(e){Object.keys(o.destinations).forEach(function(n){j[n+".destinaton"]._loading=false;this._settingsModel.checkUpdate(true);}.bind(this));v.error("Can not get destinations list from '"+k.getId()+"'.");}.bind(this));}}};l1.prototype._getManifestDefaultValue=function(s){return this._oInitialManifestModel.getProperty(s);};l1.prototype._getManifestBeforelValue=function(s){return this._beforeManifestModel.getProperty(s);};l1.prototype._isValueWithHandlebarsTranslation=function(a){if(typeof a==="string"){return!!a.match(g1);}return false;};l1.prototype._isValueWithParameterSyntax=function(a){if(typeof a==="string"){return!!a.match(h1);}return false;};l1.prototype.prepareFieldsInKey=function(o){this._sKeySeparator=o.values.keySeparator;if(!this._sKeySeparator){this._sKeySeparator="#";}var k=o.values.item.key;this._aFields=k.split(this._sKeySeparator);for(var n in this._aFields){if(this._aFields[n].startsWith("{")){this._aFields[n]=this._aFields[n].substring(1);}if(this._aFields[n].endsWith("}")){this._aFields[n]=this._aFields[n].substring(0,this._aFields[n].length-1);}}};l1.prototype.getKeyFromItem=function(i){var s="";this._aFields.forEach(function(a){s+=i[a].toString()+this._sKeySeparator;}.bind(this));if(s.endsWith(this._sKeySeparator)){s=s.substring(0,s.length-this._sKeySeparator.length);}return s;};l1._contextEntries={empty:{label:j1.getText("EDITOR_CONTEXT_EMPTY_VAL"),type:"string",description:j1.getText("EDITOR_CONTEXT_EMPTY_DESC"),placeholder:"",value:""},"editor.internal":{label:j1.getText("EDITOR_CONTEXT_EDITOR_INTERNAL_VAL"),todayIso:{type:"string",label:j1.getText("EDITOR_CONTEXT_EDITOR_TODAY_VAL"),description:j1.getText("EDITOR_CONTEXT_EDITOR_TODAY_DESC"),tags:[],placeholder:j1.getText("EDITOR_CONTEXT_EDITOR_TODAY_VAL"),customize:["format.dataTime"],value:"{{parameters.TODAY_ISO}}"},nowIso:{type:"string",label:j1.getText("EDITOR_CONTEXT_EDITOR_NOW_VAL"),description:j1.getText("EDITOR_CONTEXT_EDITOR_NOW_DESC"),tags:[],placeholder:j1.getText("EDITOR_CONTEXT_EDITOR_NOW_VAL"),customize:["dateFormatters"],value:"{{parameters.NOW_ISO}}"},currentLanguage:{type:"string",label:j1.getText("EDITOR_CONTEXT_EDITOR_LANG_VAL"),description:j1.getText("EDITOR_CONTEXT_EDITOR_LANG_VAL"),tags:["technical"],customize:["languageFormatters"],placeholder:j1.getText("EDITOR_CONTEXT_EDITOR_LANG_VAL"),value:"{{parameters.LOCALE}}"}}};l1._languages={};l1._appendThemeVars=function(){var a=["sapUiButtonHoverBackground","sapUiBaseBG","sapUiContentLabelColor","sapUiTileSeparatorColor","sapUiHighlight","sapUiListSelectionBackgroundColor","sapUiNegativeText","sapUiCriticalText","sapUiPositiveText","sapUiChartScrollbarBorderColor"];var m=F.get({name:a,callback:function(b){}});if(m){for(var n in m){document.body.style.setProperty("--"+n,m[n]);}}};l1.init=function(){this.init=function(){};l1._appendThemeVars();c.attachThemeChanged(function(){l1._appendThemeVars();});var s=sap.ui.require.toUrl("sap.ui.integration.editor.css.Editor".replace(/\./g,"/")+".css");A(s);B.loadResource("sap/ui/integration/editor/languages.json",{dataType:"json",failOnError:false,async:true}).then(function(o){l1._languages=o;});};l1.init();return l1;});
