/*!
 * OpenUI5
 * (c) Copyright 2009-2022 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/integration/editor/fields/BaseField","sap/m/Text","sap/m/TextArea","sap/m/Input","sap/m/NavContainer","sap/m/Page","sap/m/Popover","sap/m/OverflowToolbar","sap/m/ToolbarSpacer","sap/m/Button","sap/ui/model/json/JSONModel","sap/ui/table/Table","sap/ui/table/Column","sap/m/Label","sap/m/VBox","sap/ui/model/Filter","sap/ui/model/FilterOperator","sap/base/util/deepEqual","sap/ui/core/Icon","sap/m/Switch","sap/m/CheckBox","sap/m/MessageBox","sap/m/MessageToast","sap/base/util/deepClone","sap/m/Link","sap/ui/layout/form/SimpleForm","sap/base/util/merge","sap/m/List","sap/m/CustomListItem","sap/ui/model/Sorter","sap/ui/core/CustomData","sap/ui/integration/editor/EditorResourceBundles","sap/base/util/includes","sap/ui/integration/util/Utils"],function(B,T,a,I,N,P,b,O,c,d,J,f,C,L,V,F,g,h,j,S,k,M,l,o,q,r,t,u,v,w,x,E,y,U){"use strict";var R=/\{\{(?!parameters.)(?!destinations.)([^\}\}]+)\}\}/g;var z=B.extend("sap.ui.integration.editor.fields.ObjectField",{metadata:{library:"sap.ui.integration"},renderer:B.getMetadata().getRenderer()});z.prototype.initVisualization=function(e){var i=this;i._newObjectTemplate={"_dt":{"_selected":true,"_uuid":""}};var m=e.visualization;if(!m){if(e.value&&!e.properties&&(!e.values||(e.values&&!e.values.metadata))){i.parseValueProperties();}if(e.values){m=i.createTableVisualization(e);}else if(e.properties){m=i.createSimpleFormVisualization(e);}else{m=i.createTextAreaVisualization(e);}e.withLabel=true;}this._visualization=m;this.attachAfterInit(this._afterInit);};z.prototype._afterInit=function(){var e=this;var i=this.getAggregation("_field");if(i instanceof r){i.addStyleClass("sapUiIntegrationEditorItemObjectFieldForm");var m=o(e.getConfiguration().value,500)||{};i.setModel(new J({value:m,editMode:"Properties"}));}else if(i instanceof f){i.addStyleClass("sapUiIntegrationEditorItemObjectFieldTable");}};z.prototype.parseValueProperties=function(){var e=this;var i=e.getConfiguration();if(typeof i.value==="object"&&!h(i.value,{})&&!Array.isArray(i.value)&&!i.properties){var p={};for(var n in i.value){if(n!=="_dt"){var s=typeof i.value[n];var m=s==="string"?{}:{"type":s};p[n]=m;}}if(!h(p,{})){i.properties=p;i._propertiesParsedFromValue=true;}}};z.prototype.createTableVisualization=function(e){var i=this;var m=i.createTableToolbar(e);var n=[];var p=e.values?e.values.data.path||"/":"/value";if(e.values&&e.values.metadata){n={path:'meta>/'+e.values.metadata.namespace+'.'+e.values.metadata.entityTypeName,filters:new F({path:"$kind",operator:g.EQ,value1:"Property"}),factory:i.columnFactory.bind(i)};}else{n=i.buildTableColumns();}var s={type:f,settings:{rows:"{"+p+"}",visibleRowCount:5,busy:"{currentSettings>_loading}",columns:n,selectionBehavior:"RowOnly",rowSelectionChange:i.onTableSelectionChange.bind(i),toolbar:m,filter:i.onFilter.bind(i)}};return s;};z.prototype.createSimpleFormVisualization=function(e){var i=this;var m=i.getResourceBundle();var n=function(){var G=this.getAggregation("_field").getModel();G.checkUpdate(true);var H=G.getProperty("/value");if(!H._dt){H._dt={_uuid:U.generateUuidV4()};}else if(!H._dt._uuid){H._dt._uuid=U.generateUuidV4();}H=o(H,500);this.setValue(H);}.bind(i);var p=i.createFormContents(n,"/value/",false,i.openTranslationPopup);var s=new d({icon:{path:'/editMode',formatter:function(G){if(G==="Properties"){return"sap-icon://syntax";}else{return"sap-icon://form";}}},tooltip:{path:'/editMode',formatter:function(G){if(G==="Properties"){return m.getText("EDITOR_FIELD_OBJECT_FORM_EDITMODE_JSON");}else{return m.getText("EDITOR_FIELD_OBJECT_FORM_EDITMODE_PROPERTIES");}}},press:function(){var G=i.getAggregation("_field").getModel();var H=G.getProperty("/editMode");if(H==="Properties"){G.setProperty("/editMode","Json");}else{G.setProperty("/editMode","Properties");}}});var D=new d({icon:"sap-icon://delete",tooltip:m.getText("EDITOR_FIELD_OBJECT_DELETE"),visible:e.enabled,enabled:{path:'currentSettings>value',formatter:function(G){if(!G||G===""){return false;}return true;}},press:function(G){i.setValue(undefined);var H=i.getAggregation("_field").getModel();var K=H.getProperty("/value");if(K&&K._dt&&K._dt._uuid){i.deleteTranslationValueInTexts(undefined,K._dt._uuid);}H.setProperty("/value",{});H.checkUpdate(true);}});var A={type:r,settings:{layout:"ResponsiveGridLayout",visible:e.visible,labelSpanXL:2,labelSpanL:2,labelSpanM:2,labelSpanS:12,emptySpanXL:1,emptySpanL:1,emptySpanM:1,emptySpanS:0,columnsXL:1,columnsL:1,columnsM:1,toolbar:new O({content:[new c(),s,D]}).addStyleClass("sapMTB"),content:p}};return A;};z.prototype.createTextAreaVisualization=function(e){var i=this;var m={type:a,settings:{value:{path:'currentSettings>value',formatter:function(n){if(!n||n===""){return undefined;}n=JSON.stringify(n,null,"\t");if(typeof n==="object"&&!n.length){n=n.replace(/\"\$\$([a-zA-Z]*)\$\$\"/g,function(s){return s.substring(3,s.length-3);});}return n;}},editable:"{config/editable}",width:"100%",enabled:"{config/enabled}",placeholder:"{config/placeholder}",visible:e.visible,change:this.onChangeOfTextArea.bind(i),rows:7}};return m;};z.prototype.buildSelectionColumnLables=function(){var e=this;var i=e.getConfiguration();var m=e.getResourceBundle();return new d({icon:"sap-icon://clear-all",type:"Transparent",enabled:typeof i.values==="undefined"?false:"{/_hasSelected}",tooltip:m.getText("EDITOR_FIELD_OBJECT_TABLE_COLUMN_SELECTION_TOOLTIP_REMOVE"),press:e.onUnSelectAll.bind(e)});};z.prototype.buildTableColumns=function(){var e=this;var i=e.getConfiguration();var m=[];var K=Object.keys(i.properties);if(K.length>0){var p=e.getResourceBundle();var s=e.buildSelectionColumnLables();var A=new C({width:"3.2rem",hAlign:"Center",multiLabels:[s],template:new k({selected:"{_dt/_selected}",enabled:typeof i.values==="undefined"?false:true,tooltip:{path:'_dt/_selected',formatter:function(c1){if(c1){if(i.type==="object"){return p.getText("EDITOR_FIELD_OBJECT_TABLE_COLUMN_SELECTION_CELL_TOOLTIP_UNSELECT");}else{return p.getText("EDITOR_FIELD_OBJECT_LIST_TABLE_COLUMN_SELECTION_CELL_TOOLTIP_REMOVE");}}else if(i.type==="object"){return p.getText("EDITOR_FIELD_OBJECT_TABLE_COLUMN_SELECTION_CELL_TOOLTIP_SELECT");}else{return p.getText("EDITOR_FIELD_OBJECT_LIST_TABLE_COLUMN_SELECTION_CELL_TOOLTIP_ADD");}}},select:e.onSelectionChange.bind(e)})});m.push(A);for(var n in i.properties){var D=i.properties[n];var G=D.label||n;var H="{"+n+"}";if(D.defaultValue){e._newObjectTemplate[n]=D.defaultValue;}var Q={"width":"7rem","label":G};if(D.column){Q=t(Q,D.column);}if(Q.label.match(R)){Q.label="{i18n>"+Q.label.substring(2,Q.label.length-1);}Q.tooltip=Q.label;var W=D.cell&&D.cell.type?D.cell.type:D.type||"Text";var X;var Y;var Z=o(D.cell)||{};delete Z.type;switch(W){case"int":case"number":Y={text:H,wrapping:false};Y=t(Y,Z);X=new T(Y);break;case"string":case"Text":Y={text:H,wrapping:false};Y=t(Y,Z);var $=Y.text;var _=new J({translatable:D.translatable||false,property:n});if(typeof $==="string"){var a1=e.getTranslationKey($);if(a1){Y.text=p.getText(a1);}else if($.startsWith('{')&&$.endsWith('}')){Y.text={path:$.substring(1,$.length-1),formatter:function(c1){var d1=this.getBindingContext(),e1,f1=this.getModel("settings").getData(),g1=e.getTranslationKey(c1);if(f1.translatable||g1){if(d1&&d1.getObject()&&d1.getObject()._dt){e1=e.getTranslationValueInTexts(p.sLocale.replaceAll('_','-'),d1.getObject()._dt._uuid,f1.property);if(e1){return e1;}}if(g1){c1=p.getText(g1);return c1;}}return c1;}};}}Y.tooltip=Z.tooltip||Y.text;X=new T(Y);X.setModel(_,"settings");break;case"Icon":Y={src:H};Y=t(Y,Z);X=new j(Y);break;case"boolean":Y={selected:H,enabled:false};Y=t(Y,Z);X=new k(Y);break;case"Switch":Y={state:H,enabled:false};Y=t(Y,Z);X=new S(Y);break;case"Link":Y={text:H,target:"_blank",href:H};Y=t(Y,Z);X=new q(Y);break;default:X=new T({text:H,wrapping:false});break;}Q.template=X;var b1=new C(Q);m.push(b1);}}return m;};z.prototype.checkHasFilterDefined=function(e){var H=true;if(e._propertiesParsedFromValue===true){H=false;}else{var p=JSON.stringify(e.properties,null,"\t");H=p.indexOf("filterProperty")>-1?true:false;}return H;};z.prototype.createTableToolbar=function(e){var i=this;var m=i.getResourceBundle();var H=i.checkHasFilterDefined(e);var A=e.enabled!==false;var s=e.addButtonText||m.getText("EDITOR_FIELD_OBJECT_TABLE_BUTTON_ADD_TOOLTIP");if(A&&e.values){A=e.values.allowAdd===true;}return new O({content:[new c(),new d({icon:"sap-icon://add",visible:A,tooltip:s,press:i.addNewObject.bind(i)}),new d({icon:"sap-icon://edit",tooltip:m.getText("EDITOR_FIELD_OBJECT_TABLE_BUTTON_EDIT_TOOLTIP"),enabled:"{= !!${/_hasTableSelected}}",press:i.onEditOrViewDetail.bind(i)}),new d({icon:"sap-icon://delete",tooltip:m.getText("EDITOR_FIELD_OBJECT_DELETE"),enabled:"{= !!${/_canDelete}}",press:i.onDelete.bind(i)}),new j({src:"sap-icon://vertical-grip"}),new d({icon:"sap-icon://clear-filter",visible:H,enabled:"{= !!${/_hasFilter}}",tooltip:m.getText("EDITOR_FIELD_OBJECT_TABLE_BUTTON_CLEAR_ALL_FILTERS_TOOLTIP"),press:i.clearAllFilters.bind(i)}),new d({icon:"sap-icon://multiselect-all",enabled:"{= !${/_hasTableAllSelected}}",tooltip:m.getText("EDITOR_FIELD_OBJECT_TABLE_BUTTON_SELECT_ALL_SELETIONS_TOOLTIP"),press:i.selectAllTableSelections.bind(i)}),new d({icon:"sap-icon://multiselect-none",enabled:"{= !!${/_hasTableSelected}}",tooltip:m.getText("EDITOR_FIELD_OBJECT_TABLE_BUTTON_CLEAR_ALL_SELETIONS_TOOLTIP"),press:i.clearAllTableSelections.bind(i)})]});};z.prototype.onUnSelectAll=function(e){var i=this;var m=i.getAggregation("_field");var p=m.getBindingContext().getPath();var n=m.getModel();var D=n.getProperty(p);D.forEach(function(s){s._dt=s._dt||{};s._dt._selected=false;});n.setProperty("/_hasSelected",false);n.checkUpdate(true);i.setValue(undefined);};z.prototype.onEditOrViewDetail=function(e){var i=this;var m=i.getAggregation("_field");var s=m.getSelectedIndex();var n=m.getBinding("rows").getContexts();var p=n[s].getObject();var A=m.getFirstVisibleRow();var D=m.getRows()[s-A];var G=D.getCells()[0];i.openObjectDetailsPopover(p,G,!p._dt||p._dt._editable!==false?"update":"view");};z.prototype.onFilter=function(e){var i=this;var m=i.getAggregation("_field");m.detachEvent("rowsUpdated",i.updateTable,i);m.attachEventOnce("rowsUpdated",i.updateTable,i);};z.prototype.updateTable=function(e){var i=this;i.updateSelectionColumn();i.updateToolbar();};z.prototype.updateSelectionColumn=function(){var e=this;var m=e.getAggregation("_field");var n=m.getBinding("rows").getContexts();var H=false;for(var i=0;i<n.length;i++){var p=n[i].getObject();if(p._dt&&p._dt._selected){H=true;break;}}m.getModel().setProperty("/_hasSelected",H);};z.prototype.updateToolbar=function(){var e=this;var m=e.getAggregation("_field");var n=m.getColumns();var H=false;for(var i=0;i<n.length;i++){var p=n[i].getMenu();var s=p.getItems();if(s.length>0){var A=s[0];var D=A.getValue();if(D&&D!==""){H=true;break;}}}m.getModel().setProperty("/_hasFilter",H);};z.prototype.columnFactory=function(i,e){var p=e.getPath();var n=p.substring(e.getPath().lastIndexOf("/")+1);var s=e.getProperty("$Type");var m=e.getProperty("$MaxLength");var A="7rem";m=m?parseInt(m):10;m=m<7?7:m;if(m>50){A="15rem";}else if(m>9){A="10rem";}return new C(i,{visible:true,filterProperty:s&&s.indexOf("String")>=0?n:null,width:A,label:new L({text:n}),hAlign:s&&s.indexOf("Decimal")>=0?"End":"Begin",template:new T({text:{path:n},wrapping:false})});};z.prototype.onTableSelectionChange=function(e){var i=this;var m=i.getAggregation("_field");var n=m.getModel();var s=m.getSelectedIndices();if(s.length>0){n.setProperty("/_hasTableSelected",true);}else{n.setProperty("/_hasTableSelected",false);n.setProperty("/_canDelete",false);return;}if(s.length===m.getBinding("rows").getContexts().length){n.setProperty("/_hasTableAllSelected",true);}else{n.setProperty("/_hasTableAllSelected",false);}var p=[];var A=m.getBinding("rows").getContexts();s.forEach(function(D){var G=A[D].getObject();if(G._dt&&G._dt._editable!==false){var H=A[D].getPath();p.push(H);}});if(p.length===0){n.setProperty("/_canDelete",false);}else{n.setProperty("/_canDelete",true);}};z.prototype.selectAllTableSelections=function(e){var i=this;var m=i.getAggregation("_field");m.selectAll();m.getModel().setProperty("/_hasTableAllSelected",true);};z.prototype.clearAllTableSelections=function(e){var i=this;var m=i.getAggregation("_field");var n=m.getModel();m.clearSelection();n.setProperty("/_hasTableSelected",false);n.setProperty("/_canDelete",false);n.setProperty("/_hasTableAllSelected",false);};z.prototype.onSelectionChange=function(e){var i=this;var m=e.getSource();var s=e.getParameter("selected");var n=i.getAggregation("_field");var p=n.getBindingContext().getPath();var A=n.getModel();if(s){var D=A.getProperty(p);D.forEach(function(K){K._dt=K._dt||{};K._dt._selected=false;});var G=m.getBindingContext().getObject();G._dt._selected=true;var H=o(G);A.setProperty("/_hasSelected",true);i.setValue(H);}else{A.setProperty("/_hasSelected",false);i.setValue(undefined);}};z.prototype.addNewObject=function(e){var i=this;var m=e.getSource();i._newObjectTemplate._dt._uuid=U.generateUuidV4();i.openObjectDetailsPopover(i._newObjectTemplate,m,"add");};z.prototype.mergeValueWithRequestResult=function(e){var i=this;var m=i.getConfiguration();var n=i.getAggregation("_field");var p=n.getModel();if(m.value&&(typeof m.value==="object")&&!h(m.value,{})){var s=o(m.value,500),A=n.getBinding("rows").getPath();if(Array.isArray(e)&&e.length>0){if(s._dt&&s._dt._editable===false){var D=s._dt._uuid||U.generateUuidV4();delete s._dt._uuid;e.forEach(function(G){if(h(G,s)){G._dt._selected=true;G._dt._uuid=D;}else{G._dt._uuid=U.generateUuidV4();}});}else{e.forEach(function(G){G._dt._uuid=U.generateUuidV4();});s._dt=s._dt||{};s._dt._selected=true;s._dt._uuid=s._dt._uuid||U.generateUuidV4();e.unshift(s);}}else{s._dt=s._dt||{};s._dt._selected=true;s._dt._uuid=s._dt._uuid||U.generateUuidV4();e=[s];}p.setProperty("/_hasSelected",true);p.setProperty(A,e);}else{if(Array.isArray(e)&&e.length>0){e.forEach(function(G){G._dt._uuid=U.generateUuidV4();});}p.setProperty("/_hasSelected",false);}p.checkUpdate();};z.prototype.onChangeOfTextArea=function(i){var m=this;var n=m.getResourceBundle();var p=i.getSource();var s=p.getValue();if(!s||s===""){m.saveValue(undefined,p);}else{try{var A=JSON.parse(s);if(A instanceof Array){p.setValueState("Error");p.setValueStateText(n.getText("EDITOR_VAL_NOT_A_SINGLE_JSONOBJECT"));return;}m.saveValue(A,p);}catch(e){p.setValueState("Error");p.setValueStateText(n.getText("EDITOR_VAL_NOT_A_JSONOBJECT"));}}};z.prototype.onChangeOfTextAreaInPopover=function(i){var m=this;var n=m.getResourceBundle();var p=i.getSource();var s=p.getValue();if(!s||s===""){m.saveValue(undefined,p,true);}else{try{var A=JSON.parse(s);if(A instanceof Array){p.setValueState("Error");p.setValueStateText(n.getText("EDITOR_VAL_NOT_A_SINGLE_JSONOBJECT"));return;}m.saveValue(A,p,true);}catch(e){p.setValueState("Error");p.setValueStateText(n.getText("EDITOR_VAL_NOT_A_JSONOBJECT"));}}};z.prototype.createFormContents=function(e,p,i,n){var m=this;var A=m.getConfiguration();var D=m.createPropertyContents(e,p,n);D.push(new L({visible:false}).addStyleClass("sapFormLabel"));D.push(new a({value:{path:p,formatter:function(G){if(!G||G===""){return undefined;}if(h(G,{})&&!i&&!m._getCurrentProperty("value")){return undefined;}G=JSON.stringify(G,null,"\t");if(typeof G==="object"&&!G.length){G=G.replace(/\"\$\$([a-zA-Z]*)\$\$\"/g,function(s){return s.substring(3,s.length-3);});}return G;}},editable:A.editable===false?false:"{= ${"+p+"_dt/_editable} !== false}",width:"100%",placeholder:"{config/placeholder}",visible:"{= ${/editMode} === 'Json'}",change:i===true?this.onChangeOfTextAreaInPopover.bind(m):this.onChangeOfTextArea.bind(m),rows:i===true?11:7}));return D;};z.prototype.createPropertyContents=function(e,p,i){var A=this;var D=A.getConfiguration();var G=[];if(!p){p="currentSettings>value/";}var H={};if(D.values&&D.values.metadata){var K=A.getModel("meta");var Q="/"+D.values.metadata.namespace+'.'+D.values.metadata.entityTypeName;var W=K.getProperty(Q);for(var m in W){var X=W[m];var Y=X['$Type'];if(X['$kind']==="Property"&&Y){if(Y.indexOf("Int")>=0){H[m]={type:"int"};}else if(Y.indexOf("Boolean")>=0){H[m]={type:"boolean"};}else if(Y.indexOf("Decimal")>=0){H[m]={type:"number"};}else{H[m]={type:"string"};}}}}if(h(H,{})){H=D.properties;}for(var n in H){var Z=H[n];var $=Z.label||n;if($.match(R)){var _=$.substring(2,$.length-2);$="{i18n>"+_+"}";}var a1=new L({text:$,visible:"{= ${/editMode} === 'Properties'}",required:Z.required||false});G.push(a1);var b1;var c1=o(Z,500);delete c1.type;delete c1.label;delete c1.translatable;delete c1.defaultValue;delete c1.formatter;delete c1.column;delete c1.cell;var d1;switch(Z.type){case"boolean":if(Z.cell&&Z.cell.type==="Switch"){d1={state:"{"+p+n+"}",visible:"{= ${/editMode} === 'Properties'}",enabled:D.editable===false?false:"{= ${"+p+"_dt/_editable} !== false}",change:e};if(Z.cell.customTextOn){d1.customTextOn=Z.cell.customTextOn;}if(Z.cell.customTextOff){d1.customTextOff=Z.cell.customTextOff;}d1=t(d1,c1);b1=new S(d1);}else{d1={selected:"{"+p+n+"}",visible:"{= ${/editMode} === 'Properties'}",enabled:D.editable===false?false:"{= ${"+p+"_dt/_editable} !== false}",select:e};d1=t(d1,c1);b1=new k(d1);}break;case"int":case"integer":d1={value:{path:p+n,type:"sap.ui.model.type.Integer",formatOptions:Z.formatter},visible:"{= ${/editMode} === 'Properties'}",editable:D.editable===false?false:"{= ${"+p+"_dt/_editable} !== false}",type:"Number",change:e};d1=t(d1,c1);b1=new I(d1);break;case"number":d1={value:{path:p+n,type:"sap.ui.model.type.Float",formatOptions:Z.formatter},visible:"{= ${/editMode} === 'Properties'}",editable:D.editable===false?false:"{= ${"+p+"_dt/_editable} !== false}",type:"Number",change:e};d1=t(d1,c1);b1=new I(d1);break;case"object":d1={value:{path:p+n,formatter:function(f1){if(!f1||f1===""){return undefined;}f1=JSON.stringify(f1,null,"\t");if(typeof f1==="object"&&!f1.length){f1=f1.replace(/\"\$\$([a-zA-Z]*)\$\$\"/g,function(s){return s.substring(3,s.length-3);});}return f1;}},visible:"{= ${/editMode} === 'Properties'}",editable:D.editable===false?false:"{= ${"+p+"_dt/_editable} !== false}",change:e,rows:3};d1=t(d1,c1);b1=new a(d1);break;default:var e1=new J({translatable:Z.translatable||false,uuidPath:p+"_dt/_uuid",property:n});d1={value:"{"+p+n+"}",visible:"{= ${/editMode} === 'Properties'}",editable:D.editable===false?false:"{= ${"+p+"_dt/_editable} !== false}",change:function(s){var f1=s.getSource();var g1=s.getParameter("value");if(g1&&g1.match(R)){var h1=g1.substring(2,g1.length-2);g1="{i18n>"+h1+"}";f1.setValue(g1);f1.fireChange();}else if(e){e(s);}}};d1=t(d1,c1);if(i){d1.valueHelpIconSrc="sap-icon://translate";d1.valueHelpRequest=i.bind(A,n);if(Z.translatable){d1.showValueHelp=true;}else{d1.showValueHelp={path:p+n,formatter:function(s){var d1=this.getModel("settings").getData();var f1=this.getModel().getProperty(d1.uuidPath);var g1="translatable";if(A.getTranslationKey(s)){if(!this.getShowValueHelp()&&A.getObjectPropertyConfigValueInDesigntime(f1,d1.property,g1)===false){A.setObjectPropertyConfigValueInDesigntime(f1,d1.property,g1,true);}return true;}if(this.getShowValueHelp()){A.deleteTranslationValueInTexts(undefined,f1,d1.property);A.setObjectPropertyConfigValueInDesigntime(f1,d1.property,g1,false);A._oUpdatedTranslations={};}return false;}};}}b1=new I(d1);b1.setModel(e1,"settings");}G.push(b1);}return G;};z.prototype.saveValue=function(e,i,m){var n=this;var p;if(!m){n.setValue(e);p=n.getAggregation("_field").getModel();if(p){e=o(e,500);p.setProperty("/value",e||{});}i.setValueState("None");i.setValueStateText("");if(n.getConfiguration()._propertiesParsedFromValue){n.refreshSimpleForm();}}else{p=i.getModel();p.setProperty("/value",e);i.setValueState("None");i.setValueStateText("");}};z.prototype.refreshSimpleForm=function(){var e=this;var i=e.getConfiguration();var m=e.getAggregation("_field");var n=m.removeAllContent().slice(-2);delete i.properties;e.parseValueProperties();var p=function(){var A=m.getModel();A.checkUpdate(true);var D=A.getProperty("/value");D=o(D,500);e.setValue(D);};var s=e.createPropertyContents(p,"/value/");s=s.concat(n);s.forEach(function(A){m.addContent(A);});};z.prototype.getOriginTranslatedValues=function(K){var e=[];var i=E.getInstance();for(var p in i){var m=i[p];var s="";var n="";if(K&&m){var A=m.resourceBundle&&m.resourceBundle.getText(K);s=A;n=A;}else{s="";n="";}var D={"key":p,"desription":m.language,"value":s,"originValue":n,"editable":true};e.push(D);}return e;};z.prototype.buildPropertyTranslationValues=function(K){var e=[];var i=E.getInstance();for(var p in i){e.push({"key":p,"desription":i[p].language,"value":K,"originValue":K,"editable":true});}return e;};z.prototype.openObjectDetailsPopover=function(i,e,m){var n=this;var p=n.getResourceBundle();var s=o(i,500);var A;var D=m==="add"&&n._previewPosition!=="right"?"Left":"Right";if(!n._oObjectDetailsPopover){var G=new d({text:p.getText("EDITOR_FIELD_OBJECT_DETAILS_POPOVER_BUTTON_ADD"),visible:m==="add",enabled:{path:'/value',formatter:function(c1){if(typeof c1!=="object"||h(c1,{})){return false;}else{var d1=o(c1);delete d1._dt;if(h(d1,{})){return false;}}return true;}},press:n.onAdd.bind(n)});var H=new d({text:p.getText("EDITOR_FIELD_OBJECT_DETAILS_POPOVER_BUTTON_UPDATE"),visible:m==="update",enabled:{path:'/value',formatter:function(c1){if(!c1||c1===""||h(c1,{})){return false;}return true;}},press:n.onUpdate.bind(n)});var K=new d({text:p.getText("EDITOR_FIELD_OBJECT_DETAILS_POPOVER_BUTTON_CANCEL"),visible:m!=="view",press:function(){if(m==="add"){var c1=n._oObjectDetailsPopover.getModel().getProperty("/value");n.deleteTranslationValueInTexts(undefined,c1._dt._uuid);}n._oObjectDetailsPopover.close();}});var Q=new d({text:p.getText("EDITOR_FIELD_OBJECT_DETAILS_POPOVER_BUTTON_CLOSE"),visible:m==="view",press:function(){n._oObjectDetailsPopover.close();}});var W=new d({icon:{path:'/editMode',formatter:function(c1){if(c1==="Properties"){return"sap-icon://syntax";}else{return"sap-icon://form";}}},tooltip:{path:'/editMode',formatter:function(c1){if(c1==="Properties"){return p.getText("EDITOR_FIELD_OBJECT_FORM_EDITMODE_JSON");}else{return p.getText("EDITOR_FIELD_OBJECT_FORM_EDITMODE_PROPERTIES");}}},press:function(c1){var e=c1.getSource();var A=e.getModel();var d1=A.getProperty("/editMode");if(d1==="Properties"){A.setProperty("/editMode","Json");}else{A.setProperty("/editMode","Properties");}}});var X;n._oNavContainer=new N();n._oObjectDetailsPage=new P({title:p.getText("EDITOR_FIELD_OBJECT_DETAILS_POPOVER_TITLE"),headerContent:W,footer:new O({content:[new c(),G,H,K,Q]})});var Y=function(c1){n._oNavContainer.back();n._oObjectDetailsPage.focus();};var Z=n.buildTranslationsList();var $=n.buildTranslationsFooter(Z,false);n._oTranslationListPage=new P({title:p.getText("EDITOR_FIELD_OBJECT_TRANSLATION_LIST_TITLE","{languages>/property}"),showNavButton:true,navButtonPress:Y,content:Z,footer:$});var _=function(c1){var A=n._oObjectDetailsPopover.getModel();A.checkUpdate(true);var d1=A.getProperty("/value");if(d1&&d1!==""&&typeof d1==="object"&&!h(d1,{})){G.setEnabled(true);}else{G.setEnabled(false);}};var a1=function(){};if(i._dt&&i._dt._editable===false){X=n.createFormContents(a1,"/value/",true,n.navToTranslationPage);}else{X=n.createFormContents(_,"/value/",true,n.navToTranslationPage);}var b1=new r({layout:"ResponsiveGridLayout",labelSpanXL:4,labelSpanL:4,labelSpanM:4,labelSpanS:12,emptySpanXL:1,emptySpanL:1,emptySpanM:1,emptySpanS:0,columnsXL:1,columnsL:1,columnsM:1,content:X});n._oObjectDetailsPage.addContent(b1);n._oNavContainer.addPage(n._oObjectDetailsPage);n._oNavContainer.addPage(n._oTranslationListPage);n._oObjectDetailsPopover=new b({placement:D,showHeader:false,contentWidth:"300px",contentHeight:"345px",modal:true,content:n._oNavContainer}).addStyleClass("sapUiIntegrationEditorItemObjectFieldDetailsPopover");A=new J({"value":s,"editMode":"Properties"});n._oObjectDetailsPopover.setModel(A);n._oObjectDetailsPopover.setModel(n.getModel("i18n"),"i18n");n._oObjectDetailsPopover._oAddButton=G;n._oObjectDetailsPopover._oUpdateButton=H;n._oObjectDetailsPopover._oCancelButton=K;n._oObjectDetailsPopover._oCloseButton=Q;n._oObjectDetailsPopover._openBy=e;}else{A=n._oObjectDetailsPopover.getModel();A.setProperty("/value",s);A.checkUpdate(true);if(m==="add"){n._oObjectDetailsPopover._oAddButton.setVisible(true);n._oObjectDetailsPopover._oUpdateButton.setVisible(false);n._oObjectDetailsPopover._oCancelButton.setVisible(true);n._oObjectDetailsPopover._oCloseButton.setVisible(false);}else if(m==="update"){n._oObjectDetailsPopover._oAddButton.setVisible(false);n._oObjectDetailsPopover._oUpdateButton.setVisible(true);n._oObjectDetailsPopover._oCancelButton.setVisible(true);n._oObjectDetailsPopover._oCloseButton.setVisible(false);}else{n._oObjectDetailsPopover._oAddButton.setVisible(false);n._oObjectDetailsPopover._oUpdateButton.setVisible(false);n._oObjectDetailsPopover._oCancelButton.setVisible(false);n._oObjectDetailsPopover._oCloseButton.setVisible(true);}n._oObjectDetailsPopover._openBy=e;n._oObjectDetailsPopover.setPlacement(D);n._oNavContainer.back();}n._oObjectDetailsPopover.openBy(e);};z.prototype.buildTranslationsData=function(K,s,e,p){var i=this;var m=i.getResourceBundle();i._oOriginTranslatedValues=i._oOriginTranslatedValues||{};i._oUpdatedTranslations=i._oUpdatedTranslations||{};var n=e+"_"+p;var A=K;if(s==="key"){if(!i._oOriginTranslatedValues[K]){i._oOriginTranslatedValues[K]=i.getOriginTranslatedValues(K);}}else if(s==="property"){A=n;i._oOriginTranslatedValues[A]=i.buildPropertyTranslationValues(K);}var D=[];i._oOriginTranslatedValues[A].forEach(function(H){var Q=o(H,500);Q.status=m.getText("EDITOR_FIELD_TRANSLATION_LIST_POPOVER_LISTITEM_GROUP_NOTUPDATED");var W=i.getTranslationValueInTexts(Q.key,e,p);if(W){Q.value=W;if(y(i._oUpdatedTranslations[A],Q.key)){Q.value=i.getTranslationValueInTexts(Q.key,e,p);Q.status=m.getText("EDITOR_FIELD_TRANSLATION_LIST_POPOVER_LISTITEM_GROUP_UPDATED");}else{Q.originValue=Q.value;}}if(Q.key===m.sLocale.replaceAll('_','-')){Q.desription+=" ("+m.getText("EDITOR_FIELD_TRANSLATION_LIST_POPOVER_CURRENTLANGUAGE")+")";D.unshift(Q);}else{D.push(Q);}});var G={"isUpdated":false,"key":K,"translationKey":A,"translationType":s,"uuid":e,"property":p,"translatedLanguages":D};return G;};z.prototype.getTranslationKey=function(s){var K;if(s&&s.match(R)){K=s.substring(2,s.length-2);}else if(s&&s.startsWith("{i18n>")&&s.endsWith('}')){K=s.substring(6,s.length-1);}return K;};z.prototype.buildTranslationsModel=function(e){var i=this;var m=i.getResourceBundle();var n=new J(e);n.attachPropertyChange(function(p){var D=n.getData();var s=m.getText("EDITOR_FIELD_TRANSLATION_LIST_POPOVER_LISTITEM_GROUP_UPDATED");var A=m.getText("EDITOR_FIELD_TRANSLATION_LIST_POPOVER_LISTITEM_GROUP_NOTUPDATED");var G=false;D.translatedLanguages.forEach(function(H){if(H.value!==H.originValue){H.status=s;G=true;}else{H.status=A;}});D.isUpdated=G;n.setData(D);n.checkUpdate(true);});return n;};z.prototype.buildTranslationsList=function(){return new u({items:{path:"languages>/translatedLanguages",template:new v({content:[new V({items:[new T({text:"{languages>desription}"}),new I({value:"{languages>value}",editable:"{languages>editable}"})]})],customData:[new x({key:"{languages>key}",value:"{languages>desription}"})]}),sorter:[new w({path:'status',descending:true,group:true})]}});};z.prototype.buildTranslationsFooter=function(e,i){var m=this;var n=m.getResourceBundle();var s=n.sLocale.replaceAll('_','-');var p=new d({type:"Emphasized",text:n.getText("EDITOR_FIELD_TRANSLATION_LIST_POPOVER_BUTTON_SAVE"),enabled:"{languages>/isUpdated}",press:function(){var G=e.getModel("languages");var H=G.getData();var K=[];var Q=H.key;var W=H.translationKey;var X=H.translationType;var Y=H.uuid;var Z=H.property;H.translatedLanguages.forEach(function(_){if(_.value!==_.originValue){m.setTranslationValueInTexts(_.key,Y,Z,_.value);K.push(_.key);}});var $=false;if(K.length>0){m._oUpdatedTranslations=m._oUpdatedTranslations||{};m._oUpdatedTranslations[W]=K;if(y(K,s)){$=true;}}H=m.buildTranslationsData(Q,X,Y,Z);G.setData(H);G.checkUpdate(true);if(m.getModel()){m.getModel().checkUpdate(true);}if($&&m._oValueBinding){m._oValueBinding.fireEvent("change");}}});var A=new d({text:n.getText("EDITOR_FIELD_OBJECT_DETAILS_POPOVER_BUTTON_RESET"),enabled:"{languages>/isUpdated}",press:function(G){var H=e.getModel("languages");var K=H.getData();K.translatedLanguages.forEach(function(Q){Q.value=Q.originValue;Q.status=n.getText("EDITOR_FIELD_TRANSLATION_LIST_POPOVER_LISTITEM_GROUP_NOTUPDATED");});K.isUpdated=false;H.setData(K);H.checkUpdate(true);}});var D=new d({text:n.getText("EDITOR_FIELD_TRANSLATION_LIST_POPOVER_BUTTON_CANCEL"),visible:i,press:function(){m._oTranslationPopover.close();}});return new O({content:[new c(),p,A,D]});};z.prototype.openTranslationPopup=function(p,e){var i=this;var m=e.getSource();var n=i.getResourceBundle();var s=m.getModel().getProperty("/value");if(!s._dt){s._dt={_uuid:U.generateUuidV4()};}else if(!s._dt._uuid){s._dt._uuid=U.generateUuidV4();}var A=m.getValue();var K=i.getTranslationKey(A);var D="property";if(K&&K!==""){D="key";}else{K=A;}var G=i.buildTranslationsData(K,D,s._dt._uuid,p);var H;if(!i._oTranslationPopover){var Q=i.buildTranslationsList();var W=i.buildTranslationsFooter(Q,true);var X=i._previewPosition==="right"?"Right":"Left";i._oTranslationPopover=new b({placement:X,contentWidth:"300px",contentHeight:"345px",title:n.getText("EDITOR_FIELD_OBJECT_TRANSLATION_LIST_TITLE","{languages>/property}"),content:Q,footer:W}).addStyleClass("sapUiIntegrationFieldTranslation");H=i.buildTranslationsModel(G);i._oTranslationPopover.setModel(H,"languages");}else{H=i._oTranslationPopover.getModel("languages");H.setData(G);H.checkUpdate(true);}i._oTranslationPopover.openBy(m._oValueHelpIcon);};z.prototype.navToTranslationPage=function(p,e){var i=this;var n=i._oObjectDetailsPopover.getModel().getProperty("/value");var s=n[p];var K=i.getTranslationKey(s);var m="property";if(K&&K!==""){m="key";}else{K=s;}var A=i.buildTranslationsData(K,m,n._dt._uuid,p);var D=i._oTranslationListPage.getModel("languages");if(!D){D=i.buildTranslationsModel(A);i._oTranslationListPage.setModel(D,"languages");}else{D.setData(A);}i._oNavContainer.to(i._oTranslationListPage);i._oTranslationListPage.focus();};z.prototype.onAdd=function(e){var i=this;var m=i.getAggregation("_field");var n=m.getModel();var p=i._oObjectDetailsPopover.getModel().getProperty("/value");var s=m.getBinding("rows").getPath();var D=n.getProperty(s);D.forEach(function(A){if(A._dt._selected){A._dt._selected=false;}});D.push(p);n.setProperty("/_hasSelected",true);n.setProperty("/_hasTableAllSelected",false);n.setProperty("/_hasTableSelected",false);n.checkUpdate();i.refreshValue();i.updateTable();i._oObjectDetailsPopover.close();};z.prototype.onUpdate=function(e){var i=this;var m=i.getAggregation("_field");var n=i._oObjectDetailsPopover.getModel().getProperty("/value");var p=m.getModel();var s=i._oObjectDetailsPopover._openBy.getParent();var A=s.getIndex();var D=m.getBinding("rows").getContexts();var G=D[A].getPath();p.setProperty(G,o(n,500));p.checkUpdate();if(n._dt&&n._dt._selected){i.refreshValue();}i.updateTable();i._oObjectDetailsPopover.close();};z.prototype.onDelete=function(e){var m=this;var n=m.getAggregation("_field");var p=m.getResourceBundle();var s=n.getSelectedIndices();var A=[];var D=n.getBinding("rows").getContexts();s.forEach(function(i){var G=D[i].getObject();if(G._dt&&G._dt._editable!==false){var H=D[i].getPath();var K=H.substring(H.lastIndexOf("/")+1);A.push(K);}});if(A.length===0){M.error(p.getText("EDITOR_FIELD_OBJECT_DELETE_ERROR_MSG"));return;}M.confirm(p.getText("EDITOR_FIELD_OBJECT_DELETE_CONFIRM_MSG"),{title:p.getText("EDITOR_FIELD_OBJECT_DELETE_CONFIRM_TITLE"),onClose:function(G){if(G===M.Action.OK){var H=n.getBindingContext().getPath();var K=n.getModel();var Q=K.getProperty(H);var W=[];for(var i=0;i<Q.length;i++){if(y(A,i+"")){m.deleteTranslationValueInTexts(undefined,Q[i]._dt._uuid);}else{W.push(Q[i]);}}K.setProperty(H,W);K.checkUpdate(true);m.refreshValue();m.updateTable();}else{l.show(p.getText("EDITOR_FIELD_OBJECT_DELETE_CONFIRM_CANCLE"));}}});};z.prototype.refreshValue=function(){var e=this;var m=e.getAggregation("_field");var n=m.getModel();var p=m.getBinding("rows").getPath();var D=n.getProperty(p);var s;for(var i=0;i<D.length;i++){var A=D[i];if(A._dt._selected){s=o(A);break;}}e.setValue(s);};z.prototype.clearAllFilters=function(e){var m=this;var n=m.getAggregation("_field");var p=n.getColumns();for(var i=0;i<p.length;i++){var s=p[i];if(i<p.length-1){s._applySelection=false;}n.filter(s,undefined);}};z.prototype.setValue=function(e){var i=this;i.cleanDT(e);i._setCurrentProperty("value",e);};z.prototype.cleanDT=function(e){if(e&&e._dt&&e._dt._selected){delete e._dt._selected;}if(e&&e._dt&&h(e._dt,{})){delete e._dt;}};z.prototype.getTranslationValueInTexts=function(s,e,p){var i=this;var m=i.getConfiguration();var n="/texts/"+s;var A=this._settingsModel.getProperty(n)||{};var D=A[m.manifestpath];var G;if(D&&D[e]){G=D[e][p];}return G;};z.prototype.setObjectPropertyConfigValueInDesigntime=function(s,p,e,i){var m=this;var n=m.getConfiguration();var D="/:designtime";var A=this._settingsModel.getData();if(!A){return;}var G;if(!A.hasOwnProperty(":designtime")){G={};}else{G=o(A[":designtime"],500);}if(!G.hasOwnProperty(n.manifestpath)){G[n.manifestpath]={};}if(!G[n.manifestpath].hasOwnProperty(s)){G[n.manifestpath][s]={};}if(!G[n.manifestpath][s].hasOwnProperty(p)){G[n.manifestpath][s][p]={};}G[n.manifestpath][s][p][e]=i;this._settingsModel.setProperty(D,G);};z.prototype.getObjectPropertyConfigValueInDesigntime=function(s,p,e){var i=this;var m;var n=i.getConfiguration();var D=this._settingsModel.getData();if(D&&D[":designtime"]&&D[":designtime"][n.manifestpath]&&D[":designtime"][n.manifestpath][s]&&D[":designtime"][n.manifestpath][s][p]&&D[":designtime"][n.manifestpath][s][p].hasOwnProperty(e)){m=D[":designtime"][n.manifestpath][s][p][e];}return m;};z.prototype.setTranslationValueInTexts=function(s,e,p,i){var m=this;var n=m.getConfiguration();var A="/texts";var D=this._settingsModel.getData();if(!D){return;}var G;if(!D.hasOwnProperty("texts")){G={};}else{G=o(D.texts,500);}if(!G.hasOwnProperty(s)){G[s]={};}if(!G[s].hasOwnProperty(n.manifestpath)){G[s][n.manifestpath]={};}if(!G[s][n.manifestpath].hasOwnProperty(e)){G[s][n.manifestpath][e]={};}G[s][n.manifestpath][e][p]=i;this._settingsModel.setProperty(A,G);};z.prototype.deleteTranslationValueInTexts=function(s,e,p){var i=this;var D=i._settingsModel.getData();if(!D||!D.texts||!e){return;}var m=i.getConfiguration();var A="/texts";var G=o(D.texts,500);if(s){if(G[s]&&G[s][m.manifestpath]&&G[s][m.manifestpath][e]){if(p){if(G[s][m.manifestpath][e].hasOwnProperty(p)){delete G[s][m.manifestpath][e][p];if(h(G[s][m.manifestpath][e],{})){delete G[s][m.manifestpath][e];}this._settingsModel.setProperty(A,G);}}else{delete G[s][m.manifestpath][e];if(h(G[s][m.manifestpath],{})){delete G[s][m.manifestpath];if(h(G[s],{})){delete G[s];}}this._settingsModel.setProperty(A,G);}}}else{for(var n in G){i.deleteTranslationValueInTexts(n,e,p);}}};return z;});
