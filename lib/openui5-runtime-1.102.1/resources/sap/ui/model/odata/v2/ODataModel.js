/*!
 * OpenUI5
 * (c) Copyright 2009-2022 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["./_CreatedContextsCache","./Context","./ODataAnnotations","./ODataContextBinding","./ODataListBinding","./ODataTreeBinding","sap/base/assert","sap/base/Log","sap/base/security/encodeURL","sap/base/util/deepEqual","sap/base/util/deepExtend","sap/base/util/each","sap/base/util/extend","sap/base/util/isEmptyObject","sap/base/util/isPlainObject","sap/base/util/merge","sap/base/util/uid","sap/base/util/UriParameters","sap/ui/base/SyncPromise","sap/ui/core/library","sap/ui/core/message/Message","sap/ui/core/message/MessageParser","sap/ui/model/_Helper","sap/ui/model/BindingMode","sap/ui/model/Context","sap/ui/model/FilterProcessor","sap/ui/model/Model","sap/ui/model/odata/CountMode","sap/ui/model/odata/MessageScope","sap/ui/model/odata/ODataMetadata","sap/ui/model/odata/ODataMetaModel","sap/ui/model/odata/ODataMessageParser","sap/ui/model/odata/ODataPropertyBinding","sap/ui/model/odata/ODataUtils","sap/ui/model/odata/OperationMode","sap/ui/model/odata/UpdateMethod","sap/ui/thirdparty/datajs","sap/ui/thirdparty/URI","sap/ui/util/isCrossOriginURL"],function(_,C,O,a,b,c,d,L,e,f,g,h,l,m,o,p,u,U,S,q,M,r,s,B,t,F,v,w,x,y,z,A,D,E,G,H,I,J,K){"use strict";var N="sap.ui.model.odata.v2.ODataModel",P=q.MessageType,Q={},R=["groupId","urlParameters"];Q[P.Error]=0;Q[P.Warning]=1;Q[P.Success]=2;Q[P.Information]=3;Q[P.None]=4;var T=v.extend("sap.ui.model.odata.v2.ODataModel",{constructor:function(i,j){v.apply(this,arguments);var k,n,V,W,X,Y,Z,$,a1,b1,c1,d1,e1,f1,g1,h1,i1,j1,k1,l1,m1,n1,o1,p1,q1,r1,s1,t1,u1,v1,w1=this;if(typeof(i)==="object"){j=i;this.sServiceUrl=j.serviceUrl;}else{this.sServiceUrl=i;}this.mCodeListModelParams=this.createCodeListModelParameters(j);if(j){k=j.user;n=j.password;V=j.headers;W=j.tokenHandling;X=j.withCredentials;Y=j.maxDataServiceVersion;Z=j.useBatch;$=j.refreshAfterChange;a1=j.annotationURI;b1=j.loadAnnotationsJoined;e1=j.defaultBindingMode;c1=j.defaultCountMode;d1=j.preliminaryContext;f1=j.defaultOperationMode;g1=j.metadataNamespaces;h1=j.serviceUrlParams;i1=j.metadataUrlParams;j1=j.json;k1=j.messageParser;l1=j.skipMetadataAnnotationParsing;m1=j.defaultUpdateMethod;n1=j.disableHeadRequestForToken;o1=j.sequentializeRequests;p1=j.disableSoftStateHeader;q1=j.bindableResponseHeaders;r1=j.warmupUrl;s1=j.canonicalRequests;t1=j.tokenHandlingForGet;u1=j.earlyTokenRequest;v1=j.persistTechnicalMessages;}this.mPathCache={};this.mInvalidatedPaths={};this.bCanonicalRequests=!!s1;this.bTokenHandlingForGet=!!t1;this.sMessageScope=x.RequestedObjects;this.sWarmupUrl=r1;this.bWarmup=!!r1;this.mSupportedBindingModes={"OneWay":true,"OneTime":true,"TwoWay":true};this.mUnsupportedFilterOperators={"Any":true,"All":true};this.sDefaultBindingMode=e1||B.OneWay;this.bIsMessageScopeSupported=false;this.iPendingDeferredRequests=0;this.bJSON=j1!==false;this.aPendingRequestHandles=[];this.aCallAfterUpdate=[];this.mRequests={};this.mDeferredRequests={};this.mChangedEntities={};this.mChangeHandles={};this.mDeferredGroups={};this.mLaunderingState={};this.sDefaultUpdateMethod=m1||H.Merge;this.bTokenHandling=W!==false;this.bWithCredentials=X===true;this.bUseBatch=Z!==false;this.bRefreshAfterChange=$!==false;this.sMaxDataServiceVersion=Y;this.bLoadAnnotationsJoined=b1!==false;this.sAnnotationURI=a1;this.sDefaultCountMode=c1||w.Request;this.sDefaultOperationMode=f1||G.Default;this.sMetadataLoadEvent=null;this.oMetadataFailedEvent=null;this.sRefreshGroupId=undefined;this.bIncludeInCurrentBatch=false;this.bSkipMetadataAnnotationParsing=!!l1;this.bDisableHeadRequestForToken=!!n1;this.bSequentializeRequests=!!o1;this.bDisableSoftStateHeader=!!p1;this.aBindableResponseHeaders=q1?q1:null;this.bPreliminaryContext=d1||false;this.mMetadataUrlParams=i1||{};this.mChangedEntities4checkUpdate={};this.bPersistTechnicalMessages=v1===undefined?undefined:!!v1;this.oCreatedContextsCache=new _();this.aSideEffectCleanUpFunctions=[];if(k1){k1.setProcessor(this);}this.oMessageParser=k1;this.setDeferredGroups(["changes"]);this.setChangeGroups({"*":{groupId:"changes"}});this.oData={};this.oMetadata=null;this.oAnnotations=null;this.aUrlParams=[];this.pSequentialRequestCompleted=Promise.resolve();this.pReadyForRequest=Promise.resolve();var x1=this.sServiceUrl.split("?");if(x1.length>1){this.sServiceUrl=x1[0];if(x1[1]){this.aUrlParams.push(x1[1]);}}this.sServiceUrl=this.sServiceUrl.replace(/\/$/,"");this.sUser=k;this.sPassword=n;if(sap.ui.getCore().getConfiguration().getStatistics()){this.aUrlParams.push("sap-statistics=true");}this.oHeaders={};this.setHeaders(V);if(!this.bDisableSoftStateHeader){this.oHeaders["sap-contextid-accept"]="header";this.mCustomHeaders["sap-contextid-accept"]="header";}var y1=this._getServerUrl();this.sMetadataUrl=this.sWarmupUrl||this._createMetadataUrl("/$metadata");this.oSharedServerData=T._getSharedData("server",y1);this.oSharedServiceData=T._getSharedData("service",this.sServiceUrl);this.oSharedMetaData=T._getSharedData("meta",this.sMetadataUrl);this.bUseCache=this._cacheSupported(this.sMetadataUrl);if(!this.oSharedMetaData.oMetadata||this.oSharedMetaData.oMetadata.bFailed){this.oMetadata=new y(this.sMetadataUrl,{async:true,cacheKey:this.bUseCache?this.sMetadataUrl:undefined,user:this.sUser,password:this.sPassword,headers:this.mCustomHeaders,namespaces:g1,withCredentials:this.bWithCredentials});if(!this.bWarmup){this.oSharedMetaData.oMetadata=this.oMetadata;}}else{this.oMetadata=this.oSharedMetaData.oMetadata;}this.oAnnotations=new O(this.oMetadata,{source:this.sAnnotationURI,skipMetadata:this.bSkipMetadataAnnotationParsing,headers:this.mCustomHeaders,combineEvents:true,cacheKey:this._getAnnotationCacheKey(this.sMetadataUrl),useCache:this.bUseCache});if(!this.bDisableSoftStateHeader){delete this.mCustomHeaders["sap-contextid-accept"];}this.oAnnotations.attachAllFailed(this.onAnnotationsFailed,this);this.oAnnotations.attachSomeLoaded(this.onAnnotationsLoaded,this);this.pAnnotationsLoaded=this.oAnnotations.loaded();if(h1){this.aUrlParams=this.aUrlParams.concat(E._createUrlParamsArray(h1));}this.onMetadataFailed=function(z1){w1.fireMetadataFailed(z1.getParameters());};if(!this.oMetadata.isLoaded()){this.oMetadata.attachFailed(this.onMetadataFailed);}this.oMetadata.loaded().then(function(){w1._initializeMetadata();});if(this.bJSON){if(this.sMaxDataServiceVersion==="3.0"){this.oHeaders["Accept"]="application/json;odata=fullmetadata";}else{this.oHeaders["Accept"]="application/json";}}else{this.oHeaders["Accept"]="application/atom+xml,application/atomsvc+xml,application/xml";}if(this.bTokenHandling){if(this.oSharedServiceData.securityToken){this.oHeaders["x-csrf-token"]=this.oSharedServiceData.securityToken;}else if(this.oSharedServerData.securityToken){this.oSharedServiceData.securityToken=this.oSharedServerData.securityToken;this.oHeaders["x-csrf-token"]=this.oSharedServiceData.securityToken;}if(u1){this.securityTokenAvailable();}}this.oHeaders["Accept-Language"]=sap.ui.getCore().getConfiguration().getLanguageTag();this.oHeaders["DataServiceVersion"]="2.0";this.oHeaders["MaxDataServiceVersion"]="2.0";if(this.sMaxDataServiceVersion){this.oHeaders["MaxDataServiceVersion"]=this.sMaxDataServiceVersion;}if(!this.mCustomHeaders["X-Requested-With"]&&!K(this.sServiceUrl)){this.oHeaders["X-Requested-With"]="XMLHttpRequest";}},metadata:{publicMethods:["read","create","update","remove","submitChanges","getServiceMetadata","metadataLoaded","hasPendingChanges","getPendingChanges","refresh","refreshMetadata","resetChanges","setDefaultCountMode","setDefaultBindingMode","getDefaultBindingMode","getDefaultCountMode","setProperty","getSecurityToken","refreshSecurityToken","setHeaders","getHeaders","setUseBatch","setDeferredBatchGroups","getDeferredBatchGroups","setChangeBatchGroups","getChangeBatchGroups"]}});T.M_EVENTS={MetadataLoaded:"metadataLoaded",MetadataFailed:"metadataFailed",AnnotationsLoaded:"annotationsLoaded",AnnotationsFailed:"annotationsFailed",BatchRequestFailed:"batchRequestFailed",BatchRequestSent:"batchRequestSent",BatchRequestCompleted:"batchRequestCompleted"};T.prototype.attachBatchRequestFailed=function(i,j,k){this.attachEvent("batchRequestFailed",i,j,k);return this;};T.prototype.detachBatchRequestFailed=function(i,j){this.detachEvent("batchRequestFailed",i,j);return this;};T.prototype.fireBatchRequestFailed=function(i){this.fireEvent("batchRequestFailed",i);return this;};T.prototype.attachBatchRequestSent=function(i,j,k){this.attachEvent("batchRequestSent",i,j,k);return this;};T.prototype.detachBatchRequestSent=function(i,j){this.detachEvent("batchRequestSent",i,j);return this;};T.prototype.fireBatchRequestSent=function(i){this.fireEvent("batchRequestSent",i);return this;};T.prototype.attachBatchRequestCompleted=function(i,j,k){this.attachEvent("batchRequestCompleted",i,j,k);return this;};T.prototype.detachBatchRequestCompleted=function(i,j){this.detachEvent("batchRequestCompleted",i,j);return this;};T.prototype.fireBatchRequestCompleted=function(i){this.fireEvent("batchRequestCompleted",i);return this;};T.mSharedData={server:{},service:{},meta:{}};T._getSharedData=function(i,k){var j=this.mSharedData[i][k];if(!j){j={};this.mSharedData[i][k]=j;}return j;};T.prototype._initializeMetadata=function(){if(this.bDestroyed){return;}this.bIsMessageScopeSupported=this.oMetadata._isMessageScopeSupported();var i=function(){this.fireMetadataLoaded({metadata:this.oMetadata});L.debug(this+" - metadataloaded fired");}.bind(this);this.initialize();if(this.bLoadAnnotationsJoined){this.oAnnotations.loaded().then(i,this.fireMetadataFailed.bind(this));}else{i();}};T.prototype.refreshMetadata=function(){if(this.oMetadata&&this.oMetadata.refresh){return this.oMetadata.refresh();}return undefined;};T.prototype.fireAnnotationsLoaded=function(i){this.fireEvent("annotationsLoaded",i);return this;};T.prototype.attachAnnotationsLoaded=function(i,j,k){this.attachEvent("annotationsLoaded",i,j,k);return this;};T.prototype.detachAnnotationsLoaded=function(i,j){this.detachEvent("annotationsLoaded",i,j);return this;};T.prototype.fireAnnotationsFailed=function(i){this.fireEvent("annotationsFailed",i);L.debug(this+" - annotationsfailed fired");return this;};T.prototype.attachAnnotationsFailed=function(i,j,k){this.attachEvent("annotationsFailed",i,j,k);return this;};T.prototype.detachAnnotationsFailed=function(i,j){this.detachEvent("annotationsFailed",i,j);return this;};T.prototype.fireMetadataLoaded=function(i){this.fireEvent("metadataLoaded",i);return this;};T.prototype.attachMetadataLoaded=function(i,j,k){this.attachEvent("metadataLoaded",i,j,k);return this;};T.prototype.detachMetadataLoaded=function(i,j){this.detachEvent("metadataLoaded",i,j);return this;};T.prototype.fireMetadataFailed=function(i){this.fireEvent("metadataFailed",i);return this;};T.prototype.attachMetadataFailed=function(i,j,k){this.attachEvent("metadataFailed",i,j,k);return this;};T.prototype.detachMetadataFailed=function(i,j){this.detachEvent("metadataFailed",i,j);return this;};T.prototype._createEventInfo=function(k,n,V){var W,X,Y={};Y.url=k.requestUri;Y.method=k.method;Y.async=k.async;Y.headers=k.headers;if(V){Y.requests=[];for(var i=0;i<V.length;i++){X={};if(Array.isArray(V[i])){var Z=V[i];for(var j=0;j<Z.length;j++){k=Z[j].request;W=V[i][j].response;X={};X.url=k.requestUri;X.method=k.method;X.headers=k.headers;if(W){X.response={};if(k._aborted){X.success=false;X.response.statusCode=0;X.response.statusText="abort";}else{X.success=true;if(W.message){X.response.message=W.message;W=W.response;X.response.responseText=W.body;X.success=false;}X.response.headers=W.headers;X.response.statusCode=W.statusCode;X.response.statusText=W.statusText;}}Y.requests.push(X);}}else{k=V[i].request;W=V[i].response;X.url=k.requestUri;X.method=k.method;X.headers=k.headers;if(W){X.response={};if(k._aborted){X.success=false;X.response.statusCode=0;X.response.statusText="abort";}else{X.success=true;if(W.message){X.response.message=W.message;W=W.response;X.response.responseText=W.body;X.success=false;}X.response.headers=W.headers;X.response.statusCode=W.statusCode;X.response.statusText=W.statusText;}}Y.requests.push(X);}}}if(n){Y.response={};Y.success=true;if(n.message){Y.response.message=n.message;Y.success=false;}if(n.response){n=n.response;}if(n&&n.statusCode!=undefined){Y.response.headers=n.headers;Y.response.statusCode=n.statusCode;Y.response.statusText=n.statusText;Y.response.responseText=n.body!==undefined?n.body:n.responseText;if(n.expandAfterCreateFailed){Y.response.expandAfterCreateFailed=true;}if(n.expandAfterFunctionCallFailed){Y.response.expandAfterFunctionCallFailed=true;}}}Y.ID=k.requestID;return Y;};T.prototype._createRequestID=function(){var i;i=u();return i;};T.prototype._getServerUrl=function(){var i,j;i=new J(this.sServiceUrl).absoluteTo(document.baseURI);j=new J("/").absoluteTo(i).toString();return j;};T.prototype._createMetadataUrl=function(i){if(i.indexOf(this.sServiceUrl)==-1){if(!i.startsWith("/")){i="/"+i;}i=this.sServiceUrl+i;}var j=U.fromURL(i||window.location.href);var k=Object.assign({},this.mMetadataUrlParams);Array.from(j.keys()).forEach(function(W){k[W]=j.get(W);});var n=E._createUrlParamsArray(k);var V=i.split("?");if(V.length>1){i=V[0];}return this._addUrlParams(i,n);};T.prototype._addUrlParams=function(i,j){var k=[];if(this.aUrlParams){k=k.concat(this.aUrlParams);}if(j){k=k.concat(j);}if(k.length>0){i+="?"+k.join("&");}return i;};T.prototype._createRequestUrl=function(i,j,k,n){return this._createRequestUrlWithNormalizedPath(this._normalizePath(i,j),k,n);};T.prototype._createRequestUrlWithNormalizedPath=function(n,i,j){var k="";if(!j){k=this.sServiceUrl+n;}else{k=n.substr(n.indexOf('/')+1);}return this._addUrlParams(k,i);};T.prototype._importData=function(j,k,n,V,W,X,Y,Z,$){var a1=this,b1,c1,d1,e1;V=V||"";X=X||"";if(j.results&&Array.isArray(j.results)){b1=[];h(j.results,function(i,l1){var X=a1._getKey(l1);X=a1._importData(l1,k,n,V.substr(0,V.lastIndexOf("/")),W,X,undefined,undefined,$);if(X){b1.push(X);}});return b1;}else{if(X){V="/"+X;W+=X.substr(X.indexOf("("));}else{X=this._getKey(j);}if(!X){return X;}d1=this._getEntity(X);e1=d1;if(!d1||(d1.__metadata&&d1.__metadata.invalid)){if(!e1){e1=j;}d1=j;X=this._addEntity(d1);}if(this.aBindableResponseHeaders){var f1={};for(var g1 in n.headers){var h1=g1.toLowerCase();if(this.aBindableResponseHeaders.indexOf(h1)>-1){f1[h1]=n.headers[g1];}}if(!m(f1)){if(!j.__metadata){j.__metadata={};}j.__metadata.headers=f1;}}h(j,function(i,l1){if(l1&&(l1.__metadata&&l1.__metadata.uri||l1.results)&&!l1.__deferred){var m1=V+"/"+i;var n1=W+"/"+i;c1=a1._importData(l1,k,n,m1,n1,undefined,false,"/"+X+"/"+i,$);if(Array.isArray(c1)){d1[i]={__list:c1};if($){d1[i].__list.sideEffects=true;a1.aSideEffectCleanUpFunctions.push(function(){delete d1[i];});}}else{if(e1[i]&&e1[i].__ref){if(e1[i].__ref!==c1){a1.mInvalidatedPaths[V.substr(V.lastIndexOf("("))+"/"+i]="/"+c1;}}d1[i]={__ref:c1};}}else if(!l1||!l1.__deferred){if(e1[i]&&l1===null){a1.mInvalidatedPaths[V.substr(V.lastIndexOf("("))+"/"+i]=null;}d1[i]=l1;}});var i1={};i1[X]=d1;if(this.hasContext("/"+X)&&this.getContext("/"+X).isPreliminary()){var j1=this.getContext("/"+X);j1.setUpdated(true);j1.setPreliminary(false);}this._updateChangedEntities(i1);k[X]=true;V=V||'/'+X;W=W||V;var k1=this.resolveFromCache(W);if(k1==="/"+X||(k1&&k1.split("/").length>2)){this._writePathCache(k1,"/"+X,Y);}this._writePathCache(V,"/"+X,Y);this._writePathCache(W,"/"+X,Y,true);if(Z){this._writePathCache(Z,"/"+X,Y);}return X;}};T.prototype._writePathCache=function(i,j,k,n){var V,W,X,Y,Z,$;if(i&&j){if(!this.mPathCache[i]){this.mPathCache[i]={};}if(!k&&i.lastIndexOf("/")===0){j=i;}this.mPathCache[i].canonicalPath=j;if(n){Z=i.split("/");for($=3;$<Z.length;$+=1){X=Z.slice(0,$).join("/");Y=this.mPathCache[X];if(Y){V=Y.canonicalPath+i.slice(X.length);W=this.mPathCache[V];if(W){W.canonicalPath=j;}}}}}};T.prototype._removeReferences=function(j){var k=this,n;if(!j){return j;}if(j.results){n=[];h(j.results,function(i,V){n.push(k._removeReferences(V));});return n;}else{h(j,function(i,V){if(V){if(V["__ref"]||V["__list"]){delete j[i];}}});return j;}};T.prototype._restoreReferences=function(j,V){var k=this,n,W,X;function Y(n){var W=V[n];if(!W){W=k._getObject("/"+n);d(W,"ODataModel inconsistent: "+n+" not found!");if(W){W=p({},W);V[n]=W;k._restoreReferences(W,V);}}return W;}if(!V){V={};}h(j,function(Z,$){if($){if($.__ref){n=$.__ref;W=Y(n);if(W){j[Z]=W;}delete $.__ref;}else if($.__list){X=[];h($.__list,function(i,n){W=Y(n);if(W){X.push(W);}});delete $.__list;$.results=X;}}});return j;};T.prototype.removeData=function(){this.oData={};};T.prototype.initialize=function(){var i=this.getBindings();i.forEach(function(j){j.initialize();});};T.prototype.invalidate=function(i){var j;for(var k in this.oData){j=this.oData[k];if(!i||i(k,j)){j.__metadata.invalid=true;}}};T.prototype.invalidateEntry=function(i){var j;if(typeof i==="string"){if(i.indexOf("/")===0){j=this._getObject(i);}else{j=this.oData[i];}}else if(i instanceof t){j=this._getObject(i.getPath());}if(j&&j.__metadata){j.__metadata.invalid=true;}};T.prototype.invalidateEntityType=function(i){var j;for(var k in this.oData){j=this.oData[k];if(j.__metadata.type===i){j.__metadata.invalid=true;}}};T.prototype.refresh=function(i,j,k){if(typeof i==="string"){k=i;i=false;j=false;}if(j){this.removeData();}this._refresh(i,k);};T.prototype._refresh=function(i,j,k,n){var V=this.getBindings();this.sRefreshGroupId=j;V.forEach(function(W){W._refresh(i,k,n);});this.sRefreshGroupId=undefined;};T.prototype.checkUpdate=function(i,j,k,n){if(j){this.bForceUpdate=this.bForceUpdate||i;Object.assign(this.mChangedEntities4checkUpdate,k);if(!this.sUpdateTimer){this.sUpdateTimer=setTimeout(function(){this.checkUpdate(this.bForceUpdate,false,this.mChangedEntities4checkUpdate);}.bind(this),0);}return;}i=this.bForceUpdate||i;if(this.sUpdateTimer){clearTimeout(this.sUpdateTimer);this.sUpdateTimer=null;this.bForceUpdate=undefined;this.mChangedEntities4checkUpdate={};}var V=this.getBindings();V.forEach(function(W){if(!n||this.isMetaModelPath(W.getPath())){W.checkUpdate(i,k);}}.bind(this));this._processAfterUpdate();};T.prototype.checkDataState=function(i){var j=this.getBindings();j.forEach(function(k){if(k.checkDataState){k.checkDataState(i);}});};T.prototype.bindProperty=function(i,j,k){var n=new D(this,i,j,k);return n;};T.prototype.bindList=function(i,j,k,n,V){var W=new b(this,i,j,k,n,V);return W;};T.prototype.bindTree=function(i,j,k,n,V){var W=new c(this,i,j,k,n,V);return W;};T.prototype.createBindingContext=function(i,j,k,n,V){var W,X,Y,Z,$,a1,b1,c1,d1,e1=this;if(j!==null&&typeof j==="object"&&!(j instanceof t)){V=n;n=k;k=j;j=undefined;}if(typeof j=="function"){V=k;n=j;k=undefined;j=undefined;}if(typeof j=="boolean"){V=j;n=undefined;k=undefined;j=undefined;}if(typeof k=="function"){V=n;n=k;k=undefined;}if(typeof k=="boolean"){V=k;n=undefined;k=undefined;}if(typeof n=="boolean"){V=n;n=undefined;}if(k){W=k.canonicalRequest;}W=this._isCanonicalRequestNeeded(W);d1=this.resolve(i,j,W);if(!d1&&W){d1=this.resolve(i,j);}Z=this.resolveDeep(i,j);if(!d1){if(n){n(null);}return null;}if(V===undefined){V=this._isReloadNeeded(d1,k);}if(!V){X=this.resolve(i,j,true);if(X){b1=this.getContext(X,Z);}else{b1=null;}if(n){n(b1);}return b1;}function f1(h1){var i1=h1?e1._getKey(h1):null,j1=!(i===""||i.indexOf("/")>0),k1=null,l1,m1;b1=null;if(i1){b1=e1.getContext('/'+i1,Z);k1={__ref:i1};}if(j&&a1&&j1){l1=j.getPath();l1=l1.substr(1);m1=e1._getEntity(l1);if(m1){m1[i]=k1;}}n(b1);}function g1(h1){var i1;if(h1.statusCode=='404'&&j&&a1){var j1=j.getPath();j1=j1.substr(1);i1=e1._getEntity(j1);if(i1){i1[i]={__ref:null};}}n(null);}if(n){a1=!i.startsWith("/");c1=[];Y=this.createCustomParams(k);if(Y){c1.push(Y);}if(k&&(k.batchGroupId||k.groupId)){$=k.groupId||k.batchGroupId;}this.read(i,{canonicalRequest:W,context:j,error:g1,groupId:$,success:f1,updateAggregatedMessages:true,urlParameters:c1});}if(k&&k.createPreliminaryContext){d1=this.resolve(i,j,W);if(!d1&&W){d1=this.resolve(i,j);}b1=this.getContext(d1,Z);return b1;}return undefined;};T.prototype._updateContext=function(i,j,k){i.sPath=j;if(k!==undefined){i.sDeepPath=k;}this.mContexts[j]=i;};T.prototype._splitEntries=function(i){return i.replace(/\s/g,"").split(',').map(function(j){return j.split("/");});};T.prototype._filterOwnSelect=function(i,j){var k,n;if(!j){return[];}n=j.map(function(V){return V.name;});k=i.filter(function(V){return V.length===1;}).map(function(V){return V[0];});if(i.length===0||k.indexOf("*")!==-1||k.indexOf("**")!==-1){return n;}else{return k.filter(function(V){return n.indexOf(V)!==-1;});}};T.prototype._filterOwnExpand=function(i,j){return i.map(function(k){return k[0];}).filter(function(V,k,n){return n.indexOf(V)===k;}).filter(function(V){return j.length===0||j.some(function(k){return k.indexOf(V)===0||k.indexOf("**")===0;});});};T.prototype._filterSelectByNavProp=function(i,n){return i.filter(function(j){return j[0]===n;}).map(function(j){return j.length>1?j.slice(1):["**"];});};T.prototype._filterExpandByNavProp=function(i,n){return i.filter(function(j){return j.length>1&&j[0]===n;}).map(function(j){return j.slice(1);});};T.prototype._isReloadNeeded=function(k,n){var V=this,W=this.oMetadata,X,Y=this._getObject(k),Z=[],$=[];if(!this.oMetadata.isLoaded()){return true;}X=this.oMetadata._getEntityTypeByPath(k);if(this._isCreatedEntity(Y)){return false;}function a1(X,Y,$,Z){var b1,i,c1,d1,e1,f1,g1,h1,i1,j1;if(!X){return false;}if(Y===null){return false;}if(!Y){return true;}if(Y.__metadata&&Y.__metadata.invalid){return true;}i1=V._filterOwnSelect($,X.property);for(i=0;i<i1.length;i++){j1=i1[i];if(Y[j1]===undefined){return true;}}h1=V._filterOwnExpand(Z,$);for(i=0;i<h1.length;i++){b1=h1[i];c1=Y[b1];if(c1===null){continue;}if(c1===undefined||c1.__deferred){return true;}e1=W._getEntityTypeByNavProperty(X,b1);g1=V._filterSelectByNavProp($,b1);f1=V._filterExpandByNavProp(Z,b1);if(c1.__ref){d1=V._getEntity(c1.__ref);if(a1(e1,d1,g1,f1)){return true;}}if(c1.__list){for(var j=0;j<c1.__list.length;j++){d1=V._getEntity(c1.__list[j]);if(a1(e1,d1,g1,f1)){return true;}}}}return false;}if(n){if(n.select){$=this._splitEntries(n.select);}if(n.expand){Z=this._splitEntries(n.expand);}}return a1(X,Y,$,Z);};T.prototype.createCustomParams=function(i){var j=[],k,n={expand:true,select:true};for(var V in i){if(V in n){j.push("$"+V+"="+e(i[V]));}if(V==="custom"){k=i[V];for(V in k){if(V.indexOf("$")===0){L.warning(this+" - Trying to set OData parameter '"+V+"' as custom query option!");}else if(typeof k[V]==='string'){j.push(V+"="+e(k[V]));}else{j.push(V);}}}}return j.join("&");};T.prototype.bindContext=function(i,j,k){var n=new a(this,i,j,k);return n;};T.prototype.setDefaultCountMode=function(i){this.sDefaultCountMode=i;};T.prototype.getDefaultCountMode=function(){return this.sDefaultCountMode;};T.prototype._addEntity=function(i){var k=this._getKey(i);this.oData[k]=i;return k;};T.prototype._removeEntity=function(k){k=k&&E._normalizeKey(k);delete this.oData[k];delete this.mChangedEntities[k];delete this.mContexts["/"+k];};T.prototype._getEntity=function(k){var i=this.oData[k];if(!i){k=k&&E._normalizeKey(k);i=this.oData[k];}return i;};T.prototype._getKey=function(V){var k,i;if(V instanceof t){k=V.getPath().substr(1);}else if(V&&V.__metadata&&V.__metadata.uri){i=V.__metadata.uri;k=i.substr(i.lastIndexOf("/")+1);}else if(typeof V==='string'){k=V.substr(V.lastIndexOf("/")+1);}if(!this.oData[k]){k=k&&E._normalizeKey(k);}return k;};T.prototype.getKey=function(V){return this._getKey(V);};T.prototype.createKey=function(j,k){var n=this.oMetadata._getEntityTypeByPath(j),V=j,W=this,X,Y;d(n,"Could not find entity type of collection \""+j+"\" in service metadata!");V+="(";if(n.key.propertyRef.length===1){X=n.key.propertyRef[0].name;d(X in k,"Key property \""+X+"\" is missing in object!");Y=this.oMetadata._getPropertyMetadata(n,X);V+=encodeURIComponent(E.formatValue(k[X],Y.type));}else{h(n.key.propertyRef,function(i,Z){if(i>0){V+=",";}X=Z.name;d(X in k,"Key property \""+X+"\" is missing in object!");Y=W.oMetadata._getPropertyMetadata(n,X);V+=X;V+="=";V+=encodeURIComponent(E.formatValue(k[X],Y.type));});}V+=")";return V;};T.prototype.getProperty=function(i,j,k){var V=this._getObject(i,j);if(!k){return V;}if(!o(V)){return V;}V=p({},V);if(k===true){return this._restoreReferences(V);}else{return this._removeReferences(V);}};T.prototype.getObject=function(n,V,W){if(o(V)){W=V;V=undefined;}var X=this,Y=this.resolve(n,V),Z=this._getObject(Y),$=this.oMetadata._getEntityTypeByPath(Y),a1=[],b1=[];if(!$||!o(Z)||!Z.__metadata||!Z.__metadata.uri){return Z;}if(!W||!(W.select||W.expand)){return p({},Z);}function c1($,Z,b1,a1){var d1,i,e1,f1,g1,h1,i1,j1,k1,l1,m1,n1,o1,p1;if(!Z){return undefined;}if(!$){return undefined;}m1=X._filterOwnSelect(b1,$.property);o1={};for(i=0;i<m1.length;i++){p1=m1[i];if(Z[p1]!==undefined||Z.__metadata.created){o1[p1]=Z[p1];}else{L.fatal("No data loaded for select property: "+p1+" of entry: "+X.getKey(Z));return undefined;}}if(Z.__metadata){o1.__metadata=Z.__metadata;}k1=X._filterOwnExpand(a1,b1);for(i=0;i<k1.length;i++){d1=k1[i];e1=Z[d1];f1=X.oMetadata._getEntityTypeByNavProperty($,d1);i1=X._filterSelectByNavProp(b1,d1);g1=X._filterExpandByNavProp(a1,d1);if(e1&&e1.__ref){h1=X._getObject("/"+e1.__ref);j1=c1(f1,h1,i1,g1);if(j1!==undefined){o1[d1]=j1;}else{L.fatal("No data loaded for expand property: "+d1+" of entry: "+X.getKey(j1));return undefined;}}if(e1&&e1.__list){n1=[];for(var j=0;j<e1.__list.length;j++){h1=X._getObject("/"+e1.__list[j]);j1=c1(f1,h1,i1,g1);if(j1!==undefined){n1.push(j1);}else{L.fatal("No data loaded for expand property: "+d1+" of entry: "+X.getKey(j1));return undefined;}}o1[d1]=n1;}}l1=X._filterOwnSelect(b1,$.navigationProperty);for(var k=0;k<l1.length;k++){d1=l1[k];if(k1.indexOf(d1)===-1){var q1=o1.__metadata.uri+"/"+d1;o1[d1]={__deferred:{uri:q1}};}}return o1;}if(W.select){b1=this._splitEntries(W.select);}if(W.expand){a1=this._splitEntries(W.expand);}Z=c1($,Z,b1,a1);return Z;};T.prototype._getObject=function(i,j,k,n){var V,W,X,Y,Z,$,a1,b1,c1,d1,e1,f1=n?undefined:null,g1=this.isLegacySyntax()?this.oData:f1;d1=this.resolve(i,j,this.bCanonicalRequests);if(!d1&&this.bCanonicalRequests){d1=this.resolve(i,j);}if(!d1){return g1;}if(i&&i.startsWith("@$ui5.")){return this._getInstanceAnnotationValue(i,j);}if(this._isMetadataPath(d1)){if(this.oMetadata&&this.oMetadata.isLoaded()){if(this.isMetaModelPath(d1)){a1=this.getMetaModel();X=z.getCodeListTerm(d1);if(X){W=a1.fetchCodeList(X);if(W.isFulfilled()){return W.getResult();}if(W.isRejected()){W.caught();}return undefined;}if(!this.bMetaModelLoaded){return null;}e1=d1.indexOf('/##');Y=d1.substr(0,e1);b1=d1.substr(e1+3);$=a1.getMetaContext(Y);g1=a1.getProperty(b1,$);}else{g1=this.oMetadata._getAnnotation(d1);}}else if(z.getCodeListTerm(d1)){return undefined;}}else{if(d1==="/"){return this.oData;}var h1=d1.split("/"),i1=0;Z=h1[1];h1.splice(0,2);V=this.mChangedEntities[Z];c1=this._getEntity(Z);g1=k?c1:V||c1;while(g1&&h1[i1]){var j1=V&&V.hasOwnProperty(h1[i1]);V=V&&V[h1[i1]];c1=c1&&c1[h1[i1]];g1=k||!j1?c1:V;if(g1){if(g1.__ref){V=this.mChangedEntities[g1.__ref];c1=this._getEntity(g1.__ref);g1=k?c1:V||c1;}else if(g1.__list){g1=g1.__list;}else if(g1.__deferred){g1=undefined;}}i1++;}}if(o(V)){g1=k?c1:p({},c1,V);}return g1;};T.prototype._getInstanceAnnotationValue=function(i,j){if(i==="@$ui5.context.isInactive"){return j.isInactive();}if(i==="@$ui5.context.isTransient"){return j.isTransient();}throw new Error("Unsupported instance annotation: "+i);};T.prototype.updateSecurityToken=function(){if(this.bTokenHandling){if(!this.oSharedServiceData.securityToken){this.refreshSecurityToken();}if(this.bTokenHandling){this.oHeaders["x-csrf-token"]=this.oSharedServiceData.securityToken;}}};T.prototype.resetSecurityToken=function(){delete this.oSharedServiceData.securityToken;delete this.oHeaders["x-csrf-token"];delete this.pSecurityToken;};T.prototype.getSecurityToken=function(){var i=this.oSharedServiceData.securityToken;if(!i){this.refreshSecurityToken();i=this.oSharedServiceData.securityToken;}return i;};T.prototype.securityTokenAvailable=function(){if(!this.pSecurityToken){if(this.oSharedServiceData.securityToken){this.pSecurityToken=Promise.resolve(this.oSharedServiceData.securityToken);}else{this.pSecurityToken=new Promise(function(i,j){this.refreshSecurityToken(function(){i(this.oSharedServiceData.securityToken);}.bind(this),function(){j();},true);}.bind(this));}}return this.pSecurityToken;};T.prototype.refreshSecurityToken=function(i,j,k){var n,V,W={abort:function(){this.request.abort();}},X=this._createRequestUrlWithNormalizedPath("/"),Y=this;function Z(c1,d1){if(d1){V=Y._getHeader("x-csrf-token",d1.headers);Y._setSessionContextIdHeader(Y._getHeader("sap-contextid",d1.headers));if(V){Y.oSharedServerData.securityToken=V;Y.oSharedServiceData.securityToken=V;Y.pSecurityToken=Promise.resolve(V);Y.oHeaders["x-csrf-token"]=V;}else{Y.resetSecurityToken();Y.bTokenHandling=false;}}if(i){i(c1,d1);}}function $(c1){Y.resetSecurityToken();Y.bTokenHandling=false;Y._handleError(c1,n);if(j){j(c1);}}function a1(c1){W.request=b1("GET",$);}function b1(c1,j){n=Y._createRequest(X,"",c1,Y._getHeaders(undefined,true),null,null,!!k);n.headers["x-csrf-token"]="Fetch";return Y._request(n,Z,j,undefined,undefined,Y.getServiceMetadata());}if(this.bDisableHeadRequestForToken){W.request=b1("GET",$);}else{W.request=b1("HEAD",a1);}return W;};T.prototype._submitRequest=function(j,k,n){var V=this,W,X,Y,Z,$;Z=new Promise(function(i,g1){$=i;});function a1(i,g1){if(k){k(i,g1);}V.aSideEffectCleanUpFunctions.forEach(function(h1){h1();});V.aSideEffectCleanUpFunctions=[];$();}function b1(i){if(V.bTokenHandling&&i.response){var g1=V._getHeader("x-csrf-token",i.response.headers);if(!j.bTokenReset&&i.response.statusCode=='403'&&g1&&g1.toLowerCase()==="required"){V.resetSecurityToken();j.bTokenReset=true;d1();return;}}if(n){n(i);}$();}function c1(j){if(V.bTokenHandling&&(j.method!=="GET"||V.bTokenHandlingForGet)){V.pReadyForRequest=V.securityTokenAvailable();}return V.pReadyForRequest;}function d1(){if(V.bTokenHandling){delete j.headers["x-csrf-token"];}c1(j).then(function(i){if(V.bTokenHandling&&(j.method!=="GET"||V.bTokenHandlingForGet)){j.headers["x-csrf-token"]=i;}f1();},function(){f1();});}function e1(g1,j,h1){var i1,j1=j.eventInfo.requests;if(j1){h(j1,function(i,j){if(Array.isArray(j)){j.forEach(function(j){h(j.parts,function(i,k1){i1=V._createEventInfo(j.request,k1.fnError);V["fireRequest"+g1](i1);});});}else if(j.parts){h(j.parts,function(i,k1){i1=V._createEventInfo(j.request,k1.fnError);V["fireRequest"+g1](i1);});}else{i1=V._createEventInfo(j.request,j.fnError);V["fireRequest"+g1](i1);}});if(j.eventInfo.batch){i1=V._createEventInfo(j,h1,j1);V["fireBatchRequest"+g1](i1);}}}function f1(){if(V.sSessionContextId){j.headers["sap-contextid"]=V.sSessionContextId;}X=V._request(j,a1,b1,W,undefined,V.getServiceMetadata());if(j.eventInfo){e1("Sent",j,null);delete j.eventInfo;}if(Y&&X){X.abort();}}W=V._getODataHandler(j.requestUri);if(this.bSequentializeRequests){this.pSequentialRequestCompleted.then(function(){d1();});this.pSequentialRequestCompleted=Z;}else{d1();}return{abort:function(){if(X){X.abort();}Y=true;}};};T.prototype._setSessionContextIdHeader=function(i){if(i){this.sSessionContextId=i;}};T.prototype._submitSingleRequest=function(j){var k=this,n,V={},W={},X={};function Y($,a1){if($===undefined&&a1.statusCode===200){Z({message:"Response did not contain a valid OData result",response:a1});return;}function b1($,a1){for(var i=0;i<j.parts.length;i++){if(j.parts[i].request._aborted){k._processAborted(j.parts[i].request,a1);}else if(j.parts[i].fnSuccess){j.parts[i].fnSuccess($,a1);}}if(j.request.requestUri.indexOf("$count")===-1){k.checkUpdate(false,false,W);if(j.bRefreshAfterChange){k._refresh(false,undefined,V,X);}}}k._processSuccess(j.request,a1,b1,W,V,X);k._invalidatePathCache();k._setSessionContextIdHeader(k._getHeader("sap-contextid",a1.headers));}function Z($){var i;if($.message=="Request aborted"){for(i=0;i<j.parts.length;i++){k._processAborted(j.parts[i].request,$);}}else{for(i=0;i<j.parts.length;i++){k._processError(j.parts[i].request,$,j.parts[i].fnError);}}k._processAfterUpdate();}j.request.eventInfo={requests:j.parts,batch:false};n=this._submitRequest(j.request,Y,Z);return n;};T.prototype._submitBatchRequest=function(k,n,V,W){var X=this,Y={},Z={},$={},a1={};function b1(j,h1,i1){var j1,k1,i;for(i=0;i<j.parts.length;i++){if(i1||j.parts[i].request._aborted){X._processAborted(j.parts[i].request,h1);}else if(h1.message){X._processError(j.parts[i].request,h1,j.parts[i].fnError);}else{if(j.request.contentID){j1=j.request.contentID;if(j.request.created||j.request.functionMetadata){k1=X._getKey(h1.data);Z[j1]={key:k1,deepPath:j.request.deepPath.replace("('"+j1+"')",k1.slice(k1.indexOf("(")))};}else{k1=Z[j1].key;j.request.requestUri=j.request.requestUri.replace("$"+j1,k1);j.request.deepPath=Z[j1].deepPath;}}X._processSuccess(j.parts[i].request,h1,j.parts[i].fnSuccess,$,Y,a1,false,undefined,Z);}}}function c1(h1,i1){if(h1===undefined&&i1.statusCode===200){d1({message:"Response did not contain a valid OData batch result",response:i1});return;}var j1,k1,l1,m1=h1.__batchResponses;if(m1){var i,j;for(i=0;i<m1.length;i++){j1=m1[i];if(Array.isArray(n[i])){if(j1.message){for(j=0;j<n[i].length;j++){j1.$reported=false;k1=n[i][j];b1(k1,j1);k1.response=j1;}}else{l1=j1.__changeResponses;for(j=0;j<l1.length;j++){var n1=l1[j];k1=n[i][j];b1(k1,n1);k1.response=n1;}}}else{k1=n[i];b1(k1,j1);k1.response=j1;}}X._invalidatePathCache();X.checkUpdate(false,false,$);}X._processSuccess(k,i1,V,$,Y,a1,true,n);X._setSessionContextIdHeader(X._getHeader("sap-contextid",i1.headers));}function d1(j){var h1=j.message=="Request aborted";j.$reported=true;h(n,function(i,i1){if(Array.isArray(i1)){i1.forEach(function(i1){b1(i1,j,h1);});}else{b1(i1,j,h1);}});X._processAfterUpdate();if(h1){X._processAborted(k,j,true);}else{j.$reported=false;X._processError(k,j,W,true,n);}}k.eventInfo={requests:n,batch:true};var e1=this._submitRequest(k,c1,d1);function f1(j){var W;for(var i=0;i<j.parts.length;i++){W=j.parts[i].fnError;if(!j.parts[i].request._aborted&&W){W(T._createAbortedError());}}}var g1={abort:function(j){h(n,function(i,h1){if(Array.isArray(h1)){h1.forEach(function(h1){f1(h1);});}else{f1(h1);}});if(W&&!j){W(T._createAbortedError());}e1.abort();}};return g1;};T.prototype._invalidatePathCache=function(){var i=this,j;if(Object.keys(this.mInvalidatedPaths).length>0){Object.keys(this.mPathCache).forEach(function(k){for(var n in i.mInvalidatedPaths){j=k.indexOf(n);if(j>-1){if(j+n.length!==k.length){var V=k.substr(j+n.length);i.mPathCache[k].canonicalPath=i.mInvalidatedPaths[n]===null?null:i.mInvalidatedPaths[n]+V;}else{i.mPathCache[k].canonicalPath=i.mInvalidatedPaths[n];}}}});}this.mInvalidatedPaths={};};T.prototype._createBatchRequest=function(i){var j,k,n={},V={},W=true;V.__batchRequests=i;for(var X in i){if(i[X]&&i[X].__changeRequests||i[X]&&i[X].headers&&!i[X].headers['sap-cancel-on-close']){W=false;break;}}j=this.sServiceUrl+"/$batch";if(this.aUrlParams.length>0){j+="?"+this.aUrlParams.join("&");}l(n,this.mCustomHeaders,this.oHeaders);n["Accept"]="multipart/mixed";delete n["Content-Type"];n['sap-cancel-on-close']=W;k={headers:n,requestUri:j,method:"POST",data:V,user:this.sUser,password:this.sPassword,async:true};k.withCredentials=this.bWithCredentials;return k;};T.prototype.abortInternalRequest=function(j,k){var n=this.mRequests;var V,W;if(k){V=k.requestKey;W=k.path;}if(j in this.mDeferredGroups){n=this.mDeferredRequests;}var X=function(Z){for(var i=0;i<Z.parts.length;i++){Z.parts[i].requestHandle.abort();}};var Y=n[j];if(Y){if(V in Y.map){X(Y.map[V]);}else if(W){h(Y.map,function(V,i){if(V.indexOf(W)>=0){X(i);}});}else if(j&&!k){h(Y.map,function(i,Z){X(Z);});}}};T.prototype._pushToRequestQueue=function(i,j,k,n,V,W,X,Y){var Z,$=i[j],a1=n.key?n.key:n.method+":"+n.requestUri;if(this.bWarmup){return;}if(!$){$={};$.map={};$.requests=[];i[j]=$;}if(a1 in $.map&&(n.key||n.method==='GET')){Z=$.map[a1];var b1=Z.request;n.deepPath=b1.deepPath;if(this.sMessageScope===x.BusinessObject){n.headers["sap-message-scope"]=b1.headers["sap-message-scope"];}if(Z.bRefreshAfterChange===undefined){Z.bRefreshAfterChange=Y;}if(!n.key){Z.parts.push({request:n,fnSuccess:V,fnError:W,requestHandle:X});}if(n.method==="GET"){delete b1.data;}else{b1.method=n.method;b1.headers=n.headers;b1.data=n.data;if(n.method==="PUT"){delete b1.headers["x-http-method"];}if(b1._aborted){delete b1._aborted;}}if(b1.functionMetadata){b1.requestUri=n.requestUri;b1.functionTarget=n.functionTarget;}}else{Z={request:n,bRefreshAfterChange:Y,parts:[{request:n,fnSuccess:V,fnError:W,requestHandle:X}]};if(n.method==="GET"){$.requests.push(Z);}else{if(!$.changes){$.changes={};}var c1=$.changes[k];if(!c1){c1=[];$.changes[k]=c1;}Z.changeSetId=k;c1.push(Z);}$.map[a1]=Z;}};T.prototype._collectChangedEntities=function(j,k,n){var V=this;if(j.changes){h(j.changes,function(W,X){for(var i=0;i<X.length;i++){if(X[i].bRefreshAfterChange){var Y=X[i].request,Z="/"+Y.requestUri.split("?")[0],$,a1;if(Y.method==="POST"||Y.method==="DELETE"){var b1=V.oMetadata._getEntityTypeByPath(Z);if(b1){n[b1.entityType]=true;}}else{$=V._getObject(Z);if($){a1=V._getKey($);}else if(Z.lastIndexOf("/")===0){a1=V._getKey(Z);}if(a1){k[a1]=true;}}}}});}};T.prototype._processRequestQueue=function(j,k,n,V){var W=this,X,Y=[];function Z(a1,b1){for(var i=0;i<a1.parts.length;i++){var c1=a1.parts[i];if(c1.request._aborted){W._processAborted(a1.request,null);a1.parts.splice(i,1);i--;}else if(b1){c1.request._handle=b1;b1.iRelevantRequests++;}}}function $(){return{iRelevantRequests:0,oRequestHandle:{},abort:function(){this.iRelevantRequests--;if(this.iRelevantRequests===0&&this.oRequestHandle){this.oRequestHandle.abort(true);if(n){n({},undefined);}}}};}if(this.bUseBatch){h(j,function(i,a1){if(i===k||!k){var b1={},c1={};W._collectChangedEntities(a1,b1,c1);if(Object.keys(b1).length||Object.keys(c1).length){W.bIncludeInCurrentBatch=true;W._refresh(false,i,b1,c1);W.bIncludeInCurrentBatch=false;}}});h(j,function(a1,b1){if(a1===k||!k){var c1=[],d1=[],e1,f1;var g1=$();if(b1.changes){h(b1.changes,function(j1,k1){var l1,i,m1;e1={__changeRequests:[]};f1=[];for(i=0;i<k1.length;i++){l1=k1[i].request;X='/'+W.getKey(l1.data);W.increaseLaundering(X,l1.data);Z(k1[i],g1);if(k1[i].parts.length>0){W.removeInternalMetadata(l1.data);e1.__changeRequests.push(l1);if(l1.expandRequest){m1=k1[i].parts[0];W._pushToRequestQueue(j,a1,undefined,l1.expandRequest,m1.fnSuccess,m1.fnError,m1.requestHandle,false);}f1.push(k1[i]);}}if(e1.__changeRequests&&e1.__changeRequests.length>0){c1.push(e1);d1.push(f1);}});}if(b1.requests){var h1=b1.requests;for(var i=0;i<h1.length;i++){Z(h1[i],g1);if(h1[i].parts.length>0){c1.push(h1[i].request);d1.push(h1[i]);}}}if(c1.length>0){var i1=W._createBatchRequest(c1);g1.oRequestHandle=W._submitBatchRequest(i1,d1,n,V);Y.push(g1.oRequestHandle);}delete j[a1];}});}else{h(j,function(a1,b1){if(a1===k||!k){if(b1.changes){h(b1.changes,function(e1,f1){for(var i=0;i<f1.length;i++){var d1=$();X='/'+W.getKey(f1[i].request.data);W.increaseLaundering(X,f1[i].request.data);Z(f1[i],d1);if(f1[i].parts.length>0){W.removeInternalMetadata(f1[i].request.data);d1.oRequestHandle=W._submitSingleRequest(f1[i]);Y.push(d1.oRequestHandle);}}});}if(b1.requests){var c1=b1.requests;for(var i=0;i<c1.length;i++){var d1=$();Z(c1[i],d1);if(c1[i].parts.length>0){d1.oRequestHandle=W._submitSingleRequest(c1[i]);Y.push(d1.oRequestHandle);}}}delete j[a1];}});}this.checkDataState(this.mLaunderingState);return Y.length==1?Y[0]:Y;};T.prototype._processRequestQueueAsync=function(i){var j=this;if(!this.pCallAsync){this.pCallAsync=this.oMetadata.loaded().then(function(){return Promise.resolve().then(function(){j._processRequestQueue(i);j.pCallAsync=undefined;});});}};T.prototype._processSuccess=function(i,j,k,n,V,W,X,Y,Z){var $,a1,b1,c1,d1,e1,f1,g1,h1,i1,j1,k1,l1,m1={},n1={},o1=j.data,p1=this;if(!X){a1=!(j.statusCode===204||j.statusCode==='204');l1=i.requestUri;j1=l1.replace(this.sServiceUrl,"");if(!j1.startsWith('/')){j1='/'+j1;}h1=this._normalizePath(j1);d1=this.oMetadata._getEntityTypeByPath(h1);g1=d1&&d1.isFunction;j1=this._normalizePath(j1,undefined,!g1);this.decreaseLaundering(j1,i.data);this._decreaseDeferredRequestCount(i);if(i.functionMetadata){if(j.headers&&j.headers.location){e1=j.headers.location;k1=e1.lastIndexOf(this.sServiceUrl);if(k1>-1){$=e1.slice(k1+this.sServiceUrl.length);if(i.functionTarget===$){b1=this.getDeepPathForCanonicalPath($);if(b1){i.deepPath=b1;}}i.functionTarget=$;}}if(i.adjustDeepPath){i.deepPath=i.adjustDeepPath({deepPath:b1||i.functionTarget,response:p({},j)});}else if(!b1){i.deepPath=i.functionTarget;}if(Z&&i.contentID){Z[i.contentID].deepPath=i.deepPath;}}if(a1&&o1===undefined&&j){this._parseResponse(j,i);L.fatal(this+" - No data was retrieved by service: '"+j.requestUri+"'");p1.fireRequestCompleted({url:j.requestUri,type:"GET",async:j.async,info:"Accept headers:"+this.oHeaders["Accept"],infoObject:{acceptHeaders:this.oHeaders["Accept"]},success:false});return false;}if(o1&&!o1.__metadata&&o1.results&&!Array.isArray(o1.results)){o1=o1.results;}if(!j._imported&&o1&&(Array.isArray(o1)||typeof o1=='object')){f1=p({},o1);if(i.key||i.created){p1._importData(f1,n1,j,undefined,undefined,undefined,g1);}else{p1._importData(f1,n1,j,j1,i.deepPath,undefined,g1,undefined,i.sideEffects);}j._imported=true;}c1=this._getEntity(i.key);if(n1&&c1&&c1.__metadata.created&&c1.__metadata.created.functionImport){var q1=[];var r1=c1["$result"];if(r1&&r1.__list){h(n1,function(t1){q1.push(t1);});r1.__list=q1;}else if(r1&&r1.__ref){h(n1,function(t1){r1.__ref=t1;});}}if(!a1){i1=j1.split("/");if(i1[1]){m1[i1[1]]=i;var s1={};s1[i1[1]]=i.data;this._updateChangedEntities(s1);}if(i.method==="DELETE"&&i1[2]!=="$links"){this._removeEntity(i1[1]);}}if(a1&&i.method==="POST"||i.functionMetadata){if(d1){W[d1.entityType]=true;}if(i.key){if(i.created){var t1=this._getKey(o1);var u1=this.getContext("/"+i.key);b1=i.deepPath;if(u1.isTransient()&&b1.endsWith(")")){i.deepPath=b1.slice(0,b1.lastIndexOf("("))+t1.slice(t1.indexOf("("));}this._updateContext(u1,'/'+t1,i.deepPath);u1.setUpdated(true);this.callAfterUpdate(function(){u1.setUpdated(false);});c1=this._getEntity(t1);if(c1){delete c1.__metadata.created;this._keepChangesAfterCreate(i,c1,t1);}this._removeEntity(i.key);}else{delete this.mChangedEntities[i.key];}}}this._parseResponse(j,i,n1,m1);l(n,n1);l(V,m1);this._updateETag(i,j);}if(k){k(o1,j);}var v1=this._createEventInfo(i,j,Y);if(X){this.fireBatchRequestCompleted(v1);}else{this.fireRequestCompleted(v1);}return true;};T.prototype._keepChangesAfterCreate=function(i,j,k){var n,V,W,X=this.mChangedEntities[i.key];if(X){V=this.oMetadata._getNavigationPropertyNames(this.oMetadata._getEntityTypeByPath(k));X=s.merge({},X);X.__metadata=s.merge({},j.__metadata);X.__metadata.deepPath=i.deepPath;for(W in i.data){if(s.deepEqual(i.data[W],X[W])||V.includes(W)){delete X[W];}}this.mChangedEntities[k]=X;n={};n[k]=j;this._updateChangedEntities(n);this.abortInternalRequest(this._resolveGroup(i.key).groupId,{requestKey:i.key});}};T.prototype._processError=function(i,j,k,n,V){var W,X;if(i.functionMetadata){i.deepPath=i.functionTarget;}W=this._handleError(j,i);if(!n){X='/'+this.getKey(i.data);this.decreaseLaundering(X,i.data);this._decreaseDeferredRequestCount(i);}if(k){k(W);}var Y=this._createEventInfo(i,W,V);if(n){this.fireBatchRequestCompleted(Y);this.fireBatchRequestFailed(Y);}else{this.fireRequestCompleted(Y);this.fireRequestFailed(Y);}};T.prototype._processAborted=function(i,j,k){var n,V;if(!k){V='/'+this.getKey(i.data);this.decreaseLaundering(V,i.data);this._decreaseDeferredRequestCount(i);}if(j){n=this._createEventInfo(i,T._createAbortedError());n.success=false;if(k){this.fireBatchRequestCompleted(n);}else{this.fireRequestCompleted(n);}}};T.prototype._processAfterUpdate=function(){var j=this.aCallAfterUpdate;this.aCallAfterUpdate=[];for(var i=0;i<j.length;i++){j[i]();}};T.prototype._processChange=function(k,i,j,V){var W,X,Y,Z,$,a1,b1,c1,d1,e1,f1,g1,h1,i1=this;if(V&&this.mChangedEntities[k]&&this.mChangedEntities[k].__metadata){this.mChangedEntities[k].__metadata.deepPath=V;}else if(!V&&this.mChangedEntities[k]&&this.mChangedEntities[k].__metadata&&this.mChangedEntities[k].__metadata.deepPath){V=this.mChangedEntities[k].__metadata.deepPath;}Y=this.oMetadata._getEntityTypeByPath(k);if(!j){j="MERGE";}d1=p({},this._getObject('/'+k,true),i);if(i.__metadata&&i.__metadata.created){b1=i.__metadata.created.method?i.__metadata.created.method:"POST";k=i.__metadata.created.key;X=true;c1=i.__metadata.created;$=i.__metadata.created.expandRequest;W=i.__metadata.created.contentID;if(i.__metadata.created.functionImport){c1.urlParameters=this._createFunctionImportParameters(i.__metadata.created.key,b1,d1);d1=undefined;}else{delete d1.__metadata['uri'];}}else if(j==="MERGE"){b1="MERGE";f1=this._getEntity(k);}else{b1="PUT";}if(d1&&d1.__metadata){for(var n in d1.__metadata){if(n!=='type'&&n!=='uri'&&n!=='etag'&&n!=='content_type'&&n!=='media_src'){delete d1.__metadata[n];}}}if(d1&&Y){var j1=this.oMetadata._getNavigationPropertyNames(Y);j1.forEach(function(m1){delete d1[m1];});}if(b1==="MERGE"&&Y&&f1){h(d1,function(m1,n1){if(m1!=='__metadata'){if(f(f1[m1],n1)&&!i1.isLaundering('/'+k+'/'+m1)){delete d1[m1];}}});var k1="/"+k,l1;h(d1,function(m1,n1){if(m1!=='__metadata'){l1=i1.getProperty(k1+"/"+m1+"/#@sap:unit");if(l1){if(d1[l1]===undefined){d1[l1]=f1[l1];}}}});if(f1.__metadata.etag){d1.__metadata.etag=f1.__metadata.etag;}}d1=this._removeReferences(d1);h1=c1&&c1.urlParameters?E._createUrlParamsArray(c1.urlParameters):undefined;a1=c1?this._getHeaders(c1.headers):this._getHeaders();Z=c1&&c1.eTag?c1.eTag:this.getETag(d1);g1=this._createRequestUrl('/'+k,null,h1,this.bUseBatch);e1=this._createRequest(g1,V,b1,a1,d1,Z,undefined,true);if(X){e1.created=true;if($){e1.expandRequest=$;e1.contentID=W;}if(i.__metadata.created.functionMetadata){e1.functionTarget=this.oMetadata._getCanonicalPathOfFunctionImport(i.__metadata.created.functionMetadata,c1.urlParameters);}}if(this.bUseBatch){e1.requestUri=e1.requestUri.replace(this.sServiceUrl+'/','');}return e1;};T.prototype._resolveGroup=function(k){var i,j,n,V,W,X;j=this.oMetadata._getEntityTypeByPath(k);X=this._getObject('/'+k);if(X){n=X.__metadata.created;if(n){return{groupId:n.groupId,changeSetId:n.changeSetId};}}if(this.mChangeGroups[j.name]){i=this.mChangeGroups[j.name];V=i.groupId;W=i.single?u():i.changeSetId;}else if(this.mChangeGroups['*']){i=this.mChangeGroups['*'];V=i.groupId;W=i.single?u():i.changeSetId;}return{groupId:V,changeSetId:W};};T.prototype._updateETag=function(i,j){var k,n,V;k=i.requestUri.replace(this.sServiceUrl+'/','');if(!k.startsWith("/")){k="/"+k;}n=this._getObject(k.split("?")[0],undefined,true);V=this._getHeader("etag",j.headers);if(n&&n.__metadata&&V){n.__metadata.etag=V;}};T.prototype._handleError=function(i,j){var k,n={message:i.message};if(i.response){if(!i.$reported){this._parseResponse(i.response,j);if(this.bTokenHandling){k=this._getHeader("x-csrf-token",i.response.headers);if(i.response.statusCode=='403'&&k&&k.toLowerCase()==="required"){this.resetSecurityToken();}}}n.statusCode=i.response.statusCode;n.statusText=i.response.statusText;n.headers=i.response.headers;n.responseText=i.response.body;}else if(!i.$reported){L.error("The following problem occurred: "+i.message,undefined,N);}i.$reported=true;return n;};T.prototype.getData=function(i,j,k){return this.getProperty(i,j,k);};T.prototype._getODataHandler=function(i){if(i.indexOf("$batch")>-1){return I.batchHandler;}else if(i.indexOf("$count")>-1){return undefined;}else if(this.bJSON){return I.jsonHandler;}else{return I.atomHandler;}};T.prototype.getETag=function(i,j,k){if(typeof i=="object"){k=i;i="";}return this._getETag(i,j,k);};T.prototype._getETag=function(i,j,k){if(!k||!k.__metadata){k=this._getObject(i,j);}if(k&&k.__metadata){return k.__metadata.etag;}return null;};T.prototype.forceEntityUpdate=function(k){var i=this.mChangedEntities[k];if(i&&i.__metadata){i.__metadata.etag='*';}else{L.error(this+" - Entity with key "+k+" does not exist or has no change");}};T.prototype._createRequest=function(i,j,k,n,V,W,X,Y,Z){var $;X=X!==false;if(W&&k!=="GET"){n["If-Match"]=W;}if(!n["Content-Type"]&&k!=="DELETE"&&k!=="GET"){if(this.bJSON){n["Content-Type"]="application/json";}else{n["Content-Type"]="application/atom+xml";}}if(i.indexOf("$count")>-1){n["Accept"]="text/plain, */*;q=0.5";}if(k==="MERGE"&&!this.bUseBatch){n["x-http-method"]="MERGE";k="POST";}if(this.sMessageScope===x.BusinessObject){if(this.bIsMessageScopeSupported){n["sap-message-scope"]=this.sMessageScope;}else{L.error("Message scope 'sap.ui.model.odata.MessageScope.BusinessObject' is not"+" supported by the service: "+this.sServiceUrl,undefined,N);}}Y=Y&&this.sMessageScope===x.BusinessObject&&this.bIsMessageScopeSupported;if(this.bUseBatch&&k!=="GET"&&k!=="HEAD"&&!n["Content-ID"]){n["Content-ID"]=u();}$={async:X,deepPath:j,headers:n,method:k,password:this.sPassword,requestUri:i,updateAggregatedMessages:Y,user:this.sUser};if(Z){$.sideEffects=true;}if(V){$.data=V;}if(this.bWithCredentials){$.withCredentials=this.bWithCredentials;}$.requestID=this._createRequestID();return $;};T.prototype._processRequest=function(i,j,k){var n,V,W=false,X=this;if(this.bWarmup){return{abort:function(){}};}if(k){this.iPendingDeferredRequests+=1;}V={abort:function(){if(k&&!W){X.iPendingDeferredRequests-=1;}if(!W&&j){j(T._createAbortedError());}if(n){n._aborted=true;if(n._handle){n._handle.abort();}}W=true;}};this.oMetadata.loaded().then(function(){n=i(V);if(n){n.deferred=!!k;}X._processRequestQueueAsync(X.mRequests);if(W){V.abort();}});return V;};T.prototype.update=function(i,j,k){var n,V,W,X,Y,Z,$,a1,b1,c1,d1,e1,f1,g1,h1,i1=this,j1,k1,l1;if(k){a1=k.groupId||k.batchGroupId;b1=k.changeSetId;Y=k.context;n=k.success;V=k.error;Z=k.eTag;d1=k.headers;c1=k.urlParameters;g1=k.refreshAfterChange;l1=k.canonicalRequest;if(k.merge!==undefined){e1=k.merge?"MERGE":"PUT";}}l1=this._isCanonicalRequestNeeded(l1);h1=a1 in i1.mDeferredGroups;g1=this._getRefreshAfterChange(g1,a1);$=E._createUrlParamsArray(c1);d1=this._getHeaders(d1);e1=e1?e1:this.sDefaultUpdateMethod;Z=Z||this._getETag(i,Y,j);j1=this._normalizePath(i,Y,l1);k1=this.resolveDeep(i,Y);return this._processRequest(function(m1){X=i1._createRequestUrlWithNormalizedPath(j1,$,i1.bUseBatch);W=i1._createRequest(X,k1,e1,d1,j,Z);f1=i1.mRequests;if(h1){f1=i1.mDeferredRequests;}i1._pushToRequestQueue(f1,a1,b1,W,n,V,m1,g1);return W;},V,h1);};T.prototype.create=function(i,j,k){var n,V,W,X,Y,Z,$,a1,b1,c1,d1,e1,f1,g1,h1,i1,j1=this,k1,l1,m1;if(k){X=k.context;$=k.urlParameters;Y=k.success;Z=k.error;e1=k.groupId||k.batchGroupId;g1=k.changeSetId;d1=k.eTag;b1=k.headers;h1=k.refreshAfterChange;m1=k.canonicalRequest;}m1=this._isCanonicalRequestNeeded(m1);h1=this._getRefreshAfterChange(h1,e1);c1=E._createUrlParamsArray($);b1=this._getHeaders(b1);f1="POST";i1=e1 in j1.mDeferredGroups;k1=j1._normalizePath(i,X,m1);l1=this.resolveDeep(i,X);return this._processRequest(function(n1){V=j1._createRequestUrlWithNormalizedPath(k1,c1,j1.bUseBatch);n=j1._createRequest(V,l1,f1,b1,j,d1);n.created=true;W=j1.oMetadata._getEntityTypeByPath(k1);n.entityTypes={};if(W){n.entityTypes[W.entityType]=true;}a1=j1.mRequests;if(i1){a1=j1.mDeferredRequests;}j1._pushToRequestQueue(a1,e1,g1,n,Y,Z,n1,h1);return n;},Z,i1);};T.prototype.remove=function(i,j){var k,n,V,W,X,Y,Z,$,a1,b1,c1,d1,e1,f1,g1,h1,i1,j1,k1,l1=this.bCanonicalRequests,m1=this;if(j){$=j.groupId||j.batchGroupId;k=j.changeSetId;n=j.context;h1=j.success;Y=j.error;Z=j.eTag;a1=j.headers;k1=j.urlParameters;e1=j.refreshAfterChange;l1=j.canonicalRequest;}l1=this._isCanonicalRequestNeeded(l1);e1=this._getRefreshAfterChange(e1,$);j1=E._createUrlParamsArray(k1);a1=this._getHeaders(a1);c1="DELETE";Z=Z||this._getETag(i,n);X=$ in m1.mDeferredGroups;d1=this._normalizePath(i,n,l1);W=this.resolveDeep(i,n);function n1(o1,p1){m1._removeEntity(b1);if(V&&V.isTransient()===false){m1.oCreatedContextsCache.findAndRemoveContext(V);}if(h1){h1(o1,p1);}}return this._processRequest(function(o1){i1=m1._createRequestUrlWithNormalizedPath(d1,j1,m1.bUseBatch);b1=i1.substr(i1.lastIndexOf('/')+1);b1=b1.split("?")[0];V=m1.mContexts["/"+b1];f1=m1._createRequest(i1,W,c1,a1,undefined,Z,undefined,true);g1=m1.mRequests;if(X){g1=m1.mDeferredRequests;}m1._pushToRequestQueue(g1,$,k,f1,n1,Y,o1,e1);return f1;},Y,X);};T.prototype.callFunction=function(i,j){var k,n,V,W,X,Y,Z,$,a1,b1,c1,d1,e1,f1,g1=this;if(!i.startsWith("/")){L.fatal("callFunction: sFunctionName has to be absolute, but the given '"+i+"' is not absolute",this,N);return undefined;}j=j||{};k=j.changeSetId;V=j.error;W=j.eTag;X=j.expand;Y=j.groupId||j.batchGroupId;Z=j.headers;$=j.method||"GET";a1=j.refreshAfterChange;e1=j.success;f1=Object.assign({},j.urlParameters);if(X){if(!this.bUseBatch){throw new Error("Use 'expand' parameter only with 'useBatch' set to 'true'");}if($!=="POST"){throw new Error("Use 'expand' parameter only with HTTP method 'POST'");}}a1=this._getRefreshAfterChange(a1,Y);n=new Promise(function(h1,i1){d1=h1;b1=i1;});c1=this._processRequest(function(h1){var i1,j1,k1,l1,m1,n1,o1,p1,q1,r1,s1,t1={},u1=V,v1=false,w1=e1;k1=g1.oMetadata._getFunctionImportMetadata(i,$);if(!k1){L.error("Function '"+i+"' not found in the metadata",g1,N);b1();return undefined;}if(k1.entitySet||k1.entitySetPath){t1.$result={__list:[]};if(k1.returnType&&!k1.returnType.startsWith("Collection")){t1.$result={__ref:{}};}}if(X&&(!t1.$result||!t1.$result.__ref)){b1(new Error("Use 'expand' parameter only for functions returning a single"+" entity"));return undefined;}if(k1.parameter!=null){k1.parameter.forEach(function(x1){t1[x1.name]=g1._createPropertyValue(x1.type);if(f1[x1.name]!==undefined){t1[x1.name]=f1[x1.name];f1[x1.name]=E.formatValue(f1[x1.name],x1.type);}else{L.warning("No value given for parameter '"+x1.name+"' of function import '"+i+"'",g1,N);}});}q1=u();if(X){Z=Object.assign({},Z,{"Content-ID":q1,"sap-messages":"transientOnly"});e1=function(t1,x1){if(!m1){m1=t1;l1=x1;return;}if(w1){t1=Object.assign({},m1,t1);w1(t1,l1);}};V=function(x1){if(m1){l1.expandAfterFunctionCallFailed=true;x1.expandAfterFunctionCallFailed=true;L.error("Function '"+i+"' was called successfully, but"+" expansion of navigation properties ("+X+") failed",x1,N);if(w1){w1(m1,l1);}return;}if(!v1){v1=true;if(u1){u1(x1);}}else{x1.expandAfterFunctionCallFailed=true;}};}t1.__metadata={uri:g1.sServiceUrl+i+"('"+q1+"')",created:{changeSetId:k,error:V,eTag:W,functionImport:true,groupId:Y,headers:Object.assign({},Z),key:i.substring(1),method:$,success:e1}};n1=g1._addEntity(t1);i1=g1.getContext("/"+n1);g1._writePathCache("/"+n1,"/"+n1);d1(i1);s1=E._createUrlParamsArray(f1);r1=g1._createRequestUrlWithNormalizedPath(i,s1,g1.bUseBatch);o1=g1._createRequest(r1,i,$,g1._getHeaders(Z),undefined,W,undefined,true);o1.adjustDeepPath=j.adjustDeepPath;o1.functionMetadata=k1;t1.__metadata.created.functionMetadata=k1;o1.functionTarget=g1.oMetadata._getCanonicalPathOfFunctionImport(k1,f1);o1.key=n1;if(X){j1=g1._createRequest("$"+q1+"?"+E._encodeURLParameters({$expand:X,$select:X}),"/$"+q1,"GET",g1._getHeaders(undefined,true),undefined,undefined,undefined,true);j1.contentID=q1;o1.expandRequest=j1;o1.contentID=q1;}p1=g1.mRequests;if(Y in g1.mDeferredGroups){p1=g1.mDeferredRequests;}g1._pushToRequestQueue(p1,Y,k,o1,e1,V,h1,a1);return o1;},V);c1.contextCreated=function(){return n;};return c1;};T.prototype._createFunctionImportParameters=function(i,j,k){var n=g({},k);delete n.__metadata;delete n["$result"];var V=this.oMetadata._getFunctionImportMetadata(i,j);d(V,this+": Function "+i+" not found in the metadata !");if(!V){return undefined;}if(V.parameter!=null){h(V.parameter,function(W,X){if(n&&n[X.name]!==undefined){n[X.name]=E.formatValue(n[X.name],X.type);}});}return n;};T.prototype._getResourcePath=function(i,j,k,n){var V,W,X,Y;if(!i){return this.resolve(k,n);}X=this.oMetadata._splitByLastNavigationProperty(j);W=X.pathBeforeLastNavigationProperty;V=X.lastNavigationProperty;if(V.includes("(")&&X.addressable){Y=this.resolve(W+V,undefined,true);if(Y){return Y+X.pathAfterLastNavigationProperty;}}Y=this.resolve(W,undefined,true)||W;return Y+V+X.pathAfterLastNavigationProperty;};T.prototype.read=function(i,j){return this._read(i,j);};T.prototype._read=function(i,j,k){var n,V,W,X,Y,Z,$,a1,b1,c1,d1,e1,f1,g1,h1=this;if(j){n=j.canonicalRequest;V=j.context;W=j.error;Y=j.filters;Z=j.groupId||j.batchGroupId;$=j.headers;c1=j.sorters;d1=j.success;e1=j.updateAggregatedMessages;g1=j.urlParameters;}n=this._isCanonicalRequestNeeded(n);if(i&&i.indexOf('?')!==-1){i=i.slice(0,i.indexOf('?'));}if(this.sRefreshGroupId){Z=this.sRefreshGroupId;}f1=E._createUrlParamsArray(g1);$=this._getHeaders($,true);a1="GET";X=this._getETag(i,V);var i1={abort:function(){if(b1){b1._aborted=true;}}};function j1(k1){var l1,m1,n1,o1,p1,q1,r1=h1.resolveDeep(i,V),s1=h1._getResourcePath(n,r1,i,V);p1=E.createSortParams(c1);if(p1){f1.push(p1);}l1=h1.oMetadata._getEntityTypeByPath(s1);m1=F.groupFilters(Y);n1=E.createFilterParams(m1,h1.oMetadata,l1);if(n1){f1.push(n1);}q1=h1._createRequestUrlWithNormalizedPath(s1,f1,h1.bUseBatch);b1=h1._createRequest(q1,r1,a1,$,null,X,undefined,e1,k);o1=h1.mRequests;if(Z in h1.mDeferredGroups){o1=h1.mDeferredRequests;}h1._pushToRequestQueue(o1,Z,null,b1,d1,W,k1,false);return b1;}if(this.bUseBatch&&this.bIncludeInCurrentBatch){b1=j1(i1);return i1;}else{return this._processRequest(j1,W);}};T.prototype.requestSideEffects=function(i,j){var k,n=this;j=j||{};for(k in j){if(!R.includes(k)){throw new Error("Parameter '"+k+"' is not supported");}}return new Promise(function(V,W){var X=new Set(),Y=j.urlParameters&&j.urlParameters["$expand"];n._read("",{context:i,error:W,groupId:j.groupId,success:function(){V();},updateAggregatedMessages:true,urlParameters:j.urlParameters},true);if(Y){Y.split(",").forEach(function(Z){var $=n.oMetadata._getEntityTypeByPath(n.resolve(Z,i));X.add($);});n.getBindings().forEach(function(Z){if(Z.isA("sap.ui.model.odata.v2.ODataListBinding")){Z._refreshForSideEffects(X,j.groupId);}});}});};T.prototype.getServiceMetadata=function(){if(this.oMetadata&&this.oMetadata.isLoaded()){return this.oMetadata.getServiceMetadata();}return undefined;};T.prototype.metadataLoaded=function(i){var j=this.oMetadata.loaded(i);if(this.bLoadAnnotationsJoined){if(i){return Promise.all([j,this.pAnnotationsLoaded]);}var k=function(){return j;};return this.pAnnotationsLoaded.then(k,k);}else{return j;}};T.prototype.annotationsLoaded=function(){return this.pAnnotationsLoaded;};T.prototype.isMetadataLoadingFailed=function(){return this.oMetadata.isFailed();};T.prototype.getServiceAnnotations=function(){var i=this.oAnnotations.getData();return m(i)?null:i;};T.prototype.onAnnotationsFailed=function(i){this.fireAnnotationsFailed(i.getParameters());};T.prototype.onAnnotationsLoaded=function(i){this.fireAnnotationsLoaded(i.getParameters());};T.prototype.addAnnotationUrl=function(i){var j=[].concat(i),k=[],n=[],V=[],W=this;j.forEach(function(X){var Y=X.indexOf("$metadata");if(Y>=0){X=W._createMetadataUrl(X);k.push(X);}else{n.push(X);}});return this.oMetadata._addUrl(k).then(function(X){return Promise.all(X.map(function(Y){V=V.concat(Y.entitySets);return W.oAnnotations.addSource({type:"xml",data:Y["metadataString"]});}));}).then(function(){return W.oAnnotations.addSource(n);}).then(function(X){return{annotations:W.oAnnotations.getData(),entitySets:V};});};T.prototype.addAnnotationXML=function(X,i){return this.oAnnotations.addSource({type:"xml",data:X});};T.prototype.submitChanges=function(j){var k,n,V,W,X,Y,Z,$=false,a1=this.bRefreshAfterChange,b1=this;if(j){V=j.groupId||j.batchGroupId;Z=j.success;n=j.error;if(j.merge!==undefined){W=j.merge?"MERGE":"PUT";}}if(V&&!this.mDeferredGroups[V]){L.fatal(this+" submitChanges: \""+V+"\" is not a deferred group!");}k=p({},b1.mChangedEntities);this.oMetadata.loaded().then(function(){var c1,d1,e1,i,f1,g1;h(k,function(h1,i1){var j1,k1,l1,m1=b1._resolveGroup(h1);if(m1.groupId===V||!V){k1=b1._processChange(h1,i1,W||b1.sDefaultUpdateMethod);k1.key=h1;j1=i1.__metadata&&i1.__metadata.created?i1.__metadata.created:{};l1={abort:function(){k1._aborted=true;}};if(m1.groupId in b1.mDeferredGroups){b1._pushToRequestQueue(b1.mDeferredRequests,m1.groupId,m1.changeSetId,k1,j1.success,j1.error,l1,j1.refreshAfterChange===undefined?a1:j1.refreshAfterChange);}}});for(f1 in b1.mDeferredRequests){g1=b1.mDeferredRequests[f1];for(e1 in g1.changes){d1=g1.changes[e1];for(i=d1.length-1;i>=0;i--){c1=d1[i];if(c1.bRefreshAfterChange===undefined){c1.bRefreshAfterChange=a1;}}}}Y=b1._processRequestQueue(b1.mDeferredRequests,V,Z,n);if($){X.abort();}if(Array.isArray(Y)&&Y.length==0&&Z){Z({},undefined);}});X={abort:function(){if(Y){if(Array.isArray(Y)){Y.forEach(function(X){X.abort();});}else{Y.abort();}}else{$=true;}}};return X;};T.prototype._updateChangedEntities=function(i){var j=this,k,n,V;function W(X,Y,Z){h(Y,function($){var a1=Z+'/'+$;if(o(Y[$])&&o(X[$])){W(X[$],Y[$],a1);if(m(Y[$])){delete Y[$];}}else if(Z.endsWith("__metadata")||f(Y[$],X[$])&&!j.isLaundering(a1)){delete Y[$];if(Z===k){n=j.oMetadata._getEntityTypeByPath(k);V=n&&j.oMetadata._getNavPropertyRefInfo(n,$);if(V&&Y[V.name]){X[V.name]=Y[V.name];delete Y[V.name];}}}});}h(i,function(X,Y){if(X in j.mChangedEntities){var Z=j._getObject('/'+X,null,true);var $=j._getObject('/'+X);p(Z,Y);k='/'+X;var a1=j.removeInternalMetadata($).deepPath;W(Z,$,k);if(m($)){delete j.mChangedEntities[X];j.abortInternalRequest(j._resolveGroup(X).groupId,{requestKey:X});}else{j.mChangedEntities[X]=$;$.__metadata={deepPath:a1};l($.__metadata,Z.__metadata);}}});};T.prototype._discardEntityChanges=function(k,i){var j,n=this._resolveGroup(k).groupId,V=this.oMetadata.loaded(),W=this;V.then(function(){W.abortInternalRequest(n,{requestKey:k});});if(i){this.oCreatedContextsCache.findAndRemoveContext(this.mContexts["/"+k]);j=this.mChangedEntities[k]&&this.mChangedEntities[k].__metadata.created;this._removeEntity(k);if(j&&j.abort){j.abort(T._createAbortedError());}}else{delete this.mChangedEntities[k];}sap.ui.getCore().getMessageManager().removeMessages(this.getMessagesByEntity(k,!i));return V;};T.prototype.resetChanges=function(j,k,n){var V=this.oMetadata.loaded(),W=this;if(k){V.then(function(){h(W.mDeferredGroups,function(i){if(j){j.forEach(function(X){W.abortInternalRequest(i,{path:X.substring(1)});});}else{W.abortInternalRequest(i);}});});}if(j){h(j,function(X,Y){var Z,i,$,a1,b1,c1={};if(W.getEntityByPath(Y,null,c1)){b1=c1.propertyPath.split("/");a1=b1[b1.length-1];$=c1.key;Z=W.mChangedEntities[$];if(Z){for(i=0;i<b1.length-1;i+=1){if(Z&&Z.hasOwnProperty(b1[i])){Z=Z[b1[i]];}else{Z=undefined;break;}}if(Z&&Z.hasOwnProperty(a1)){delete Z[a1];}Z=W.mChangedEntities[$];if(T._isChangedEntityEmpty(Z)||!c1.propertyPath){W._discardEntityChanges($,Z.__metadata.created&&n);}}}});}else{h(this.mChangedEntities,function(i,X){W._discardEntityChanges(i,X.__metadata.created&&n);});}this.checkUpdate(true);return V;};T.prototype.setProperty=function(j,V,k,n){var W,X,Y,Z,$,a1,b1,c1,d1,e1,f1,g1,h1,i1,j1,k1,l1,m1,n1,o1,p1,q1,r1,s1={},t1={},u1=false,v1=this;function w1(y1,z1){h(z1,function(e1){if(o(z1[e1])&&o(y1[e1])){w1(y1[e1],z1[e1]);if(m(z1[e1])){delete z1[e1];}}else if(f(z1[e1],y1[e1])){delete z1[e1];}});}r1=this.resolve(j,k);Z=this.resolveDeep(j,k);b1=this.getEntityByPath(r1,null,t1);if(!b1){return false;}l1=r1.substring(r1.lastIndexOf("/")+1);if(l1.startsWith("@$ui5.")){throw new Error("Setting a value for an instance annotation starting with '@$ui5' is "+"not allowed: "+l1);}e1=t1.key;h1=this._getObject('/'+e1,null,true);i1=this._getObject(j,k,true);if(!this.mChangedEntities[e1]){$=b1.__metadata;b1={};b1.__metadata=Object.assign({},$);if(t1.propertyPath.length>0){var x1=Z.lastIndexOf(t1.propertyPath);b1.__metadata.deepPath=Z.substring(0,x1-1);}this.mChangedEntities[e1]=b1;}X=this.mChangedEntities[e1];k1=t1.propertyPath.split("/");for(var i=0;i<k1.length-1;i++){if(!X.hasOwnProperty(k1[i])){X[k1[i]]={};}X=X[k1[i]];}u1=h1.__metadata.created&&h1.__metadata.created.functionImport;X[l1]=V;a1=this.oMetadata._getEntityTypeByPath(t1.key);g1=a1&&this.oMetadata._getNavPropertyRefInfo(a1,l1);d1=g1&&h1[g1.name]&&h1[g1.name].__ref;if(d1&&g1.keys.length===1){if(V===null){m1=null;}else{f1={};g1.keys.forEach(function(y1){f1[y1]=b1[y1]!==undefined?b1[y1]:h1[y1];});f1[g1.keys[0]]=V;m1=this.createKey(g1.entitySet,f1);}X[g1.name]={__ref:m1};}if(f(V,i1)&&!this.isLaundering('/'+e1)&&!u1){$=this.mChangedEntities[e1].__metadata;Y=$&&$.created;delete this.mChangedEntities[e1].__metadata;if(!Y){w1(h1,this.mChangedEntities[e1]);}if(m(this.mChangedEntities[e1])){delete this.mChangedEntities[e1];s1[e1]=true;this.checkUpdate(false,n,s1);v1.oMetadata.loaded().then(function(){v1.abortInternalRequest(v1._resolveGroup(e1).groupId,{requestKey:e1});});return true;}this.mChangedEntities[e1].__metadata=$;}c1=this._resolveGroup(e1);p1=this.mRequests;if(c1.groupId in this.mDeferredGroups){p1=this.mDeferredRequests;o1=this._processChange(e1,{__metadata:b1.__metadata},this.sDefaultUpdateMethod);}else{o1=this._processChange(e1,this._getObject('/'+e1),this.sDefaultUpdateMethod);}o1.key=e1;j1=X.__metadata&&X.__metadata.created?X.__metadata.created:{};n1=this._getRefreshAfterChange(undefined,c1.groupId);if(b1.__metadata.created&&!b1.__metadata.created.functionImport){W=this.oCreatedContextsCache.findCreatedContext(r1);if(W){W.activate();}}this.oMetadata.loaded().then(function(){q1={abort:function(){o1._aborted=true;}};v1._pushToRequestQueue(p1,c1.groupId,c1.changeSetId,o1,j1.success,j1.error,q1,n1);v1._processRequestQueueAsync(v1.mRequests);});s1[e1]=true;this.checkUpdate(false,n,s1);return true;};T.prototype._isHeaderPrivate=function(i){switch(i.toLowerCase()){case"accept":case"accept-language":case"maxdataserviceversion":case"dataserviceversion":return true;case"x-csrf-token":return this.bTokenHandling;case"sap-contextid-accept":case"sap-contextid":return!this.bDisableSoftStateHeader;default:return false;}};T.prototype.setHeaders=function(i){var j={},k=this;this.mCustomHeaders={};if(i){h(i,function(n,V){if(k._isHeaderPrivate(n)){L.warning(this+" - modifying private header: '"+n+"' not allowed!");}else{j[n]=V;}});this.mCustomHeaders=j;}if(this.oAnnotations){this.oAnnotations.setHeaders(this.mCustomHeaders);}};T.prototype._getHeaders=function(i,j){var k={},n=this;if(i){h(i,function(V,W){if(n._isHeaderPrivate(V)){L.warning(this+" - modifying private header: '"+V+"' not allowed!");}else{k[V]=W;}});}return l({'sap-cancel-on-close':!!j},this.mCustomHeaders,k,this.oHeaders);};T.prototype.getHeaders=function(){return l({},this.mCustomHeaders,this.oHeaders);};T.prototype._getHeader=function(i,j){var k;for(k in j){if(k.toLowerCase()===i.toLowerCase()){return j[k];}}return null;};T.prototype.hasPendingChanges=function(i){var j=!m(this.mChangedEntities);if(i){j=j||this.iPendingDeferredRequests>0;}return j;};T.prototype.hasPendingRequests=function(){return this.aPendingRequestHandles.length>0;};T.prototype.getPendingChanges=function(){return p({},this.mChangedEntities);};T.prototype.updateBindings=function(i){this.checkUpdate(i);};T.prototype.setTokenHandlingEnabled=function(i){this.bTokenHandling=i;};T.prototype.setUseBatch=function(i){this.bUseBatch=i;};T.prototype.formatValue=function(V,i){return E.formatValue(V,i);};T.prototype.deleteCreatedEntry=function(i){var j,k,n=this;if(i){k=i.getPath().substr(1);j=this._resolveGroup(k).groupId;n.oMetadata.loaded().then(function(){n.abortInternalRequest(j,{requestKey:k});});n._removeEntity(k);sap.ui.getCore().getMessageManager().removeMessages(this.getMessagesByEntity(i.getPath(),true));}};T.prototype.createEntry=function(j,k){var n,V,W,X,Y,Z,$,a1,b1,c1,d1,e1,f1,g1,h1,i1,j1,k1,l1,m1,n1,o1,p1,q1={},r1="POST",s1=this;if(k){i1=k.properties;d1=k.groupId||k.batchGroupId;V=k.changeSetId;W=k.context;m1=k.success;a1=k.error;X=k.created;b1=k.eTag;e1=k.headers;p1=k.urlParameters;j1=k.refreshAfterChange;n=k.canonicalRequest;c1=k.expand;f1=k.inactive;}if(c1&&!this.bUseBatch){throw new Error("The 'expand' parameter is only supported if batch mode is used");}n=this._isCanonicalRequestNeeded(n);e1=e1||{};o1=E._createUrlParamsArray(p1);var t1={abort:function(){if(k1){k1._aborted=true;if(k1.expandRequest){k1.expandRequest._aborted=true;}}}};if(!j.startsWith("/")&&!W){j="/"+j;}h1=s1._normalizePath(j,W,n);$=s1.resolveDeep(j,W);function u1(){var v1,w1,x1,y1,z1,A1,B1,C1=false,D1=a1,E1=m1;A1=s1._resolveGroup(h1);d1=d1||A1.groupId;V=V||A1.changeSetId;j1=s1._getRefreshAfterChange(j1,d1);var F1=s1.oMetadata._getEntityTypeByPath(h1);if(!F1){d(F1,"No Metadata for collection "+h1+" found");return undefined;}if(typeof i1==="object"&&!Array.isArray(i1)){q1=p({},i1);}else{for(var i=0;i<F1.property.length;i++){var G1=F1.property[i];var H1=(i1?i1.indexOf(G1.name):-1)>-1;if(!i1||H1){q1[G1.name]=s1._createPropertyValue(G1.type);if(H1){i1.splice(i1.indexOf(G1.name),1);}}}if(i1){d(i1.length===0,"No metadata for the following properties found: "+i1.join(","));}}y1=s1.oMetadata._getEntitySetByType(F1);B1=u();g1=y1.name+"('"+B1+"')";if($&&s1.oMetadata._isCollection($)){$=$+"('"+B1+"')";}if(c1){e1=Object.assign({},e1,{"Content-ID":B1,"sap-messages":"transientOnly"});m1=function(I1,J1){if(!v1){v1=I1;x1=J1;return;}if(E1){I1=Object.assign({},v1,I1);E1(I1,x1);}Z();};a1=function(I1){if(v1){x1.expandAfterCreateFailed=true;I1.expandAfterCreateFailed=true;L.error("Entity creation was successful but expansion of navigation"+" properties failed",I1,N);if(E1){E1(v1,x1);}Z();return;}if(!C1){C1=true;if(D1){D1(I1);}}else{I1.expandAfterCreateFailed=true;C1=false;}};}else{m1=function(I1,x1){if(E1){E1(I1,x1);}Z();};}q1.__metadata={type:""+F1.entityType,uri:s1.sServiceUrl+'/'+g1,created:{changeSetId:V,error:a1,eTag:b1,groupId:d1,headers:e1,key:h1.substring(1),refreshAfterChange:j1,success:m1,urlParameters:p1},deepPath:$};Y=new S(function(I1,J1){Z=function(){if(!s1.oCreatedContextsCache.getCacheInfo(w1)){w1.resetCreatedPromise();}I1();};q1.__metadata.created.abort=J1;});Y.catch(function(){});g1=s1._addEntity(p({},q1));if(!f1){s1.mChangedEntities[g1]=q1;}n1=s1._createRequestUrlWithNormalizedPath(h1,o1,s1.bUseBatch);k1=s1._createRequest(n1,$,r1,e1,q1,b1);if(c1){z1=s1._createRequest("$"+B1+"?"+E._encodeURLParameters({$expand:c1,$select:c1}),"/$"+B1,"GET",s1._getHeaders(undefined,true),null,undefined,undefined,true);z1.contentID=B1;k1.expandRequest=z1;k1.contentID=B1;q1.__metadata.created.expandRequest=z1;q1.__metadata.created.contentID=B1;}w1=s1.getContext("/"+g1,$,Y,f1);k1.key=g1;k1.created=true;l1=s1.mRequests;if(d1 in s1.mDeferredGroups){l1=s1.mDeferredRequests;}s1.oMetadata.loaded().then(function(){w1.fetchActivated().then(function(){s1._pushToRequestQueue(l1,d1,V,k1,m1,a1,t1,j1);s1._processRequestQueueAsync(s1.mRequests);});});return w1;}if(X){this.oMetadata.loaded().then(function(){X(u1());});}else if(this.oMetadata.isLoaded()){return u1();}else{L.error("Tried to use createEntry without created-callback, before metadata is "+"available!");}return undefined;};T.prototype._isCreatedEntity=function(i){return!!(i&&i.__metadata&&i.__metadata.created);};T.prototype._createPropertyValue=function(j){var k=this.oMetadata._splitName(j);var n=k.namespace;var V=k.name;if(n.toUpperCase()!=='EDM'){var W={};var X=this.oMetadata._getObjectMetadata("complexType",V,n);d(X,"Complex type "+j+" not found in the metadata !");for(var i=0;i<X.property.length;i++){var Y=X.property[i];W[Y.name]=this._createPropertyValue(Y.type);}return W;}else{return this._getDefaultPropertyValue(V,n);}};T.prototype._getDefaultPropertyValue=function(i,n){return undefined;};T.prototype._normalizePath=function(i,j,k){if(i&&i.indexOf('?')!==-1){i=i.substr(0,i.indexOf('?'));}if(!j&&!i.startsWith("/")){L.fatal(this+" path "+i+" must be absolute if no Context is set");}return this.resolve(i,j,k)||this.resolve(i,j);};T.prototype.getRefreshAfterChange=function(){return this.bRefreshAfterChange;};T.prototype.setRefreshAfterChange=function(i){this.bRefreshAfterChange=i;};T.prototype.isList=function(i,j){i=this.resolve(i,j);return i&&i.substr(i.lastIndexOf("/")).indexOf("(")===-1;};T.prototype._isMetadataPath=function(i){var j=false;if(i&&i.indexOf('/#')>-1){j=true;}return j;};T.prototype.isMetaModelPath=function(i){return i.indexOf("##")==0||i.indexOf("/##")>-1;};T.prototype._request=function(i,j,k,n,V,W){var X;if(this.bDestroyed){return{abort:function(){}};}var Y=this;function Z($){return function(){if(Y.aPendingRequestHandles){var a1=Y.aPendingRequestHandles.indexOf(X);if(a1>-1){Y.aPendingRequestHandles.splice(a1,1);}}if(!(X&&X.bSuppressErrorHandlerCall)){$.apply(this,arguments);}};}X=I.request(i,Z(j||I.defaultSuccess),Z(k||I.defaultError),n,V,W);if(i.async!==false){this.aPendingRequestHandles.push(X);}return X;};T.prototype.destroy=function(){this.bDestroyed=true;v.prototype.destroy.apply(this,arguments);if(this.aPendingRequestHandles){for(var i=this.aPendingRequestHandles.length-1;i>=0;i--){var j=this.aPendingRequestHandles[i];if(j&&j.abort){j.bSuppressErrorHandlerCall=true;j.abort();}}delete this.aPendingRequestHandles;}if(this.sMetadataLoadEvent){clearTimeout(this.sMetadataLoadEvent);}if(this.oMetadataFailedEvent){clearTimeout(this.oMetadataFailedEvent);}if(this.oMetadata){this.oMetadata.detachFailed(this.onMetadataFailed);if(!this.oMetadata.isLoaded()&&!this.oMetadata.hasListeners("loaded")){this.oMetadata.destroy();delete this.oSharedMetaData.oMetadata;}delete this.oMetadata;delete this.pMetadataLoaded;}if(this.oMetaModel){this.oMetaModel.destroy();delete this.oMetaModel;}if(this.oAnnotations){this.oAnnotations.detachSomeLoaded(this.onAnnotationsLoaded);this.oAnnotations.detachAllFailed(this.onAnnotationsFailed);this.oAnnotations.destroy();delete this.oAnnotations;delete this.pAnnotationsLoaded;}};T.prototype.setDeferredBatchGroups=function(i){this.setDeferredGroups(i);};T.prototype.setDeferredGroups=function(i){var j=this;this.mDeferredGroups={};h(i,function(k,n){j.mDeferredGroups[n]=n;});};T.prototype.getDeferredBatchGroups=function(){return this.getDeferredGroups();};T.prototype.getDeferredGroups=function(){return Object.keys(this.mDeferredGroups);};T.prototype.setChangeBatchGroups=function(i){h(i,function(j,k){k.groupId=k.batchGroupId;});this.setChangeGroups(i);};T.prototype.setChangeGroups=function(i){this.mChangeGroups=i;};T.prototype.getChangeBatchGroups=function(){return this.getChangeGroups();};T.prototype.getChangeGroups=function(){return this.mChangeGroups;};T.prototype.setMessageParser=function(i){if(!(i instanceof r)){L.error("Given MessageParser is not of type sap.ui.core.message.MessageParser");return this;}i.setProcessor(this);this.oMessageParser=i;return this;};T.prototype._parseResponse=function(i,j,k,n){try{if(!this.oMessageParser){this.oMessageParser=new A(this.sServiceUrl,this.oMetadata,!!this.bPersistTechnicalMessages);this.oMessageParser.setProcessor(this);}this.oMessageParser.parse(i,j,k,n,this.bIsMessageScopeSupported);}catch(V){L.error("Error parsing OData messages: "+V);}};T.prototype.callAfterUpdate=function(i){this.aCallAfterUpdate.push(i);};T.prototype.getMetaModel=function(){var i=this;if(!this.oMetaModel){this.oMetaModel=new z(this.oMetadata,this.oAnnotations,this);this.oMetaModel.loaded().then(function(){i.bMetaModelLoaded=true;i.checkUpdate(false,false,null,true);},function(j){var k=j.message,n;if(!k&&j.xmlDoc&&j.xmlDoc.parseError){k=j.xmlDoc.parseError.reason;n=j.xmlDoc.parseError.srcText;}L.error("error in ODataMetaModel.loaded(): "+k,n,N);});}return this.oMetaModel;};T.prototype.getOriginalProperty=function(i,j){return this._getObject(i,j,true);};T.prototype.getEntityByPath=function(i,j,k){var n,V=v.prototype.resolve.call(this,i,j);if(!V){return null;}var W=V.split("/"),X=null,Y=[];while(W.length>0){var Z=W.join("/"),$=this._getObject(Z);if(o($)){n=this._getKey($);if(n){X=$;break;}}Y.unshift(W.pop());}if(X){k.propertyPath=Y.join("/");k.key=n;return X;}return null;};T.prototype.resolveFromCache=function(i){if(!this.mPathCache){return undefined;}var j,k="",n,V,W;n=this.mPathCache[i]?this.mPathCache[i].canonicalPath:undefined;if(i&&n!==i){j=n||i;if(!n){W=j.lastIndexOf("/");k=j.substr(W);j=j.substr(0,W);}V=this.resolveFromCache(j);if(V&&V!==j){n=V+k;}}return n;};T.prototype.resolve=function(i,j,k){var n=v.prototype.resolve.call(this,i,j);if(n&&!this._isMetadataPath(n)&&k){var V=this.resolveFromCache(n);if(!V){V=this.oMetadata._calculateCanonicalPath(n);V=this.resolveFromCache(V)||V;}this._writePathCache(n,V);return V;}return n;};T.prototype.resolveDeep=function(i,j){var k=v.prototype.resolve.call(this,i,j);if(i&&!i.startsWith("/")){k=j?j.sDeepPath+'/'+i:k;}if(i===""){k=j?j.sDeepPath:k;}return k;};T.prototype.isLaundering=function(i,j){var k=this.resolve(i,j);return(k in this.mLaunderingState)&&this.mLaunderingState[k]>0;};T.prototype.increaseLaundering=function(i,j){if(!o(j)){return;}for(var n in j){if(n==="__metadata"){continue;}var k=j[n];if(o(k)){this.increaseLaundering(i+"/"+n,k);}else{var V=i+"/"+n;if(!(V in this.mLaunderingState)){this.mLaunderingState[V]=0;}this.mLaunderingState[V]++;}}if(!(i in this.mLaunderingState)){this.mLaunderingState[i]=0;}this.mLaunderingState[i]++;};T.prototype.decreaseLaundering=function(i,j){if(!o(j)){return;}for(var n in j){if(n==="__metadata"){continue;}var k=j[n],V=i+"/"+n;if(o(k)){this.decreaseLaundering(V,k);}else if(V in this.mLaunderingState){this.mLaunderingState[V]--;if(this.mLaunderingState[V]===0){delete this.mLaunderingState[V];}}}this.mLaunderingState[i]--;if(this.mLaunderingState[i]===0){delete this.mLaunderingState[i];}};T.prototype._getRefreshAfterChange=function(i,j){if(i===undefined&&!(j in this.mDeferredGroups)){return this.bRefreshAfterChange;}return i;};T.prototype.getMessagesByEntity=function(j,k){var n=j,V=[],W;function X(V){var Y=[];for(var i=0;i<V.length;i++){if(!k||(k&&!V[i].persistent)){Y.push(V[i]);}}return Y;}if(!n.startsWith('/')){n='/'+n;}if(this.mMessages){for(W in this.mMessages){if(typeof n=="string"&&n.length>0&&W.startsWith(n)){V=V.concat(X(this.mMessages[W]));}}return V;}return null;};T.prototype._cacheSupported=function(i){var j=/\/~[\w\-]+~[A-Z0-9]?/;var k=[i];if(this.sAnnotationURI){if(!Array.isArray(this.sAnnotationURI)){this.sAnnotationURI=[this.sAnnotationURI];}k=k.concat(this.sAnnotationURI);}k=k.filter(function(n){return n.indexOf("sap-context-token")===-1;});k=k.filter(function(n){return!j.test(n);});return k.length===0?true:false;};T.prototype._getAnnotationCacheKey=function(i){var j;if(this.bUseCache){if(!this.bSkipMetadataAnnotationParsing){j=i+"#annotations";}if(this.sAnnotationURI){if(!Array.isArray(this.sAnnotationURI)){this.sAnnotationURI=[this.sAnnotationURI];}this.sAnnotationURI=this.sAnnotationURI.map(function(k){return k+"#annotations";});j=this.bSkipMetadataAnnotationParsing?this.sAnnotationURI.join("_"):j+"_"+this.sAnnotationURI.join("_");}}return j;};T.prototype.canonicalRequestsEnabled=function(){return this.bCanonicalRequests;};T.prototype._decreaseDeferredRequestCount=function(i){if(i.deferred){this.iPendingDeferredRequests--;}};T.prototype.enableCanonicalRequests=function(i){this.bCanonicalRequests=!!i;};T.prototype.getMessageScope=function(){return this.sMessageScope;};T.prototype.setMessageScope=function(i){if(i!==x.RequestedObjects&&i!==x.BusinessObject){throw new Error("Unsupported message scope: "+i);}this.sMessageScope=i;};T.prototype.messageScopeSupported=function(){var i=this;return this.metadataLoaded().then(function(){return i.bIsMessageScopeSupported;});};T.prototype.getContext=function(i,j,k,n){var V=this.mContexts[i];if(!V){V=this.mContexts[i]=new C(this,i,j,k,n);}else{V.setDeepPath(j||V.getDeepPath()||i);}return V;};T.prototype.hasContext=function(i){return this.mContexts[i];};T.prototype.removeInternalMetadata=function(i){var j,k,n,V,W;if(i&&i.__metadata){j=i.__metadata.created;k=i.__metadata.deepPath;n=i.__metadata.invalid;delete i.__metadata.created;delete i.__metadata.deepPath;delete i.__metadata.invalid;}for(V in i){W=i[V];if(Array.isArray(W)){W.forEach(T.prototype.removeInternalMetadata);}else if(typeof W==="object"){T.prototype.removeInternalMetadata(W);}}return{created:j,deepPath:k,invalid:n};};T.prototype._isCanonicalRequestNeeded=function(i){if(i!==undefined){return!!i;}else{return!!this.bCanonicalRequests;}};T.prototype.filterMatchingMessages=function(i,j){var k=this;return this.mMessages[i].filter(function(n){return k.isMessageMatching(n,j);});};T.prototype.isMessageMatching=function(i,j){var k=j.length;return i.aFullTargets.some(function(n){return n===j||n.startsWith(j)&&(j==="/"||n[k]==="/"||n[k]==="(");});};T.prototype.getMessages=function(i){return this.getMessagesByPath(i.sDeepPath,true).sort(M.compare);};T.prototype.getDeepPathForCanonicalPath=function(j){var k,V,W,X,Y,i,n,Z=j.slice(j.indexOf("("));Y=this.aBindings.filter(function($){return($ instanceof a||$ instanceof b)&&$.isResolved();});for(i=0,n=Y.length;i<n;i+=1){k=Y[i];W=this.resolveDeep(k instanceof b?k.sPath+Z:k.sPath,k.oContext);V=this.resolveFromCache(W);if(V===j){if(X&&X!==W){return undefined;}X=W;}}return X;};T.prototype.getPersistTechnicalMessages=function(){return this.bPersistTechnicalMessages;};T.prototype.setPersistTechnicalMessages=function(i){i=!!i;if(this.bPersistTechnicalMessages===i){return;}if(this.bPersistTechnicalMessages!==undefined){L.warning("The flag whether technical messages should always be treated as persistent"+" has been overwritten to "+i,undefined,N);}this.bPersistTechnicalMessages=i;if(this.oMessageParser){this.oMessageParser._setPersistTechnicalMessages(i);}};T.prototype.createCodeListModelParameters=function(i){i=i||{};return{defaultCountMode:w.None,disableSoftStateHeader:true,headers:i.headers&&Object.assign({},i.headers),json:i.json,metadataUrlParams:i.metadataUrlParams&&Object.assign({},i.metadataUrlParams),persistTechnicalMessages:i.persistTechnicalMessages,serviceUrl:this.sServiceUrl,serviceUrlParams:i.serviceUrlParams&&Object.assign({},i.serviceUrlParams),tokenHandling:false,useBatch:false,warmupUrl:i.warmupUrl};};T.prototype.getCodeListModelParameters=function(){return this.mCodeListModelParams;};T.prototype.getMetadataUrl=function(){return this.sMetadataUrl;};T._createAbortedError=function(){return{aborted:true,headers:{},message:"Request aborted",responseText:"",statusCode:0,statusText:"abort"};};T.prototype._getCreatedContextsCache=function(){return this.oCreatedContextsCache;};T._isChangedEntityEmpty=function(i){return Object.keys(i).every(function(k){return k==="__metadata";});};return T;});
