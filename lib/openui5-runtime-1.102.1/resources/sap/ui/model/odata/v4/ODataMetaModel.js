/*!
 * OpenUI5
 * (c) Copyright 2009-2022 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["./AnnotationHelper","./ValueListType","./lib/_Helper","sap/base/assert","sap/base/Log","sap/base/util/isEmptyObject","sap/base/util/JSTokenizer","sap/base/util/ObjectPath","sap/ui/base/ManagedObject","sap/ui/base/SyncPromise","sap/ui/model/BindingMode","sap/ui/model/ChangeReason","sap/ui/model/ClientListBinding","sap/ui/model/Context","sap/ui/model/ContextBinding","sap/ui/model/MetaModel","sap/ui/model/PropertyBinding","sap/ui/model/odata/OperationMode","sap/ui/model/odata/type/Boolean","sap/ui/model/odata/type/Byte","sap/ui/model/odata/type/Date","sap/ui/model/odata/type/DateTimeOffset","sap/ui/model/odata/type/Decimal","sap/ui/model/odata/type/Double","sap/ui/model/odata/type/Guid","sap/ui/model/odata/type/Int16","sap/ui/model/odata/type/Int32","sap/ui/model/odata/type/Int64","sap/ui/model/odata/type/Raw","sap/ui/model/odata/type/SByte","sap/ui/model/odata/type/Single","sap/ui/model/odata/type/Stream","sap/ui/model/odata/type/String","sap/ui/model/odata/type/TimeOfDay","sap/ui/thirdparty/URI"],function(A,V,_,a,L,b,J,O,M,S,B,C,c,d,f,g,P,h,k,l,E,D,m,o,G,I,p,q,R,r,s,t,u,T,U){"use strict";var v=M.extend("sap.ui.model.odata.v4._any",{metadata:{properties:{any:"any"}}}),w,x=new Map(),y=L.Level.DEBUG,z=/\$\(/g,F=/^-?\d+$/,H="sap.ui.model.odata.v4.ODataMetaModel",K=/\(.*\)$/,N=new R(),Q=/\$\)/g,W=new Map(),X={messageChange:true},Y={"Edm.Boolean":{Type:k},"Edm.Byte":{Type:l},"Edm.Date":{Type:E},"Edm.DateTimeOffset":{constraints:{$Precision:"precision"},Type:D},"Edm.Decimal":{constraints:{"@Org.OData.Validation.V1.Minimum/$Decimal":"minimum","@Org.OData.Validation.V1.Minimum@Org.OData.Validation.V1.Exclusive":"minimumExclusive","@Org.OData.Validation.V1.Maximum/$Decimal":"maximum","@Org.OData.Validation.V1.Maximum@Org.OData.Validation.V1.Exclusive":"maximumExclusive",$Precision:"precision",$Scale:"scale"},Type:m},"Edm.Double":{Type:o},"Edm.Guid":{Type:G},"Edm.Int16":{Type:I},"Edm.Int32":{Type:p},"Edm.Int64":{Type:q},"Edm.SByte":{Type:r},"Edm.Single":{Type:s},"Edm.Stream":{Type:t},"Edm.String":{constraints:{"@com.sap.vocabularies.Common.v1.IsDigitSequence":"isDigitSequence",$MaxLength:"maxLength"},Type:u},"Edm.TimeOfDay":{constraints:{$Precision:"precision"},Type:T}},Z={},$="@com.sap.vocabularies.Common.v1.ValueList",a1="@com.sap.vocabularies.Common.v1.ValueListMapping",b1="@com.sap.vocabularies.Common.v1.ValueListReferences",c1="@com.sap.vocabularies.Common.v1.ValueListRelevantQualifiers",d1="@com.sap.vocabularies.Common.v1.ValueListWithFixedValues",e1=L.Level.WARNING,f1,g1=g.extend("sap.ui.model.odata.v4.ODataMetaModel",{constructor:r1}),h1,i1;function j1(e,i,j,n){var s1,t1=e.mSchema2MetadataUrl[i];if(!t1){t1=e.mSchema2MetadataUrl[i]={};t1[j]=false;}else if(!(j in t1)){s1=Object.keys(t1)[0];if(t1[s1]){p1(e,"A schema cannot span more than one document: "+i+" - expected reference URI "+s1+" but instead saw "+j,n);}t1[j]=false;}}function k1(e,i,j,n){var s1,t1,u1,v1;function w1(x1){var y1,z1;if(!(j in x1)){n(e1,t1," does not contain ",j);return;}n(y,"Including ",j," from ",t1);for(z1 in x1){if(z1[0]!=="$"&&q1(z1)===j){y1=x1[z1];i[z1]=y1;o1(y1,i.$Annotations);}}}if(j in i){return i[j];}v1=e.mSchema2MetadataUrl[j];if(v1){u1=Object.keys(v1);if(u1.length>1){p1(e,"A schema cannot span more than one document: "+"schema is referenced by following URLs: "+u1.join(", "),j);}t1=u1[0];v1[t1]=true;n(y,"Namespace ",j," found in $Include of ",t1);s1=e.mMetadataUrl2Promise[t1];if(!s1){n(y,"Reading ",t1);s1=e.mMetadataUrl2Promise[t1]=S.resolve(e.oRequestor.read(t1)).then(e.validate.bind(e,t1));}s1=s1.then(w1);if(j in i){return i[j];}i[j]=s1;return s1;}}function l1(e,i){if(e===i){return"";}if(e.startsWith(i)&&e[i.length]==="#"&&!e.includes("@",i.length)){return e.slice(i.length+1);}}function m1(e){var i=l1(e,a1);return i!==undefined?i:l1(e,$);}function n1(n,e){return e.some(function(i){return n==="$ReturnType"?i.$ReturnType:i.$Parameter&&i.$Parameter.some(function(j){return j.$Name===n;});});}function o1(e,i,j){var n;function s1(t1,u1){var v1;for(v1 in u1){if(j||!(v1 in t1)){t1[v1]=u1[v1];}}}for(n in e.$Annotations){if(!(n in i)){i[n]={};}s1(i[n],e.$Annotations[n]);}delete e.$Annotations;}function p1(e,i,j){var n=new Error(j+": "+i);e.oModel.reportError(i,H,n);throw n;}function q1(e){return e.slice(0,e.lastIndexOf(".")+1);}f1=f.extend("sap.ui.model.odata.v4.ODataMetaContextBinding",{constructor:function(e,i,j){a(!j||j.getModel()===e,"oContext must belong to this model");f.call(this,e,i,j);},initialize:function(){var e=this.oModel.createBindingContext(this.sPath,this.oContext);this.bInitial=false;if(e!==this.oElementContext){this.oElementContext=e;this._fireChange();}},setContext:function(e){a(!e||e.getModel()===this.oModel,"oContext must belong to this model");if(e!==this.oContext){this.oContext=e;if(!this.bInitial){this.initialize();}}}});h1=c.extend("sap.ui.model.odata.v4.ODataMetaListBinding",{constructor:function(){c.apply(this,arguments);},_fireFilter:function(){},_fireSort:function(){},checkUpdate:function(e){var i=this.oList.length;this.update();if(e||this.oList.length!==i){this._fireChange({reason:C.Change});}},fetchContexts:function(){var i,e=this.getResolvedPath(),j=this;if(!e){return S.resolve([]);}i=e.endsWith("@");if(!i&&!e.endsWith("/")){e+="/";}return this.oModel.fetchObject(e).then(function(n){if(!n){return[];}if(i){e=e.slice(0,-1);}return Object.keys(n).filter(function(s1){return s1[0]!=="$"&&i!==(s1[0]!=="@");}).map(function(s1){return new d(j.oModel,e+s1);});});},getContexts:function(i,e){this.iCurrentStart=i||0;this.iCurrentLength=Math.min(e||Infinity,this.iLength-this.iCurrentStart);return this.getCurrentContexts();},getCurrentContexts:function(){var e=[],i,n=this.iCurrentStart+this.iCurrentLength;for(i=this.iCurrentStart;i<n;i+=1){e.push(this.oList[this.aIndices[i]]);}if(this.oList.dataRequested){e.dataRequested=true;}return e;},setContexts:function(e){this.oList=e;this.updateIndices();this.applyFilter();this.applySort();this.iLength=this._getLength();},update:function(){var e=[],i=this.fetchContexts(),j=this;if(i.isFulfilled()){e=i.getResult();}else{i.then(function(e){j.setContexts(e);j._fireChange({reason:C.Change});});e.dataRequested=true;}this.setContexts(e);}});i1=P.extend("sap.ui.model.odata.v4.ODataMetaPropertyBinding",{constructor:function(){P.apply(this,arguments);this.vValue=undefined;},checkUpdate:function(e,i){var j,n=this;function s1(t1){if(e||t1!==n.vValue){n.vValue=t1;n._fireChange({reason:i||C.Change});}return t1;}j=this.oModel.fetchObject(this.sPath,this.oContext,this.mParameters).then(s1);if(this.mParameters&&this.mParameters.$$valueAsPromise&&j.isPending()){s1(j.unwrap());}else if(j.isRejected()){j.unwrap();}},getValue:function(){return this.vValue;},setContext:function(e){if(this.oContext!==e){this.oContext=e;if(this.bRelative){this.checkUpdate(false,C.Context);}}},setValue:function(){throw new Error("Unsupported operation: ODataMetaPropertyBinding#setValue");}});function r1(e,i,j,n,s1){g.call(this);this.aAnnotationUris=j&&!Array.isArray(j)?[j]:j;this.sDefaultBindingMode=B.OneTime;this.mETags={};this.oLastModified=new Date(0);this.oMetadataPromise=null;this.oModel=n;this.mMetadataUrl2Promise={};this.oRequestor=e;this.mSchema2MetadataUrl={};this.mSupportedBindingModes={OneTime:true,OneWay:true};this.bSupportReferences=s1!==false;this.mUnsupportedFilterOperators={All:true,Any:true};this.sUrl=i;}g1.prototype.$$valueAsPromise=true;g1.prototype._mergeAnnotations=function(e,j){var n=this;this.validate(this.sUrl,e);e.$Annotations={};Object.keys(e).forEach(function(i){if(e[i].$kind==="Schema"){j1(n,i,n.sUrl);o1(e[i],e.$Annotations);}});j.forEach(function(s1,i){var t1,u1;n.validate(n.aAnnotationUris[i],s1);for(u1 in s1){if(u1[0]!=="$"){if(u1 in e){p1(n,"A schema cannot span more than one document: "+u1,n.aAnnotationUris[i]);}t1=s1[u1];e[u1]=t1;if(t1.$kind==="Schema"){j1(n,u1,n.aAnnotationUris[i]);o1(t1,e.$Annotations,true);}}}});};g1.prototype.attachEvent=function(e,i,j,n){if(!(e in X)){throw new Error("Unsupported event '"+e+"': v4.ODataMetaModel#attachEvent");}return g.prototype.attachEvent.apply(this,arguments);};g1.prototype.bindContext=function(e,i){return new f1(this,e,i);};g1.prototype.bindList=function(e,i,j,n){return new h1(this,e,i,j,n);};g1.prototype.bindProperty=function(e,i,j){return new i1(this,e,i,j);};g1.prototype.bindTree=function(e,i,j,n,s1){throw new Error("Unsupported operation: v4.ODataMetaModel#bindTree");};g1.prototype.fetchCanonicalPath=function(e){return this.fetchUpdateData("",e).then(function(i){if(!i.editUrl){throw new Error(e.getPath()+": No canonical path for transient entity");}if(i.propertyPath){throw new Error("Context "+e.getPath()+" does not point to an entity. It should be "+i.entityPath);}return"/"+i.editUrl;});};g1.prototype.fetchData=function(){return this.fetchEntityContainer().then(function(e){return JSON.parse(JSON.stringify(e));});};g1.prototype.fetchEntityContainer=function(e){var i,j=this;if(!this.oMetadataPromise){i=[S.resolve(this.oRequestor.read(this.sUrl,false,e))];if(this.aAnnotationUris){this.aAnnotationUris.forEach(function(n){i.push(S.resolve(j.oRequestor.read(n,true,e)));});}if(!e){this.oMetadataPromise=S.all(i).then(function(n){var s1=n[0];j._mergeAnnotations(s1,n.slice(1));return s1;});}}return this.oMetadataPromise;};g1.prototype.fetchObject=function(j,n,s1){var t1=this.resolve(j,n),u1=this;if(!t1){L.error("Invalid relative path w/o context",j,H);return S.resolve(null);}return this.fetchEntityContainer().then(function(v1){var w1,x1,y1,z1,A1,B1,C1,D1,E1,F1;function G1(e,i,O1){var P1,Q1,R1,S1,T1="";if(i){Q1=i.indexOf("@@");if(Q1>0){i=i.slice(0,Q1);}}else{i=e;}O1=O1||"";if(w1){C1=S1=F1.filter(J1);if(S1.length!==1){return K1(e1,"Expected a single overload, but found "+S1.length);}if(w1!==Z){T1=S1[0].$Parameter[0].$isCollection?"Collection("+w1+")":w1;}R1=E1+"("+T1+")"+O1;if(v1.$Annotations[R1]){if(i==="@"){F1=v1.$Annotations[R1];P1=v1.$Annotations[E1+O1];if(P1){F1=Object.assign({},P1,F1);}return false;}if(i in v1.$Annotations[R1]){E1=R1;F1=v1;return true;}}}E1+=O1;F1=v1;return true;}function H1(i,j){var O1,P1,Q1,R1=i.indexOf("@",2);if(R1>-1){return K1(e1,"Unsupported path after ",i.slice(0,R1));}i=i.slice(2);Q1=i.indexOf("(");if(Q1>0){if(!i.endsWith(")")){return K1(e1,"Expected ')' instead of '",i.slice(-1),"'");}try{P1=J.parseJS("["+i.slice(Q1+1,-1).replace(z,"{").replace(Q,"}")+"]");}catch(e){return K1(e1,e.message,": ",e.text.slice(1,e.at),"<--",e.text.slice(e.at,-1));}i=i.slice(0,Q1);}O1=i[0]==="."?O.get(i.slice(1),s1.scope):s1&&O.get(i,s1.scope)||(i==="requestCurrencyCodes"||i==="requestUnitsOfMeasure"?u1[i].bind(u1):O.get(i));if(typeof O1!=="function"){return K1(e1,i," is not a function but: "+O1);}try{F1=O1(F1,{$$valueAsPromise:s1&&s1.$$valueAsPromise,arguments:P1,context:new d(u1,j),schemaChildName:D1,overload:C1.length===1?C1[0]:undefined});}catch(e){K1(e1,"Error calling ",i,": ",e);}return true;}function I1(e,i){var O1;if(e==="$ReturnType"){if(i.$ReturnType){F1=i.$ReturnType;return true;}}else if(e&&i.$Parameter){O1=i.$Parameter.filter(function(P1){return P1.$Name===e;});if(O1.length){F1=O1[0];return true;}}return false;}function J1(e){return!e.$IsBound&&w1===Z||e.$IsBound&&w1===e.$Parameter[0].$Type;}function K1(i){var e;if(L.isLoggable(i,H)){e=Array.isArray(z1)?z1.join("/"):z1;L[i===y?"debug":"warning"](Array.prototype.slice.call(arguments,1).join("")+(e?" at /"+e:""),t1,H);}if(i===e1){F1=undefined;}return false;}function L1(e,i){var O1;function P1(){z1=z1||E1&&i&&E1+"/"+i;return K1.apply(this,arguments);}w1=F1&&F1.$Type||w1;if(u1.bSupportReferences&&!(e in v1)){O1=q1(e);F1=k1(u1,v1,O1,P1);}if(e in v1){E1=A1=D1=e;F1=C1=v1[D1];if(!S.isThenable(F1)){return true;}}if(S.isThenable(F1)&&F1.isPending()){return P1(y,"Waiting for ",O1);}return P1(e1,"Unknown qualified name ",e);}function M1(e,i,O1){var P1,Q1,R1;if(e==="$Annotations"){return K1(e1,"Invalid segment: $Annotations");}e=e.replaceAll("%2F","/");if(i&&typeof F1==="object"&&e in F1){if(e[0]==="$"||F.test(e)){B1=false;}}else{P1=e.indexOf("@@");if(P1<0){if(e.endsWith("@sapui.name")){P1=e.length-11;}else{P1=e.indexOf("@");}}if(P1>0){if(!M1(e.slice(0,P1),i,O1)){return false;}e=e.slice(P1);R1=true;if(F1&&(F1.$kind==="EntitySet"||F1.$kind==="Singleton")){x1=F1;}}if(typeof F1==="string"&&!(R1&&(e==="@sapui.name"||e[1]==="@"))&&!(B1&&C1&&C1.$kind==="EnumType")&&!N1(F1,O1.slice(0,i))){return false;}if(B1){if(e[0]==="$"&&e!=="$Parameter"&&e!=="$ReturnType"||F.test(e)){B1=false;}else{Q1=typeof F1==="object";if(R1){}else if(e[0]!=="@"&&e.includes(".",1)){return L1(e);}else if(Q1&&"$Type"in F1){if(!L1(F1.$Type,"$Type")){return false;}}else if(Q1&&"$Action"in F1){if(!L1(F1.$Action,"$Action")){return false;}w1=Z;}else if(Q1&&"$Function"in F1){if(!L1(F1.$Function,"$Function")){return false;}w1=Z;}else if(!i){E1=A1=D1=D1||v1.$EntityContainer;F1=C1=C1||v1[D1];if(Array.isArray(F1)){if(w1){F1=F1.filter(J1);}if(I1(e,F1[0])){return true;}}if(e&&e[0]!=="@"&&!(e in C1)){return K1(e1,"Unknown child ",e," of ",D1);}}if(Array.isArray(F1)){if(e==="$Parameter"){return true;}if(e.startsWith("@$ui5.overload@")){e=e.slice(14);R1=true;}if(R1){if(e[1]!=="@"&&!G1(e)){return false;}}else{if(e!==O1[i]&&O1[i][e.length+1]!=="@"&&n1(e,F1)){A1=e;return G1(e,O1[i].slice(e.length),"/"+A1);}if(w1){F1=F1.filter(J1);}if(e==="@$ui5.overload"){return true;}if(F1.length!==1){return K1(e1,"Expected a single overload, but found "+F1.length);}if(I1(e,F1[0])){return true;}F1=F1[0].$ReturnType;E1+="/0/$ReturnType";if(F1){if(e==="value"&&!(v1[F1.$Type]&&v1[F1.$Type].value)){A1=undefined;return true;}if(!L1(F1.$Type,"$Type")){return false;}}if(!e){return true;}}}}}if(!e){return i+1>=O1.length||K1(e1,"Invalid empty segment");}if(e[0]==="@"){if(e==="@sapui.name"){F1=A1;if(F1===undefined){K1(e1,"Unsupported path before @sapui.name");}else if(i+1<O1.length){K1(e1,"Unsupported path after @sapui.name");}return false;}if(e[1]==="@"){if(i+1<O1.length){return K1(e1,"Unsupported path after ",e);}return H1(e,[""].concat(O1.slice(0,i),O1[i].slice(0,P1)).join("/"));}}if(B1&&e[0]==="@"){w1=F1&&F1.$Type||w1;F1=v1.$Annotations[E1]||{};B1=false;}else if(e==="$"&&i+1<O1.length){return K1(e1,"Unsupported path after $");}else if(!F1||typeof F1!=="object"){F1=undefined;return!y1&&K1(y,"Invalid segment: ",e);}}if(e!=="@"&&e!=="$"){if(e[0]==="@"){y1=true;}A1=B1||e[0]==="@"?e:undefined;E1=B1?E1+"/"+e:undefined;F1=F1[e];}return true;}function N1(e,i){var O1;if(z1){return K1(e1,"Invalid recursion");}z1=i;y1=false;B1=true;F1=v1;if(x1){if(!e){F1=x1;x1=z1=undefined;return true;}D1=x1.$Type;x1=C1=undefined;}O1=e.split("/").every(M1);z1=undefined;return O1;}if(!N1(t1.slice(1))&&S.isThenable(F1)){F1=F1.then(function(){return u1.fetchObject(j,n,s1);});}return F1;});};g1.prototype.fetchUI5Type=function(e,i){var j=this.getMetaContext(e),n=this;if(e.endsWith("/$count")){w=w||new q();return S.resolve(w);}return this.fetchObject(undefined,j).catch(this.oModel.getReporter()).then(function(s1){var t1=N,u1;if(!s1){L.warning("No metadata for path '"+e+"', using "+t1.getName(),undefined,H);return t1;}if(i){if(b(i)){i=undefined;}else if("parseKeepsEmptyString"in i&&s1.$Type!=="Edm.String"){if(Object.keys(i).length===1){i=undefined;}else{i=Object.assign({},i);delete i.parseKeepsEmptyString;}}}if(!i&&s1["$ui5.type"]){return s1["$ui5.type"];}if(s1.$isCollection){L.warning("Unsupported collection type, using "+t1.getName(),e,H);}else{u1=Y[s1.$Type];if(u1){t1=new u1.Type(i,n.getConstraints(s1,j.getPath()));}else{L.warning("Unsupported type '"+s1.$Type+"', using "+t1.getName(),e,H);}}if(!i){s1["$ui5.type"]=t1;}return t1;});};g1.prototype.fetchUpdateData=function(e,j,n){var s1=j.getModel(),t1=s1.resolve(e,j),u1=this;function v1(i){var w1=new Error(t1+": "+i);s1.reportError(i,H,w1);throw w1;}return this.fetchObject(_.getMetaPath(t1)).then(function(){return u1.fetchEntityContainer();}).then(function(w1){var x1,y1=w1[w1.$EntityContainer],z1,A1,B1,C1,D1=false,E1,F1,G1,H1;function I1(M1){var i=M1.indexOf("(");return i>=0?M1.slice(i):"";}function J1(i){x1.push({path:E1,prefix:i,type:H1});}function K1(M1){var i=M1.indexOf("(");return i>=0?M1.slice(0,i):M1;}function L1(i){if(i.includes("($uid=")){J1(K1(i));}else{x1.push(i);}}G1=t1.slice(1).split("/");C1=G1.shift();E1="/"+C1;z1=E1;B1=decodeURIComponent(K1(C1));A1=y1[B1];if(!A1){v1("Not an entity set: "+B1);}H1=w1[A1.$Type];e="";F1="";x1=[];L1(C1);G1.forEach(function(i){var M1,N1;E1+="/"+i;if(F.test(i)){J1(x1.pop());z1+="/"+i;}else{N1=decodeURIComponent(K1(i));F1=_.buildPath(F1,N1);M1=D1?{}:H1[N1];if(!M1){if(N1.includes("@")){if(N1.includes("@$ui5.")){v1("Read-only path must not be updated");}D1=true;M1={};}else{v1("Not a (navigation) property: "+N1);}}H1=w1[M1.$Type];if(M1.$kind==="NavigationProperty"){if(A1.$NavigationPropertyBinding&&F1 in A1.$NavigationPropertyBinding){B1=A1.$NavigationPropertyBinding[F1];A1=y1[B1];F1="";x1=[encodeURIComponent(B1)+I1(i)];if(!M1.$isCollection){J1(x1.pop());}}else{L1(i);}z1=E1;e="";}else{e=_.buildPath(e,i);}}});if(n){return S.resolve({editUrl:undefined,entityPath:z1,propertyPath:e});}return S.all(x1.map(function(i){if(typeof i==="string"){return i;}return j.fetchValue(i.path).then(function(M1){var N1;if(!M1){v1("No instance to calculate key predicate at "+i.path);}if(M1["@$ui5.context.isTransient"]){n=true;return undefined;}N1=_.getPrivateAnnotation(M1,"predicate");if(!N1){v1("No key predicate known at "+i.path);}return i.prefix+N1;},function(M1){v1(M1.message+" at "+i.path);});})).then(function(i){return{editUrl:n?undefined:i.join("/"),entityPath:z1,propertyPath:e};});});};g1.prototype.fetchValueListMappings=function(e,i,j,n){var s1=this,t1=e.getMetaModel();function u1(){var v1=n[0],w1="";if(n.length!==1){throw new Error("Expected a single overload, but found "+n.length);}if(v1.$IsBound){w1=v1.$Parameter[0].$isCollection?"Collection("+v1.$Parameter[0].$Type+")":v1.$Parameter[0].$Type;}return i+"("+w1+")";}return t1.fetchEntityContainer().then(function(v1){var w1,x1=v1.$Annotations,y1,z1=_.namespace(i),A1={},B1=s1===t1,C1,D1;if(j.$Name){y1=u1()+"/"+j.$Name;D1=i+"/"+j.$Name;}C1=Object.keys(x1).filter(function(E1){if(_.namespace(E1)===z1){if(y1?E1===y1||E1===D1:s1.getObject("/"+E1)===j){return true;}if(B1||D1&&_.getMetaPath(E1)===D1){return false;}throw new Error("Unexpected annotation target '"+E1+"' with namespace of data service in "+e.sServiceUrl);}return false;});if(!C1.length){throw new Error("No annotation '"+$.slice(1)+"' in "+e.sServiceUrl);}if(C1.length===1){w1=x1[C1[0]];}else{w1=Object.assign({},x1[D1],x1[y1]);}Object.keys(w1).forEach(function(E1){var F1=m1(E1);if(F1!==undefined){A1[F1]=w1[E1];["CollectionRoot","SearchSupported"].forEach(function(G1){if(G1 in w1[E1]){throw new Error("Property '"+G1+"' is not allowed in annotation '"+E1.slice(1)+"' for target '"+C1[0]+"' in "+e.sServiceUrl);}});}else if(!B1){throw new Error("Unexpected annotation '"+E1.slice(1)+"' for target '"+C1[0]+"' with namespace of data service in "+e.sServiceUrl);}});return A1;});};g1.prototype.fetchValueListType=function(e){var i=this.getMetaContext(e),j=this;return this.fetchObject(undefined,i).then(function(n){var s1,t1;if(!n){throw new Error("No metadata for "+e);}s1=j.getObject("@",i);if(s1[d1]){return V.Fixed;}for(t1 in s1){if(l1(t1,b1)!==undefined||l1(t1,a1)!==undefined){return V.Standard;}if(l1(t1,$)!==undefined){return s1[t1].SearchSupported===false?V.Fixed:V.Standard;}}return V.None;});};g1.prototype.getAbsoluteServiceUrl=function(e){var i=new U(this.sUrl).absoluteTo(document.baseURI).pathname().toString();return new U(e).absoluteTo(i).filename("").toString();};g1.prototype.getAllPathReductions=function(e,n,s1,t1){var u1=n.split("/").length,v1,w1={},x1=e.split("/"),y1=this;function z1(j,A1,B1,C1){var D1,E1,i;function F1(G1){if(!s1){z1(j,A1,i-1,true);}if(C1){A1=A1.slice();j=j.slice();}A1.splice(i,G1);j.splice(i,G1);if(!s1){w1[j.join("/")]=true;}}for(i=B1;i>=u1;i-=1){D1=F.test(j[i+1])?i+2:i+1;if(D1<j.length&&A1[i].$Partner===j[D1]&&!A1[D1].$isCollection&&A1[D1].$Partner===j[i].replace(K,"")){F1(D1-i+1);}else if(Array.isArray(A1[i])&&j[i+1]==="$Parameter"){E1=y1.getObject(_.getMetaPath(j.slice(0,i+1).join("/")+"/@$ui5.overload"));if(E1.length===1&&E1[0].$Parameter[0].$Name===j[i+2]){F1(3);}}else if(t1&&A1[i].$isCollection){break;}}}v1=x1.map(function(i,j){return j<u1||i[0]==="#"||i[0]==="@"||F.test(i)||i==="$Parameter"?{}:y1.getObject(_.getMetaPath(x1.slice(0,j+1).join("/")))||{};});w1[e]=true;if(!(t1&&v1[x1.length-1].$isCollection)){z1(x1,v1,x1.length-2);}return s1?x1.join("/"):Object.keys(w1);};g1.prototype.getConstraints=function(e,i){var j,n,s1,t1=Y[e.$Type];function u1(v1,w1){if(w1!==undefined){n=n||{};n[v1]=w1;}}if(t1){s1=t1.constraints;for(j in s1){u1(s1[j],j[0]==="@"?this.getObject(i+j):e[j]);}if(e.$Nullable===false){u1("nullable",false);}}return n;};g1.prototype.getData=_.createGetMethod("fetchData");g1.prototype.getETags=function(){return this.mETags;};g1.prototype.getLastModified=function(){return this.oLastModified;};g1.prototype.getMetaContext=function(e){return new d(this,_.getMetaPath(e));};g1.prototype.getMetaPath=function(e){return _.getMetaPath(e);};g1.prototype.getObject=_.createGetMethod("fetchObject");g1.prototype.getOrCreateSharedModel=function(e,i,j){var n,s1;e=this.getAbsoluteServiceUrl(e);n=!!j+e;s1=W.get(n);if(!s1){s1=new this.oModel.constructor({autoExpandSelect:j,groupId:i,httpHeaders:this.oModel.getHttpHeaders(),operationMode:h.Server,serviceUrl:e,sharedRequests:true,synchronizationMode:"None"});W.set(n,s1);}return s1;};g1.prototype.getOriginalProperty=function(){throw new Error("Unsupported operation: v4.ODataMetaModel#getOriginalProperty");};g1.prototype.getProperty=g1.prototype.getObject;g1.prototype.getReducedPath=function(e,i){return this.getAllPathReductions(e,i,true,true);};g1.prototype.getUI5Type=_.createGetMethod("fetchUI5Type",true);g1.prototype.getUnitOrCurrencyPath=function(e){var i=this.getObject("@",this.getMetaContext(e)),j=i&&(i["@Org.OData.Measures.V1.Unit"]||i["@Org.OData.Measures.V1.ISOCurrency"]);return j&&j.$Path;};g1.prototype.getValueListType=_.createGetMethod("fetchValueListType",true);g1.prototype.isList=function(){throw new Error("Unsupported operation: v4.ODataMetaModel#isList");};g1.prototype.refresh=function(){throw new Error("Unsupported operation: v4.ODataMetaModel#refresh");};g1.prototype.requestCodeList=function(e,i,j){var n=this.fetchEntityContainer().getResult(),s1=n[n.$EntityContainer],t1=this;if(j&&j.context){if(j.context.getModel()!==this||j.context.getPath()!=="/"){throw new Error("Unsupported context: "+j.context);}}if(i!==undefined&&i!==s1){throw new Error("Unsupported raw value: "+i);}return this.requestObject("/@com.sap.vocabularies.CodeList.v1."+e).then(function(u1){var v1,w1,x1,y1,z1;if(!u1){return null;}v1=t1.getAbsoluteServiceUrl(u1.Url)+"#"+u1.CollectionPath;y1=x.get(v1);if(y1){return y1;}x1=t1.getOrCreateSharedModel(u1.Url,"$direct");w1=x1.getMetaModel();z1="/"+u1.CollectionPath+"/";y1=w1.requestObject(z1).then(function(A1){var B1=z1+"@Org.OData.Core.V1.AlternateKeys",C1=w1.getObject(B1),D1,E1=M1(A1.$Key),F1=z1+E1+"@com.sap.vocabularies.Common.v1.",G1,H1,I1=z1+E1+"@com.sap.vocabularies.CodeList.v1.StandardCode/$Path",J1,K1;function L1(N1,O1){var P1=O1.getProperty(E1),Q1={Text:O1.getProperty(K1),UnitSpecificScale:O1.getProperty(H1)};if(J1){Q1.StandardCode=O1.getProperty(J1);}if(Q1.UnitSpecificScale===null){L.error("Ignoring customizing w/o unit-specific scale for code "+P1+" from "+u1.CollectionPath,u1.Url,H);}else{N1[P1]=Q1;}return N1;}function M1(N1){var O1;if(N1&&N1.length===1){O1=N1[0];}else{throw new Error("Single key expected: "+z1);}return typeof O1==="string"?O1:O1[Object.keys(O1)[0]];}if(C1){if(C1.length!==1){throw new Error("Single alternative expected: "+B1);}else if(C1[0].Key.length!==1){throw new Error("Single key expected: "+B1+"/0/Key");}E1=C1[0].Key[0].Name.$PropertyPath;}H1=w1.getObject(F1+"UnitSpecificScale/$Path");K1=w1.getObject(F1+"Text/$Path");G1=[E1,H1,K1];J1=w1.getObject(I1);if(J1){G1.push(J1);}D1=x1.bindList("/"+u1.CollectionPath,null,null,null,{$select:G1});return D1.requestContexts(0,Infinity).then(function(N1){if(!N1.length){L.error("Customizing empty for ",x1.sServiceUrl+u1.CollectionPath,H);}return N1.reduce(L1,{});}).finally(function(){D1.destroy();});});x.set(v1,y1);return y1;});};g1.prototype.requestCurrencyCodes=function(e,i){return this.requestCodeList("CurrencyCodes",e,i);};g1.prototype.requestData=_.createRequestMethod("fetchData");g1.prototype.requestObject=_.createRequestMethod("fetchObject");g1.prototype.requestUI5Type=_.createRequestMethod("fetchUI5Type");g1.prototype.requestUnitsOfMeasure=function(e,i){return this.requestCodeList("UnitsOfMeasure",e,i);};g1.prototype.requestValue4Annotation=function(e,i,j){var n=new v({any:A.value(e,{context:this.createBindingContext(i)}),bindingContexts:j,models:j.getModel()}),s1=n.getBinding("any"),t1;if(s1){if(s1.getBindings){t1=Promise.all(s1.getBindings().map(function(u1){return u1.requestValue();}));}else{t1=s1.requestValue();}}else{t1=Promise.resolve();}return t1.then(function(){return n.getAny();});};g1.prototype.requestValueListInfo=function(e,j,n){var s1=_.getMetaPath(e),t1=s1.slice(0,s1.lastIndexOf("/")).replace("/$Parameter",""),u1=t1.slice(t1.lastIndexOf("/")+1),v1=this;if(!u1.includes(".")){u1=undefined;}return Promise.all([u1||this.requestObject(t1+"/@sapui.name"),this.requestObject(s1),this.requestObject(s1+"@"),this.requestObject(s1+d1),this.requestObject(t1+"/@$ui5.overload")]).then(function(w1){var x1=w1[2],y1=w1[3],z1={},A1=w1[1],B1={};function C1(i,D1,E1,F1){if("CollectionRoot"in i){F1=v1.getOrCreateSharedModel(i.CollectionRoot,undefined,j);if(B1[D1]&&B1[D1].$model===F1){z1[D1]=undefined;}}if(z1[D1]){throw new Error("Annotations '"+$.slice(1)+"' with identical qualifier '"+D1+"' for property "+e+" in "+z1[D1]+" and "+E1);}z1[D1]=E1;i=_.clone(i);i.$model=F1;delete i.CollectionRoot;delete i.SearchSupported;B1[D1]=i;}if(!A1){throw new Error("No metadata for "+e);}return Promise.all(Object.keys(x1).filter(function(i){return l1(i,b1)!==undefined;}).map(function(D1){var E1=x1[D1];return Promise.all(E1.map(function(i){var F1=v1.getOrCreateSharedModel(i,undefined,j);return v1.fetchValueListMappings(F1,w1[0],A1,w1[4]).then(function(G1){return{valueListMappingByQualifier:G1,$model:F1};});})).then(function(w1){E1.forEach(function(F1,i){var G1=w1[i].valueListMappingByQualifier;Object.keys(G1).forEach(function(H1){C1(G1[H1],H1,F1,w1[i].$model);});});});})).then(function(){var i=x1[c1];Object.keys(x1).filter(function(D1){return m1(D1)!==undefined;}).forEach(function(D1){C1(x1[D1],m1(D1),v1.sUrl,v1.oModel);});if(b(B1)){throw new Error("No annotation '"+b1.slice(1)+"' for "+e);}return i&&n&&n.getBinding?v1.filterValueListRelevantQualifiers(B1,i,s1+c1,n):B1;}).then(function(i){var D1,E1;if(y1){D1=Object.keys(i);if(D1.length!==1){throw new Error("Annotation '"+d1.slice(1)+"' but not exactly one '"+$.slice(1)+"' for property "+e);}E1=i[D1[0]];E1.$qualifier=D1[0];return{"":E1};}return i;});});};g1.prototype.filterValueListRelevantQualifiers=function(e,i,j,n){return this.requestValue4Annotation(i,j,n).then(function(s1){var t1={};s1.forEach(function(u1){if(u1 in e){t1[u1]=e[u1];}});return t1;});};g1.prototype.requestValueListType=_.createRequestMethod("fetchValueListType");g1.prototype.resolve=function(e,i){var j,n;if(!e){return i?i.getPath():undefined;}n=e[0];if(n==="/"){return e;}if(!i){return undefined;}if(n==="."){if(e[1]!=="/"){throw new Error("Unsupported relative path: "+e);}e=e.slice(2);}j=i.getPath();return n==="@"||j.endsWith("/")?j+e:j+"/"+e;};g1.prototype.setLegacySyntax=function(){throw new Error("Unsupported operation: v4.ODataMetaModel#setLegacySyntax");};g1.prototype.toString=function(){return H+": "+this.sUrl;};g1.prototype.validate=function(e,j){var n,s1,t1,u1,v1,i;if(!this.bSupportReferences){return j;}for(v1 in j.$Reference){u1=j.$Reference[v1];v1=new U(v1).absoluteTo(this.sUrl).toString();if("$IncludeAnnotations"in u1){p1(this,"Unsupported IncludeAnnotations",e);}for(i in u1.$Include){t1=u1.$Include[i];if(t1 in j){p1(this,"A schema cannot span more than one document: "+t1+" - is both included and defined",e);}j1(this,t1,v1,e);}}s1=j.$LastModified?new Date(j.$LastModified):null;this.mETags[e]=j.$ETag?j.$ETag:s1;n=j.$Date?new Date(j.$Date):new Date();s1=s1||n;if(this.oLastModified<s1){this.oLastModified=s1;}delete j.$Date;delete j.$ETag;delete j.$LastModified;return j;};return g1;});
