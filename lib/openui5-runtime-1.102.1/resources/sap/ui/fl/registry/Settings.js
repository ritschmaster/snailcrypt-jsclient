/*!
 * OpenUI5
 * (c) Copyright 2009-2022 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/fl/write/_internal/Storage","sap/ui/fl/Utils","sap/base/Log"],function(S,U,L){"use strict";function r(){var u=U.getUshellContainer();if(u){return U.getUShellService("UserInfo").then(function(o){var b=o.getUser();return b&&b.getId();}).catch(function(e){L.error("Error getting service from Unified Shell: "+e.message);});}return Promise.resolve();}var a=function(s){if(!s){throw new Error("no flex settings provided");}this._oSettings=s;};a.attachEvent=function(e,c){a._oEventProvider.attachEvent(e,c);};a.detachEvent=function(e,c){a._oEventProvider.detachEvent(e,c);};a.getInstance=function(){if(a._instance){return Promise.resolve(a._instance);}if(a._oLoadSettingsPromise){return a._oLoadSettingsPromise;}return a._loadSettings();};a._loadSettings=function(){var s;var l=S.loadFeatures().then(function(o){s=o;return r();}).then(function(u){if(!s){L.error("The request for flexibility settings failed; A default response is generated and returned to consuming APIs");s={isKeyUser:false,isKeyUserTranslationEnabled:false,isVariantSharingEnabled:false,isVariantPersonalizationEnabled:true,isAtoAvailable:false,isAtoEnabled:false,isAppVariantSaveAsEnabled:false,isCondensingEnabled:false,isProductiveSystem:true,isPublicLayerAvailable:false,isVariantAdaptationEnabled:false,versioning:{},_bFlexChangeMode:false,_bFlexibilityAdaptationButtonAllowed:false};}s.userId=u;return a._storeInstance(s);});a._oLoadSettingsPromise=l;return l;};a._storeInstance=function(s){if(!a._instance){a._instance=new a(s);}return a._instance;};a.getInstanceOrUndef=function(){return a._instance;};a.getDefaultLayerPermissions=function(){return{VENDOR:true,CUSTOMER_BASE:true,CUSTOMER:true,PUBLIC:false,USER:false};};a.getDeveloperModeLayerPermissions=function(){return{VENDOR:true,CUSTOMER_BASE:true,CUSTOMER:false,PUBLIC:false,USER:false};};a.prototype._getBooleanProperty=function(p){return this._oSettings[p]||false;};a.prototype.isKeyUser=function(){return this._getBooleanProperty("isKeyUser");};a.prototype.isKeyUserTranslationEnabled=function(){return this._getBooleanProperty("isKeyUserTranslationEnabled");};a.prototype.isPublicLayerAvailable=function(){return this._getBooleanProperty("isPublicLayerAvailable");};a.prototype.isVariantAdaptationEnabled=function(){return this._getBooleanProperty("isVariantAdaptationEnabled");};a.prototype.isAppVariantSaveAsEnabled=function(){return this._getBooleanProperty("isAppVariantSaveAsEnabled");};a.prototype.isVersioningEnabled=function(l){return!!(this._oSettings.versioning[l]||this._oSettings.versioning["ALL"]);};a.prototype.isModelS=function(){return this._getBooleanProperty("isAtoAvailable");};a.prototype.isAtoEnabled=function(){return this._getBooleanProperty("isAtoEnabled");};a.prototype.isAtoAvailable=function(){return this._getBooleanProperty("isAtoAvailable");};a.prototype.isProductiveSystem=function(){return this._getBooleanProperty("isProductiveSystem");};a.prototype.isVariantSharingEnabled=function(){return this._getBooleanProperty("isVariantSharingEnabled");};a.prototype.isPublicFlVariantEnabled=function(){return this._getBooleanProperty("isPublicFlVariantEnabled");};a.prototype.isVariantPersonalizationEnabled=function(){return this._getBooleanProperty("isVariantPersonalizationEnabled");};a.prototype.isCondensingEnabled=function(){return this._getBooleanProperty("isCondensingEnabled");};a.prototype.isSystemWithTransports=function(){return!!(this._oSettings.system&&this._oSettings.client);};a.prototype.isProductiveSystemWithTransports=function(){return this.isProductiveSystem()&&this.isSystemWithTransports();};a.prototype.getSystem=function(){return this._oSettings.system;};a.prototype.getClient=function(){return this._oSettings.client;};a.prototype._getHostname=function(){return document.location.hostname;};a.prototype.isCustomerSystem=function(){var s=this._oSettings.systemType;var i={CUSTOMER:true,SAP:false}[s];var h=this._getHostname();return i!==undefined?i:!(h.endsWith(".sap"+".corp")||h==="localhost"||h==="127.0.0.1");};a.prototype.getUserId=function(){return this._oSettings.userId;};return a;},true);
