/*!
 * OpenUI5
 * (c) Copyright 2009-2022 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/base/Log","sap/ui/fl/Utils"],function(L,F){"use strict";var M={};M.CHANGE_TYPE="moveElements";function c(C,m,v,a){if(!C){return Promise.reject(new Error("No change instance"));}var o=C.getContent();if(!o||!o.movedElements||o.movedElements.length===0){return Promise.reject(new Error("Change format invalid"));}if(!C.getSelector().aggregation){return Promise.reject(new Error("No source aggregation supplied via selector for move"));}if(!o.target||!o.target.selector){return Promise.reject(new Error("No target supplied for move"));}if(!m.bySelector(o.target.selector,a,v)){return Promise.reject(new Error("Move target parent not found"));}if(!o.target.selector.aggregation){return Promise.reject(new Error("No target aggregation supplied for move"));}return Promise.resolve();}function g(m,o,a,v){if(!m.selector&&!m.id){return Promise.reject(new Error("Change format invalid - moveElements element has no id attribute"));}if(typeof m.targetIndex!=="number"){return Promise.reject(new Error("Missing targetIndex for element with id '"+m.selector.id+"' in movedElements supplied"));}return Promise.resolve().then(function(){return o.bySelector(m.selector||m.id,a,v);});}function h(m,o,a,v,s,t,S,T){var b;return g(m,o,a,v).then(function(r){b=r;if(!b){L.warning("Element to move not found");return Promise.reject();}return Promise.resolve().then(o.removeAggregation.bind(o,s,S,b)).then(o.insertAggregation.bind(o,t,T,b,m.targetIndex,v));});}M.applyChange=function(C,s,p){var m=p.modifier;var v=p.view;var a=p.appComponent;var o=C.getContent();var S;var t;var T;return c(C,m,v,a).then(function(){S=C.getSelector().aggregation;t=o.target.selector.aggregation;return m.bySelector(o.target.selector,a,v);}).then(function(r){T=r;var P=[];o.movedElements.forEach(function(b){P.push(h.bind(null,b,m,a,v,s,T,S,t));});return F.execPromiseQueueSequentially(P,true,true);});};M.completeChangeContent=function(){throw new Error('Using deprecated change handler. Please consider using \'MoveControls\' instead');};M.getSpecificChangeInfo=function(m,s){var S=s.source.parent||m.bySelector(s.source.id);var t=s.target.parent||m.bySelector(s.target.id);var a=s.source.aggregation;var T=s.target.aggregation;var b={source:{id:S.getId(),aggregation:a,type:m.getControlType(S)},target:{id:t.getId(),aggregation:T,type:m.getControlType(t)},movedElements:s.movedElements};return b;};return M;},true);
