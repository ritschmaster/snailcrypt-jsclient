/*!
 * OpenUI5
 * (c) Copyright 2009-2022 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/core/util/File","sap/ui/core/util/reflection/JsControlTreeModifier","sap/m/MessageBox","sap/ui/fl/apply/_internal/flexState/ManifestUtils","sap/ui/thirdparty/jquery"],function(F,J,M,a,q){"use strict";var E={};E.VERSION='v1.0';E.extractData=function(c){var e={sVersion:E.VERSION,bIsInvestigationExport:true,mControlData:{},aAppliedChanges:[],aFailedChanges:[],aNotApplicableChanges:[],mChangesEntries:{},mVariantsChanges:{},sComponentName:c._mComponent.name};this._enhanceExportWithChangeData(c,e);this._enhanceExportWithVariantChangeData(c,e);this._enhanceExportWithControlData(c,e);return e;};E.getAppComponentInstance=function(c){var C;var b=q.find(".sapUiComponentContainer");b.some(function(o){var d=sap.ui.getCore().byId(o.id);var A=d&&d.getComponentInstance();if(A&&a.getFlexReferenceForControl(A)===c){C=A;return true;}});return C;};E._enhanceExportWithChangeData=function(c,e){var A=E.getAppComponentInstance(e.sComponentName);q.each(c._mChangesEntries,function(C,o){e.mChangesEntries[C]={mDefinition:o._oDefinition,aControlsDependencies:[],aDependencies:[]};if(o._aDependentSelectorList){o._aDependentSelectorList.forEach(function(s){var m={bPresent:!!J.bySelector(s,A),aAppliedChanges:[],aFailedChangesJs:[],aFailedChangesXml:[],aNotApplicableChanges:[]};e.mControlData[s.id]=m;});}});this._enhanceExportWithDependencyData(c,e);};E._enhanceExportWithDependencyData=function(c,e){q.each(c._mChangesInitial.mDependencies,function(C,m){e.mChangesEntries[C].aControlsDependencies=m.controlsDependencies;e.mChangesEntries[C].aDependencies=m.dependencies;});};E._enhanceExportWithVariantChangeData=function(c,e){q.each(c._mVariantsChanges,function(C,o){e.mVariantsChanges[C]={mDefinition:o._oDefinition};});};E._enhanceWithChangetypeSpecificData=function(e,s,c,C,b){if(b){c[C]=b;c[C].map(function(d){if(!(d in e[s])){e[s].push(d);}});}};E._getChangesForControlFromCustomData=function(c,i){var C=c.getCustomData();var b=[];C.forEach(function(o){var k=o.getKey();if(k.startsWith(i)){b.push(k.replace(i,""));}});return b;};E._enhanceExportWithControlData=function(c,e){q.each(c._mChanges.mChanges,function(C){var m={bPresent:false,aAppliedChanges:[],aFailedChangesJs:[],aFailedChangesXml:[],aNotApplicableChanges:[]};var o=sap.ui.getCore().byId(C);if(o){m.bPresent=true;this._enhanceWithChangetypeSpecificData(e,"aAppliedChanges",m,"aAppliedChanges",this._getChangesForControlFromCustomData(o,"sap.ui.fl.appliedChanges."));this._enhanceWithChangetypeSpecificData(e,"aFailedChanges",m,"aFailedChangesJs",this._getChangesForControlFromCustomData(o,"sap.ui.fl.failedChanges.js."));this._enhanceWithChangetypeSpecificData(e,"aFailedChanges",m,"aFailedChangesXml",this._getChangesForControlFromCustomData(o,"sap.ui.fl.failedChanges.xml."));this._enhanceWithChangetypeSpecificData(e,"aNotApplicableChanges",m,"aNotApplicableChanges",this._getChangesForControlFromCustomData(o,"sap.ui.fl.notApplicableChanges."));}e.mControlData[C]=m;}.bind(this));};return E;});
