/*
 * ! OpenUI5
 * (c) Copyright 2009-2022 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/fl/apply/_internal/flexState/FlexState","sap/ui/fl/write/_internal/Versions","sap/ui/fl/Utils","sap/ui/fl/write/api/Version","sap/ui/fl/apply/_internal/flexState/ManifestUtils"],function(F,V,U,a,M){"use strict";function g(d){var r=M.getFlexReferenceForControl(d);if(!r){throw Error("The application ID could not be determined");}return r;}function b(p){if(!p.control){throw Error("No control was provided");}if(!p.layer){throw Error("No layer was provided");}var r=g(p.control);return V.getVersionsModel({nonNormalizedReference:r,reference:U.normalizeReference(r),layer:p.layer});}var c={};c.initialize=function(p){if(!p.control){return Promise.reject("No control was provided");}if(!p.layer){return Promise.reject("No layer was provided");}var A=U.getAppComponentForControl(p.control);return V.initialize({reference:U.normalizeReference(g(A)),layer:p.layer});};c.isDraftAvailable=function(p){var m=b(p);var v=m.getProperty("/versions");var d=v.find(function(o){return o.version===a.Number.Draft;});return!!d;};c.isOldVersionDisplayed=function(p){var m=b(p);var d=m.getProperty("/displayedVersion");var e=m.getProperty("/activeVersion");return d!==a.Number.Draft&&d!==e;};c.loadDraftForApplication=function(p){p.version=a.Number.Draft;return c.loadVersionForApplication(p);};c.loadVersionForApplication=function(p){if(!p.control){return Promise.reject("No control was provided");}if(!p.layer){return Promise.reject("No layer was provided");}if(p.version===undefined){var m=b(p);if(m){p.version=m.getProperty("/activeVersion");}}var A=U.getAppComponentForControl(p.control);var r=g(A);return F.clearAndInitialize({componentId:A.getId(),reference:r,version:p.version,allContexts:p.allContexts});};c.activate=function(p){if(!p.control){return Promise.reject("No control was provided");}if(!p.layer){return Promise.reject("No layer was provided");}if(!p.title){return Promise.reject("No version title was provided");}var r=g(p.control);return V.activate({nonNormalizedReference:r,reference:U.normalizeReference(r),layer:p.layer,title:p.title,appComponent:U.getAppComponentForControl(p.control)});};c.discardDraft=function(p){if(!p.control){return Promise.reject("No control was provided");}if(!p.layer){return Promise.reject("No layer was provided");}var A=U.getAppComponentForControl(p.control);var r=g(A);return V.discardDraft({nonNormalizedReference:r,reference:U.normalizeReference(r),layer:p.layer}).then(function(d){if(d.backendChangesDiscarded){F.clearAndInitialize({componentId:A.getId(),reference:r});}return d;});};c.publish=function(p){if(!p.selector){return Promise.reject("No selector was provided");}if(!p.layer){return Promise.reject("No layer was provided");}if(!p.version){return Promise.reject("No version was provided");}p.styleClass=p.styleClass||"";p.reference=g(p.selector);return V.publish(p);};return c;});
