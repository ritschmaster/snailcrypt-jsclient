/*
 * ! OpenUI5
 * (c) Copyright 2009-2022 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/core/Core","sap/ui/fl/apply/_internal/ChangesController","sap/ui/fl/write/_internal/flexState/FlexObjectState","sap/ui/fl/apply/_internal/flexState/FlexState","sap/ui/fl/apply/_internal/flexState/ManifestUtils","sap/ui/fl/write/_internal/Storage","sap/ui/fl/ChangePersistenceFactory","sap/base/util/isEmptyObject","sap/ui/fl/Utils"],function(C,a,F,b,M,S,c,i,U){"use strict";function g(r){if(!r){return[];}var o=c.getChangePersistenceForComponent(r);return o.getDirtyChanges();}function d(p){var A=U.getAppComponentForControl(p.selector);var f=M.getFlexReferenceForControl(A);return g(U.normalizeReference(f));}var T={};T.hasTranslationRelevantDirtyChanges=function(p){return[].concat(F.getDirtyFlexObjects(p),d(p)).some(function(o){return!i(o.getTexts());});};T.getTexts=function(p){if(!p.selector){return Promise.reject("No selector was provided");}if(!p.sourceLanguage){return Promise.reject("No sourceLanguage was provided");}if(!p.targetLanguage){return Promise.reject("No targetLanguage was provided");}if(!p.layer){return Promise.reject("No layer was provided");}var A=U.getAppComponentForControl(p.selector);p.reference=M.getFlexReferenceForControl(A);return Promise.resolve().then(S.translation.getTexts.bind(undefined,p));};T.getSourceLanguages=function(p){if(!p.selector){return Promise.reject("No selector was provided");}if(!p.layer){return Promise.reject("No layer was provided");}var A=U.getAppComponentForControl(p.selector);p.reference=M.getFlexReferenceForControl(A);return S.translation.getSourceLanguages(p).then(function(l){var s=C.getConfiguration().getLanguage();if(!l.includes(s)&&T.hasTranslationRelevantDirtyChanges(p)){l.push(s);}return l;});};T.uploadTranslationTexts=function(p){if(!p.layer){return Promise.reject("No layer was provided");}if(!p.payload){return Promise.reject("No payload was provided");}return Promise.resolve().then(S.translation.postTranslationTexts.bind(undefined,p));};return T;});
