/*
 * ! OpenUI5
 * (c) Copyright 2009-2022 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/fl/write/api/PersistenceWriteAPI","sap/ui/fl/write/api/ChangesWriteAPI","sap/ui/core/util/reflection/JsControlTreeModifier","sap/ui/fl/Change","sap/ui/fl/Utils","sap/ui/fl/ChangePersistenceFactory","sap/base/util/restricted/_union"],function(P,C,J,a,U,b,u){"use strict";var L={};function g(o,l,s){var p={includeDirtyChanges:true,layer:l};var d=b.getChangePersistenceForControl(o);return d.getAllUIChanges(p).filter(function(e){return(e.getState()!==a.states.DELETED&&e.getVariantReference()===(s||""));});}function c(t){var o=U.getAppComponentForControl(t);var n=[];var O=[];function i(e,r){var R=(r||[]).concat(e);if(e===t||n.includes(e)){n=u(n,R);return true;}var p=e.getParent();if(O.includes(e)||!p){O=u(O,R);return false;}return i(p,R);}function d(e){return e.getDependentSelectorList().map(function(s){return J.bySelector(s,o);}).filter(Boolean).some(function(D){return i(D);});}return d;}L.resetChanges=function(d,A){var r=d.slice().reverse();var R=r.map(function(o){var e=J.bySelector(o.getSelector(),A);return function(){return P.remove({change:o,selector:e}).then(function(){o.setQueuedForRevert();return C.revert({change:o,element:e});});};});return U.execPromiseQueueSequentially(R);};L.restoreChanges=function(d,A){var e=d.map(function(o){return function(){o.restorePreviousState();var f=J.bySelector(o.getSelector(),A);P.add({change:o,selector:f});if(o.getState()===a.states.PERSISTED){var h=b.getChangePersistenceForControl(A);var D=h.getDirtyChanges();var i=D.indexOf(o);if(i>=0){D.splice(i,1);}}return C.apply({change:o,element:f,modifier:J});};});return U.execPromiseQueueSequentially(e);};L.getNestedUIChangesForControl=function(o,p){var d=g(o,p.layer,p.currentVariant);var f=c(o);return d.filter(f);};L.isResetEnabled=function(o,p){var d=g(o,p.layer,p.currentVariant);var f=c(o);return d.some(f);};return L;});
