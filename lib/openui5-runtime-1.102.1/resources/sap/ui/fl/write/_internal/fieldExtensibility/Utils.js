/*!
 * OpenUI5
 * (c) Copyright 2009-2022 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/base/Log","sap/base/security/encodeURL","sap/ui/core/Core","sap/ui/fl/Utils","sap/ui/thirdparty/jquery"],function(L,a,C,F,q){"use strict";var p={v2:"v2",v4:"v4"};function _(x){var m=[];try{var E=JSON.parse(x.responseText);if(E&&E.error&&E.error.message&&E.error.message.value){m.push({severity:"error",text:E.error.message.value});}else{m.push({severity:"error",text:x.responseText});}}catch(e){}return m;}function b(o){var B=null;var e=o.getBindingContext?o.getBindingContext():null;if(e&&e.getPath){B=e.getPath();}if(!B){L.warning("Control not bound to a path");}return B;}function c(m,B){return m.metadataLoaded().then(function(){var e=m.oMetadata._getEntitySetByPath(B);return e?e.name:null;});}function d(m,B){var M=m.getMetaModel();var s=M.getMetaPath(B);return M.requestObject(s).then(function(e){var S=M.fetchEntityContainer().getResult();var E=S[S.$EntityContainer];var k=Object.keys(E).filter(function(l){return E[l]===e;});return k.length>0&&k[0];});}function f(m,B){return m.metadataLoaded().then(function(){var e=m.oMetadata._getEntityTypeByPath(B);return e?e.name:null;});}function g(m,B){var M=m.getMetaModel();var s=M.getMetaPath(B);return M.requestObject(s).then(function(e){var S=e.$Type.split(".");return S[S.length-1];});}function h(m){var s=null;if(m&&m.sServiceUrl){s=m.sServiceUrl;}if(!s){L.warning("Model has no Service Uri");}return s;}function i(m){if(m){if(m.isA("sap.ui.model.odata.v2.ODataModel")){return p.v2;}else if(m.isA("sap.ui.model.odata.v4.ODataModel")){return p.v4;}}return null;}function j(o){if(o){var m=o.getModel?o.getModel():null;if(i(m)){return m;}L.warning("Unsupported model type or protocol");return null;}L.warning("No Control passed");return null;}var U={};U.checkControlPrerequisites=function(o){if(o){var m=j(o);var s=h(m);var B=b(o);return Boolean(s&&B);}L.warning("No Control passed");return false;};U.executeRequest=function(r,P){var s=r+this.getUriParameters(P);return new Promise(function(R){var S={type:"GET",async:true,dataType:"json"};q.ajax(s,S).done(function(D){var o=D&&D.d;R({errorOccurred:false,result:o});}).fail(function(e){R({errorOccurred:true,errorMessages:_(e),statusCode:e.status});});});};U.getBoundEntitySet=function(o){var m=j(o);var P=i(m);if(P===p.v2){return c(m,b(o));}else if(P===p.v4){return d(m,b(o));}return Promise.resolve(null);};U.getBoundEntityType=function(o){var m=j(o);var P=i(m);if(P===p.v2){return f(m,b(o));}else if(P===p.v4){return g(m,b(o));}return Promise.resolve(null);};U.getNavigationUriForIntent=function(I){return F.getUShellService("CrossApplicationNavigation").then(function(o){if(o&&o.hrefForExternal){return o.hrefForExternal(I);}return Promise.resolve(null);});};U.getServiceUri=function(o){var m=j(o);return h(m);};U.getText=function(t){return C.getLibraryResourceBundle("sap.ui.fl").getText(t);};U.getUriParameters=function(P){if(!P){return"";}var u=[];Object.keys(P).forEach(function(n){if(n){var v="'"+a(P[n]||"")+"'";u.push(a(n)+"="+v);}});return u.length===0?"":"?"+u.join("&");};U.isNavigationSupportedForIntents=function(I){return F.getUShellService("CrossApplicationNavigation").then(function(o){if(o&&o.isNavigationSupported){return o.isNavigationSupported(I).then(function(r){return r.map(function(R){return R&&R.supported===true;});});}return Promise.resolve(I.map(function(){return false;}));});};return U;});
