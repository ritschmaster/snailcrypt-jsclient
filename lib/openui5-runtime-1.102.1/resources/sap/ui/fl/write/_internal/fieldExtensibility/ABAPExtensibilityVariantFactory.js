/*
 * ! OpenUI5
 * (c) Copyright 2009-2022 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/base/Log","sap/ui/fl/write/_internal/fieldExtensibility/ABAPExtensibilityVariant","sap/ui/fl/write/_internal/fieldExtensibility/MultiTenantABAPExtensibilityVariant","sap/ui/fl/write/_internal/fieldExtensibility/SingleTenantABAPExtensibilityVariant","sap/ui/fl/write/_internal/fieldExtensibility/Utils","sap/ui/fl/write/_internal/fieldExtensibility/UriParser"],function(L,A,M,S,U,a){"use strict";var _={};var b=new A();function c(C){return Promise.all([U.getBoundEntitySet(C),U.getBoundEntityType(C)]).then(function(r){return{entitySetName:r[0],entityTypeName:r[1]};});}function d(E){L.error("Error occurred:");if(E){if(Array.isArray(E.errorMessages)){E.errorMessages.forEach(function(o){L.error(o.text);});}else{L.error(E);}}}function e(s,B){try{var m=a.parseServiceUri(s);var o=new M(s,m,B);var j=new S(s,m,B);return Promise.all([o.isActive(),j.isActive()]).then(function(I){var k=b;if(I[0]===true){k=o;}else if(I[1]===true){k=j;}return k;}).catch(function(E){d(E);return Promise.resolve(b);});}catch(E){d(E);return Promise.resolve(b);}}function f(s,B){if(_[s]){return _[s][B.entityTypeName];}return null;}function g(s,B,I){if(!_[s]){_[s]={};}_[s][B.entityTypeName]=I;}function h(C,B){var s=U.getServiceUri(C);var E=f(s,B);if(!E){return e(s,B).then(function(o){g(s,B,o);return Promise.resolve(o);});}return Promise.resolve(E);}var i={};i.getInstance=function(C){if(U.checkControlPrerequisites(C)){return c(C).then(function(B){return h(C,B).then(function(I){return I.getInterface();});}).catch(function(E){d(E);return Promise.resolve(b.getInterface());});}return Promise.resolve(b.getInterface());};i.reset=function(){_={};};return i;});
