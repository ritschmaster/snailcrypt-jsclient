/*
 * ! OpenUI5
 * (c) Copyright 2009-2022 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/base/util/merge","sap/ui/fl/write/_internal/connectors/BackendConnector","sap/ui/fl/initial/_internal/connectors/KeyUserConnector","sap/ui/fl/initial/_internal/connectors/Utils","sap/ui/fl/write/_internal/connectors/Utils","sap/base/util/restricted/_pick"],function(m,B,I,a,W,_){"use strict";var P="/flex/keyuser";var A="/v1";var K=m({},B,{layers:I.layers,ROUTES:{CHANGES:P+A+"/changes/",SETTINGS:P+A+"/settings",TOKEN:P+A+"/settings",VERSIONS:{GET:P+A+"/versions/",ACTIVATE:P+A+"/versions/activate/",DISCARD:P+A+"/versions/draft/"},TRANSLATION:{UPLOAD:P+A+"/translation/texts",DOWNLOAD:P+A+"/translation/texts/",GET_SOURCELANGUAGE:P+A+"/translation/sourcelanguages/"},CONTEXTS:P+A+"/contexts/"},isLanguageInfoRequired:true,loadFeatures:function(p){return B.loadFeatures.call(K,p).then(function(f){f.isPublicLayerAvailable=f.isPublicLayerAvailable&&!f.isVariantAdaptationEnabled;return f;});},getContexts:function(p){var d=["type","$skip","$filter"];var e=_(p,d);var C=a.getUrl(K.ROUTES.CONTEXTS,p,e);return a.sendRequest(C).then(function(R){return R.response;});},loadContextDescriptions:function(p){var d={};a.addLanguageInfo(d);b(p);var C=a.getUrl(K.ROUTES.CONTEXTS,p,d);p.payload=JSON.stringify(p.flexObjects);p.dataType="json";p.contentType="application/json; charset=utf-8";return W.sendRequest(C,"POST",p);}});function b(p){p.initialConnector=I;p.xsrfToken=I.xsrfToken;p.tokenUrl=K.ROUTES.TOKEN;}function c(p){var o={title:p.title};p.payload=JSON.stringify(o);p.dataType="json";p.contentType="application/json; charset=utf-8";}function r(v){v.version=v.versionNumber.toString();delete v.versionNumber;return v;}K.versions={load:function(p){b(p);var d={};a.addLanguageInfo(d);d.limit=p.limit;var v=a.getUrl(K.ROUTES.VERSIONS.GET,p,d);return a.sendRequest(v,"GET",p).then(function(R){return R.response.map(function(V){return r(V);});});},activate:function(p){b(p);c(p);var d={version:p.version};a.addLanguageInfo(d);var v=a.getUrl(K.ROUTES.VERSIONS.ACTIVATE,p,d);return W.sendRequest(v,"POST",p).then(function(R){var V=R.response;return r(V);});},discardDraft:function(p){b(p);var v=a.getUrl(K.ROUTES.VERSIONS.DISCARD,p);return W.sendRequest(v,"DELETE",p);}};K.translation={getTexts:function(p){var d=_(p,["sourceLanguage","targetLanguage"]);var t=a.getUrl(K.ROUTES.TRANSLATION.DOWNLOAD,p,d);return a.sendRequest(t,"GET",p).then(function(R){return R.response;});},getSourceLanguages:function(p){var d={};var t=a.getUrl(K.ROUTES.TRANSLATION.GET_SOURCELANGUAGE,p,d);return a.sendRequest(t,"GET",p).then(function(R){return R&&R.response&&R.response.sourceLanguages?R.response.sourceLanguages:[];});},postTranslationTexts:function(p){b(p);var t=a.getUrl(K.ROUTES.TRANSLATION.UPLOAD,p,{});return a.sendRequest(t,"POST",p);}};K.initialConnector=I;return K;});
