/*
 * ! OpenUI5
 * (c) Copyright 2009-2022 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/fl/initial/_internal/StorageUtils","sap/base/util/merge","sap/base/util/isEmptyObject"],function(S,m,i){"use strict";function _(f,c){if(c.content.fileName!==c.content.variantManagementReference){f.push(c.content);}c.controlChanges.forEach(function(o){f.push(o);});for(var C in c.variantChanges){f=f.concat(c.variantChanges[C]);}return f;}function a(c){var I=true;if(c){Object.keys(c).some(function(k){if(c[k].length){I=false;return true;}});}return I;}return function(r){var f;if(!i(r.variantSection)){f=r.changes||[];for(var v in r.variantSection){var V=r.variantSection[v];for(var c in V.variantManagementChanges){f=f.concat(V.variantManagementChanges[c]);}f=V.variants.reduce(_,f);}var g=S.getGroupedFlexObjects(f);var d=S.filterAndSortResponses(g);delete r.changes;delete r.variantSection;m(d[0]||{},r);return d;}if(a(r.comp)){f=r.changes||[];r.comp={variants:[],changes:[],defaultVariants:[],standardVariants:[]};f.slice().reverse().forEach(function(F,n,A){var M=false;if(F.fileType==="variant"){r.comp.variants.unshift(F);M=true;}else{switch(F.changeType){case"addFavorite":case"removeFavorite":case"updateVariant":r.comp.changes.unshift(F);M=true;break;case"defaultVariant":r.comp.defaultVariants.unshift(F);M=true;break;case"standardVariant":r.comp.standardVariants.unshift(F);M=true;break;default:break;}}if(M){var b=A.length-1-n;r.changes.splice(b,1);}});}return[r];};});
