/*
 * ! OpenUI5
 * (c) Copyright 2009-2022 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/base/util/includes","sap/base/Log","sap/ui/core/util/reflection/JsControlTreeModifier","sap/ui/fl/apply/_internal/controlVariants/Utils","sap/ui/fl/apply/_internal/flexState/ManifestUtils","sap/ui/fl/apply/_internal/ChangesController","sap/ui/fl/FlexControllerFactory","sap/ui/fl/Layer","sap/ui/fl/Utils"],function(i,L,J,V,M,C,F,a,U){"use strict";var b={isPersonalized:function(p){function l(m){L.error(m);return Promise.reject(m);}function c(e){return e.getFileType()==="change";}function f(A,e,g){var I=e.map(function(j){return j.id||j.getId();});var s=g.getSelector();var h=J.getControlIdBySelector(s,A);return i(I,h);}function d(e,g){return(Array.isArray(e)&&e.length>0)?i(e,g.getChangeType()):true;}if(!p.selectors||p.selectors.length===0){return l("At least one control ID has to be provided as a parameter");}var A=p.selectors[0].appComponent||U.getAppComponentForControl(p.selectors[0]);if(!A){return l("App Component could not be determined");}var o=F.createForControl(A);return o.getComponentChanges({currentLayer:a.USER,includeCtrlVariants:true}).then(function(e){return e.filter(f.bind(this,A,p.selectors)).filter(d.bind(this,p.changeTypes)).some(c);}.bind(this));},waitForChanges:function(p){var c;var f;if(p.element){c=[{selector:p.element}];f=p.element;}else if(p.selectors){c=p.selectors.map(function(s){return{selector:s};});f=p.selectors[0];}else if(p.complexSelectors){c=p.complexSelectors;f=p.complexSelectors[0].selector;}return C.getFlexControllerInstance(f).waitForChangesToBeApplied(c);},isFlexSupported:function(p){return!!U.getAppComponentForControl(p.element);},hasVariantManagement:function(p){return V.belongsToVariantManagement(p.element);},getFlexReference:function(p){return M.getFlexReferenceForControl(p.element);}};return b;});
