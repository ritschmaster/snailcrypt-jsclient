/*!
 * OpenUI5
 * (c) Copyright 2009-2022 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/fl/util/DescriptorChangeCheck"],function(D){"use strict";var S=["BEGINNING","END"];function i(M,s){return Object.keys(M).indexOf(s)>=0;}function a(M,s){return!M[s].type||M[s].type==="OData";}function b(M,C,s){return((M[s]&&M[s].type==="ODataAnnotation")||C[s]);}function c(C,s){return C[s].type&&C[s].type==="ODataAnnotation";}function d(C,s){return C.indexOf(s)>=0;}function e(M,C){if(C){if(Object.keys(M).length>0){if(!i(M,C)){throw new Error("There is no dataSource '"+C+"' existing in the manifest. You can only add annotations to already existing dataSources in the manifest");}if(!a(M,C)){throw new Error("The dataSource '"+C+"' is existing in the manifest but is not type of 'OData'. The type of the dataSource in the manifest is '"+M[C].type+"'");}}else{throw new Error("There are no dataSources in the manifest at all");}}else{throw new Error("Invalid change format: The mandatory 'dataSourceId' is not defined. Please define the mandatory property 'dataSourceId' and refer it to an existing OData");}}function f(C){if(C){if(C.length===0){throw new Error("Invalid change format: The 'annotations' array property is empty");}}else{throw new Error("Invalid change format: The mandatory 'annotations' array property is not defined. Please define the 'annotations' array property");}}function g(C){if(!(S.indexOf(C)>=0)&&!(C===undefined)){throw new Error("The defined insert position '"+C+"' is not supported. The supported insert positions are: "+S.join("|"));}}function h(C,l,o){if(C){if(Object.keys(C).length===0){throw new Error("The 'dataSource' object is empty");}Object.keys(C).forEach(function(s){D.checkIdNamespaceCompliance(s,o);if(!c(C,s)){throw new Error("The dataSource annotation '"+s+"' is type of '"+C[s].type+"'. Only dataSource annotations of type 'ODataAnnotation' is supported");}if(!d(l,s)){throw new Error("The annotation '"+s+"' is not part of 'annotations' array property. Please add the annotation '"+s+"' in the 'annotations' array property");}});}else{throw new Error("Invalid change format: The mandatory 'dataSource' object is not defined. Please define the mandatory 'dataSource' object");}}function m(M,C,l,s,o){j(M[C],l,s);k(M,o);}function j(M,C,s){if(!M["settings"]){M["settings"]={};}if(!M["settings"].annotations){M["settings"].annotations=[];}var n=M["settings"].annotations.filter(function(l){return(C.indexOf(l)<0);});M["settings"].annotations=n;if(s==="END"){M["settings"].annotations=M["settings"].annotations.concat(C);}else{M["settings"].annotations=C.concat(M["settings"].annotations);}}function k(M,C){Object.assign(M,C);}function p(M,C,l){l.forEach(function(s){if(!b(M,C,s)){throw new Error("The annotation '"+s+"' is part of 'annotations' array property but does not exists in the change property 'dataSource' and in the manifest (or it is not type of 'ODataAnnotation' in the manifest)");}});}var A={applyChange:function(M,C){var s=C.getContent().dataSourceId;var l=C.getContent().annotations;var n=C.getContent().annotationsInsertPosition;var o=C.getContent().dataSource;e(M["sap.app"].dataSources,s);f(l);g(n);h(o,l,C);p(M["sap.app"]["dataSources"],o,l);m(M["sap.app"]["dataSources"],s,l,n,o);return M;}};return A;});
