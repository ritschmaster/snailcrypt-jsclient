/*!
 * OpenUI5
 * (c) Copyright 2009-2022 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define([],function(){"use strict";var S=["OData","INA","XML","JSON","FHIR","http","WebSocket"];var a=S.concat(["ODataAnnotation"]);function i(C,D,s){return!C[D].type||s.indexOf(C[D]["type"])>=0;}function b(C,o){return k(C).some(function(D){return(!D.type||D["type"]==="OData")&&D["settings"]["annotations"].indexOf(o)>=0;});}function c(M,C,D){return d(C,D,S)||e(M,D);}function d(D,s,l){return h(D,s)&&i(D,s,l);}function e(D,s){if(h(D,s)){if(D[s].type&&D[s]["type"]==="ODataAnnotation"){throw new Error("The already existing dataSource '"+s+"' in the manifest is type of 'ODataAnnotation'. A model must not reference to a dataSource which is of type 'ODataAnnotation'");}return true;}return false;}function h(t,s){return t&&Object.keys(t).indexOf(s)>=0;}function m(M,C,E){if(C){Object.keys(C).forEach(function(n){if(M[n]){throw new Error("The "+E+" '"+n+"' already exists");}M[n]=C[n];});}}function f(M,C,r,s,l){if(!M[r][s]){M[r][s]={};}m(M[r][s],C.getContent()[l],l);return M[r][s];}function g(C,o,D){if(C[D].type==="ODataAnnotation"){return true;}return k(o).some(function(M){return M.dataSource&&M["dataSource"]===D;});}function j(C,M){return C[M].type||C[M].dataSource;}function k(o){return Object.keys(o).map(function(O){return o[O];});}var A={applyChange:function(M,C){var o=C.getContent().model;var l=C.getContent().dataSource;if(o){if(Object.keys(o).length!==1){throw new Error("There are currently '"+Object.keys(o).length+"' models in the change. Currently it is only allowed to add '1' model");}Object.keys(o).forEach(function(s){if(!j(o,s)){throw new Error("There is no 'dataSource' or 'type' in the change model defined. Please define either 'type' or 'dataSource' in property '"+s+"'");}if(o[s].dataSource){if(!c(M["sap.app"]["dataSources"],l,o[s]["dataSource"])){throw new Error("The defined dataSource '"+o[s]["dataSource"]+"' in the model does not exists as dataSource or must be allowed type of "+S.join("|"));}}});}else{throw new Error("No model defined");}if(l){Object.keys(l).forEach(function(D){if(!i(l,D,a)){throw new Error("The dataSource '"+D+"' has the type '"+l[D]["type"]+"', but only dataSources with the follwing types are supported: "+a.join("|"));}if(!g(l,o,D)){throw new Error("The dataSource in the change '"+D+"' is not used by any model in the change. A dataSource in the change must be used by model in the change");}if(l[D]["type"]==="ODataAnnotation"){if(!b(l,D)){throw new Error("There is no dataSource with type 'OData' defined which includes the annotation '"+D+"'");}}});}f(M,C,"sap.ui5","models","model");f(M,C,"sap.app","dataSources","dataSource");return M;}};return A;});
