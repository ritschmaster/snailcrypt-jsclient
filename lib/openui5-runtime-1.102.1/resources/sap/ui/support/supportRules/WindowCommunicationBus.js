/*!
 * OpenUI5
 * (c) Copyright 2009-2022 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/base/Object","sap/base/Log","sap/base/util/isEmptyObject"],function(B,L,i){"use strict";var W=B.extend("sap.ui.support.supportRules.WindowCommunicationBus",{constructor:function(c){B.call(this);this.bSilentMode=false;this._channels={};this._frame={};this._oConfig=c;if(window.addEventListener){window.addEventListener("message",this._onmessage.bind(this),false);}else{window.attachEvent("onmessage",this._onmessage.bind(this));}}});W.prototype.subscribe=function(c,C,o){if(this.bSilentMode){return;}this._channels[c]=this._channels[c]||[];this._channels[c].push({callback:C,context:o});};W.prototype.publish=function(c,p){if(this.bSilentMode){return;}var r=this._oConfig.getReceivingWindow();var d={channelName:c,params:p,_frameIdentifier:this._getFrameIdentifier(),_origin:window.location.href};r.postMessage(d,this._oConfig.getOrigin());};W.prototype.allowFrame=function(o){this._frame={origin:o.origin,identifier:o.identifier,url:o.url};};W.prototype.destroyChannels=function(){this._channels={};};W.prototype._onmessage=function(e){if(!this._validate(e)){L.error("Message was received but failed validation");return;}var c=this._channels[e.data.channelName]||[];c.forEach(function(a){a.callback.apply(a.context,[e.data.params]);});};W.prototype._validate=function(e){if(i(this._frame)){return true;}var m=e.data._frameIdentifier===this._frame.identifier;var o=new RegExp("^"+this._frame.origin+"$","i");var M=o.exec(e.origin);var f=this._frame.url.indexOf("?");var F=this._frame.url.substr(0,f).replace(/\.\.\//g,"").replace(/\.\//g,"")+this._frame.url.substr(f);var b=e.data._origin.indexOf(F)>-1;return m&&M&&b;};W.prototype._getFrameIdentifier=function(){return this._frame.identifier||this._oConfig.getFrameId();};return W;},true);
