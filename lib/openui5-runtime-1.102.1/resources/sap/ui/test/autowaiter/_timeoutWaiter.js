/*!
 * OpenUI5
 * (c) Copyright 2009-2022 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/test/autowaiter/_utils","sap/ui/thirdparty/jquery","./WaiterBase"],function(_,q,W){"use strict";var t={};var a={TRACKED:"TRACKED",STARTER:"STARTED",FINISHED:"FINISHED",CLEARED:"CLEARED"};var i;var I;var T=W.extend("sap.ui.test.autowaiter._timeoutWaiter",{hasPending:function(){var B=Object.keys(t).filter(function(g){return e(g);});var h=B.length>0;l(B);return h;},_getDefaultConfig:function(){return q.extend({maxDepth:1,maxDelay:1000,minDelay:10},W.prototype._getDefaultConfig.call(this));},_getValidationInfo:function(){return q.extend({maxDepth:"numeric",maxDelay:"numeric",minDelay:"numeric"},W.prototype._getValidationInfo.call(this));},_getInitiatorId:function(){return I;},_isPolling:function(g){return!f(g);},_registerInitiatorResolverId:function(g){i=g;}});var o=new T();function b(){if(I){return I;}if(i){return i();}}function c(n){var s="set"+n;var C="clear"+n;var O=window[s];if(!O){return;}var g=window[C];window[s]=function p(h,D,j){D=D||0;var k=Array.prototype.slice.call(arguments,2);var N={delay:D,initiator:b(),func:_.functionToString(h),stack:_.resolveStackTrace(),status:a.TRACKED};var m;if(j&&j==='TIMEOUT_WAITER_IGNORE'){m=O.apply(null,[h,D].concat(k.slice(1)));o._oLogger.trace("Timeout with ID "+m+" should not be tracked. "+" Delay: "+D+" Initiator: "+I);return m;}var w=function u(){var r=t[m];if(!r){o._oLogger.trace("Timeout data for timeout with ID "+m+" disapered unexpectedly");r={};}I=m;o._oLogger.trace("Timeout with ID "+m+" started");r.status=a.STARTED;try{h();}finally{I=undefined;}o._oLogger.trace("Timeout with ID "+m+" finished");r.status=a.FINISHED;};m=O.apply(null,[w,D].concat(k));o._oLogger.trace("Timeout with ID "+m+" is tracked. "+" Delay: "+D+" Initiator: "+I);t[m]=N;return m;};window[C]=function w(h){if(!h){o._oLogger.trace("Could not clean timeout with invalid ID: "+h);return;}var j=t[h];if(!j){o._oLogger.trace("Timeout data for timeout with ID "+h+" disapered unexpectedly or timeout was not tracked intentionally");j={};}j.status=a.CLEARED;o._oLogger.trace("Timeout with ID "+h+" cleared");g(h);};}c("Timeout");c("Immediate");function d(g,h,B,D){return"\nTimeout: ID: "+g+" Type: "+(B?"BLOCKING":"NOT BLOCKING")+" Status: "+h.status+" Delay: "+h.delay+" Initiator: "+h.initiator+(D?("\nFunction: "+h.func):"")+(D?("\nStack: "+h.stack):"");}function l(B){var g=Object.keys(t);var L="Found "+B.length+" blocking out of "+g.length+" tracked timeouts";B.forEach(function(h){L+=d(h,t[h],B.some(function(j){return j==h;}),true);});o._oHasPendingLogger.debug(L);var s="Tracked timeouts";g.forEach(function(h){s+=d(h,t[h],B.some(function(j){return j==h;}),true);});o._oHasPendingLogger.trace(s);}function e(g){var C=t[g];if(C.status!==a.TRACKED){return false;}if(C.delay>o._mConfig.maxDelay){return false;}if(C.delay>o._mConfig.minDelay){return f(g);}return true;}function f(g,h){h=h||1;var C=t[g];if(C.initiator&&t[C.initiator]){if(C.delay==t[C.initiator].delay){if(h>=o._mConfig.maxDepth){return false;}return f(C.initiator,h+1);}}return true;}return o;},true);
