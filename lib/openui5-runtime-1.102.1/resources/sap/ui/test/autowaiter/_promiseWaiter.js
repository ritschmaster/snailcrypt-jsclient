/*!
 * OpenUI5
 * (c) Copyright 2009-2022 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/test/autowaiter/_utils","sap/ui/thirdparty/jquery","sap/ui/test/autowaiter/_timeoutWaiter","./WaiterBase"],function(_,q,a,W){"use strict";var p=[];var O=window.Promise;var s=["resolve","reject","all","race","allSettled"];var t;var P=W.extend("sap.ui.test.autowaiter._promiseWaiter",{hasPending:function(){var i=p.filter(function(m){return!!m.pending&&!g(m);});if(i.length>0){var l="There are "+i.length+" pending promises\n";i.forEach(function(m){l+=b(m);});o._oHasPendingLogger.debug(l);}return i.length>0;},_getDefaultConfig:function(){return q.extend({maxDelay:1000},W.prototype._getDefaultConfig.call(this));},_getValidationInfo:function(){return q.extend({maxDelay:"numeric"},W.prototype._getValidationInfo.call(this));}});var o=new P();a._registerInitiatorResolverId(function(){return t?t.completorTimeoutId:undefined;});function b(m){return"\nPromise: Args: "+m.args+"\n Stack: "+m.stack;}function c(){var i=a._getInitiatorId();if(!i&&t){i=t.completorTimeoutId;}return i;}function d(){var i=a._getInitiatorId();return i;}function e(A){var m={args:A,stack:_.resolveStackTrace(),pending:true,tooLate:false,initiatorTimeoutId:c(),longRunnerTimeoutId:setTimeout(function(){m.tooLate=true;m.pending=false;o._oLogger.trace("Long-running promise is ignored:"+b(m));},o._mConfig.maxDelay,'TIMEOUT_WAITER_IGNORE')};o._oLogger.trace("New pending promise:"+b(m));p.push(m);return m;}function f(m){if(!m){return;}m.completorTimeoutId=d();m.endTime=Date.now();if(m.tooLate){return;}else{m.pending=false;o._oLogger.trace("Promise complete:"+b(m));clearTimeout(m.longRunnerTimeoutId);}}function g(C){if(C.initiatorTimeoutId&&a._isPolling(C.initiatorTimeoutId)){o._oLogger.trace("Polling promise is ignored:"+b(C));return true;}return false;}var h=function(i){var m;var w=function(l,n){var A=_.functionToString(i);if(window.ES6Promise&&A==="'function noop() {}'"){o._oLogger.trace("Ignoring internal constructor of ES6 Promise polyfill");return i(l,n);}else if(A==="'function () { [native code] }'"){o._oLogger.trace("Ignoring internal Promise constructor");return i(l,n);}else{m=e(A);var r=function v(){f(m);l.apply(this,arguments);};var u=function v(){f(m);n.apply(this,arguments);};return i(r,u);}};var j=new O(w);function k(l){var n=l.then;l.then=function y(r,u){var v=r;if(r){var v=function v(){t=m;var z=r.apply(this,arguments);t=undefined;return z;};}var x=n.apply(this,[v,u]);return x;};return l;}return k(j);};h.prototype=O.prototype;h.prototype.constructor=h;s.forEach(function(F){if(O[F]){h[F]=O[F];}});window.Promise=h;return o;},true);
