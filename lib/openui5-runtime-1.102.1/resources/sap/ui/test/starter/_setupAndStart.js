/*!
 * OpenUI5
 * (c) Copyright 2009-2022 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/base/util/UriParameters","./_utils"],function(U,u){"use strict";var h=Function.prototype.call.bind(Object.prototype.hasOwnProperty);function m(b){return Array.isArray(b)?b:[b];}function r(d){return new Promise(function(b,e){sap.ui.require(m(d),function(){b(Array.prototype.slice.call(arguments));},e);});}function c(b,d,f){if(d){for(var k in d){if(h(f,k)){b[k]=d[k];}}}return b;}function a(){function b(d){if(document.body.querySelector("#"+d)==null){var e=document.createElement("div");e.id=d;document.body.insertBefore(e,document.body.firstChild);}}return u.whenDOMReady().then(function(){b("qunit");b("qunit-fixture");});}function o(e){var l=e.sourceFile+":"+e.lineNumber+":"+e.columnNumber,b="Security policy violation: directive '"+e.violatedDirective+"'";if(e.blockedURI){b+=" violated by '"+String(e.blockedURI).slice(0,20)+"'";}if(QUnit.config.current){QUnit.pushFailure(b,l);}else{throw new Error(b+" at "+l);}}var Q={altertitle:1,collapse:1,filter:1,fixture:1,hidepassed:1,maxDepth:1,module:1,moduleId:1,notrycatch:1,noglobals:1,seed:1,reorder:1,requireExpects:1,testId:1,testTimeout:1,scrolltop:1};function g(b,d){var v=b.versions;var e=b.version||null;while(typeof e!=="object"){if(!h(v,e)){throw new TypeError("unsupported "+d+" version "+b.version);}e=v[e];}return e;}function i(C){var b,d,e,f,j,k,l,q,J;document.title=C.title;if(C.loader){sap.ui.loader.config(C.loader);}if(C.runAfterLoader){b=r(C.runAfterLoader);}else{b=Promise.resolve();}q=g(C.qunit,"qunit");if(q!=null){window.QUnit=window.QUnit||{};QUnit.config=QUnit.config||{};if(C.qunit!=null&&typeof C.qunit==='object'){c(QUnit.config,C.qunit,Q);}QUnit.config.autostart=false;d=b.then(function(){return r("sap/ui/test/qunitPause");}).then(function(){u.addStylesheet(q.css);return r(q.module);}).then(function(){J=[];QUnit.jUnitDone=function(n){J.push(n);};return r("sap/ui/qunit/qunit-junit");}).then(function(){delete QUnit.jUnitDone;return r("sap/ui/thirdparty/qunit-reporter-junit");}).then(function(){J.forEach(function(n){QUnit.jUnitDone(n);});J=undefined;});}var S=g(C.sinon,"sinon");if(S!=null){e=b.then(function(){return r(S.module);});if(C.sinon.qunitBridge&&d){f=Promise.all([d,e]).then(function(){return r(S.bridge);});}if(C.sinon!=null&&typeof C.sinon==='object'){j=Promise.all([e,f]).then(function(){sinon.config=c(sinon.config||{},C.sinon,sinon.defaultConfig);return arguments;});}}else if(q!=null){sap.ui.loader.config({shim:{"sap/ui/thirdparty/sinon-qunit":{deps:[q.module,"sap/ui/thirdparty/sinon"]},"sap/ui/qunit/sinon-qunit-bridge":{deps:[q.module,"sap/ui/thirdparty/sinon-4"]}}});}k=d.then(function(){if(QUnit.urlParams.coverage){return r("sap/ui/thirdparty/blanket").then(function(){if(C.coverage&&window.blanket){if(C.coverage.only!=null){window.blanket.options("sap-ui-cover-only",C.coverage.only);}if(C.coverage.never!=null){window.blanket.options("sap-ui-cover-never",C.coverage.never);}if(C.coverage.branchTracking){window.blanket.options("branchTracking",true);}}return r("sap/ui/qunit/qunit-coverage");}).then(function(){QUnit.config.autostart=false;});}else{return r(["sap/ui/qunit/qunit-coverage"]);}}).then(function(){if(QUnit.urlParams["sap-ui-xx-csp-policy"]){document.addEventListener("securitypolicyviolation",o);QUnit.done(function(){document.removeEventListener("securitypolicyviolation",o);});}QUnit.config.urlConfig.push({id:"sap-ui-xx-csp-policy",label:"CSP",value:{"sap-target-level-1:report-only":"Level 1","sap-target-level-2:report-only":"Level 2"},tooltip:"What Content-Security-Policy should the server send"});if(QUnit.urlParams["rtf"]||QUnit.urlParams["repeat-to-failure"]){QUnit.done(function(n){if(n.failed===0){setTimeout(function(){location.reload();},100);}});}QUnit.config.urlConfig.push({id:"repeat-to-failure",label:"Repeat",value:false,tooltip:"Whether this test should auto-repeat until it fails"});});l=Promise.all([b,d,e,f,j,k]);if(C.beforeBootstrap){l=l.then(function(){return r(C.beforeBootstrap);});}window["sap-ui-config"]=C.ui5||{};if(Array.isArray(window["sap-ui-config"].libs)){window["sap-ui-config"].libs=window["sap-ui-config"].libs.join(",");}window["sap-ui-test-config"]=C.testConfig||{};if(C.bootCore){l=l.then(function(){return new Promise(function(n,v){sap.ui.require(["sap/ui/core/Core"],function(w){w.boot();w.attachInit(n);},v);});});}return l.then(function(){if(C.autostart){return r(C.module).then(function(T){return Promise.all(T);}).then(function(){return a();}).then(function(){if(C.ui5["xx-waitfortheme"]==="init"){return new Promise(function(n,v){sap.ui.require(["sap/ui/qunit/utils/waitForThemeApplied"],n,v);}).then(function(w){return w();});}}).then(function(){QUnit.start();});}else{return a().then(function(){return r(C.module).then(function(T){return Promise.all(T);});});}});}var p=U.fromQuery(window.location.search),s=u.getAttribute('data-sap-ui-testsuite')||p.get("testsuite"),t=u.getAttribute('data-sap-ui-test')||p.get("test");u.getSuiteConfig(s).then(function(S){var T=S.tests[t];if(!T){throw new TypeError("Invalid test name");}return i(T);}).catch(function(e){console.error(e.stack||e);if(typeof QUnit!=="undefined"){QUnit.test("Test Starter",function(){throw e;});QUnit.start();}else{u.whenDOMReady().then(function(){document.body.style.color="red";document.body.innerHTML="<pre>"+u.encode(e.stack||e.message||String(e))+"</pre>";});}});});
