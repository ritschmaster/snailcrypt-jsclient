/*!
 * OpenUI5
 * (c) Copyright 2009-2022 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(['sap/ui/thirdparty/URI','sap/ui/Device','sap/ui/test/_LogCollector',"sap/base/Log","sap/ui/thirdparty/jquery",'sap/base/util/ObjectPath'],function(U,D,_,L,q,O){"use strict";var a=1280;var b=1024;var f=null,F=null,$=null,o=null,c=null,d=null,r=false,u=false,A=null,e=null,s,g;function h(){f=F[0].contentWindow;k();l();}function j(W,H){if(W){F.css("width",W);$.css("padding-left",W);}else{F.css("width",a);F.addClass("default-scale-x");}if(H){F.css("height",H);}else{F.css("height",b);F.addClass("default-scale-y");}if(!W&&!H){F.addClass("default-scale-both");}}function k(){var i=f.onerror;f.onerror=function(E,z,B,C,G){var R=false;if(i){R=i.apply(this,arguments);}setTimeout(function(){var H=C?"\ncolumn: "+C:"";var I=G&&"\niFrame error: "+(G.stack?G.message+"\n"+G.stack:G)||"";throw new Error("Error in launched application iFrame: "+E+"\nurl: "+z+"\nline: "+B+H+I);},0);return R;};}function l(){if(u){return true;}if(f&&f.sap&&f.sap.ui&&f.sap.ui.getCore){if(!r){f.sap.ui.getCore().attachInit(n);}r=true;}return u;}function m(i){f.sap.ui.require(["sap/ui/thirdparty/sinon"],function(z){if(!z){setTimeout(function(){m(i);},50);}else{i();}});}function n(){t();if(D.browser.firefox){m(w);}else{w();}}function p(){d.sap.log.addLogListener(_.getInstance()._oListener);u=true;}function t(){d=f.jQuery;x("sap/ui/test");x("sap/ui/qunit");x("sap/ui/thirdparty");}function v(i,H,z){var B=new z(),C=new H(B),E=i.setHash,G=i.getHash,I,K=false,J=f.history.go;i.replaceHash=function(P){K=true;var Q=this.getHash();I=P;B.fireEvent("hashReplaced",{sHash:P});this.changed.dispatch(P,Q);};i.setHash=function(P){K=true;var R=G.call(this);I=P;B.fireEvent("hashSet",{sHash:P});E.apply(this,arguments);if(R===this.getHash()){this.changed.dispatch(R,C.aHistory[C.iHistoryPosition]);}};i.getHash=function(){if(I===undefined){return G.apply(this,arguments);}return I;};i.changed.add(function(P){if(!K){B.fireEvent("hashSet",{sHash:P});I=P;}K=false;});B.init();function M(){K=true;var P=C.aHistory[C.iHistoryPosition],Q=C.getPreviousHash();I=Q;i.changed.dispatch(Q,P);}function N(){K=true;var P=C.aHistory[C.iHistoryPosition+1],Q=C.aHistory[C.iHistoryPosition];if(P===undefined){L.error("Could not navigate forwards, there is no history entry in the forwards direction",this);return;}I=P;i.changed.dispatch(P,Q);}f.history.back=M;f.history.forward=N;f.history.go=function(S){if(S===-1){M();return;}else if(S===1){N();return;}L.error("Using history.go with a number greater than 1 is not supported by OPA5",this);return J.apply(f.history,arguments);};}function w(){f.sap.ui.require(["sap/ui/test/OpaPlugin","sap/ui/test/autowaiter/_autoWaiter","sap/ui/test/_OpaLogger","sap/ui/qunit/QUnitUtils","sap/ui/thirdparty/hasher","sap/ui/core/routing/History","sap/ui/core/routing/HashChanger"],function(i,z,B,Q,C,H,E){B.setLevel(s);o=new i();A=z;c=Q;if(!g){v(C,H,E);}e=E;p();});}function x(R){var i=sap.ui.require.toUrl(R);var z=new U(i).absoluteTo(document.baseURI).search("").toString();var C=O.get("sap.ui._ui5loader.config",f)||O.get("sap.ui.loader.config",f);if(C){var B={};B[R]=z;C({paths:B});}else if(d&&d.sap&&d.sap.registerResourcePath){d.sap.registerResourcePath(R,z);}else{throw new Error("iFrameLauncher.js: UI5 module system not found.");}}function y(){if(!f){throw new Error("sap.ui.test.launchers.iFrameLauncher: Teardown was called before launch. No iFrame was loaded.");}f.onerror=q.noop;for(var i=0;i<F.length;i++){F[0].src="about:blank";F[0].contentWindow.document.write('');F[0].contentWindow.close();}if(typeof CollectGarbage=="function"){CollectGarbage();}F.remove();$.remove();d=null;o=null;c=null;f=null;u=false;r=false;A=null;e=null;}return{launch:function(i){if(f){throw new Error("sap.ui.test.launchers.iFrameLauncher: Launch was called twice without teardown. Only one iFrame may be loaded at a time.");}F=q("#"+i.frameId);if(F.length){$=q(".opaFrameContainer");}else{if(!i.source){L.error("No source was given to launch the IFrame",this);}$=q("<div class='opaFrameContainer'></div>");F=q('<IFrame id="'+i.frameId+'" class="opaFrame" src="'+i.source+'"></IFrame>');$.append(F);q("body").append($);j(i.width,i.height);}if(F[0].contentDocument&&F[0].contentDocument.readyState==="complete"){h();}else{F.on("load",h);}s=i.opaLogLevel;g=i.disableHistoryOverride;return l();},hasLaunched:function(){l();return u;},teardown:function(){y();},getHashChanger:function(){if(!e){return null;}return e.getInstance();},getPlugin:function(){return o;},getJQuery:function(){return d;},getUtils:function(){return c;},getWindow:function(){return f;},_getAutoWaiter:function(){return A;}};},true);
