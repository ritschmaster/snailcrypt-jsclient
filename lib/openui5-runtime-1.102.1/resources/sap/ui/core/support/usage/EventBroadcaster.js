/*!
 * OpenUI5
 * (c) Copyright 2009-2022 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(['sap/base/Log','../../Component','../../Element','../../routing/Router'],function(L,C,E,R){"use strict";var a={};var b={global:["modelContextChange","beforeRendering","afterRendering","propertyChanged","beforeGeometryChanged","geometryChanged","aggregationChanged","componentCreated","afterInit","updateStarted","updateFinished","load","scroll"],controls:{}};a.getEventsExcludeList=function(){return JSON.parse(JSON.stringify(b));};a.setEventsExcludeList=function(c){if(this._isValidConfig(c)){b=JSON.parse(JSON.stringify(c));}else{if(L.isLoggable()){L.error("Provided ExcludeList configuration is not valid. Continuing to use previously/default set configuration.");}}};a.enable=function(){E._interceptEvent=function(e,o,p){a.broadcastEvent(e,o,p);};R._interceptRouteMatched=function(c,r){a.broadcastRouteMatched(R.M_EVENTS.ROUTE_MATCHED,c,r);};};a.disable=function(){if(E._interceptEvent){delete E._interceptEvent;}if(R._interceptRouteMatched){delete R._interceptRouteMatched;}};a.broadcastEvent=function(e,o,p){var t=new Date();setTimeout(function(){var d={},c;if(a._shouldExpose(e,o)){c=a._createOwnerComponentInfo(o);d={componentId:c.id,componentVersion:c.version,eventName:e,targetId:o.getId(),targetType:o.getMetadata().getName(),timestamp:t.getTime()};if(L.isLoggable()){L.debug("EventBroadcaster: Broadcast Event: ",JSON.stringify(d));}d.additionalAttributes=p;a._dispatchCustomEvent(d);}});};a.broadcastRouteMatched=function(e,s,r){var t=new Date();setTimeout(function(){var c=a._createOwnerComponentInfo(sap.ui.getCore().byId(s)),d={componentId:c.id,componentVersion:c.version,eventName:e,targetId:s,targetType:"sap.ui.core.routing.Router",timestamp:t.getTime(),additionalAttributes:{fullURL:document&&document.baseURI,hash:r.getHashChanger().getHash(),previousHash:a._previousHash}};a._previousHash=d.additionalAttributes.hash;if(L.isLoggable()){L.debug("EventBroadcaster: Broadcast Route Matched: ",JSON.stringify(d));}a._dispatchCustomEvent(d);});};a._dispatchCustomEvent=function(d){var c=new window.CustomEvent("UI5Event",{detail:d});window.dispatchEvent(c);};a._shouldExpose=function(e,o){var c=a.getEventsExcludeList(),d=c.global.indexOf(e)===-1&&a._isPublicElementEvent(e,o),f=a._isTrackableControlEvent(c,e,o);return d&&f;};a._isTrackableControlEvent=function(c,e,o){var d,i,t=true,n=o.getMetadata().getName();if(c.controls[n]){d=c.controls[n].exclude;i=c.controls[n].include;if(!d&&!i){t=false;}if(i&&i.indexOf(e)>-1){t=true;}if(d&&d.indexOf(e)>-1){t=false;}}return t;};a._isPublicElementEvent=function(e,o){return o.getMetadata().hasEvent(e);};a._isValidConfig=function(c){var g=c.hasOwnProperty("global"),d=c.hasOwnProperty("controls");return g&&d;};a._createOwnerComponentInfo=function(s){var i,v,c,A;if(s){while(s&&s.getParent){c=C.getOwnerComponentFor(s);if(c||s.getMetadata().isA("sap.ui.core.Component")){c=c||s;A=c.getManifestEntry("sap.app");i=A&&A.id||c.getMetadata().getName();v=A&&A.applicationVersion&&A.applicationVersion.version;}s=s.getParent();}}return{id:i||"undetermined",version:v||""};};return a;});
