/*!
 * OpenUI5
 * (c) Copyright 2009-2022 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/base/Log","sap/base/util/ObjectPath","sap/ui/core/mvc/View","sap/ui/core/Component"],function(L,O,V,C){"use strict";sap.ui.extensionpoint=function(c,e,f,t,a){L.warning("Do not use deprecated factory function 'sap.ui.extensionpoint'. Use 'sap.ui.core.ExtensionPoint.load' instead","sap.ui.extensionpoint",null,function(){return{type:"sap.ui.extensionpoint",name:e};});return E._factory(c,e,f,t,a);};var E=sap.ui.extensionpoint||{};E._factory=function(c,e,f,t,a,A){var o,v,r,s;if(c){if(c.isA("sap.ui.core.mvc.View")){s=c.sViewName;v=c;}else if(c.isA("sap.ui.core.Fragment")){s=c.getFragmentName();v=c._oContainingView;}o=C.getCustomizing(c,{type:"sap.ui.viewExtensions",name:s,extensionName:e});}if(o){if(o.className){L.info("Customizing: View extension found for extension point '"+e+"' in View '"+v.sViewName+"': "+o.className+": "+(o.viewName||o.fragmentName));var I=v&&o.id?v.createId(o.id):o.id;var F={async:A,id:I,type:o.type};if(A&&v._sProcessingMode){F.processingMode=v._sProcessingMode;}if(o.className==="sap.ui.core.Fragment"){var b=sap.ui.require("sap/ui/core/Fragment");F.fragmentName=o.fragmentName;F.containingView=v;if(A){if(b){r=b.load(F);}else{r=new Promise(function(R,i){sap.ui.require(["sap/ui/core/Fragment"],function(b){R(b.load(F));},i);});}}else{b=b||sap.ui.requireSync("sap/ui/core/Fragment");var d=new b(F);r=(Array.isArray(d)?d:[d]);}}else if(o.className==="sap.ui.core.mvc.View"){F.viewName=o.viewName;var g=V._create(F);if(A){r=g.loaded();}else{r=[g];}}else{L.warning("Customizing: Unknown extension className configured (and ignored) in Component.js for extension point '"+e+"' in View '"+v.sViewName+"': "+o.className);}}else{L.warning("Customizing: no extension className configured in Component.js for extension point '"+e+"' in View '"+v.sViewName+"': "+o.className);}}else if(E._fnExtensionProvider){var h=E._fnExtensionProvider(v);var j;if(v.isA("sap.ui.core.Fragment")){j=v._sExplicitId;var k=v.getController();v=k&&typeof k.isA==="function"&&k.isA("sap.ui.core.mvc.Controller")&&k.getView();if(v){j=v.getLocalId(j)||j;}}if(h){if(!v){L.warning("View instance could not be passed to ExtensionPoint Provider for extension point '"+e+"' "+"in fragment '"+j+"'.");}return[{providerClass:h,view:v,fragmentId:j,name:e,createDefault:f,targetControl:undefined,aggregationName:undefined,index:undefined,ready:function(i){var n=this._nextSibling;while(n!=null){n.index+=i.length;n=n._nextSibling;}this._aControls=i;},_aControls:[],_isExtensionPoint:true,_nextSibling:null}];}}if(!r&&typeof f==='function'){r=f();}var p=function(r){if(r&&!Array.isArray(r)){r=[r];}if(r&&t){var m=t.getMetadata().getAggregation(a);if(m){for(var i=0,l=r.length;i<l;i++){t[m._sMutator](r[i]);}}else{L.error("Creating extension point failed - Tried to add extension point with name "+e+" to an aggregation of "+t.getId()+" in view "+v.sViewName+", but sAggregationName was not provided correctly and I could not find a default aggregation");}}return r||[];};if(r&&typeof r.then==='function'){return r.then(p);}else{return p(r);}};E.registerExtensionProvider=function(e){if(e==null){delete E._fnExtensionProvider;}else if(typeof e=="function"){E._fnExtensionProvider=e;}else{L.error("ExtensionPoint provider must be a function!");}};E.load=function(o){return Promise.resolve(E._factory(o.container,o.name,o.createDefaultContent,null,null,!!o.async));};return E;});
